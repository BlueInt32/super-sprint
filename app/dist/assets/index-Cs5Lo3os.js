const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-BaksmmF0.js","assets/webworkerAll--16mRO_9.js","assets/colorToUniform-DhkOguHj.js","assets/WebGPURenderer-YwIOS9WJ.js","assets/SharedSystems-CK9mx515.js","assets/WebGLRenderer-Bd0aKfEZ.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var Ot={consts:{METER:100,STAGE_WIDTH_PIXEL:1e3,STAGE_HEIGHT_PIXEL:750,DEGTORAD:2*Math.PI/360},tracks:[{id:0,nbCheckpoints:3,jsonPath:"assets/tracks/track0.json",imagePath:"assets/tracks/images/track0.png"},{id:1,nbCheckpoints:3,jsonPath:"assets/tracks/track1.json",imagePath:"assets/tracks/images/track1.png"}],cars:[{width:40,height:25,spritePath:"assets/ship/right.001.png",jsonPath:"assets/cars/car0.json",probesSystemPath:"assets/cars/probeSystem0.json",accelerationFactor:.038,driftTrigger:.002,driftTriggerWithHandbrake:.001,natural_deceleration:.01,steeringWheelSpeed:200,wheelMaxAngle:20,normalAdherenceFactor:1,driftAdherenceFactor:.08,restitution:.1,puddleFactor:.005}],defaultSetup:{trackId:0,carIds:[0,0]},technical:{debugDraw:!1},atlas:"assets/atlas.json",spritesMapping:{ships:[{still:"right.001.png",turnRight:{path:"right.0##.png",frames:20,offset:0},turnLeft:{path:"left.0##.png",frames:20,offset:40}}]}};const hh="modulepreload",uh=function(i){return"/"+i},to={},fr=function(t,e,r){let n=Promise.resolve();if(e&&e.length>0){let l=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");n=l(e.map(c=>{if(c=uh(c),c in to)return;to[c]=!0;const f=c.endsWith(".css"),_=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${_}`))return;const x=document.createElement("link");if(x.rel=f?"stylesheet":hh,f||(x.as="script"),x.crossOrigin="",x.href=c,o&&x.setAttribute("nonce",o),document.head.appendChild(x),f)return new Promise((y,M)=>{x.addEventListener("load",y),x.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})};var wt=(i=>(i.Application="application",i.WebGLPipes="webgl-pipes",i.WebGLPipesAdaptor="webgl-pipes-adaptor",i.WebGLSystem="webgl-system",i.WebGPUPipes="webgpu-pipes",i.WebGPUPipesAdaptor="webgpu-pipes-adaptor",i.WebGPUSystem="webgpu-system",i.CanvasSystem="canvas-system",i.CanvasPipesAdaptor="canvas-pipes-adaptor",i.CanvasPipes="canvas-pipes",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i.MaskEffect="mask-effect",i.BlendMode="blend-mode",i.TextureSource="texture-source",i.Environment="environment",i.ShapeBuilder="shape-builder",i.Batcher="batcher",i))(wt||{});const ms=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},qi=(i,t)=>ms(i).priority??t,ue={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(ms).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...i){return i.map(ms).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,n=this._queue;r[e]?r[e]?.(t):(n[e]=n[e]||[],n[e]?.push(t))})}),this},handle(i,t,e){const r=this._addHandlers,n=this._removeHandlers;if(r[i]||n[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,n[i]=e;const s=this._queue;return s[i]&&(s[i]?.forEach(a=>t(a)),delete s[i]),this},handleByMap(i,t){return this.handle(i,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(i,t,e=-1){return this.handle(i,r=>{t.findIndex(s=>s.name===r.name)>=0||(t.push({name:r.name,value:r.ref}),t.sort((s,a)=>qi(a.value,e)-qi(s.value,e)))},r=>{const n=t.findIndex(s=>s.name===r.name);n!==-1&&t.splice(n,1)})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((n,s)=>qi(s,e)-qi(n,e)))},r=>{const n=t.indexOf(r.ref);n!==-1&&t.splice(n,1)})},mixin(i,...t){for(const e of t)Object.defineProperties(i.prototype,Object.getOwnPropertyDescriptors(e))}},fh={extension:{type:wt.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await fr(()=>import("./browserAll-BaksmmF0.js"),__vite__mapDeps([0,1,2]))}},ph={extension:{type:wt.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await fr(()=>import("./webworkerAll--16mRO_9.js"),__vite__mapDeps([1,2]))}};class fe{constructor(t,e,r){this._x=e||0,this._y=r||0,this._observer=t}clone(t){return new fe(t??this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}var Oe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fs(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function mh(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var t=i.default;if(typeof t=="function"){var e=function r(){var n=!1;try{n=this instanceof r}catch{}return n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),e}var Er={exports:{}},eo;function dh(){return eo||(eo=1,(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function n(l,c,f){this.fn=l,this.context=c,this.once=f||!1}function s(l,c,f,_,x){if(typeof f!="function")throw new TypeError("The listener must be a function");var y=new n(f,_||l,x),M=e?e+c:c;return l._events[M]?l._events[M].fn?l._events[M]=[l._events[M],y]:l._events[M].push(y):(l._events[M]=y,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],f,_;if(this._eventsCount===0)return c;for(_ in f=this._events)t.call(f,_)&&c.push(e?_.slice(1):_);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(f)):c},o.prototype.listeners=function(c){var f=e?e+c:c,_=this._events[f];if(!_)return[];if(_.fn)return[_.fn];for(var x=0,y=_.length,M=new Array(y);x<y;x++)M[x]=_[x].fn;return M},o.prototype.listenerCount=function(c){var f=e?e+c:c,_=this._events[f];return _?_.fn?1:_.length:0},o.prototype.emit=function(c,f,_,x,y,M){var G=e?e+c:c;if(!this._events[G])return!1;var h=this._events[G],v=arguments.length,C,E;if(h.fn){switch(h.once&&this.removeListener(c,h.fn,void 0,!0),v){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,f),!0;case 3:return h.fn.call(h.context,f,_),!0;case 4:return h.fn.call(h.context,f,_,x),!0;case 5:return h.fn.call(h.context,f,_,x,y),!0;case 6:return h.fn.call(h.context,f,_,x,y,M),!0}for(E=1,C=new Array(v-1);E<v;E++)C[E-1]=arguments[E];h.fn.apply(h.context,C)}else{var k=h.length,J;for(E=0;E<k;E++)switch(h[E].once&&this.removeListener(c,h[E].fn,void 0,!0),v){case 1:h[E].fn.call(h[E].context);break;case 2:h[E].fn.call(h[E].context,f);break;case 3:h[E].fn.call(h[E].context,f,_);break;case 4:h[E].fn.call(h[E].context,f,_,x);break;default:if(!C)for(J=1,C=new Array(v-1);J<v;J++)C[J-1]=arguments[J];h[E].fn.apply(h[E].context,C)}}return!0},o.prototype.on=function(c,f,_){return s(this,c,f,_,!1)},o.prototype.once=function(c,f,_){return s(this,c,f,_,!0)},o.prototype.removeListener=function(c,f,_,x){var y=e?e+c:c;if(!this._events[y])return this;if(!f)return a(this,y),this;var M=this._events[y];if(M.fn)M.fn===f&&(!x||M.once)&&(!_||M.context===_)&&a(this,y);else{for(var G=0,h=[],v=M.length;G<v;G++)(M[G].fn!==f||x&&!M[G].once||_&&M[G].context!==_)&&h.push(M[G]);h.length?this._events[y]=h.length===1?h[0]:h:a(this,y)}return this},o.prototype.removeAllListeners=function(c){var f;return c?(f=e?e+c:c,this._events[f]&&a(this,f)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,i.exports=o})(Er)),Er.exports}var yh=dh();const Re=Fs(yh),_h=Math.PI*2,gh=180/Math.PI,xh=Math.PI/180;class pe{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new pe(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return Rr.x=0,Rr.y=0,Rr}}const Rr=new pe;class Bt{constructor(t=1,e=0,r=0,n=1,s=0,a=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,n,s,a){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new pe;const r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e}applyInverse(t,e){e=e||new pe;const r=this.a,n=this.b,s=this.c,a=this.d,o=this.tx,l=this.ty,c=1/(r*a+s*-n),f=t.x,_=t.y;return e.x=a*c*f+-s*c*_+(l*s-o*a)*c,e.y=r*c*_+-n*c*f+(-l*r+o*n)*c,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.a,s=this.c,a=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=s*e-this.d*r,this.d=s*r+this.d*e,this.tx=a*e-this.ty*r,this.ty=a*r+this.ty*e,this}append(t){const e=this.a,r=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*s+this.ty,this}appendFrom(t,e){const r=t.a,n=t.b,s=t.c,a=t.d,o=t.tx,l=t.ty,c=e.a,f=e.b,_=e.c,x=e.d;return this.a=r*c+n*_,this.b=r*f+n*x,this.c=s*c+a*_,this.d=s*f+a*x,this.tx=o*c+l*_+e.tx,this.ty=o*f+l*x+e.ty,this}setTransform(t,e,r,n,s,a,o,l,c){return this.a=Math.cos(o+c)*s,this.b=Math.sin(o+c)*s,this.c=-Math.sin(o-l)*a,this.d=Math.cos(o-l)*a,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,n=this.c,s=this.d,a=t.pivot,o=-Math.atan2(-n,s),l=Math.atan2(r,e),c=Math.abs(o+l);return c<1e-5||Math.abs(_h-c)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=l),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(a.x*e+a.y*n),t.position.y=this.ty+(a.x*r+a.y*s),t}invert(){const t=this.a,e=this.b,r=this.c,n=this.d,s=this.tx,a=t*n-e*r;return this.a=n/a,this.b=-e/a,this.c=-r/a,this.d=t/a,this.tx=(r*this.ty-n*s)/a,this.ty=-(t*this.ty-e*s)/a,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Bt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return bh.identity()}static get shared(){return vh.identity()}}const vh=new Bt,bh=new Bt,Ze=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Qe=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],je=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],ti=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],ds=[],Bl=[],Hi=Math.sign;function wh(){for(let i=0;i<16;i++){const t=[];ds.push(t);for(let e=0;e<16;e++){const r=Hi(Ze[i]*Ze[e]+je[i]*Qe[e]),n=Hi(Qe[i]*Ze[e]+ti[i]*Qe[e]),s=Hi(Ze[i]*je[e]+je[i]*ti[e]),a=Hi(Qe[i]*je[e]+ti[i]*ti[e]);for(let o=0;o<16;o++)if(Ze[o]===r&&Qe[o]===n&&je[o]===s&&ti[o]===a){t.push(o);break}}}for(let i=0;i<16;i++){const t=new Bt;t.set(Ze[i],Qe[i],je[i],ti[i],0,0),Bl.push(t)}}wh();const Lt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Ze[i],uY:i=>Qe[i],vX:i=>je[i],vY:i=>ti[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>ds[i][t],sub:(i,t)=>ds[i][Lt.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?Lt.S:Lt.N:Math.abs(t)*2<=Math.abs(i)?i>0?Lt.E:Lt.W:t>0?i>0?Lt.SE:Lt.SW:i>0?Lt.NE:Lt.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const n=Bl[Lt.inv(t)];n.tx=e,n.ty=r,i.append(n)},transformRectCoords:(i,t,e,r)=>{const{x:n,y:s,width:a,height:o}=i,{x:l,y:c,width:f,height:_}=t;return e===Lt.E?(r.set(n+l,s+c,a,o),r):e===Lt.S?r.set(f-s-o+l,n+c,o,a):e===Lt.W?r.set(f-n-a+l,_-s-o+c,a,o):e===Lt.N?r.set(s+l,_-n-a+c,o,a):r.set(n+l,s+c,a,o)}},$i=[new pe,new pe,new pe,new pe];class Zt{constructor(t=0,e=0,r=0,n=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new Zt(0,0,0,0)}clone(){return new Zt(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}strokeContains(t,e,r,n=.5){const{width:s,height:a}=this;if(s<=0||a<=0)return!1;const o=this.x,l=this.y,c=r*(1-n),f=r-c,_=o-c,x=o+s+c,y=l-c,M=l+a+c,G=o+f,h=o+s-f,v=l+f,C=l+a-f;return t>=_&&t<=x&&e>=y&&e<=M&&!(t>G&&t<h&&e>v&&e<C)}intersects(t,e){if(!e){const $=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=$)return!1;const K=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>K}const r=this.left,n=this.right,s=this.top,a=this.bottom;if(n<=r||a<=s)return!1;const o=$i[0].set(t.left,t.top),l=$i[1].set(t.left,t.bottom),c=$i[2].set(t.right,t.top),f=$i[3].set(t.right,t.bottom);if(c.x<=o.x||l.y<=o.y)return!1;const _=Math.sign(e.a*e.d-e.b*e.c);if(_===0||(e.apply(o,o),e.apply(l,l),e.apply(c,c),e.apply(f,f),Math.max(o.x,l.x,c.x,f.x)<=r||Math.min(o.x,l.x,c.x,f.x)>=n||Math.max(o.y,l.y,c.y,f.y)<=s||Math.min(o.y,l.y,c.y,f.y)>=a))return!1;const x=_*(l.y-o.y),y=_*(o.x-l.x),M=x*r+y*s,G=x*n+y*s,h=x*r+y*a,v=x*n+y*a;if(Math.max(M,G,h,v)<=x*o.x+y*o.y||Math.min(M,G,h,v)>=x*f.x+y*f.y)return!1;const C=_*(o.y-c.y),E=_*(c.x-o.x),k=C*r+E*s,J=C*n+E*s,N=C*r+E*a,H=C*n+E*a;return!(Math.max(k,J,N,H)<=C*o.x+E*o.y||Math.min(k,J,N,H)>=C*f.x+E*f.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this}scale(t,e=t){return this.x*=t,this.y*=e,this.width*=t,this.height*=e,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=s-n,this}getBounds(t){return t||(t=new Zt),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,r=t.y,n=t.x+t.width,s=t.y+t.height;return e>=this.x&&e<this.x+this.width&&r>=this.y&&r<this.y+this.height&&n>=this.x&&n<this.x+this.width&&s>=this.y&&s<this.y+this.height}set(t,e,r,n){return this.x=t,this.y=e,this.width=r,this.height=n,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const Fr={default:-1};function Kt(i="default"){return Fr[i]===void 0&&(Fr[i]=-1),++Fr[i]}const io=new Set,ae="8.0.0",Sh="8.3.4",li={quiet:!1,noColor:!1},Gt=(i,t,e=3)=>{if(li.quiet||io.has(t))return;let r=new Error().stack;const n=`${t}
Deprecated since v${i}`,s=typeof console.groupCollapsed=="function"&&!li.noColor;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",n):(r=r.split(`
`).splice(e).join(`
`),s?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",n),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",n),console.warn(r))),io.add(t)};Object.defineProperties(Gt,{quiet:{get:()=>li.quiet,set:i=>{li.quiet=i},enumerable:!0,configurable:!1},noColor:{get:()=>li.noColor,set:i=>{li.noColor=i},enumerable:!0,configurable:!1}});const Tl=()=>{};function pr(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function ro(i){return!(i&i-1)&&!!i}function Il(i){const t={};for(const e in i)i[e]!==void 0&&(t[e]=i[e]);return t}const no=Object.create(null);function Ch(i){const t=no[i];return t===void 0&&(no[i]=Kt("resource")),t}const Dl=class El extends Re{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...El.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){Gt(ae,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=Ch(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};Dl.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let mr=Dl;const Rl=class Fl extends Re{constructor(t={}){super(),this.options=t,this.uid=Kt("textureSource"),this._resourceType="textureSource",this._resourceId=Kt("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...Fl.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new mr(Il(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){this.style!==t&&(this._style?.off("change",this._onStyleChange,this),this._style=t,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(t){this._style.maxAnisotropy=t}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=Kt("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,r){r||(r=this._resolution),t||(t=this.width),e||(e=this.height);const n=Math.round(t*r),s=Math.round(e*r);return this.width=n/r,this.height=s/r,this._resolution=r,this.pixelWidth===n&&this.pixelHeight===s?!1:(this._refreshPOT(),this.pixelWidth=n,this.pixelHeight=s,this.emit("resize",this),this._resourceId=Kt("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=ro(this.pixelWidth)&&ro(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};Rl.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let Fe=Rl;class ks extends Fe{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let r=t.format;r||(e instanceof Float32Array?r="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?r="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?r="rgba16uint":(e instanceof Int8Array,r="bgra8unorm")),super({...t,resource:e,format:r}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}ks.extension=wt.TextureSource;const so=new Bt;class Ah{constructor(t,e){this.mapCoord=new Bt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof e>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){this.texture!==t&&(this._texture?.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],a=t[n+1];e[n]=s*r.a+a*r.c+r.tx,e[n+1]=s*r.b+a*r.d+r.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const r=t.orig,n=t.trim;n&&(so.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(so));const s=t.source,a=this.uClampFrame,o=this.clampMargin/s._resolution,l=this.clampOffset/s._resolution;return a[0]=(t.frame.x+o+l)/s.width,a[1]=(t.frame.y+o+l)/s.height,a[2]=(t.frame.x+t.frame.width-o+l)/s.width,a[3]=(t.frame.y+t.frame.height-o+l)/s.height,this.uClampOffset[0]=this.clampOffset/s.pixelWidth,this.uClampOffset[1]=this.clampOffset/s.pixelHeight,this.isSimple=t.frame.width===s.width&&t.frame.height===s.height&&t.rotate===0,!0}}class Pt extends Re{constructor({source:t,label:e,frame:r,orig:n,trim:s,defaultAnchor:a,defaultBorders:o,rotate:l,dynamic:c}={}){if(super(),this.uid=Kt("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new Zt,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=t?.source??new Fe,this.noFrame=!r,r)this.frame.copyFrom(r);else{const{width:f,height:_}=this._source;this.frame.width=f,this.frame.height=_}this.orig=n||this.frame,this.trim=s,this.rotate=l??0,this.defaultAnchor=a,this.defaultBorders=o,this.destroyed=!1,this.dynamic=c||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Ah(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:r,height:n}=this._source,s=e.x/r,a=e.y/n,o=e.width/r,l=e.height/n;let c=this.rotate;if(c){const f=o/2,_=l/2,x=s+f,y=a+_;c=Lt.add(c,Lt.NW),t.x0=x+f*Lt.uX(c),t.y0=y+_*Lt.uY(c),c=Lt.add(c,2),t.x1=x+f*Lt.uX(c),t.y1=y+_*Lt.uY(c),c=Lt.add(c,2),t.x2=x+f*Lt.uX(c),t.y2=y+_*Lt.uY(c),c=Lt.add(c,2),t.x3=x+f*Lt.uX(c),t.y3=y+_*Lt.uY(c)}else t.x0=s,t.y0=a,t.x1=s+o,t.y1=a,t.x2=s+o,t.y2=a+l,t.x3=s,t.y3=a+l}destroy(t=!1){this._source&&(this._source.off("resize",this.update,this),t&&(this._source.destroy(),this._source=null)),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return Gt(ae,"Texture.baseTexture is now Texture.source"),this._source}}Pt.EMPTY=new Pt({label:"EMPTY",source:new Fe({label:"EMPTY"})});Pt.EMPTY.destroy=Tl;Pt.WHITE=new Pt({source:new ks({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});Pt.WHITE.destroy=Tl;function Mh(i,t,e){const{width:r,height:n}=e.orig,s=e.trim;if(s){const a=s.width,o=s.height;i.minX=s.x-t._x*r,i.maxX=i.minX+a,i.minY=s.y-t._y*n,i.maxY=i.minY+o}else i.minX=-t._x*r,i.maxX=i.minX+r,i.minY=-t._y*n,i.maxY=i.minY+n}const oo=new Bt;class De{constructor(t=1/0,e=1/0,r=-1/0,n=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=oo,this.minX=t,this.minY=e,this.maxX=r,this.maxY=n}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new Zt);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=oo,this}set(t,e,r,n){this.minX=t,this.minY=e,this.maxX=r,this.maxY=n}addFrame(t,e,r,n,s){s||(s=this.matrix);const a=s.a,o=s.b,l=s.c,c=s.d,f=s.tx,_=s.ty;let x=this.minX,y=this.minY,M=this.maxX,G=this.maxY,h=a*t+l*e+f,v=o*t+c*e+_;h<x&&(x=h),v<y&&(y=v),h>M&&(M=h),v>G&&(G=v),h=a*r+l*e+f,v=o*r+c*e+_,h<x&&(x=h),v<y&&(y=v),h>M&&(M=h),v>G&&(G=v),h=a*t+l*n+f,v=o*t+c*n+_,h<x&&(x=h),v<y&&(y=v),h>M&&(M=h),v>G&&(G=v),h=a*r+l*n+f,v=o*r+c*n+_,h<x&&(x=h),v<y&&(y=v),h>M&&(M=h),v>G&&(G=v),this.minX=x,this.minY=y,this.maxX=M,this.maxY=G}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,r=this.minY,n=this.maxX,s=this.maxY,{a,b:o,c:l,d:c,tx:f,ty:_}=t;let x=a*e+l*r+f,y=o*e+c*r+_;this.minX=x,this.minY=y,this.maxX=x,this.maxY=y,x=a*n+l*r+f,y=o*n+c*r+_,this.minX=x<this.minX?x:this.minX,this.minY=y<this.minY?y:this.minY,this.maxX=x>this.maxX?x:this.maxX,this.maxY=y>this.maxY?y:this.maxY,x=a*e+l*s+f,y=o*e+c*s+_,this.minX=x<this.minX?x:this.minX,this.minY=y<this.minY?y:this.minY,this.maxX=x>this.maxX?x:this.maxX,this.maxY=y>this.maxY?y:this.maxY,x=a*n+l*s+f,y=o*n+c*s+_,this.minX=x<this.minX?x:this.minX,this.minY=y<this.minY?y:this.minY,this.maxX=x>this.maxX?x:this.maxX,this.maxY=y>this.maxY?y:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,r,n){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<r&&(this.minY=r),this.maxY>n&&(this.maxY=n),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new De(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,r,n){let s=this.minX,a=this.minY,o=this.maxX,l=this.maxY;n||(n=this.matrix);const c=n.a,f=n.b,_=n.c,x=n.d,y=n.tx,M=n.ty;for(let G=e;G<r;G+=2){const h=t[G],v=t[G+1],C=c*h+_*v+y,E=f*h+x*v+M;s=C<s?C:s,a=E<a?E:a,o=C>o?C:o,l=E>l?E:l}this.minX=s,this.minY=a,this.maxX=o,this.maxY=l}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var Ph={grad:.9,turn:360,rad:360/(2*Math.PI)},Ne=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},he=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},Ce=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},kl=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},ao=function(i){return{r:Ce(i.r,0,255),g:Ce(i.g,0,255),b:Ce(i.b,0,255),a:Ce(i.a)}},kr=function(i){return{r:he(i.r),g:he(i.g),b:he(i.b),a:he(i.a,3)}},Bh=/^#([0-9a-f]{3,8})$/i,Xi=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},Vl=function(i){var t=i.r,e=i.g,r=i.b,n=i.a,s=Math.max(t,e,r),a=s-Math.min(t,e,r),o=a?s===t?(e-r)/a:s===e?2+(r-t)/a:4+(t-e)/a:0;return{h:60*(o<0?o+6:o),s:s?a/s*100:0,v:s/255*100,a:n}},Ll=function(i){var t=i.h,e=i.s,r=i.v,n=i.a;t=t/360*6,e/=100,r/=100;var s=Math.floor(t),a=r*(1-e),o=r*(1-(t-s)*e),l=r*(1-(1-t+s)*e),c=s%6;return{r:255*[r,o,a,a,l,r][c],g:255*[l,r,r,o,a,a][c],b:255*[a,a,l,r,r,o][c],a:n}},lo=function(i){return{h:kl(i.h),s:Ce(i.s,0,100),l:Ce(i.l,0,100),a:Ce(i.a)}},co=function(i){return{h:he(i.h),s:he(i.s),l:he(i.l),a:he(i.a,3)}},ho=function(i){return Ll((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},Ei=function(i){return{h:(t=Vl(i)).h,s:(n=(200-(e=t.s))*(r=t.v)/100)>0&&n<200?e*r/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,r,n},Th=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ih=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Dh=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Eh=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ys={string:[[function(i){var t=Bh.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?he(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?he(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=Dh.exec(i)||Eh.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:ao({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=Th.exec(i)||Ih.exec(i);if(!t)return null;var e,r,n=lo({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(Ph[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return ho(n)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,n=i.a,s=n===void 0?1:n;return Ne(t)&&Ne(e)&&Ne(r)?ao({r:Number(t),g:Number(e),b:Number(r),a:Number(s)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,n=i.a,s=n===void 0?1:n;if(!Ne(t)||!Ne(e)||!Ne(r))return null;var a=lo({h:Number(t),s:Number(e),l:Number(r),a:Number(s)});return ho(a)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,n=i.a,s=n===void 0?1:n;if(!Ne(t)||!Ne(e)||!Ne(r))return null;var a=(function(o){return{h:kl(o.h),s:Ce(o.s,0,100),v:Ce(o.v,0,100),a:Ce(o.a)}})({h:Number(t),s:Number(e),v:Number(r),a:Number(s)});return Ll(a)},"hsv"]]},uo=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},Rh=function(i){return typeof i=="string"?uo(i.trim(),ys.string):typeof i=="object"&&i!==null?uo(i,ys.object):[null,void 0]},Vr=function(i,t){var e=Ei(i);return{h:e.h,s:Ce(e.s+100*t,0,100),l:e.l,a:e.a}},Lr=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},fo=function(i,t){var e=Ei(i);return{h:e.h,s:e.s,l:Ce(e.l+100*t,0,100),a:e.a}},_s=(function(){function i(t){this.parsed=Rh(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return he(Lr(this.rgba),2)},i.prototype.isDark=function(){return Lr(this.rgba)<.5},i.prototype.isLight=function(){return Lr(this.rgba)>=.5},i.prototype.toHex=function(){return t=kr(this.rgba),e=t.r,r=t.g,n=t.b,a=(s=t.a)<1?Xi(he(255*s)):"","#"+Xi(e)+Xi(r)+Xi(n)+a;var t,e,r,n,s,a},i.prototype.toRgb=function(){return kr(this.rgba)},i.prototype.toRgbString=function(){return t=kr(this.rgba),e=t.r,r=t.g,n=t.b,(s=t.a)<1?"rgba("+e+", "+r+", "+n+", "+s+")":"rgb("+e+", "+r+", "+n+")";var t,e,r,n,s},i.prototype.toHsl=function(){return co(Ei(this.rgba))},i.prototype.toHslString=function(){return t=co(Ei(this.rgba)),e=t.h,r=t.s,n=t.l,(s=t.a)<1?"hsla("+e+", "+r+"%, "+n+"%, "+s+")":"hsl("+e+", "+r+"%, "+n+"%)";var t,e,r,n,s},i.prototype.toHsv=function(){return t=Vl(this.rgba),{h:he(t.h),s:he(t.s),v:he(t.v),a:he(t.a,3)};var t},i.prototype.invert=function(){return Le({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),Le(Vr(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),Le(Vr(this.rgba,-t))},i.prototype.grayscale=function(){return Le(Vr(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),Le(fo(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),Le(fo(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?Le({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):he(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=Ei(this.rgba);return typeof t=="number"?Le({h:t,s:e.s,l:e.l,a:e.a}):he(e.h)},i.prototype.isEqual=function(t){return this.toHex()===Le(t).toHex()},i})(),Le=function(i){return i instanceof _s?i:new _s(i)},po=[],Fh=function(i){i.forEach(function(t){po.indexOf(t)<0&&(t(_s,ys),po.push(t))})};function kh(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var n in e)r[e[n]]=n;var s={};i.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,l,c=r[this.toHex()];if(c)return c;if(a?.closest){var f=this.toRgb(),_=1/0,x="black";if(!s.length)for(var y in e)s[y]=new i(e[y]).toRgb();for(var M in e){var G=(o=f,l=s[M],Math.pow(o.r-l.r,2)+Math.pow(o.g-l.g,2)+Math.pow(o.b-l.b,2));G<_&&(_=G,x=M)}return x}},t.string.push([function(a){var o=a.toLowerCase(),l=o==="transparent"?"#0000":e[o];return l?new i(l).toRgb():null},"name"])}Fh([kh]);const ui=class Ai{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Ai)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,a)=>s===e[a]);if(t!==null&&e!==null){const s=Object.keys(t),a=Object.keys(e);return s.length!==a.length?!1:s.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,r,n]=this._components;return{r:t,g:e,b:r,a:n}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,n]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(n*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,r,n,s]=this._components;return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,r,n]=this._components;return t[0]=e,t[1]=r,t[2]=n,t}toNumber(){return this._int}toBgrNumber(){const[t,e,r]=this.toUint8RgbArray();return(r<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,n,s]=Ai._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=n,this._components[3]*=s,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,n=this._int>>8&255,s=this._int&255;return e&&(r=r*t+.5|0,n=n*t+.5|0,s=s*t+.5|0),(t*255<<24)+(r<<16)+(n<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,r,n,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const a=t;e=(a>>16&255)/255,r=(a>>8&255)/255,n=(a&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,n,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,n,s=255]=t,e/=255,r/=255,n/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const o=Ai.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}const a=Le(t);a.isValid()&&({r:e,g:r,b:n,a:s}=a.rgba,e/=255,r/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=n,this._components[3]=s,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((n,s)=>{t[s]=Math.min(Math.max(n,e),r)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof Ai||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};ui.shared=new ui;ui._temp=new ui;ui.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let le=ui;const Vh={cullArea:null,cullable:!1,cullableChildren:!0};let Gr=0;const mo=500;function Jt(...i){Gr!==mo&&(Gr++,Gr===mo?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...i))}const Ui={_registeredResources:new Set,register(i){this._registeredResources.add(i)},unregister(i){this._registeredResources.delete(i)},release(){this._registeredResources.forEach(i=>i.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(i){return this._registeredResources.has(i)},reset(){this._registeredResources.clear()}};class Lh{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){let e;return this._index>0?e=this._pool[--this._index]:(e=new this._classType,this._count++),e.init?.(t),e}return(t){t.reset?.(),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let t=0;t<this._index;t++)this._pool[t].destroy();this._pool.length=0,this._count=0,this._index=0}}class Gh{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new Lh(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const r=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[r]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}clear(){this._poolsByClass.forEach(t=>t.clear()),this._poolsByClass.clear()}}const Ae=new Gh;Ui.register(Ae);const Oh={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(i){typeof i=="boolean"&&i===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(i===!0?{}:i))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(i){Gt("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(i)}};function Nh(i,t,e){const r=i.length;let n;if(t>=r||e===0)return;e=t+e>r?r-t:e;const s=r-e;for(n=t;n<s;++n)i[n]=i[n+e];i.length=s}const zh={allowChildren:!0,removeChildren(i=0,t){const e=t??this.children.length,r=e-i,n=[];if(r>0&&r<=e){for(let a=e-1;a>=i;a--){const o=this.children[a];o&&(n.push(o),o.parent=null)}Nh(this.children,i,e);const s=this.renderGroup||this.parentRenderGroup;s&&s.removeChildren(n);for(let a=0;a<n.length;++a){const o=n[a];o.parentRenderLayer?.detach(o),this.emit("childRemoved",o,this,a),n[a].emit("removed",this)}return n.length>0&&this._didViewChangeTick++,n}else if(r===0&&this.children.length===0)return n;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(i){const t=this.getChildAt(i);return this.removeChild(t)},getChildAt(i){if(i<0||i>=this.children.length)throw new Error(`getChildAt: Index (${i}) does not exist.`);return this.children[i]},setChildIndex(i,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(i),this.addChildAt(i,t)},getChildIndex(i){const t=this.children.indexOf(i);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(i,t){this.allowChildren||Gt(ae,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${i}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(i.parent){const n=i.parent.children.indexOf(i);if(i.parent===this&&n===t)return i;n!==-1&&i.parent.children.splice(n,1)}t===e.length?e.push(i):e.splice(t,0,i),i.parent=this,i.didChange=!0,i._updateFlags=15;const r=this.renderGroup||this.parentRenderGroup;return r&&r.addChild(i),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",i,this,t),i.emit("added",this),i},swapChildren(i,t){if(i===t)return;const e=this.getChildIndex(i),r=this.getChildIndex(t);this.children[e]=t,this.children[r]=i;const n=this.renderGroup||this.parentRenderGroup;n&&(n.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...i){return i.length===1?this.reparentChildAt(i[0],this.children.length):(i.forEach(t=>this.reparentChildAt(t,this.children.length)),i[0])},reparentChildAt(i,t){if(i.parent===this)return this.setChildIndex(i,t),i;const e=i.worldTransform.clone();i.removeFromParent(),this.addChildAt(i,t);const r=this.worldTransform.clone();return r.invert(),e.prepend(r),i.setFromMatrix(e),i},replaceChild(i,t){i.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(i)),t.setFromMatrix(i.localTransform),t.updateLocalTransform(),this.removeChild(i)}},Wh={collectRenderables(i,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(i,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,i):this.collectRenderablesWithEffects(i,t,e))},collectRenderablesSimple(i,t,e){const r=this.children,n=r.length;for(let s=0;s<n;s++)r[s].collectRenderables(i,t,e)},collectRenderablesWithEffects(i,t,e){const{renderPipes:r}=t;for(let n=0;n<this.effects.length;n++){const s=this.effects[n];r[s.pipe].push(s,this,i)}this.collectRenderablesSimple(i,t,e);for(let n=this.effects.length-1;n>=0;n--){const s=this.effects[n];r[s.pipe].pop(s,this,i)}}};class yo{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class Uh{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const r=this._tests[e];if(r.test(t))return Ae.get(r.maskClass,t)}return t}returnMaskEffect(t){Ae.return(t)}}const gs=new Uh;ue.handleByList(wt.MaskEffect,gs._effectClasses);const Jh={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const i=this.renderGroup||this.parentRenderGroup;i&&(i.structureDidChange=!0)},addEffect(i){this.effects.indexOf(i)===-1&&(this.effects.push(i),this.effects.sort((e,r)=>e.priority-r.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(i){const t=this.effects.indexOf(i);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(i){const t=this._maskEffect;t?.mask!==i&&(t&&(this.removeEffect(t),gs.returnMaskEffect(t),this._maskEffect=null),i!=null&&(this._maskEffect=gs.getMaskEffect(i),this.addEffect(this._maskEffect)))},get mask(){return this._maskEffect?.mask},setMask(i){this._maskOptions={...this._maskOptions,...i},i.mask&&(this.mask=i.mask),this._markStructureAsChanged()},set filters(i){!Array.isArray(i)&&i&&(i=[i]);const t=this._filterEffect||(this._filterEffect=new yo);i=i;const e=i?.length>0,r=t.filters?.length>0,n=e!==r;i=Array.isArray(i)?i.slice(0):i,t.filters=Object.freeze(i),n&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=i??null))},get filters(){return this._filterEffect?.filters},set filterArea(i){this._filterEffect||(this._filterEffect=new yo),this._filterEffect.filterArea=i},get filterArea(){return this._filterEffect?.filterArea}},qh={label:null,get name(){return Gt(ae,"Container.name property has been removed, use Container.label instead"),this.label},set name(i){Gt(ae,"Container.name property has been removed, use Container.label instead"),this.label=i},getChildByName(i,t=!1){return this.getChildByLabel(i,t)},getChildByLabel(i,t=!1){const e=this.children;for(let r=0;r<e.length;r++){const n=e[r];if(n.label===i||i instanceof RegExp&&i.test(n.label))return n}if(t)for(let r=0;r<e.length;r++){const s=e[r].getChildByLabel(i,!0);if(s)return s}return null},getChildrenByLabel(i,t=!1,e=[]){const r=this.children;for(let n=0;n<r.length;n++){const s=r[n];(s.label===i||i instanceof RegExp&&i.test(s.label))&&e.push(s)}if(t)for(let n=0;n<r.length;n++)r[n].getChildrenByLabel(i,!0,e);return e}},ge=Ae.getPool(Bt),ze=Ae.getPool(De),Hh=new Bt,$h={getFastGlobalBounds(i,t){t||(t=new De),t.clear(),this._getGlobalBoundsRecursive(!!i,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(i,t,e){let r=t;if(i&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const n=!!this.effects.length;if((this.renderGroup||n)&&(r=ze.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const a=this.bounds;r.addFrame(a.minX,a.minY,a.maxX,a.maxY,this.groupTransform)}const s=this.children;for(let a=0;a<s.length;a++)s[a]._getGlobalBoundsRecursive(i,r,e)}if(n){let s=!1;const a=this.renderGroup||this.parentRenderGroup;for(let o=0;o<this.effects.length;o++)this.effects[o].addBounds&&(s||(s=!0,r.applyMatrix(a.worldTransform)),this.effects[o].addBounds(r,!0));s&&r.applyMatrix(a.worldTransform.copyTo(Hh).invert()),t.addBounds(r),ze.return(r)}else this.renderGroup&&(t.addBounds(r,this.relativeGroupTransform),ze.return(r))}};function Gl(i,t,e){e.clear();let r,n;return i.parent?t?r=i.parent.worldTransform:(n=ge.get().identity(),r=Vs(i,n)):r=Bt.IDENTITY,Ol(i,e,r,t),n&&ge.return(n),e.isValid||e.set(0,0,0,0),e}function Ol(i,t,e,r){if(!i.visible||!i.measurable)return;let n;r?n=i.worldTransform:(i.updateLocalTransform(),n=ge.get(),n.appendFrom(i.localTransform,e));const s=t,a=!!i.effects.length;if(a&&(t=ze.get().clear()),i.boundsArea)t.addRect(i.boundsArea,n);else{const o=i.bounds;o&&!o.isEmpty()&&(t.matrix=n,t.addBounds(o));for(let l=0;l<i.children.length;l++)Ol(i.children[l],t,n,r)}if(a){for(let o=0;o<i.effects.length;o++)i.effects[o].addBounds?.(t);s.addBounds(t,Bt.IDENTITY),ze.return(t)}r||ge.return(n)}function Vs(i,t){const e=i.parent;return e&&(Vs(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function Nl(i,t){if(i===16777215||!t)return t;if(t===16777215||!i)return i;const e=i>>16&255,r=i>>8&255,n=i&255,s=t>>16&255,a=t>>8&255,o=t&255,l=e*s/255|0,c=r*a/255|0,f=n*o/255|0;return(l<<16)+(c<<8)+f}const _o=16777215;function go(i,t){return i===_o?t:t===_o?i:Nl(i,t)}function lr(i){return((i&255)<<16)+(i&65280)+(i>>16&255)}const Xh={getGlobalAlpha(i){if(i)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(i=new Bt,t){if(t)return i.copyFrom(this.worldTransform);this.updateLocalTransform();const e=Vs(this,ge.get().identity());return i.appendFrom(this.localTransform,e),ge.return(e),i},getGlobalTint(i){if(i)return this.renderGroup?lr(this.renderGroup.worldColor):this.parentRenderGroup?lr(go(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=go(t,e.localColor),e=e.parent;return lr(t)}};function zl(i,t,e){return t.clear(),e||(e=Bt.IDENTITY),Wl(i,t,e,i,!0),t.isValid||t.set(0,0,0,0),t}function Wl(i,t,e,r,n){let s;if(n)s=ge.get(),s=e.copyTo(s);else{if(!i.visible||!i.measurable)return;i.updateLocalTransform();const l=i.localTransform;s=ge.get(),s.appendFrom(l,e)}const a=t,o=!!i.effects.length;if(o&&(t=ze.get().clear()),i.boundsArea)t.addRect(i.boundsArea,s);else{i.renderPipeId&&(t.matrix=s,t.addBounds(i.bounds));const l=i.children;for(let c=0;c<l.length;c++)Wl(l[c],t,s,r,!1)}if(o){for(let l=0;l<i.effects.length;l++)i.effects[l].addLocalBounds?.(t,r);a.addBounds(t,Bt.IDENTITY),ze.return(t)}ge.return(s)}function Ul(i,t){const e=i.children;for(let r=0;r<e.length;r++){const n=e[r],s=n.uid,a=(n._didViewChangeTick&65535)<<16|n._didContainerChangeTick&65535,o=t.index;(t.data[o]!==s||t.data[o+1]!==a)&&(t.data[t.index]=s,t.data[t.index+1]=a,t.didChange=!0),t.index=o+2,n.children.length&&Ul(n,t)}return t.didChange}const Yh=new Bt,Kh={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(i,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=i/t*e:this.scale.x=e},_setHeight(i,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=i/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new De});const i=this._localBoundsCacheData;return i.index=1,i.didChange=!1,i.data[0]!==this._didViewChangeTick&&(i.didChange=!0,i.data[0]=this._didViewChangeTick),Ul(this,i),i.didChange&&zl(this,i.localBounds,Yh),i.localBounds},getBounds(i,t){return Gl(this,i,t||new De)}},Zh={_onRender:null,set onRender(i){const t=this.renderGroup||this.parentRenderGroup;if(!i){this._onRender&&t?.removeOnRender(this),this._onRender=null;return}this._onRender||t?.addOnRender(this),this._onRender=i},get onRender(){return this._onRender}},Qh={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(i){this._zIndex!==i&&(this._zIndex=i,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(jh))}};function jh(i,t){return i._zIndex-t._zIndex}const tu={getGlobalPosition(i=new pe,t=!1){return this.parent?this.parent.toGlobal(this._position,i,t):(i.x=this._position.x,i.y=this._position.y),i},toGlobal(i,t,e=!1){const r=this.getGlobalTransform(ge.get(),e);return t=r.apply(i,t),ge.return(r),t},toLocal(i,t,e,r){t&&(i=t.toGlobal(i,e,r));const n=this.getGlobalTransform(ge.get(),r);return e=n.applyInverse(i,e),ge.return(n),e}};class Jl{constructor(){this.uid=Kt("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let eu=0;class iu{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new mr(this.textureOptions)}createTexture(t,e,r){const n=new Fe({...this.textureOptions,width:t,height:e,resolution:1,antialias:r,autoGarbageCollect:!1});return new Pt({source:n,label:`texturePool_${eu++}`})}getOptimalTexture(t,e,r=1,n){let s=Math.ceil(t*r-1e-6),a=Math.ceil(e*r-1e-6);s=pr(s),a=pr(a);const o=(s<<17)+(a<<1)+(n?1:0);this._texturePool[o]||(this._texturePool[o]=[]);let l=this._texturePool[o].pop();return l||(l=this.createTexture(s,a,n)),l.source._resolution=r,l.source.width=s/r,l.source.height=a/r,l.source.pixelWidth=s,l.source.pixelHeight=a,l.frame.x=0,l.frame.y=0,l.frame.width=t,l.frame.height=e,l.updateUvs(),this._poolKeyHash[l.uid]=o,l}getSameSizeTexture(t,e=!1){const r=t.source;return this.getOptimalTexture(t.width,t.height,r._resolution,e)}returnTexture(t,e=!1){const r=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[r].push(t)}clear(t){if(t=t!==!1,t)for(const e in this._texturePool){const r=this._texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0)}this._texturePool={}}}const ql=new iu;Ui.register(ql);class ru{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new Bt,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new Jl,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let r=0;r<e.length;r++){const n=e[r];n._updateFlags=15,this.addChild(n)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(ql.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const t=this._parentCacheAsTextureRenderGroup;t&&!t.textureNeedsUpdate&&t.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let r=0;r<e.length;r++)this.addChild(e[r])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let r=0;r<e.length;r++)this.removeChild(e[r])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let r=0;r<e.length;r++)this._getChildren(e[r],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const r=t.children;for(let n=0;n<r.length;n++)this._getChildren(r[n],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return(this._matrixDirty&1)===0?this._inverseWorldTransform:(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new Bt),this._inverseWorldTransform.copyFrom(this.worldTransform).invert())}get textureOffsetInverseTransform(){return(this._matrixDirty&2)===0?this._textureOffsetInverseTransform:(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new Bt),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y))}get inverseParentTextureTransform(){if((this._matrixDirty&4)===0)return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new Bt),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function nu(i,t,e={}){for(const r in t)!e[r]&&t[r]!==void 0&&(i[r]=t[r])}const Or=new fe(null),Yi=new fe(null),Nr=new fe(null,1,1),Ki=new fe(null),xo=1,su=2,zr=4;class Ue extends Re{constructor(t={}){super(),this.uid=Kt("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.parentRenderLayer=null,this.updateTick=-1,this.localTransform=new Bt,this.relativeGroupTransform=new Bt,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new fe(this,0,0),this._scale=Nr,this._pivot=Yi,this._origin=Ki,this._skew=Or,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],nu(this,t,{children:!0,parent:!0,effects:!0}),t.children?.forEach(e=>this.addChild(e)),t.parent?.addChild(this)}static mixin(t){Gt("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),ue.mixin(Ue,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||Gt(ae,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let n=0;n<t.length;n++)this.addChild(t[n]);return t[0]}const e=t[0],r=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),r&&(r.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,r&&r.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let n=0;n<t.length;n++)this.removeChild(t[n]);return t[0]}const e=t[0],r=this.children.indexOf(e);return r>-1&&(this._didViewChangeTick++,this.children.splice(r,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,r),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),this.renderGroup=Ae.get(ru,this),this.groupTransform=Bt.IDENTITY,t?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),Ae.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new Bt),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*gh}set angle(t){this.rotation=t*xh}get pivot(){return this._pivot===Yi&&(this._pivot=new fe(this,0,0)),this._pivot}set pivot(t){this._pivot===Yi&&(this._pivot=new fe(this,0,0),this._origin!==Ki&&Jt("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===Or&&(this._skew=new fe(this,0,0)),this._skew}set skew(t){this._skew===Or&&(this._skew=new fe(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===Nr&&(this._scale=new fe(this,1,1)),this._scale}set scale(t){this._scale===Nr&&(this._scale=new fe(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===Ki&&(this._origin=new fe(this,0,0)),this._origin}set origin(t){this._origin===Ki&&(this._origin=new fe(this,0,0),this._pivot!==Yi&&Jt("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const r=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,r.width),e!==void 0&&this._setHeight(e,r.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,r=this._scale,n=this._pivot,s=this._origin,a=this._position,o=r._x,l=r._y,c=n._x,f=n._y,_=-s._x,x=-s._y;e.a=this._cx*o,e.b=this._sx*o,e.c=this._cy*l,e.d=this._sy*l,e.tx=a._x-(c*e.a+f*e.c)+(_*e.a+x*e.c)-_,e.ty=a._y-(c*e.b+f*e.d)+(_*e.b+x*e.d)-x}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=xo,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const r=le.shared.setValue(t??16777215).toBgrNumber();r!==this.localColor&&(this.localColor=r,this._updateFlags|=xo,this._onUpdate())}get tint(){return lr(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=su,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=zr,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=zr,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=zr,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t?.children)&&e)for(let n=0;n<e.length;++n)e[n].destroy(t);this.renderGroup?.destroy(),this.renderGroup=null}}ue.mixin(Ue,zh,$h,tu,Zh,Kh,Jh,qh,Qh,Vh,Oh,Xh,Wh);class ou extends Ue{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new De(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:r,y:n}=t;return r>=e.minX&&r<=e.maxX&&n>=e.minY&&n<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){super.destroy(t),this._bounds=null;for(const e in this._gpuData)this._gpuData[e].destroy?.();this._gpuData=null}collectRenderablesSimple(t,e,r){const{renderPipes:n}=e;n.blendMode.pushBlendMode(this,this.groupBlendMode,t),n[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const a=this.children,o=a.length;for(let l=0;l<o;l++)a[l].collectRenderables(t,e,r);n.blendMode.popBlendMode(t)}}class ri extends ou{constructor(t=Pt.EMPTY){t instanceof Pt&&(t={texture:t});const{texture:e=Pt.EMPTY,anchor:r,roundPixels:n,width:s,height:a,...o}=t;super({label:"Sprite",...o}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new fe({_onUpdate:()=>{this.onViewUpdate()}}),r?this.anchor=r:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=n??!1,s!==void 0&&(this.width=s),a!==void 0&&(this.height=a)}static from(t,e=!1){return t instanceof Pt?new ri(t):new ri(Pt.from(t,e))}set texture(t){t||(t=Pt.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return Mh(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return Gt("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,r=this._bounds,{width:n,height:s}=e.orig;r.minX=-t._x*n,r.maxX=r.minX+n,r.minY=-t._y*s,r.maxY=r.minY+s}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._texture.destroy(r)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}}const au=new De;function Hl(i,t,e){const r=au;i.measurable=!0,Gl(i,e,r),t.addBoundsMask(r),i.measurable=!1}function $l(i,t,e){const r=ze.get();i.measurable=!0;const n=ge.get().identity(),s=Xl(i,e,n);zl(i,r,s),i.measurable=!1,t.addBoundsMask(r),ge.return(n),ze.return(r)}function Xl(i,t,e){return i?(i!==t&&(Xl(i.parent,t,e),i.updateLocalTransform(),e.append(i.localTransform)),e):(Jt("Mask bounds, renderable is not inside the root container"),e)}class Yl{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof ri),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask=null)}addBounds(t,e){this.inverse||Hl(this.mask,t,e)}addLocalBounds(t,e){$l(this.mask,t,e)}containsPoint(t,e){const r=this.mask;return e(r,t)}destroy(){this.reset()}static test(t){return t instanceof ri}}Yl.extension=wt.MaskEffect;class Kl{constructor(t){this.priority=0,this.pipe="colorMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}Kl.extension=wt.MaskEffect;class Zl{constructor(t){this.priority=0,this.pipe="stencilMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null)}addBounds(t,e){Hl(this.mask,t,e)}addLocalBounds(t,e){$l(this.mask,t,e)}containsPoint(t,e){const r=this.mask;return e(r,t)}destroy(){this.reset()}static test(t){return t instanceof Ue}}Zl.extension=wt.MaskEffect;const lu={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")};let vo=lu;const qt={get(){return vo},set(i){vo=i}};class Ql extends Fe{constructor(t){t.resource||(t.resource=qt.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,r=this._resolution){const n=super.resize(t,e,r);return n&&this.resizeCanvas(),n}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}Ql.extension=wt.TextureSource;class ni extends Fe{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}ni.extension=wt.TextureSource;var dr=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(dr||{});class Wr{constructor(t,e=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=r,this._once=n}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const jl=class ve{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Wr(null,null,1/0),this.deltaMS=1/ve.targetFPMS,this.elapsedMS=1/ve.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=dr.NORMAL){return this._addListener(new Wr(t,e,r))}addOnce(t,e,r=dr.NORMAL){return this._addListener(new Wr(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*ve.targetFPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,ve.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!ve._shared){const t=ve._shared=new ve;t.autoStart=!0,t._protected=!0}return ve._shared}static get system(){if(!ve._system){const t=ve._system=new ve;t.autoStart=!0,t._protected=!0}return ve._system}};jl.targetFPMS=.06;let He=jl,Ur;async function tc(){return Ur??(Ur=(async()=>{const t=qt.get().createCanvas(1,1).getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const e=await new Promise(a=>{const o=document.createElement("video");o.onloadeddata=()=>a(o),o.onerror=()=>a(null),o.autoplay=!1,o.crossOrigin="anonymous",o.preload="auto",o.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",o.load()});if(!e)return"premultiply-alpha-on-upload";const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const s=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,s),t.deleteFramebuffer(n),t.deleteTexture(r),t.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Ur}const br=class ec extends Fe{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...ec.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=He.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await tc(),this._load=new Promise((r,n)=>{this.isValid?r(this):(this._resolve=r,this._reject=n,e.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(He.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(He.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(He.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};br.extension=wt.TextureSource;br.defaultOptions={...Fe.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};br.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Ri=br;const Ie=(i,t,e=!1)=>(Array.isArray(i)||(i=[i]),t?i.map(r=>typeof r=="string"||e?t(r):r):i);class cu{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||Jt(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=Ie(t);let n;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(e)){n=c.getCacheableAssets(r,e);break}}const s=new Map(Object.entries(n||{}));n||r.forEach(l=>{s.set(l,e)});const a=[...s.keys()],o={cacheKeys:a,keys:r};r.forEach(l=>{this._cacheMap.set(l,o)}),a.forEach(l=>{const c=n?n[l]:e;this._cache.has(l)&&this._cache.get(l)!==c&&Jt("[Cache] already has key:",l),this._cache.set(l,s.get(l))})}remove(t){if(!this._cacheMap.has(t)){Jt(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const Ut=new cu,xs=[];ue.handleByList(wt.TextureSource,xs);function ic(i={}){const t=i&&i.resource,e=t?i.resource:i,r=t?i:{resource:i};for(let n=0;n<xs.length;n++){const s=xs[n];if(s.test(e))return new s(r)}throw new Error(`Could not find a source type for resource: ${r.resource}`)}function hu(i={},t=!1){const e=i&&i.resource,r=e?i.resource:i,n=e?i:{resource:i};if(!t&&Ut.has(r))return Ut.get(r);const s=new Pt({source:ic(n)});return s.on("destroy",()=>{Ut.has(r)&&Ut.remove(r)}),t||Ut.set(r,s),s}function uu(i,t=!1){return typeof i=="string"?Ut.get(i):i instanceof Fe?new Pt({source:i}):hu(i,t)}Pt.from=uu;Fe.from=ic;ue.add(Yl,Kl,Zl,Ri,ni,Ql,ks);var Xe=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(Xe||{});function Te(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function gi(i){return i.split("?")[0].split("#")[0]}function fu(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function pu(i,t,e){return i.replace(new RegExp(fu(t),"g"),e)}function mu(i,t){let e="",r=0,n=-1,s=0,a=-1;for(let o=0;o<=i.length;++o){if(o<i.length)a=i.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(n===o-1||s===1))if(n!==o-1&&s===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const l=e.lastIndexOf("/");if(l!==e.length-1){l===-1?(e="",r=0):(e=e.slice(0,l),r=e.length-1-e.lastIndexOf("/")),n=o,s=0;continue}}else if(e.length===2||e.length===1){e="",r=0,n=o,s=0;continue}}}else e.length>0?e+=`/${i.slice(n+1,o)}`:e=i.slice(n+1,o),r=o-n-1;n=o,s=0}else a===46&&s!==-1?++s:s=-1}return e}const be={toPosix(i){return pu(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){Te(i),i=this.toPosix(i);const t=/^file:\/\/\//.exec(i);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(i);return e?e[0]:""},toAbsolute(i,t,e){if(Te(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;const r=gi(this.toPosix(t??qt.get().getBaseUrl())),n=gi(this.toPosix(e??this.rootname(r)));return i=this.toPosix(i),i.startsWith("/")?be.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(Te(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const r=i.endsWith("/");return i=mu(i),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return Te(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const r=i[e];if(Te(r),r.length>0)if(t===void 0)t=r;else{const n=i[e-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(Te(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let r=-1,n=!0;const s=this.getProtocol(i),a=i;i=i.slice(s.length);for(let o=i.length-1;o>=1;--o)if(t=i.charCodeAt(o),t===47){if(!n){r=o;break}}else n=!1;return r===-1?e?"/":this.isUrl(a)?s+i:s:e&&r===1?"//":s+i.slice(0,r)},rootname(i){Te(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){Te(i),t&&Te(t),i=gi(this.toPosix(i));let e=0,r=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let a=t.length-1,o=-1;for(s=i.length-1;s>=0;--s){const l=i.charCodeAt(s);if(l===47){if(!n){e=s+1;break}}else o===-1&&(n=!1,o=s+1),a>=0&&(l===t.charCodeAt(a)?--a===-1&&(r=s):(a=-1,r=o))}return e===r?r=o:r===-1&&(r=i.length),i.slice(e,r)}for(s=i.length-1;s>=0;--s)if(i.charCodeAt(s)===47){if(!n){e=s+1;break}}else r===-1&&(n=!1,r=s+1);return r===-1?"":i.slice(e,r)},extname(i){Te(i),i=gi(this.toPosix(i));let t=-1,e=0,r=-1,n=!0,s=0;for(let a=i.length-1;a>=0;--a){const o=i.charCodeAt(a);if(o===47){if(!n){e=a+1;break}continue}r===-1&&(n=!1,r=a+1),o===46?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||r===-1||s===0||s===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){Te(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=gi(this.toPosix(i));let e=i.charCodeAt(0);const r=this.isAbsolute(i);let n;t.root=this.rootname(i),r||this.hasProtocol(i)?n=1:n=0;let s=-1,a=0,o=-1,l=!0,c=i.length-1,f=0;for(;c>=n;--c){if(e=i.charCodeAt(c),e===47){if(!l){a=c+1;break}continue}o===-1&&(l=!1,o=c+1),e===46?s===-1?s=c:f!==1&&(f=1):s!==-1&&(f=-1)}return s===-1||o===-1||f===0||f===1&&s===o-1&&s===a+1?o!==-1&&(a===0&&r?t.base=t.name=i.slice(1,o):t.base=t.name=i.slice(a,o)):(a===0&&r?(t.name=i.slice(1,s),t.base=i.slice(1,o)):(t.name=i.slice(a,s),t.base=i.slice(a,o)),t.ext=i.slice(s,o)),t.dir=this.dirname(i),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function rc(i,t,e,r,n){const s=t[e];for(let a=0;a<s.length;a++){const o=s[a];e<t.length-1?rc(i.replace(r[e],o),t,e+1,r,n):n.push(i.replace(r[e],o))}}function du(i){const t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){const n=[];e.forEach(s=>{const a=s.substring(1,s.length-1).split(",");n.push(a)}),rc(i,n,0,e,r)}else r.push(i);return r}const yr=i=>!Array.isArray(i);class pi{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`).join("&")}}getAlias(t){const{alias:e,src:r}=t;return Ie(e||r,s=>typeof s=="string"?s:Array.isArray(s)?s.map(a=>a?.src??a):s?.src?s.src:s,!0)}addManifest(t){this._manifest&&Jt("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const r=[];let n=e;Array.isArray(e)||(n=Object.entries(e).map(([s,a])=>typeof a=="string"||Array.isArray(a)?{alias:s,src:a}:{alias:s,...a})),n.forEach(s=>{const a=s.src,o=s.alias;let l;if(typeof o=="string"){const c=this._createBundleAssetId(t,o);r.push(c),l=[o,c]}else{const c=o.map(f=>this._createBundleAssetId(t,f));r.push(...c),l=[...o,...c]}this.add({...s,alias:l,src:a})}),this._bundles[t]=r}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);let r;r=s=>{this.hasKey(s)&&Jt(`[Resolver] already has key: ${s} overwriting`)},Ie(e).forEach(s=>{const{src:a}=s;let{data:o,format:l,loadParser:c,parser:f}=s;const _=Ie(a).map(G=>typeof G=="string"?du(G):Array.isArray(G)?G:[G]),x=this.getAlias(s);Array.isArray(x)?x.forEach(r):r(x);const y=[],M=G=>({...this._parsers.find(v=>v.test(G))?.parse(G),src:G});_.forEach(G=>{G.forEach(h=>{let v={};if(typeof h!="object"?v=M(h):(o=h.data??o,l=h.format??l,(h.loadParser||h.parser)&&(c=h.loadParser??c,f=h.parser??f),v={...M(h.src),...h}),!x)throw new Error(`[Resolver] alias is undefined for this asset: ${v.src}`);v=this._buildResolvedAsset(v,{aliases:x,data:o,format:l,loadParser:c,parser:f,progressSize:s.progressSize}),y.push(v)})}),x.forEach(G=>{this._assetMap[G]=y})})}resolveBundle(t){const e=yr(t);t=Ie(t);const r={};return t.forEach(n=>{const s=this._bundles[n];if(s){const a=this.resolve(s),o={};for(const l in a){const c=a[l];o[this._extractAssetIdFromBundle(n,l)]=c}r[n]=o}}),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const r={};for(const n in e)r[n]=e[n].src;return r}return e.src}resolve(t){const e=yr(t);t=Ie(t);const r={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const a=this._getPreferredOrder(s);a?.priority.forEach(o=>{a.params[o].forEach(l=>{const c=s.filter(f=>f[o]?f[o]===l:!1);c.length&&(s=c)})}),this._resolverHash[n]=s[0]}else this._resolverHash[n]=this._buildResolvedAsset({alias:[n],src:n},{});r[n]=this._resolverHash[n]}),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[e],n=this._preferredOrder.find(s=>s.params.format.includes(r.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:r,data:n,loadParser:s,parser:a,format:o,progressSize:l}=e;return(this._basePath||this._rootPath)&&(t.src=be.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=r??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=s??t.loadParser,t.parser=a??t.parser,t.format=o??t.format??yu(t.src),l!==void 0&&(t.progressSize=l),t}}pi.RETINA_PREFIX=/@([0-9\.]+)x/;function yu(i){return i.split(".").pop().split("?").shift().split("#").shift()}const vs=(i,t)=>{const e=t.split("?")[1];return e&&(i+=`?${e}`),i},nc=class Mi{constructor(t,e){this.linkedSheets=[];let r=t;t?.source instanceof Fe&&(r={texture:t,data:e});const{texture:n,data:s,cachePrefix:a=""}=r;this.cachePrefix=a,this._texture=n instanceof Pt?n:null,this.textureSource=n.source,this.textures={},this.animations={},this.data=s;const o=parseFloat(s.meta.scale);o?(this.resolution=o,n.source.resolution=this.resolution):this.resolution=n.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Mi.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const r=Mi.BATCH_SIZE;for(;e-t<r&&e<this._frameKeys.length;){const n=this._frameKeys[e],s=this._frames[n],a=s.frame;if(a){let o=null,l=null;const c=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,f=new Zt(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);s.rotated?o=new Zt(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):o=new Zt(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(l=new Zt(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[n]=new Pt({source:this.textureSource,frame:o,orig:f,trim:l,rotate:s.rotated?2:0,defaultAnchor:s.anchor,defaultBorders:s.borders,label:n.toString()})}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const n=t[e][r];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Mi.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Mi.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};nc.BATCH_SIZE=1e3;let bo=nc;const _u=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function sc(i,t,e){const r={};if(i.forEach(n=>{r[n]=t}),Object.keys(t.textures).forEach(n=>{r[`${t.cachePrefix}${n}`]=t.textures[n]}),!e){const n=be.dirname(i[0]);t.linkedSheets.forEach((s,a)=>{const o=sc([`${n}/${t.data.meta.related_multi_packs[a]}`],s,!0);Object.assign(r,o)})}return r}const gu={extension:wt.Asset,cache:{test:i=>i instanceof bo,getCacheableAssets:(i,t)=>sc(i,t,!1)},resolver:{extension:{type:wt.ResolveParser,name:"resolveSpritesheet"},test:i=>{const e=i.split("?")[0].split("."),r=e.pop(),n=e.pop();return r==="json"&&_u.includes(n)},parse:i=>{const t=i.split(".");return{resolution:parseFloat(pi.RETINA_PREFIX.exec(i)?.[1]??"1"),format:t[t.length-2],src:i}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:wt.LoadParser,priority:Xe.Normal,name:"spritesheetLoader"},async testParse(i,t){return be.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){const{texture:r,imageFilename:n,textureOptions:s,cachePrefix:a}=t?.data??{};let o=be.dirname(t.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");let l;if(r instanceof Pt)l=r;else{const _=vs(o+(n??i.meta.image),t.src);l=(await e.load([{src:_,data:s}]))[_]}const c=new bo({texture:l.source,data:i,cachePrefix:a});await c.parse();const f=i?.meta?.related_multi_packs;if(Array.isArray(f)){const _=[];for(const y of f){if(typeof y!="string")continue;let M=o+y;t.data?.ignoreMultiPack||(M=vs(M,t.src),_.push(e.load({src:M,data:{textureOptions:s,ignoreMultiPack:!0}})))}const x=await Promise.all(_);c.linkedSheets=x,x.forEach(y=>{y.linkedSheets=[c].concat(c.linkedSheets.filter(M=>M!==y))})}return c},async unload(i,t,e){await e.unload(i.textureSource._sourceOrigin),i.destroy(!1)}}};ue.add(gu);const Jr=Object.create(null),wo=Object.create(null);function Ls(i,t){let e=wo[i];return e===void 0&&(Jr[t]===void 0&&(Jr[t]=1),wo[i]=e=Jr[t]++),e}let Zi;function oc(){return(!Zi||Zi?.isContextLost())&&(Zi=qt.get().createCanvas().getContext("webgl",{})),Zi}let Qi;function xu(){if(!Qi){Qi="mediump";const i=oc();i&&i.getShaderPrecisionFormat&&(Qi=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?"highp":"mediump")}return Qi}function vu(i,t,e){return t?i:e?(i=i.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${i}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${i}
        `}function bu(i,t,e){const r=e?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(i.substring(0,9)!=="precision"){let n=e?t.requestedFragmentPrecision:t.requestedVertexPrecision;return n==="highp"&&r!=="highp"&&(n="mediump"),`precision ${n} float;
${i}`}else if(r!=="highp"&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}function wu(i,t){return t?`#version 300 es
${i}`:i}const Su={},Cu={};function Au(i,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const r=e?Su:Cu;return r[t]?(r[t]++,t+=`-${r[t]}`):r[t]=1,i.indexOf("#define SHADER_NAME")!==-1?i:`${`#define SHADER_NAME ${t}`}
${i}`}function Mu(i,t){return t?i.replace("#version 300 es",""):i}const qr={stripVersion:Mu,ensurePrecision:bu,addProgramDefines:vu,setProgramName:Au,insertVersion:wu},xi=Object.create(null),ac=class bs{constructor(t){t={...bs.defaultOptions,...t};const e=t.fragment.indexOf("#version 300 es")!==-1,r={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:xu()},setProgramName:{name:t.name},addProgramDefines:e,insertVersion:e};let n=t.fragment,s=t.vertex;Object.keys(qr).forEach(a=>{const o=r[a];n=qr[a](n,o,!0),s=qr[a](s,o,!1)}),this.fragment=n,this.vertex=s,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=Ls(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,xi[this._cacheKey]=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return xi[e]||(xi[e]=new bs(t),xi[e]._cacheKey=e),xi[e]}};ac.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let lc=ac;const So={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function Pu(i){return So[i]??So.float32}const Bu={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function Tu({source:i,entryPoint:t}){const e={},r=i.indexOf(`fn ${t}`);if(r!==-1){const n=i.indexOf("->",r);if(n!==-1){const s=i.substring(r,n),a=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let o;for(;(o=a.exec(s))!==null;){const l=Bu[o[3]]??"float32";e[o[2]]={location:parseInt(o[1],10),format:l,stride:Pu(l).stride,offset:0,instance:!1,start:0}}}}return e}function Hr(i){const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,e=/@group\((\d+)\)/,r=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,s=/:\s*(\w+)/,a=/struct\s+(\w+)\s*{([^}]+)}/g,o=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,c=i.match(t)?.map(_=>({group:parseInt(_.match(e)[1],10),binding:parseInt(_.match(r)[1],10),name:_.match(n)[2],isUniform:_.match(n)[1]==="<uniform>",type:_.match(s)[1]}));if(!c)return{groups:[],structs:[]};const f=i.match(a)?.map(_=>{const x=_.match(l)[1],y=_.match(o).reduce((M,G)=>{const[h,v]=G.split(":");return M[h.trim()]=v.trim(),M},{});return y?{name:x,members:y}:null}).filter(({name:_})=>c.some(x=>x.type===_))??[];return{groups:c,structs:f}}var Pi=(i=>(i[i.VERTEX=1]="VERTEX",i[i.FRAGMENT=2]="FRAGMENT",i[i.COMPUTE=4]="COMPUTE",i))(Pi||{});function Iu({groups:i}){const t=[];for(let e=0;e<i.length;e++){const r=i[e];t[r.group]||(t[r.group]=[]),r.isUniform?t[r.group].push({binding:r.binding,visibility:Pi.VERTEX|Pi.FRAGMENT,buffer:{type:"uniform"}}):r.type==="sampler"?t[r.group].push({binding:r.binding,visibility:Pi.FRAGMENT,sampler:{type:"filtering"}}):r.type==="texture_2d"&&t[r.group].push({binding:r.binding,visibility:Pi.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}function Du({groups:i}){const t=[];for(let e=0;e<i.length;e++){const r=i[e];t[r.group]||(t[r.group]={}),t[r.group][r.name]=r.binding}return t}function Eu(i,t){const e=new Set,r=new Set,n=[...i.structs,...t.structs].filter(a=>e.has(a.name)?!1:(e.add(a.name),!0)),s=[...i.groups,...t.groups].filter(a=>{const o=`${a.name}-${a.binding}`;return r.has(o)?!1:(r.add(o),!0)});return{structs:n,groups:s}}const vi=Object.create(null);class wr{constructor(t){this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:r,layout:n,gpuLayout:s,name:a}=t;if(this.name=a,this.fragment=e,this.vertex=r,e.source===r.source){const o=Hr(e.source);this.structsAndGroups=o}else{const o=Hr(r.source),l=Hr(e.source);this.structsAndGroups=Eu(o,l)}this.layout=n??Du(this.structsAndGroups),this.gpuLayout=s??Iu(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,r=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=Ls(r,"program")}get attributeData(){return this._attributeData??(this._attributeData=Tu(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,vi[this._cacheKey]=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return vi[e]||(vi[e]=new wr(t),vi[e]._cacheKey=e),vi[e]}}const cc=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],Ru=cc.reduce((i,t)=>(i[t]=!0,i),{});function Fu(i,t){switch(i){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const hc=class uc{constructor(t,e){this._touched=0,this.uid=Kt("uniform"),this._resourceType="uniformGroup",this._resourceId=Kt("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,e={...uc.defaultOptions,...e},this.uniformStructures=t;const r={};for(const n in t){const s=t[n];if(s.name=n,s.size=s.size??1,!Ru[s.type]){const a=s.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(a){const[,o,l]=a;throw new Error(`Uniform type ${s.type} is not supported. Use type: '${o}', size: ${l} instead.`)}throw new Error(`Uniform type ${s.type} is not supported. Supported uniform types are: ${cc.join(", ")}`)}s.value??(s.value=Fu(s.type,s.size)),r[n]=s.value}this.uniforms=r,this._dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this._signature=Ls(Object.keys(r).map(n=>`${n}-${t[n].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};hc.defaultOptions={ubo:!1,isStatic:!1};let fc=hc;class cr{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const r in t){const n=t[r];this.setResource(n,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const r in this.resources)t[e++]=this.resources[r]._resourceId;this._key=t.join("|")}setResource(t,e){const r=this.resources[e];t!==r&&(r&&t.off?.("change",this.onResourceChange,this),t.on?.("change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const r in e)e[r]._touched=t}destroy(){const t=this.resources;for(const e in t)t[e]?.off?.("change",this.onResourceChange,this);this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const r in e)e[r]===t&&(e[r]=null)}else this._updateKey()}}var ws=(i=>(i[i.WEBGL=1]="WEBGL",i[i.WEBGPU=2]="WEBGPU",i[i.BOTH=3]="BOTH",i))(ws||{});class Gs extends Re{constructor(t){super(),this.uid=Kt("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[],this._destroyed=!1;let{gpuProgram:e,glProgram:r,groups:n,resources:s,compatibleRenderers:a,groupMap:o}=t;this.gpuProgram=e,this.glProgram=r,a===void 0&&(a=0,e&&(a|=ws.WEBGPU),r&&(a|=ws.WEBGL)),this.compatibleRenderers=a;const l={};if(!s&&!n&&(s={}),s&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&n&&!o)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&n&&o)for(const c in o)for(const f in o[c]){const _=o[c][f];l[_]={group:c,binding:f,name:_}}else if(e&&n&&!o){const c=e.structsAndGroups.groups;o={},c.forEach(f=>{o[f.group]=o[f.group]||{},o[f.group][f.binding]=f.name,l[f.name]=f})}else if(s){n={},o={},e&&e.structsAndGroups.groups.forEach(_=>{o[_.group]=o[_.group]||{},o[_.group][_.binding]=_.name,l[_.name]=_});let c=0;for(const f in s)l[f]||(n[99]||(n[99]=new cr,this._ownedBindGroups.push(n[99])),l[f]={group:99,binding:c,name:f},o[99]=o[99]||{},o[99][c]=f,c++);for(const f in s){const _=f;let x=s[f];!x.source&&!x._resourceType&&(x=new fc(x));const y=l[_];y&&(n[y.group]||(n[y.group]=new cr,this._ownedBindGroups.push(n[y.group])),n[y.group].setResource(x,y.binding))}}this.groups=n,this._uniformBindMap=o,this.resources=this._buildResourceAccessor(n,l)}addResource(t,e,r){var n,s;(n=this._uniformBindMap)[e]||(n[e]={}),(s=this._uniformBindMap[e])[r]||(s[r]=t),this.groups[e]||(this.groups[e]=new cr,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const r={};for(const n in e){const s=e[n];Object.defineProperty(r,s.name,{get(){return t[s.group].getResource(s.binding)},set(a){t[s.group].setResource(a,s.binding)}})}return r}destroy(t=!1){this._destroyed||(this._destroyed=!0,this.emit("destroy",this),t&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(e=>{e.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null)}static from(t){const{gpu:e,gl:r,...n}=t;let s,a;return e&&(s=wr.from(e)),r&&(a=lc.from(r)),new Gs({gpuProgram:s,glProgram:a,...n})}}const Ss=[];ue.handleByNamedList(wt.Environment,Ss);async function ku(i){if(!i)for(let t=0;t<Ss.length;t++){const e=Ss[t];if(e.value.test()){await e.value.load();return}}}let bi;function Vu(){if(typeof bi=="boolean")return bi;try{bi=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{bi=!1}return bi}function Co(i,t,e=2){const r=t&&t.length,n=r?t[0]*e:i.length;let s=pc(i,0,n,e,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c;if(r&&(s=zu(i,t,s,e)),i.length>80*e){o=i[0],l=i[1];let f=o,_=l;for(let x=e;x<n;x+=e){const y=i[x],M=i[x+1];y<o&&(o=y),M<l&&(l=M),y>f&&(f=y),M>_&&(_=M)}c=Math.max(f-o,_-l),c=c!==0?32767/c:0}return Gi(s,a,e,o,l,c,0),a}function pc(i,t,e,r,n){let s;if(n===Qu(i,t,e,r)>0)for(let a=t;a<e;a+=r)s=Ao(a/r|0,i[a],i[a+1],s);else for(let a=e-r;a>=t;a-=r)s=Ao(a/r|0,i[a],i[a+1],s);return s&&fi(s,s.next)&&(Ni(s),s=s.next),s}function si(i,t){if(!i)return i;t||(t=i);let e=i,r;do if(r=!1,!e.steiner&&(fi(e,e.next)||$t(e.prev,e,e.next)===0)){if(Ni(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function Gi(i,t,e,r,n,s,a){if(!i)return;!a&&s&&Hu(i,r,n,s);let o=i;for(;i.prev!==i.next;){const l=i.prev,c=i.next;if(s?Gu(i,r,n,s):Lu(i)){t.push(l.i,i.i,c.i),Ni(i),i=c.next,o=c.next;continue}if(i=c,i===o){a?a===1?(i=Ou(si(i),t),Gi(i,t,e,r,n,s,2)):a===2&&Nu(i,t,e,r,n,s):Gi(si(i),t,e,r,n,s,1);break}}}function Lu(i){const t=i.prev,e=i,r=i.next;if($t(t,e,r)>=0)return!1;const n=t.x,s=e.x,a=r.x,o=t.y,l=e.y,c=r.y,f=Math.min(n,s,a),_=Math.min(o,l,c),x=Math.max(n,s,a),y=Math.max(o,l,c);let M=r.next;for(;M!==t;){if(M.x>=f&&M.x<=x&&M.y>=_&&M.y<=y&&Bi(n,o,s,l,a,c,M.x,M.y)&&$t(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function Gu(i,t,e,r){const n=i.prev,s=i,a=i.next;if($t(n,s,a)>=0)return!1;const o=n.x,l=s.x,c=a.x,f=n.y,_=s.y,x=a.y,y=Math.min(o,l,c),M=Math.min(f,_,x),G=Math.max(o,l,c),h=Math.max(f,_,x),v=Cs(y,M,t,e,r),C=Cs(G,h,t,e,r);let E=i.prevZ,k=i.nextZ;for(;E&&E.z>=v&&k&&k.z<=C;){if(E.x>=y&&E.x<=G&&E.y>=M&&E.y<=h&&E!==n&&E!==a&&Bi(o,f,l,_,c,x,E.x,E.y)&&$t(E.prev,E,E.next)>=0||(E=E.prevZ,k.x>=y&&k.x<=G&&k.y>=M&&k.y<=h&&k!==n&&k!==a&&Bi(o,f,l,_,c,x,k.x,k.y)&&$t(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;E&&E.z>=v;){if(E.x>=y&&E.x<=G&&E.y>=M&&E.y<=h&&E!==n&&E!==a&&Bi(o,f,l,_,c,x,E.x,E.y)&&$t(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;k&&k.z<=C;){if(k.x>=y&&k.x<=G&&k.y>=M&&k.y<=h&&k!==n&&k!==a&&Bi(o,f,l,_,c,x,k.x,k.y)&&$t(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function Ou(i,t){let e=i;do{const r=e.prev,n=e.next.next;!fi(r,n)&&dc(r,e,e.next,n)&&Oi(r,n)&&Oi(n,r)&&(t.push(r.i,e.i,n.i),Ni(e),Ni(e.next),e=i=n),e=e.next}while(e!==i);return si(e)}function Nu(i,t,e,r,n,s){let a=i;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&Yu(a,o)){let l=yc(a,o);a=si(a,a.next),l=si(l,l.next),Gi(a,t,e,r,n,s,0),Gi(l,t,e,r,n,s,0);return}o=o.next}a=a.next}while(a!==i)}function zu(i,t,e,r){const n=[];for(let s=0,a=t.length;s<a;s++){const o=t[s]*r,l=s<a-1?t[s+1]*r:i.length,c=pc(i,o,l,r,!1);c===c.next&&(c.steiner=!0),n.push(Xu(c))}n.sort(Wu);for(let s=0;s<n.length;s++)e=Uu(n[s],e);return e}function Wu(i,t){let e=i.x-t.x;if(e===0&&(e=i.y-t.y,e===0)){const r=(i.next.y-i.y)/(i.next.x-i.x),n=(t.next.y-t.y)/(t.next.x-t.x);e=r-n}return e}function Uu(i,t){const e=Ju(i,t);if(!e)return t;const r=yc(e,i);return si(r,r.next),si(e,e.next)}function Ju(i,t){let e=t;const r=i.x,n=i.y;let s=-1/0,a;if(fi(i,e))return e;do{if(fi(i,e.next))return e.next;if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){const _=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(_<=r&&_>s&&(s=_,a=e.x<e.next.x?e:e.next,_===r))return a}e=e.next}while(e!==t);if(!a)return null;const o=a,l=a.x,c=a.y;let f=1/0;e=a;do{if(r>=e.x&&e.x>=l&&r!==e.x&&mc(n<c?r:s,n,l,c,n<c?s:r,n,e.x,e.y)){const _=Math.abs(n-e.y)/(r-e.x);Oi(e,i)&&(_<f||_===f&&(e.x>a.x||e.x===a.x&&qu(a,e)))&&(a=e,f=_)}e=e.next}while(e!==o);return a}function qu(i,t){return $t(i.prev,i,t.prev)<0&&$t(t.next,i,i.next)<0}function Hu(i,t,e,r){let n=i;do n.z===0&&(n.z=Cs(n.x,n.y,t,e,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,$u(n)}function $u(i){let t,e=1;do{let r=i,n;i=null;let s=null;for(t=0;r;){t++;let a=r,o=0;for(let c=0;c<e&&(o++,a=a.nextZ,!!a);c++);let l=e;for(;o>0||l>0&&a;)o!==0&&(l===0||!a||r.z<=a.z)?(n=r,r=r.nextZ,o--):(n=a,a=a.nextZ,l--),s?s.nextZ=n:i=n,n.prevZ=s,s=n;r=a}s.nextZ=null,e*=2}while(t>1);return i}function Cs(i,t,e,r,n){return i=(i-e)*n|0,t=(t-r)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function Xu(i){let t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function mc(i,t,e,r,n,s,a,o){return(n-a)*(t-o)>=(i-a)*(s-o)&&(i-a)*(r-o)>=(e-a)*(t-o)&&(e-a)*(s-o)>=(n-a)*(r-o)}function Bi(i,t,e,r,n,s,a,o){return!(i===a&&t===o)&&mc(i,t,e,r,n,s,a,o)}function Yu(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!Ku(i,t)&&(Oi(i,t)&&Oi(t,i)&&Zu(i,t)&&($t(i.prev,i,t.prev)||$t(i,t.prev,t))||fi(i,t)&&$t(i.prev,i,i.next)>0&&$t(t.prev,t,t.next)>0)}function $t(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function fi(i,t){return i.x===t.x&&i.y===t.y}function dc(i,t,e,r){const n=tr($t(i,t,e)),s=tr($t(i,t,r)),a=tr($t(e,r,i)),o=tr($t(e,r,t));return!!(n!==s&&a!==o||n===0&&ji(i,e,t)||s===0&&ji(i,r,t)||a===0&&ji(e,i,r)||o===0&&ji(e,t,r))}function ji(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function tr(i){return i>0?1:i<0?-1:0}function Ku(i,t){let e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&dc(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Oi(i,t){return $t(i.prev,i,i.next)<0?$t(i,t,i.next)>=0&&$t(i,i.prev,t)>=0:$t(i,t,i.prev)<0||$t(i,i.next,t)<0}function Zu(i,t){let e=i,r=!1;const n=(i.x+t.x)/2,s=(i.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function yc(i,t){const e=As(i.i,i.x,i.y),r=As(t.i,t.x,t.y),n=i.next,s=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,r.next=e,e.prev=r,s.next=r,r.prev=s,r}function Ao(i,t,e,r){const n=As(i,t,e);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Ni(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function As(i,t,e){return{i,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Qu(i,t,e,r){let n=0;for(let s=t,a=e-r;s<e;s+=r)n+=(i[a]-i[s])*(i[s+1]+i[a+1]),a=s;return n}const ju=Co.default||Co;var _c=(i=>(i[i.NONE=0]="NONE",i[i.COLOR=16384]="COLOR",i[i.STENCIL=1024]="STENCIL",i[i.DEPTH=256]="DEPTH",i[i.COLOR_DEPTH=16640]="COLOR_DEPTH",i[i.COLOR_STENCIL=17408]="COLOR_STENCIL",i[i.DEPTH_STENCIL=1280]="DEPTH_STENCIL",i[i.ALL=17664]="ALL",i))(_c||{});class tf{constructor(t){this.items=[],this._name=t}emit(t,e,r,n,s,a,o,l){const{name:c,items:f}=this;for(let _=0,x=f.length;_<x;_++)f[_][c](t,e,r,n,s,a,o,l);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const ef=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],gc=class xc extends Re{constructor(t){super(),this.uid=Kt("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...ef,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(t={}){const e=t.skipExtensionImports===!0?!0:t.manageImports===!1;await ku(e),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const r in this._systemsHash)t={...this._systemsHash[r].constructor.defaultOptions,...t};t={...xc.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let r=0;r<this.runners.init.items.length;r++)await this.runners.init.items[r].init(t);this._initOptions=t}render(t,e){let r=t;if(r instanceof Ue&&(r={container:r},e&&(Gt(ae,"passing a second argument is deprecated, please use render options instead"),r.target=e.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,r.clearColor??(r.clearColor=this.background.colorRgba),r.clear??(r.clear=this.background.clearBeforeRender)),r.clearColor){const n=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=n?r.clearColor:le.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),r.container.visible&&(r.container.enableRenderGroup(),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r))}resize(t,e,r){const n=this.view.resolution;this.view.resize(t,e,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),r!==void 0&&r!==n&&this.runners.resolutionChange.emit(r)}clear(t={}){const e=this;t.target||(t.target=e.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=_c.ALL);const{clear:r,clearColor:n,target:s}=t;le.shared.setValue(n??this.background.colorRgba),e.renderTarget.clear(s,r,le.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new tf(e)})}_addSystems(t){let e;for(e in t){const r=t[e];this._addSystem(r.value,r.name)}}_addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const n in this.runners)this.runners[n].add(r);return this}_addPipes(t,e){const r=e.reduce((n,s)=>(n[s.name]=s.value,n),{});t.forEach(n=>{const s=n.value,a=n.name,o=r[a];this.renderPipes[a]=new s(this,o?new o:null),this.runners.destroy.add(this.renderPipes[a])})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),(t===!0||typeof t=="object"&&t.releaseGlobalResources)&&Ui.release(),Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!Vu())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};gc.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let vc=gc,er;function rf(i){return er!==void 0||(er=(()=>{const t={stencil:!0,failIfMajorPerformanceCaveat:i??vc.defaultOptions.failIfMajorPerformanceCaveat};try{if(!qt.get().getWebGLRenderingContext())return!1;let r=qt.get().createCanvas().getContext("webgl",t);const n=!!r?.getContextAttributes()?.stencil;if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,n}catch{return!1}})()),er}let ir;async function nf(i={}){return ir!==void 0||(ir=await(async()=>{const t=qt.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(i)).requestDevice(),!0}catch{return!1}})()),ir}const Mo=["webgl","webgpu","canvas"];async function sf(i){let t=[];i.preference?(t.push(i.preference),Mo.forEach(s=>{s!==i.preference&&t.push(s)})):t=Mo.slice();let e,r={};for(let s=0;s<t.length;s++){const a=t[s];if(a==="webgpu"&&await nf()){const{WebGPURenderer:o}=await fr(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-YwIOS9WJ.js");return{WebGPURenderer:l}},__vite__mapDeps([3,2,4]));e=o,r={...i,...i.webgpu};break}else if(a==="webgl"&&rf(i.failIfMajorPerformanceCaveat??vc.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:o}=await fr(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-Bd0aKfEZ.js");return{WebGLRenderer:l}},__vite__mapDeps([5,2,4]));e=o,r={...i,...i.webgl};break}else if(a==="canvas")throw r={...i},new Error("CanvasRenderer is not yet implemented")}if(delete r.webgpu,delete r.webgl,!e)throw new Error("No available renderer for the current environment");const n=new e;return await n.init(r),n}const bc="8.14.3";class wc{static init(){globalThis.__PIXI_APP_INIT__?.(this,bc)}static destroy(){}}wc.extension=wt.Application;class of{constructor(t){this._renderer=t}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,bc)}destroy(){this._renderer=null}}of.extension={type:[wt.WebGLSystem,wt.WebGPUSystem],name:"initHook",priority:-10};const Sc=class Ms{constructor(...t){this.stage=new Ue,t[0]!==void 0&&Gt(ae,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.stage||(this.stage=new Ue),this.renderer=await sf(t),Ms._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return Gt(ae,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,e=!1){const r=Ms._plugins.slice(0);r.reverse(),r.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Sc._plugins=[];let Cc=Sc;ue.handleByList(wt.Application,Cc._plugins);ue.add(wc);class Ac extends Re{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return Gt(ae,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return Gt(ae,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return Gt(ae,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return Gt(ae,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return Gt(ae,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners();for(const e in this.chars)this.chars[e].texture?.destroy();this.chars=null,t&&(this.pages.forEach(e=>e.texture.destroy(!0)),this.pages=null)}}class af{constructor(t=0,e=0,r=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=r,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map(e=>[e,this.get(e)])}evict(t=!1){if(t||this.size>0){const e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){const e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){const t=[];let e=this.first;for(;e!==null;)t.push(e.key),e=e.next;return t}setWithEvicted(t,e,r=this.resetTtl){let n=null;if(this.has(t))this.set(t,e,!0,r);else{this.max>0&&this.size===this.max&&(n={...this.first},this.evict(!0));let s=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=s:this.last.next=s,this.last=s}return n}set(t,e,r=!1,n=this.resetTtl){let s=this.items[t];return r||s!==void 0?(s.value=e,r===!1&&n&&(s.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(s)):(this.max>0&&this.size===this.max&&this.evict(!0),s=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=s:this.last.next=s,this.last=s),this}values(t=this.keys()){return t.map(e=>this.get(e))}}function Mc(i=1e3,t=0,e=!1){if(isNaN(i)||i<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new af(i,t,e)}const lf=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Ps(i){const t=typeof i.fontSize=="number"?`${i.fontSize}px`:i.fontSize;let e=i.fontFamily;Array.isArray(i.fontFamily)||(e=i.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let n=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!lf.includes(n)&&(n=`"${n}"`),e[r]=n}return`${i.fontStyle} ${i.fontVariant} ${i.fontWeight} ${t} ${e.join(",")}`}const $r={willReadFrequently:!0},ke=class xt{static get experimentalLetterSpacingSupported(){let t=xt._experimentalLetterSpacingSupported;if(t===void 0){const e=qt.get().getCanvasRenderingContext2D().prototype;t=xt._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,n,s,a,o,l,c){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=s,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=l,this.fontProperties=c}static measureText(t=" ",e,r=xt._canvas,n=e.wordWrap){const s=`${t}-${e.styleKey}-wordWrap-${n}`;if(xt._measurementCache.has(s))return xt._measurementCache.get(s);const a=Ps(e),o=xt.measureFont(a);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const l=xt.__context;l.font=a;const f=(n?xt._wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),_=new Array(f.length);let x=0;for(let C=0;C<f.length;C++){const E=xt._measureText(f[C],e.letterSpacing,l);_[C]=E,x=Math.max(x,E)}const y=e._stroke?.width||0;let M=x+y;e.dropShadow&&(M+=e.dropShadow.distance);const G=e.lineHeight||o.fontSize;let h=Math.max(G,o.fontSize+y)+(f.length-1)*(G+e.leading);e.dropShadow&&(h+=e.dropShadow.distance);const v=new xt(t,e,M,h,f,_,G+e.leading,x,o);return xt._measurementCache.set(s,v),v}static _measureText(t,e,r){let n=!1;xt.experimentalLetterSpacingSupported&&(xt.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));const s=r.measureText(t);let a=s.width;const o=-s.actualBoundingBoxLeft;let c=s.actualBoundingBoxRight-o;if(a>0)if(n)a-=e,c-=e;else{const f=(xt.graphemeSegmenter(t).length-1)*e;a+=f,c+=f}return Math.max(a,c)}static _wordWrap(t,e,r=xt._canvas){const n=r.getContext("2d",$r);let s=0,a="",o="";const l=Object.create(null),{letterSpacing:c,whiteSpace:f}=e,_=xt._collapseSpaces(f),x=xt._collapseNewlines(f);let y=!_;const M=e.wordWrapWidth+c,G=xt._tokenize(t);for(let h=0;h<G.length;h++){let v=G[h];if(xt._isNewline(v)){if(!x){o+=xt._addLine(a),y=!_,a="",s=0;continue}v=" "}if(_){const E=xt.isBreakingSpace(v),k=xt.isBreakingSpace(a[a.length-1]);if(E&&k)continue}const C=xt._getFromCache(v,c,l,n);if(C>M)if(a!==""&&(o+=xt._addLine(a),a="",s=0),xt.canBreakWords(v,e.breakWords)){const E=xt.wordWrapSplit(v);for(let k=0;k<E.length;k++){let J=E[k],N=J,H=1;for(;E[k+H];){const j=E[k+H];if(!xt.canBreakChars(N,j,v,k,e.breakWords))J+=j;else break;N=j,H++}k+=H-1;const $=xt._getFromCache(J,c,l,n);$+s>M&&(o+=xt._addLine(a),y=!1,a="",s=0),a+=J,s+=$}}else{a.length>0&&(o+=xt._addLine(a),a="",s=0);const E=h===G.length-1;o+=xt._addLine(v,!E),y=!1,a="",s=0}else C+s>M&&(y=!1,o+=xt._addLine(a),a="",s=0),(a.length>0||!xt.isBreakingSpace(v)||y)&&(a+=v,s+=C)}return o+=xt._addLine(a,!1),o}static _addLine(t,e=!0){return t=xt._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,r,n){let s=r[t];return typeof s!="number"&&(s=xt._measureText(t,e,n)+e,r[t]=s),s}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!xt.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:xt._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:xt._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const s=t[n],a=t[n+1];if(xt.isBreakingSpace(s,a)||xt._isNewline(s)){r!==""&&(e.push(r),r=""),s==="\r"&&a===`
`?(e.push(`\r
`),n++):e.push(s);continue}r+=s}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,s){return!0}static wordWrapSplit(t){return xt.graphemeSegmenter(t)}static measureFont(t){if(xt._fonts[t])return xt._fonts[t];const e=xt._context;e.font=t;const r=e.measureText(xt.METRICS_STRING+xt.BASELINE_SYMBOL),n={ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,fontSize:r.actualBoundingBoxAscent+r.actualBoundingBoxDescent};return xt._fonts[t]=n,n}static clearMetrics(t=""){t?delete xt._fonts[t]:xt._fonts={}}static get _canvas(){if(!xt.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",$r)?.measureText)return xt.__canvas=e,e;t=qt.get().createCanvas()}catch{t=qt.get().createCanvas()}t.width=t.height=10,xt.__canvas=t}return xt.__canvas}static get _context(){return xt.__context||(xt.__context=xt._canvas.getContext("2d",$r)),xt.__context}};ke.METRICS_STRING="|q";ke.BASELINE_SYMBOL="M";ke.BASELINE_MULTIPLIER=1.4;ke.HEIGHT_MULTIPLIER=2;ke.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const i=new Intl.Segmenter;return t=>{const e=i.segment(t),r=[];let n=0;for(const s of e)r[n++]=s.segment;return r}}return i=>[...i]})();ke.experimentalLetterSpacing=!1;ke._fonts={};ke._newlines=[10,13];ke._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];ke._measurementCache=Mc(1e3);let hr=ke;const Po=[{offset:0,color:"white"},{offset:1,color:"black"}],Os=class Bs{constructor(...t){this.uid=Kt("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=cf(t);e={...e.type==="radial"?Bs.defaultRadialOptions:Bs.defaultLinearOptions,...Il(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(n=>{this.addColorStop(n.offset,n.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:le.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:r,y:n}=this.end,s=r-t,a=n-e;const o=s<0||a<0;if(this._wrapMode==="clamp-to-edge"){if(s<0){const h=t;t=r,r=h,s*=-1}if(a<0){const h=e;e=n,n=h,a*=-1}}const l=this.colorStops.length?this.colorStops:Po,c=this._textureSize,{canvas:f,context:_}=To(c,1),x=o?_.createLinearGradient(this._textureSize,0,0,0):_.createLinearGradient(0,0,this._textureSize,0);Bo(x,l),_.fillStyle=x,_.fillRect(0,0,c,1),this.texture=new Pt({source:new ni({resource:f,addressMode:this._wrapMode})});const y=Math.sqrt(s*s+a*a),M=Math.atan2(a,s),G=new Bt;G.scale(y/c,1),G.rotate(M),G.translate(t,e),this.textureSpace==="local"&&G.scale(c,c),this.transform=G}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Po,e=this._textureSize,{canvas:r,context:n}=To(e,e),{x:s,y:a}=this.center,{x:o,y:l}=this.outerCenter,c=this.innerRadius,f=this.outerRadius,_=o-f,x=l-f,y=e/(f*2),M=(s-_)*y,G=(a-x)*y,h=n.createRadialGradient(M,G,c*y,(o-_)*y,(l-x)*y,f*y);Bo(h,t),n.fillStyle=t[t.length-1].color,n.fillRect(0,0,e,e),n.fillStyle=h,n.translate(M,G),n.rotate(this.rotation),n.scale(1,this.scale),n.translate(-M,-G),n.fillRect(0,0,e,e),this.texture=new Pt({source:new ni({resource:r,addressMode:this._wrapMode})});const v=new Bt;v.scale(1/y,1/y),v.translate(_,x),this.textureSpace==="local"&&v.scale(e,e),this.transform=v}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};Os.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};Os.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Je=Os;function Bo(i,t){for(let e=0;e<t.length;e++){const r=t[e];i.addColorStop(r.offset,r.color)}}function To(i,t){const e=qt.get().createCanvas(i,t),r=e.getContext("2d");return{canvas:e,context:r}}function cf(i){let t=i[0]??{};return(typeof t=="number"||i[1])&&(Gt("8.5.2","use options object instead"),t={type:"linear",start:{x:i[0],y:i[1]},end:{x:i[2],y:i[3]},textureSpace:i[4],textureSize:i[5]??Je.defaultLinearOptions.textureSize}),t}const Io={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Sr{constructor(t,e){this.uid=Kt("fillPattern"),this._tick=0,this.transform=new Bt,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=Io[e].addressModeU,t.source.style.addressModeV=Io[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}var Xr,Do;function hf(){if(Do)return Xr;Do=1,Xr=e;var i={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function e(s){var a=[];return s.replace(t,function(o,l,c){var f=l.toLowerCase();for(c=n(c),f=="m"&&c.length>2&&(a.push([l].concat(c.splice(0,2))),f="l",l=l=="m"?"l":"L");;){if(c.length==i[f])return c.unshift(l),a.push(c);if(c.length<i[f])throw new Error("malformed path data");a.push([l].concat(c.splice(0,i[f])))}}),a}var r=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function n(s){var a=s.match(r);return a?a.map(Number):[]}return Xr}var uf=hf();const ff=Fs(uf);function pf(i,t){const e=ff(i),r=[];let n=null,s=0,a=0;for(let o=0;o<e.length;o++){const l=e[o],c=l[0],f=l;switch(c){case"M":s=f[1],a=f[2],t.moveTo(s,a);break;case"m":s+=f[1],a+=f[2],t.moveTo(s,a);break;case"H":s=f[1],t.lineTo(s,a);break;case"h":s+=f[1],t.lineTo(s,a);break;case"V":a=f[1],t.lineTo(s,a);break;case"v":a+=f[1],t.lineTo(s,a);break;case"L":s=f[1],a=f[2],t.lineTo(s,a);break;case"l":s+=f[1],a+=f[2],t.lineTo(s,a);break;case"C":s=f[5],a=f[6],t.bezierCurveTo(f[1],f[2],f[3],f[4],s,a);break;case"c":t.bezierCurveTo(s+f[1],a+f[2],s+f[3],a+f[4],s+f[5],a+f[6]),s+=f[5],a+=f[6];break;case"S":s=f[3],a=f[4],t.bezierCurveToShort(f[1],f[2],s,a);break;case"s":t.bezierCurveToShort(s+f[1],a+f[2],s+f[3],a+f[4]),s+=f[3],a+=f[4];break;case"Q":s=f[3],a=f[4],t.quadraticCurveTo(f[1],f[2],s,a);break;case"q":t.quadraticCurveTo(s+f[1],a+f[2],s+f[3],a+f[4]),s+=f[3],a+=f[4];break;case"T":s=f[1],a=f[2],t.quadraticCurveToShort(s,a);break;case"t":s+=f[1],a+=f[2],t.quadraticCurveToShort(s,a);break;case"A":s=f[6],a=f[7],t.arcToSvg(f[1],f[2],f[3],f[4],f[5],s,a);break;case"a":s+=f[6],a+=f[7],t.arcToSvg(f[1],f[2],f[3],f[4],f[5],s,a);break;case"Z":case"z":t.closePath(),r.length>0&&(n=r.pop(),n?(s=n.startX,a=n.startY):(s=0,a=0)),n=null;break;default:Jt(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&n===null&&(n={startX:s,startY:a},r.push(n))}return t}class Ns{constructor(t=0,e=0,r=0){this.type="circle",this.x=t,this.y=e,this.radius=r}clone(){return new Ns(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=r}strokeContains(t,e,r,n=.5){if(this.radius===0)return!1;const s=this.x-t,a=this.y-e,o=this.radius,l=(1-n)*r,c=Math.sqrt(s*s+a*a);return c<=o+l&&c>o-(r-l)}getBounds(t){return t||(t=new Zt),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class zs{constructor(t=0,e=0,r=0,n=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=r,this.halfHeight=n}clone(){return new zs(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let r=(t-this.x)/this.halfWidth,n=(e-this.y)/this.halfHeight;return r*=r,n*=n,r+n<=1}strokeContains(t,e,r,n=.5){const{halfWidth:s,halfHeight:a}=this;if(s<=0||a<=0)return!1;const o=r*(1-n),l=r-o,c=s-l,f=a-l,_=s+o,x=a+o,y=t-this.x,M=e-this.y,G=y*y/(c*c)+M*M/(f*f),h=y*y/(_*_)+M*M/(x*x);return G>1&&h<=1}getBounds(t){return t||(t=new Zt),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function mf(i,t,e,r,n,s){const a=i-e,o=t-r,l=n-e,c=s-r,f=a*l+o*c,_=l*l+c*c;let x=-1;_!==0&&(x=f/_);let y,M;x<0?(y=e,M=r):x>1?(y=n,M=s):(y=e+x*l,M=r+x*c);const G=i-y,h=t-M;return G*G+h*h}let df,yf;class Fi{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const r=[];for(let n=0,s=e.length;n<s;n++)r.push(e[n].x,e[n].y);e=r}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,r=e.length;for(let n=0;n<r;n+=2){const s=e[n],a=e[n+1],o=e[(n+2)%r],l=e[(n+3)%r];t+=(o-s)*(l+a)}return t<0}containsPolygon(t){const e=this.getBounds(df),r=t.getBounds(yf);if(!e.containsRect(r))return!1;const n=t.points;for(let s=0;s<n.length;s+=2){const a=n[s],o=n[s+1];if(!this.contains(a,o))return!1}return!0}clone(){const t=this.points.slice(),e=new Fi(t);return e.closePath=this.closePath,e}contains(t,e){let r=!1;const n=this.points.length/2;for(let s=0,a=n-1;s<n;a=s++){const o=this.points[s*2],l=this.points[s*2+1],c=this.points[a*2],f=this.points[a*2+1];l>e!=f>e&&t<(c-o)*((e-l)/(f-l))+o&&(r=!r)}return r}strokeContains(t,e,r,n=.5){const s=r*r,a=s*(1-n),o=s-a,{points:l}=this,c=l.length-(this.closePath?0:2);for(let f=0;f<c;f+=2){const _=l[f],x=l[f+1],y=l[(f+2)%l.length],M=l[(f+3)%l.length],G=mf(t,e,_,x,y,M),h=Math.sign((y-_)*(e-x)-(M-x)*(t-_));if(G<=(h<0?o:a))return!0}return!1}getBounds(t){t||(t=new Zt);const e=this.points;let r=1/0,n=-1/0,s=1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=2){const c=e[o],f=e[o+1];r=c<r?c:r,n=c>n?c:n,s=f<s?f:s,a=f>a?f:a}return t.x=r,t.width=n-r,t.y=s,t.height=a-s,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return Gt("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return Gt("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const rr=(i,t,e,r,n,s,a)=>{const o=i-e,l=t-r,c=Math.sqrt(o*o+l*l);return c>=n-s&&c<=n+a};class Ws{constructor(t=0,e=0,r=0,n=0,s=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=r,this.height=n,this.radius=s}getBounds(t){return t||(t=new Zt),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new Ws(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let n=t-(this.x+r),s=e-(this.y+r);const a=r*r;if(n*n+s*s<=a||(n=t-(this.x+this.width-r),n*n+s*s<=a)||(s=e-(this.y+this.height-r),n*n+s*s<=a)||(n=t-(this.x+r),n*n+s*s<=a))return!0}return!1}strokeContains(t,e,r,n=.5){const{x:s,y:a,width:o,height:l,radius:c}=this,f=r*(1-n),_=r-f,x=s+c,y=a+c,M=o-c*2,G=l-c*2,h=s+o,v=a+l;return(t>=s-f&&t<=s+_||t>=h-_&&t<=h+f)&&e>=y&&e<=y+G||(e>=a-f&&e<=a+_||e>=v-_&&e<=v+f)&&t>=x&&t<=x+M?!0:t<x&&e<y&&rr(t,e,x,y,c,_,f)||t>h-c&&e<y&&rr(t,e,h-c,y,c,_,f)||t>h-c&&e>v-c&&rr(t,e,h-c,v-c,c,_,f)||t<x&&e>v-c&&rr(t,e,x,v-c,c,_,f)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const Pc={};function _f(i,t,e){let r=2166136261;for(let n=0;n<t;n++)r^=i[n].uid,r=Math.imul(r,16777619),r>>>=0;return Pc[r]||gf(i,t,r,e)}function gf(i,t,e,r){const n={};let s=0;for(let o=0;o<r;o++){const l=o<t?i[o]:Pt.EMPTY.source;n[s++]=l.source,n[s++]=l.style}const a=new cr(n);return Pc[e]=a,a}class Eo{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this.uint32View=null,this.float32View=null,this.uint16View=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._int32View=null,this._float64Array=null,this._bigUint64Array=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function Ro(i,t){const e=i.byteLength/8|0,r=new Float64Array(i,0,e);new Float64Array(t,0,e).set(r);const s=i.byteLength-e*8;if(s>0){const a=new Uint8Array(i,e*8,s);new Uint8Array(t,e*8,s).set(a)}}const xf={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var vf=(i=>(i[i.DISABLED=0]="DISABLED",i[i.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",i[i.MASK_ACTIVE=2]="MASK_ACTIVE",i[i.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",i[i.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",i[i.NONE=5]="NONE",i))(vf||{});function Fo(i,t){return t.alphaMode==="no-premultiply-alpha"&&xf[i]||i}const bf=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function wf(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function Sf(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const r=bf.replace(/%forloop%/gi,wf(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}}finally{t.deleteShader(e)}return i}let oi=null;function Cf(){if(oi)return oi;const i=oc();return oi=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),oi=Sf(oi,i),i.getExtension("WEBGL_lose_context")?.loseContext(),oi}class Af{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class Mf{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new Af,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const ki=[];let _r=0;Ui.register({clear:()=>{if(ki.length>0)for(const i of ki)i&&i.destroy();ki.length=0,_r=0}});function ko(){return _r>0?ki[--_r]:new Mf}function Vo(i){ki[_r++]=i}let wi=0;const Bc=class Tc{constructor(t){this.uid=Kt("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...Tc.defaultOptions,...t},t.maxTextures||(Gt("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=Cf());const{maxTextures:e,attributesInitialSize:r,indicesInitialSize:n}=t;this.attributeBuffer=new Eo(r*4),this.indexBuffer=new Uint16Array(n),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)Vo(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const r=t._batch.textures.ids[e._source.uid];return!r&&r!==0?!1:(t._textureId=r,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let r=ko(),n=r.textures;n.clear();const s=e[this.elementStart];let a=Fo(s.blendMode,s.texture._source),o=s.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const l=this.attributeBuffer.float32View,c=this.attributeBuffer.uint32View,f=this.indexBuffer;let _=this._batchIndexSize,x=this._batchIndexStart,y="startBatch";const M=this.maxTextures;for(let G=this.elementStart;G<this.elementSize;++G){const h=e[G];e[G]=null;const C=h.texture._source,E=Fo(h.blendMode,C),k=a!==E||o!==h.topology;if(C._batchTick===wi&&!k){h._textureId=C._textureBindLocation,_+=h.indexSize,h.packAsQuad?(this.packQuadAttributes(h,l,c,h._attributeStart,h._textureId),this.packQuadIndex(f,h._indexStart,h._attributeStart/this.vertexSize)):(this.packAttributes(h,l,c,h._attributeStart,h._textureId),this.packIndex(h,f,h._indexStart,h._attributeStart/this.vertexSize)),h._batch=r;continue}C._batchTick=wi,(n.count>=M||k)&&(this._finishBatch(r,x,_-x,n,a,o,t,y),y="renderBatch",x=_,a=E,o=h.topology,r=ko(),n=r.textures,n.clear(),++wi),h._textureId=C._textureBindLocation=n.count,n.ids[C.uid]=n.count,n.textures[n.count++]=C,h._batch=r,_+=h.indexSize,h.packAsQuad?(this.packQuadAttributes(h,l,c,h._attributeStart,h._textureId),this.packQuadIndex(f,h._indexStart,h._attributeStart/this.vertexSize)):(this.packAttributes(h,l,c,h._attributeStart,h._textureId),this.packIndex(h,f,h._indexStart,h._attributeStart/this.vertexSize))}n.count>0&&(this._finishBatch(r,x,_-x,n,a,o,t,y),x=_,++wi),this.elementStart=this.elementSize,this._batchIndexStart=x,this._batchIndexSize=_}_finishBatch(t,e,r,n,s,a,o,l){t.gpuBindGroup=null,t.bindGroup=null,t.action=l,t.batcher=this,t.textures=n,t.blendMode=s,t.topology=a,t.start=e,t.size=r,++wi,this.batches[this.batchIndex++]=t,o.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),r=new Eo(e);Ro(this.attributeBuffer.rawBinaryData,r.rawBinaryData),this.attributeBuffer=r}_resizeIndexBuffer(t){const e=this.indexBuffer;let r=Math.max(t,e.length*1.5);r+=r%2;const n=r>65535?new Uint32Array(r):new Uint16Array(r);if(n.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let s=0;s<e.length;s++)n[s]=e[s];else Ro(e.buffer,n.buffer);this.indexBuffer=n}packQuadIndex(t,e,r){t[e]=r+0,t[e+1]=r+1,t[e+2]=r+2,t[e+3]=r+0,t[e+4]=r+2,t[e+5]=r+3}packIndex(t,e,r,n){const s=t.indices,a=t.indexSize,o=t.indexOffset,l=t.attributeOffset;for(let c=0;c<a;c++)e[r++]=n+s[c+o]-l}destroy(t={}){if(this.batches!==null){for(let e=0;e<this.batches.length;e++)Vo(this.batches[e]);this.batches=null,this.geometry.destroy(!0),this.geometry=null,t.shader&&(this.shader?.destroy(),this.shader=null);for(let e=0;e<this._elements.length;e++)this._elements[e]&&(this._elements[e]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};Bc.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let Pf=Bc;var xe=(i=>(i[i.MAP_READ=1]="MAP_READ",i[i.MAP_WRITE=2]="MAP_WRITE",i[i.COPY_SRC=4]="COPY_SRC",i[i.COPY_DST=8]="COPY_DST",i[i.INDEX=16]="INDEX",i[i.VERTEX=32]="VERTEX",i[i.UNIFORM=64]="UNIFORM",i[i.STORAGE=128]="STORAGE",i[i.INDIRECT=256]="INDIRECT",i[i.QUERY_RESOLVE=512]="QUERY_RESOLVE",i[i.STATIC=1024]="STATIC",i))(xe||{});class zi extends Re{constructor(t){let{data:e,size:r}=t;const{usage:n,label:s,shrinkToFit:a}=t;super(),this.uid=Kt("buffer"),this._resourceType="buffer",this._resourceId=Kt("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,r??(r=e?.byteLength);const o=!!e;this.descriptor={size:r,usage:n,mappedAtCreation:o,label:s},this.shrinkToFit=a??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&xe.STATIC)}set static(t){t?this.descriptor.usage|=xe.STATIC:this.descriptor.usage&=~xe.STATIC}setDataWithSize(t,e,r){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){r&&this.emit("update",this);return}const n=this._data;if(this._data=t,this._dataInt32=null,!n||n.length!==t.length){!this.shrinkToFit&&n&&t.byteLength<n.byteLength?r&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=Kt("resource"),this.emit("change",this));return}r&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function Ic(i,t){if(!(i instanceof zi)){let e=t?xe.INDEX:xe.VERTEX;i instanceof Array&&(t?(i=new Uint32Array(i),e=xe.INDEX|xe.COPY_DST):(i=new Float32Array(i),e=xe.VERTEX|xe.COPY_DST)),i=new zi({data:i,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return i}function Bf(i,t,e){const r=i.getAttribute(t);if(!r)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const n=r.buffer.data;let s=1/0,a=1/0,o=-1/0,l=-1/0;const c=n.BYTES_PER_ELEMENT,f=(r.offset||0)/c,_=(r.stride||8)/c;for(let x=f;x<n.length;x+=_){const y=n[x],M=n[x+1];y>o&&(o=y),M>l&&(l=M),y<s&&(s=y),M<a&&(a=M)}return e.minX=s,e.minY=a,e.maxX=o,e.maxY=l,e}function Tf(i){return(i instanceof zi||Array.isArray(i)||i.BYTES_PER_ELEMENT)&&(i={buffer:i}),i.buffer=Ic(i.buffer,!1),i}class If extends Re{constructor(t={}){super(),this.uid=Kt("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new De,this._boundsDirty=!0;const{attributes:e,indexBuffer:r,topology:n}=t;if(this.buffers=[],this.attributes={},e)for(const s in e)this.addAttribute(s,e[s]);this.instanceCount=t.instanceCount??1,r&&this.addIndex(r),this.topology=n||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const r=Tf(e);this.buffers.indexOf(r.buffer)===-1&&(this.buffers.push(r.buffer),r.buffer.on("update",this.onBufferUpdate,this),r.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=r}addIndex(t){this.indexBuffer=Ic(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,Bf(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(e=>e.destroy()),this.indexBuffer?.destroy(),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const Df=new Float32Array(1),Ef=new Uint32Array(1);class Rf extends If{constructor(){const e=new zi({data:Df,label:"attribute-batch-buffer",usage:xe.VERTEX|xe.COPY_DST,shrinkToFit:!1}),r=new zi({data:Ef,label:"index-batch-buffer",usage:xe.INDEX|xe.COPY_DST,shrinkToFit:!1}),n=24;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:n,offset:0},aUV:{buffer:e,format:"float32x2",stride:n,offset:8},aColor:{buffer:e,format:"unorm8x4",stride:n,offset:16},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:n,offset:20}},indexBuffer:r})}}function Lo(i,t,e){if(i)for(const r in i){const n=r.toLocaleLowerCase(),s=t[n];if(s){let a=i[r];r==="header"&&(a=a.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&s.push(`//----${e}----//`),s.push(a)}else Jt(`${r} placement hook does not exist in shader`)}}const Ff=/\{\{(.*?)\}\}/g;function Go(i){const t={};return(i.match(Ff)?.map(r=>r.replace(/[{()}]/g,""))??[]).forEach(r=>{t[r]=[]}),t}function Oo(i,t){let e;const r=/@in\s+([^;]+);/g;for(;(e=r.exec(i))!==null;)t.push(e[1])}function No(i,t,e=!1){const r=[];Oo(t,r),i.forEach(o=>{o.header&&Oo(o.header,r)});const n=r;e&&n.sort();const s=n.map((o,l)=>`       @location(${l}) ${o},`).join(`
`);let a=t.replace(/@in\s+[^;]+;\s*/g,"");return a=a.replace("{{in}}",`
${s}
`),a}function zo(i,t){let e;const r=/@out\s+([^;]+);/g;for(;(e=r.exec(i))!==null;)t.push(e[1])}function kf(i){const e=/\b(\w+)\s*:/g.exec(i);return e?e[1]:""}function Vf(i){const t=/@.*?\s+/g;return i.replace(t,"")}function Lf(i,t){const e=[];zo(t,e),i.forEach(l=>{l.header&&zo(l.header,e)});let r=0;const n=e.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${r++}) ${l}`).join(`,
`),s=e.sort().map(l=>`       var ${Vf(l)};`).join(`
`),a=`return VSOutput(
            ${e.sort().map(l=>` ${kf(l)}`).join(`,
`)});`;let o=t.replace(/@out\s+[^;]+;\s*/g,"");return o=o.replace("{{struct}}",`
${n}
`),o=o.replace("{{start}}",`
${s}
`),o=o.replace("{{return}}",`
${a}
`),o}function Wo(i,t){let e=i;for(const r in t){const n=t[r];n.join(`
`).length?e=e.replace(`{{${r}}}`,`//-----${r} START-----//
${n.join(`
`)}
//----${r} FINISH----//`):e=e.replace(`{{${r}}}`,"")}return e}const $e=Object.create(null),Yr=new Map;let Gf=0;function Of({template:i,bits:t}){const e=Dc(i,t);if($e[e])return $e[e];const{vertex:r,fragment:n}=zf(i,t);return $e[e]=Ec(r,n,t),$e[e]}function Nf({template:i,bits:t}){const e=Dc(i,t);return $e[e]||($e[e]=Ec(i.vertex,i.fragment,t)),$e[e]}function zf(i,t){const e=t.map(a=>a.vertex).filter(a=>!!a),r=t.map(a=>a.fragment).filter(a=>!!a);let n=No(e,i.vertex,!0);n=Lf(e,n);const s=No(r,i.fragment,!0);return{vertex:n,fragment:s}}function Dc(i,t){return t.map(e=>(Yr.has(e)||Yr.set(e,Gf++),Yr.get(e))).sort((e,r)=>e-r).join("-")+i.vertex+i.fragment}function Ec(i,t,e){const r=Go(i),n=Go(t);return e.forEach(s=>{Lo(s.vertex,r,s.name),Lo(s.fragment,n,s.name)}),{vertex:Wo(i,r),fragment:Wo(t,n)}}const Wf=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,Uf=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,Jf=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,qf=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,Hf={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},$f={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function Xf({bits:i,name:t}){const e=Of({template:{fragment:Uf,vertex:Wf},bits:[Hf,...i]});return wr.from({name:t,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function Yf({bits:i,name:t}){return new lc({name:t,...Nf({template:{vertex:Jf,fragment:qf},bits:[$f,...i]})})}const Kf={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Zf={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},Kr={};function Qf(i){const t=[];if(i===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let r=0;r<i;r++)t.push(`@group(1) @binding(${e++}) var textureSource${r+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${r+1}: sampler;`)}return t.join(`
`)}function jf(i){const t=[];if(i===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let e=0;e<i;e++)e===i-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function tp(i){return Kr[i]||(Kr[i]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${Qf(i)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${jf(i)}
            `}}),Kr[i]}const Zr={};function ep(i){const t=[];for(let e=0;e<i;e++)e>0&&t.push("else"),e<i-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${e}], vUV);`),t.push("}");return t.join(`
`)}function ip(i){return Zr[i]||(Zr[i]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${i}];

            `,main:`

                ${ep(i)}
            `}}),Zr[i]}const rp={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},np={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Uo={};function sp(i){let t=Uo[i];if(t)return t;const e=new Int32Array(i);for(let r=0;r<i;r++)e[r]=r;return t=Uo[i]=new fc({uTextures:{value:e,type:"i32",size:i}},{isStatic:!0}),t}class Jo extends Gs{constructor(t){const e=Yf({name:"batch",bits:[Zf,ip(t),np]}),r=Xf({name:"batch",bits:[Kf,tp(t),rp]});super({glProgram:e,gpuProgram:r,resources:{batchSamplers:sp(t)}}),this.maxTextures=t}}let Si=null;const Rc=class Fc extends Pf{constructor(t){super(t),this.geometry=new Rf,this.name=Fc.extension.name,this.vertexSize=6,Si??(Si=new Jo(t.maxTextures)),this.shader=Si}packAttributes(t,e,r,n,s){const a=s<<16|t.roundPixels&65535,o=t.transform,l=o.a,c=o.b,f=o.c,_=o.d,x=o.tx,y=o.ty,{positions:M,uvs:G}=t,h=t.color,v=t.attributeOffset,C=v+t.attributeSize;for(let E=v;E<C;E++){const k=E*2,J=M[k],N=M[k+1];e[n++]=l*J+f*N+x,e[n++]=_*N+c*J+y,e[n++]=G[k],e[n++]=G[k+1],r[n++]=h,r[n++]=a}}packQuadAttributes(t,e,r,n,s){const a=t.texture,o=t.transform,l=o.a,c=o.b,f=o.c,_=o.d,x=o.tx,y=o.ty,M=t.bounds,G=M.maxX,h=M.minX,v=M.maxY,C=M.minY,E=a.uvs,k=t.color,J=s<<16|t.roundPixels&65535;e[n+0]=l*h+f*C+x,e[n+1]=_*C+c*h+y,e[n+2]=E.x0,e[n+3]=E.y0,r[n+4]=k,r[n+5]=J,e[n+6]=l*G+f*C+x,e[n+7]=_*C+c*G+y,e[n+8]=E.x1,e[n+9]=E.y1,r[n+10]=k,r[n+11]=J,e[n+12]=l*G+f*v+x,e[n+13]=_*v+c*G+y,e[n+14]=E.x2,e[n+15]=E.y2,r[n+16]=k,r[n+17]=J,e[n+18]=l*h+f*v+x,e[n+19]=_*v+c*h+y,e[n+20]=E.x3,e[n+21]=E.y3,r[n+22]=k,r[n+23]=J}_updateMaxTextures(t){this.shader.maxTextures!==t&&(Si=new Jo(t),this.shader=Si)}destroy(){this.shader=null,super.destroy()}};Rc.extension={type:[wt.Batcher],name:"default"};let op=Rc;function ap(i,t,e,r,n,s,a,o=null){let l=0;e*=t,n*=s;const c=o.a,f=o.b,_=o.c,x=o.d,y=o.tx,M=o.ty;for(;l<a;){const G=i[e],h=i[e+1];r[n]=c*G+_*h+y,r[n+1]=f*G+x*h+M,n+=s,e+=t,l++}}function lp(i,t,e,r){let n=0;for(t*=e;n<r;)i[t]=0,i[t+1]=0,t+=e,n++}function kc(i,t,e,r,n){const s=t.a,a=t.b,o=t.c,l=t.d,c=t.tx,f=t.ty;e||(e=0),r||(r=2),n||(n=i.length/r-e);let _=e*r;for(let x=0;x<n;x++){const y=i[_],M=i[_+1];i[_]=s*y+o*M+c,i[_+1]=a*y+l*M+f,_+=r}}const cp=new Bt;class Vc{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,r=this.renderable;return r?Nl(e,r.groupColor)+(this.alpha*r.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||cp}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const Wi={extension:{type:wt.ShapeBuilder,name:"circle"},build(i,t){let e,r,n,s,a,o;if(i.type==="circle"){const k=i;if(a=o=k.radius,a<=0)return!1;e=k.x,r=k.y,n=s=0}else if(i.type==="ellipse"){const k=i;if(a=k.halfWidth,o=k.halfHeight,a<=0||o<=0)return!1;e=k.x,r=k.y,n=s=0}else{const k=i,J=k.width/2,N=k.height/2;e=k.x+J,r=k.y+N,a=o=Math.max(0,Math.min(k.radius,Math.min(J,N))),n=J-a,s=N-o}if(n<0||s<0)return!1;const l=Math.ceil(2.3*Math.sqrt(a+o)),c=l*8+(n?4:0)+(s?4:0);if(c===0)return!1;if(l===0)return t[0]=t[6]=e+n,t[1]=t[3]=r+s,t[2]=t[4]=e-n,t[5]=t[7]=r-s,!0;let f=0,_=l*4+(n?2:0)+2,x=_,y=c,M=n+a,G=s,h=e+M,v=e-M,C=r+G;if(t[f++]=h,t[f++]=C,t[--_]=C,t[--_]=v,s){const k=r-G;t[x++]=v,t[x++]=k,t[--y]=k,t[--y]=h}for(let k=1;k<l;k++){const J=Math.PI/2*(k/l),N=n+Math.cos(J)*a,H=s+Math.sin(J)*o,$=e+N,j=e-N,K=r+H,rt=r-H;t[f++]=$,t[f++]=K,t[--_]=K,t[--_]=j,t[x++]=j,t[x++]=rt,t[--y]=rt,t[--y]=$}M=n,G=s+o,h=e+M,v=e-M,C=r+G;const E=r-G;return t[f++]=h,t[f++]=C,t[--y]=E,t[--y]=h,n&&(t[f++]=v,t[f++]=C,t[--y]=E,t[--y]=v),!0},triangulate(i,t,e,r,n,s){if(i.length===0)return;let a=0,o=0;for(let f=0;f<i.length;f+=2)a+=i[f],o+=i[f+1];a/=i.length/2,o/=i.length/2;let l=r;t[l*e]=a,t[l*e+1]=o;const c=l++;for(let f=0;f<i.length;f+=2)t[l*e]=i[f],t[l*e+1]=i[f+1],f>0&&(n[s++]=l,n[s++]=c,n[s++]=l-1),l++;n[s++]=c+1,n[s++]=c,n[s++]=l-1}},hp={...Wi,extension:{...Wi.extension,name:"ellipse"}},up={...Wi,extension:{...Wi.extension,name:"roundedRectangle"}},Lc=1e-4,qo=1e-4;function fp(i){const t=i.length;if(t<6)return 1;let e=0;for(let r=0,n=i[t-2],s=i[t-1];r<t;r+=2){const a=i[r],o=i[r+1];e+=(a-n)*(o+s),n=a,s=o}return e<0?-1:1}function Ho(i,t,e,r,n,s,a,o){const l=i-e*n,c=t-r*n,f=i+e*s,_=t+r*s;let x,y;a?(x=r,y=-e):(x=-r,y=e);const M=l+x,G=c+y,h=f+x,v=_+y;return o.push(M,G),o.push(h,v),2}function Ke(i,t,e,r,n,s,a,o){const l=e-i,c=r-t;let f=Math.atan2(l,c),_=Math.atan2(n-i,s-t);o&&f<_?f+=Math.PI*2:!o&&f>_&&(_+=Math.PI*2);let x=f;const y=_-f,M=Math.abs(y),G=Math.sqrt(l*l+c*c),h=(15*M*Math.sqrt(G)/Math.PI>>0)+1,v=y/h;if(x+=v,o){a.push(i,t),a.push(e,r);for(let C=1,E=x;C<h;C++,E+=v)a.push(i,t),a.push(i+Math.sin(E)*G,t+Math.cos(E)*G);a.push(i,t),a.push(n,s)}else{a.push(e,r),a.push(i,t);for(let C=1,E=x;C<h;C++,E+=v)a.push(i+Math.sin(E)*G,t+Math.cos(E)*G),a.push(i,t);a.push(n,s),a.push(i,t)}return h*2}function pp(i,t,e,r,n,s){const a=Lc;if(i.length===0)return;const o=t;let l=o.alignment;if(t.alignment!==.5){let u=fp(i);l=(l-.5)*u+.5}const c=new pe(i[0],i[1]),f=new pe(i[i.length-2],i[i.length-1]),_=r,x=Math.abs(c.x-f.x)<a&&Math.abs(c.y-f.y)<a;if(_){i=i.slice(),x&&(i.pop(),i.pop(),f.set(i[i.length-2],i[i.length-1]));const u=(c.x+f.x)*.5,g=(f.y+c.y)*.5;i.unshift(u,g),i.push(u,g)}const y=n,M=i.length/2;let G=i.length;const h=y.length/2,v=o.width/2,C=v*v,E=o.miterLimit*o.miterLimit;let k=i[0],J=i[1],N=i[2],H=i[3],$=0,j=0,K=-(J-H),rt=k-N,B=0,I=0,F=Math.sqrt(K*K+rt*rt);K/=F,rt/=F,K*=v,rt*=v;const A=l,D=(1-A)*2,W=A*2;_||(o.cap==="round"?G+=Ke(k-K*(D-W)*.5,J-rt*(D-W)*.5,k-K*D,J-rt*D,k+K*W,J+rt*W,y,!0)+2:o.cap==="square"&&(G+=Ho(k,J,K,rt,D,W,!0,y))),y.push(k-K*D,J-rt*D),y.push(k+K*W,J+rt*W);for(let u=1;u<M-1;++u){k=i[(u-1)*2],J=i[(u-1)*2+1],N=i[u*2],H=i[u*2+1],$=i[(u+1)*2],j=i[(u+1)*2+1],K=-(J-H),rt=k-N,F=Math.sqrt(K*K+rt*rt),K/=F,rt/=F,K*=v,rt*=v,B=-(H-j),I=N-$,F=Math.sqrt(B*B+I*I),B/=F,I/=F,B*=v,I*=v;const g=N-k,V=J-H,d=N-$,w=j-H,m=g*d+V*w,P=V*d-w*g,T=P<0;if(Math.abs(P)<.001*Math.abs(m)){y.push(N-K*D,H-rt*D),y.push(N+K*W,H+rt*W),m>=0&&(o.join==="round"?G+=Ke(N,H,N-K*D,H-rt*D,N-B*D,H-I*D,y,!1)+4:G+=2,y.push(N-B*W,H-I*W),y.push(N+B*D,H+I*D));continue}const L=(-K+k)*(-rt+H)-(-K+N)*(-rt+J),O=(-B+$)*(-I+H)-(-B+N)*(-I+j),R=(g*O-d*L)/P,z=(w*L-V*O)/P,q=(R-N)*(R-N)+(z-H)*(z-H),X=N+(R-N)*D,Y=H+(z-H)*D,Q=N-(R-N)*W,tt=H-(z-H)*W,at=Math.min(g*g+V*V,d*d+w*w),et=T?D:W,st=at+et*et*C;q<=st?o.join==="bevel"||q/C>E?(T?(y.push(X,Y),y.push(N+K*W,H+rt*W),y.push(X,Y),y.push(N+B*W,H+I*W)):(y.push(N-K*D,H-rt*D),y.push(Q,tt),y.push(N-B*D,H-I*D),y.push(Q,tt)),G+=2):o.join==="round"?T?(y.push(X,Y),y.push(N+K*W,H+rt*W),G+=Ke(N,H,N+K*W,H+rt*W,N+B*W,H+I*W,y,!0)+4,y.push(X,Y),y.push(N+B*W,H+I*W)):(y.push(N-K*D,H-rt*D),y.push(Q,tt),G+=Ke(N,H,N-K*D,H-rt*D,N-B*D,H-I*D,y,!1)+4,y.push(N-B*D,H-I*D),y.push(Q,tt)):(y.push(X,Y),y.push(Q,tt)):(y.push(N-K*D,H-rt*D),y.push(N+K*W,H+rt*W),o.join==="round"?T?G+=Ke(N,H,N+K*W,H+rt*W,N+B*W,H+I*W,y,!0)+2:G+=Ke(N,H,N-K*D,H-rt*D,N-B*D,H-I*D,y,!1)+2:o.join==="miter"&&q/C<=E&&(T?(y.push(Q,tt),y.push(Q,tt)):(y.push(X,Y),y.push(X,Y)),G+=2),y.push(N-B*D,H-I*D),y.push(N+B*W,H+I*W),G+=2)}k=i[(M-2)*2],J=i[(M-2)*2+1],N=i[(M-1)*2],H=i[(M-1)*2+1],K=-(J-H),rt=k-N,F=Math.sqrt(K*K+rt*rt),K/=F,rt/=F,K*=v,rt*=v,y.push(N-K*D,H-rt*D),y.push(N+K*W,H+rt*W),_||(o.cap==="round"?G+=Ke(N-K*(D-W)*.5,H-rt*(D-W)*.5,N-K*D,H-rt*D,N+K*W,H+rt*W,y,!1)+2:o.cap==="square"&&(G+=Ho(N,H,K,rt,D,W,!1,y)));const U=qo*qo;for(let u=h;u<G+h-2;++u)k=y[u*2],J=y[u*2+1],N=y[(u+1)*2],H=y[(u+1)*2+1],$=y[(u+2)*2],j=y[(u+2)*2+1],!(Math.abs(k*(H-j)+N*(j-J)+$*(J-H))<U)&&s.push(u,u+1,u+2)}function mp(i,t,e,r){const n=Lc;if(i.length===0)return;const s=i[0],a=i[1],o=i[i.length-2],l=i[i.length-1],c=t||Math.abs(s-o)<n&&Math.abs(a-l)<n,f=e,_=i.length/2,x=f.length/2;for(let y=0;y<_;y++)f.push(i[y*2]),f.push(i[y*2+1]);for(let y=0;y<_-1;y++)r.push(x+y,x+y+1);c&&r.push(x+_-1,x)}function Gc(i,t,e,r,n,s,a){const o=ju(i,t,2);if(!o)return;for(let c=0;c<o.length;c+=3)s[a++]=o[c]+n,s[a++]=o[c+1]+n,s[a++]=o[c+2]+n;let l=n*r;for(let c=0;c<i.length;c+=2)e[l]=i[c],e[l+1]=i[c+1],l+=r}const dp=[],yp={extension:{type:wt.ShapeBuilder,name:"polygon"},build(i,t){for(let e=0;e<i.points.length;e++)t[e]=i.points[e];return!0},triangulate(i,t,e,r,n,s){Gc(i,dp,t,e,r,n,s)}},_p={extension:{type:wt.ShapeBuilder,name:"rectangle"},build(i,t){const e=i,r=e.x,n=e.y,s=e.width,a=e.height;return s>0&&a>0?(t[0]=r,t[1]=n,t[2]=r+s,t[3]=n,t[4]=r+s,t[5]=n+a,t[6]=r,t[7]=n+a,!0):!1},triangulate(i,t,e,r,n,s){let a=0;r*=e,t[r+a]=i[0],t[r+a+1]=i[1],a+=e,t[r+a]=i[2],t[r+a+1]=i[3],a+=e,t[r+a]=i[6],t[r+a+1]=i[7],a+=e,t[r+a]=i[4],t[r+a+1]=i[5],a+=e;const o=r/e;n[s++]=o,n[s++]=o+1,n[s++]=o+2,n[s++]=o+1,n[s++]=o+3,n[s++]=o+2}},gp={extension:{type:wt.ShapeBuilder,name:"triangle"},build(i,t){return t[0]=i.x,t[1]=i.y,t[2]=i.x2,t[3]=i.y2,t[4]=i.x3,t[5]=i.y3,!0},triangulate(i,t,e,r,n,s){let a=0;r*=e,t[r+a]=i[0],t[r+a+1]=i[1],a+=e,t[r+a]=i[2],t[r+a+1]=i[3],a+=e,t[r+a]=i[4],t[r+a+1]=i[5];const o=r/e;n[s++]=o,n[s++]=o+1,n[s++]=o+2}},xp=new Bt,vp=new Zt;function bp(i,t,e,r){const n=t.matrix?i.copyFrom(t.matrix).invert():i.identity();if(t.textureSpace==="local"){const a=e.getBounds(vp);t.width&&a.pad(t.width);const{x:o,y:l}=a,c=1/a.width,f=1/a.height,_=-o*c,x=-l*f,y=n.a,M=n.b,G=n.c,h=n.d;n.a*=c,n.b*=c,n.c*=f,n.d*=f,n.tx=_*y+x*G+n.tx,n.ty=_*M+x*h+n.ty}else n.translate(t.texture.frame.x,t.texture.frame.y),n.scale(1/t.texture.source.width,1/t.texture.source.height);const s=t.texture.source.style;return!(t.fill instanceof Je)&&s.addressMode==="clamp-to-edge"&&(s.addressMode="repeat",s.update()),r&&n.append(xp.copyFrom(r).invert()),n}const Cr={};ue.handleByMap(wt.ShapeBuilder,Cr);ue.add(_p,yp,gp,Wi,hp,up);const wp=new Zt,Sp=new Bt;function Cp(i,t){const{geometryData:e,batches:r}=t;r.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let n=0;n<i.instructions.length;n++){const s=i.instructions[n];if(s.action==="texture")Ap(s.data,r,e);else if(s.action==="fill"||s.action==="stroke"){const a=s.action==="stroke",o=s.data.path.shapePath,l=s.data.style,c=s.data.hole;a&&c&&$o(c.shapePath,l,!0,r,e),c&&(o.shapePrimitives[o.shapePrimitives.length-1].holes=c.shapePath.shapePrimitives),$o(o,l,a,r,e)}}}function Ap(i,t,e){const r=[],n=Cr.rectangle,s=wp;s.x=i.dx,s.y=i.dy,s.width=i.dw,s.height=i.dh;const a=i.transform;if(!n.build(s,r))return;const{vertices:o,uvs:l,indices:c}=e,f=c.length,_=o.length/2;a&&kc(r,a),n.triangulate(r,o,2,_,c,f);const x=i.image,y=x.uvs;l.push(y.x0,y.y0,y.x1,y.y1,y.x3,y.y3,y.x2,y.y2);const M=Ae.get(Vc);M.indexOffset=f,M.indexSize=c.length-f,M.attributeOffset=_,M.attributeSize=o.length/2-_,M.baseColor=i.style,M.alpha=i.alpha,M.texture=x,M.geometryData=e,t.push(M)}function $o(i,t,e,r,n){const{vertices:s,uvs:a,indices:o}=n;i.shapePrimitives.forEach(({shape:l,transform:c,holes:f})=>{const _=[],x=Cr[l.type];if(!x.build(l,_))return;const y=o.length,M=s.length/2;let G="triangle-list";if(c&&kc(_,c),e){const E=l.closePath??!0,k=t;k.pixelLine?(mp(_,E,s,o),G="line-list"):pp(_,k,!1,E,s,o)}else if(f){const E=[],k=_.slice();Mp(f).forEach(N=>{E.push(k.length/2),k.push(...N)}),Gc(k,E,s,2,M,o,y)}else x.triangulate(_,s,2,M,o,y);const h=a.length/2,v=t.texture;if(v!==Pt.WHITE){const E=bp(Sp,t,l,c);ap(s,2,M,a,h,2,s.length/2-M,E)}else lp(a,h,2,s.length/2-M);const C=Ae.get(Vc);C.indexOffset=y,C.indexSize=o.length-y,C.attributeOffset=M,C.attributeSize=s.length/2-M,C.baseColor=t.color,C.alpha=t.alpha,C.texture=v,C.geometryData=n,C.topology=G,r.push(C)})}function Mp(i){const t=[];for(let e=0;e<i.length;e++){const r=i[e].shape,n=[];Cr[r.type].build(r,n)&&t.push(n)}return t}class Pp{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class Bp{constructor(){this.instructions=new Jl}init(t){const e=t.maxTextures;this.batcher?this.batcher._updateMaxTextures(e):this.batcher=new op({maxTextures:e}),this.instructions.reset()}get geometry(){return Gt(Sh,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const Us=class Ts{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){Ts.defaultOptions.bezierSmoothness=t?.bezierSmoothness??Ts.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),Cp(t,e);const r=t.batchMode;t.customShader||r==="no-batch"?e.isBatchable=!1:r==="auto"?e.isBatchable=e.geometryData.vertices.length<400:e.isBatchable=!0,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=Ae.get(Bp,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:r,geometryData:n}=this._gpuContextHash[t.uid],s=n.vertices.length,a=n.indices.length;for(let f=0;f<r.length;f++)r[f].applyTransform=!1;const o=e.batcher;o.ensureAttributeBuffer(s),o.ensureIndexBuffer(a),o.begin();for(let f=0;f<r.length;f++){const _=r[f];o.add(_)}o.finish(e.instructions);const l=o.geometry;l.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),l.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!0);const c=o.batches;for(let f=0;f<c.length;f++){const _=c[f];_.bindGroup=_f(_.textures.textures,_.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new Pp;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(Ae.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(r=>{Ae.return(r)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context);this._gpuContextHash={},this._graphicsDataContextHash={},this._renderer=null}};Us.extension={type:[wt.WebGLSystem,wt.WebGPUSystem,wt.CanvasSystem],name:"graphicsContext"};Us.defaultOptions={bezierSmoothness:.5};let Oc=Us;const Tp=8,nr=11920929e-14,Ip=1;function Nc(i,t,e,r,n,s,a,o,l,c){const _=Math.min(.99,Math.max(0,c??Oc.defaultOptions.bezierSmoothness));let x=(Ip-_)/1;return x*=x,Dp(t,e,r,n,s,a,o,l,i,x),i}function Dp(i,t,e,r,n,s,a,o,l,c){Is(i,t,e,r,n,s,a,o,l,c,0),l.push(a,o)}function Is(i,t,e,r,n,s,a,o,l,c,f){if(f>Tp)return;const _=(i+e)/2,x=(t+r)/2,y=(e+n)/2,M=(r+s)/2,G=(n+a)/2,h=(s+o)/2,v=(_+y)/2,C=(x+M)/2,E=(y+G)/2,k=(M+h)/2,J=(v+E)/2,N=(C+k)/2;if(f>0){let H=a-i,$=o-t;const j=Math.abs((e-a)*$-(r-o)*H),K=Math.abs((n-a)*$-(s-o)*H);if(j>nr&&K>nr){if((j+K)*(j+K)<=c*(H*H+$*$)){l.push(J,N);return}}else if(j>nr){if(j*j<=c*(H*H+$*$)){l.push(J,N);return}}else if(K>nr){if(K*K<=c*(H*H+$*$)){l.push(J,N);return}}else if(H=J-(i+a)/2,$=N-(t+o)/2,H*H+$*$<=c){l.push(J,N);return}}Is(i,t,_,x,v,C,J,N,l,c,f+1),Is(J,N,E,k,G,h,a,o,l,c,f+1)}const Ep=8,Rp=11920929e-14,Fp=1;function kp(i,t,e,r,n,s,a,o){const c=Math.min(.99,Math.max(0,o??Oc.defaultOptions.bezierSmoothness));let f=(Fp-c)/1;return f*=f,Vp(t,e,r,n,s,a,i,f),i}function Vp(i,t,e,r,n,s,a,o){Ds(a,i,t,e,r,n,s,o,0),a.push(n,s)}function Ds(i,t,e,r,n,s,a,o,l){if(l>Ep)return;const c=(t+r)/2,f=(e+n)/2,_=(r+s)/2,x=(n+a)/2,y=(c+_)/2,M=(f+x)/2;let G=s-t,h=a-e;const v=Math.abs((r-s)*h-(n-a)*G);if(v>Rp){if(v*v<=o*(G*G+h*h)){i.push(y,M);return}}else if(G=y-(t+s)/2,h=M-(e+a)/2,G*G+h*h<=o){i.push(y,M);return}Ds(i,t,e,c,f,y,M,o,l+1),Ds(i,y,M,_,x,s,a,o,l+1)}function zc(i,t,e,r,n,s,a,o){let l=Math.abs(n-s);(!a&&n>s||a&&s>n)&&(l=2*Math.PI-l),o||(o=Math.max(6,Math.floor(6*Math.pow(r,1/3)*(l/Math.PI)))),o=Math.max(o,3);let c=l/o,f=n;c*=a?-1:1;for(let _=0;_<o+1;_++){const x=Math.cos(f),y=Math.sin(f),M=t+x*r,G=e+y*r;i.push(M,G),f+=c}}function Lp(i,t,e,r,n,s){const a=i[i.length-2],l=i[i.length-1]-e,c=a-t,f=n-e,_=r-t,x=Math.abs(l*_-c*f);if(x<1e-8||s===0){(i[i.length-2]!==t||i[i.length-1]!==e)&&i.push(t,e);return}const y=l*l+c*c,M=f*f+_*_,G=l*f+c*_,h=s*Math.sqrt(y)/x,v=s*Math.sqrt(M)/x,C=h*G/y,E=v*G/M,k=h*_+v*c,J=h*f+v*l,N=c*(v+C),H=l*(v+C),$=_*(h+E),j=f*(h+E),K=Math.atan2(H-J,N-k),rt=Math.atan2(j-J,$-k);zc(i,k+t,J+e,s,K,rt,c*f>_*l)}const Vi=Math.PI*2,Qr={centerX:0,centerY:0,ang1:0,ang2:0},jr=({x:i,y:t},e,r,n,s,a,o,l)=>{i*=e,t*=r;const c=n*i-s*t,f=s*i+n*t;return l.x=c+a,l.y=f+o,l};function Gp(i,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=t===1.5707963267948966?.551915024494:e,n=Math.cos(i),s=Math.sin(i),a=Math.cos(i+t),o=Math.sin(i+t);return[{x:n-s*r,y:s+n*r},{x:a+o*r,y:o-a*r},{x:a,y:o}]}const Xo=(i,t,e,r)=>{const n=i*r-t*e<0?-1:1;let s=i*e+t*r;return s>1&&(s=1),s<-1&&(s=-1),n*Math.acos(s)},Op=(i,t,e,r,n,s,a,o,l,c,f,_,x)=>{const y=Math.pow(n,2),M=Math.pow(s,2),G=Math.pow(f,2),h=Math.pow(_,2);let v=y*M-y*h-M*G;v<0&&(v=0),v/=y*h+M*G,v=Math.sqrt(v)*(a===o?-1:1);const C=v*n/s*_,E=v*-s/n*f,k=c*C-l*E+(i+e)/2,J=l*C+c*E+(t+r)/2,N=(f-C)/n,H=(_-E)/s,$=(-f-C)/n,j=(-_-E)/s,K=Xo(1,0,N,H);let rt=Xo(N,H,$,j);o===0&&rt>0&&(rt-=Vi),o===1&&rt<0&&(rt+=Vi),x.centerX=k,x.centerY=J,x.ang1=K,x.ang2=rt};function Np(i,t,e,r,n,s,a,o=0,l=0,c=0){if(s===0||a===0)return;const f=Math.sin(o*Vi/360),_=Math.cos(o*Vi/360),x=_*(t-r)/2+f*(e-n)/2,y=-f*(t-r)/2+_*(e-n)/2;if(x===0&&y===0)return;s=Math.abs(s),a=Math.abs(a);const M=Math.pow(x,2)/Math.pow(s,2)+Math.pow(y,2)/Math.pow(a,2);M>1&&(s*=Math.sqrt(M),a*=Math.sqrt(M)),Op(t,e,r,n,s,a,l,c,f,_,x,y,Qr);let{ang1:G,ang2:h}=Qr;const{centerX:v,centerY:C}=Qr;let E=Math.abs(h)/(Vi/4);Math.abs(1-E)<1e-7&&(E=1);const k=Math.max(Math.ceil(E),1);h/=k;let J=i[i.length-2],N=i[i.length-1];const H={x:0,y:0};for(let $=0;$<k;$++){const j=Gp(G,h),{x:K,y:rt}=jr(j[0],s,a,_,f,v,C,H),{x:B,y:I}=jr(j[1],s,a,_,f,v,C,H),{x:F,y:A}=jr(j[2],s,a,_,f,v,C,H);Nc(i,J,N,K,rt,B,I,F,A),J=F,N=A,G+=h}}function zp(i,t,e){const r=(a,o)=>{const l=o.x-a.x,c=o.y-a.y,f=Math.sqrt(l*l+c*c),_=l/f,x=c/f;return{len:f,nx:_,ny:x}},n=(a,o)=>{a===0?i.moveTo(o.x,o.y):i.lineTo(o.x,o.y)};let s=t[t.length-1];for(let a=0;a<t.length;a++){const o=t[a%t.length],l=o.radius??e;if(l<=0){n(a,o),s=o;continue}const c=t[(a+1)%t.length],f=r(o,s),_=r(o,c);if(f.len<1e-4||_.len<1e-4){n(a,o),s=o;continue}let x=Math.asin(f.nx*_.ny-f.ny*_.nx),y=1,M=!1;f.nx*_.nx-f.ny*-_.ny<0?x<0?x=Math.PI+x:(x=Math.PI-x,y=-1,M=!0):x>0&&(y=-1,M=!0);const G=x/2;let h,v=Math.abs(Math.cos(G)*l/Math.sin(G));v>Math.min(f.len/2,_.len/2)?(v=Math.min(f.len/2,_.len/2),h=Math.abs(v*Math.sin(G)/Math.cos(G))):h=l;const C=o.x+_.nx*v+-_.ny*h*y,E=o.y+_.ny*v+_.nx*h*y,k=Math.atan2(f.ny,f.nx)+Math.PI/2*y,J=Math.atan2(_.ny,_.nx)-Math.PI/2*y;a===0&&i.moveTo(C+Math.cos(k)*h,E+Math.sin(k)*h),i.arc(C,E,h,k,J,M),s=o}}function Wp(i,t,e,r){const n=(o,l)=>Math.sqrt((o.x-l.x)**2+(o.y-l.y)**2),s=(o,l,c)=>({x:o.x+(l.x-o.x)*c,y:o.y+(l.y-o.y)*c}),a=t.length;for(let o=0;o<a;o++){const l=t[(o+1)%a],c=l.radius??e;if(c<=0){o===0?i.moveTo(l.x,l.y):i.lineTo(l.x,l.y);continue}const f=t[o],_=t[(o+2)%a],x=n(f,l);let y;if(x<1e-4)y=l;else{const h=Math.min(x/2,c);y=s(l,f,h/x)}const M=n(_,l);let G;if(M<1e-4)G=l;else{const h=Math.min(M/2,c);G=s(l,_,h/M)}o===0?i.moveTo(y.x,y.y):i.lineTo(y.x,y.y),i.quadraticCurveTo(l.x,l.y,G.x,G.y,r)}}const Up=new Zt;class Jp{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new De,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const r=this._currentPoly.points,n=r[r.length-2],s=r[r.length-1];return(n!==t||s!==e)&&r.push(t,e),this}arc(t,e,r,n,s,a){this._ensurePoly(!1);const o=this._currentPoly.points;return zc(o,t,e,r,n,s,a),this}arcTo(t,e,r,n,s){this._ensurePoly();const a=this._currentPoly.points;return Lp(a,t,e,r,n,s),this}arcToSvg(t,e,r,n,s,a,o){const l=this._currentPoly.points;return Np(l,this._currentPoly.lastX,this._currentPoly.lastY,a,o,t,e,r,n,s),this}bezierCurveTo(t,e,r,n,s,a,o){this._ensurePoly();const l=this._currentPoly;return Nc(this._currentPoly.points,l.lastX,l.lastY,t,e,r,n,s,a,o),this}quadraticCurveTo(t,e,r,n,s){this._ensurePoly();const a=this._currentPoly;return kp(this._currentPoly.points,a.lastX,a.lastY,t,e,r,n,s),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const r=this.shapePrimitives,n=r.length;for(let s=0;s<t.instructions.length;s++){const a=t.instructions[s];this[a.action](...a.data)}if(t.checkForHoles&&r.length-n>1){let s=null;for(let a=n;a<r.length;a++){const o=r[a];if(o.shape.type==="polygon"){const l=o.shape,c=s?.shape;c&&c.containsPolygon(l)?(s.holes||(s.holes=[]),s.holes.push(o),r.copyWithin(a,a+1),r.length--,a--):s=o}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,r,n,s){return this.drawShape(new Zt(t,e,r,n),s),this}circle(t,e,r,n){return this.drawShape(new Ns(t,e,r),n),this}poly(t,e,r){const n=new Fi(t);return n.closePath=e,this.drawShape(n,r),this}regularPoly(t,e,r,n,s=0,a){n=Math.max(n|0,3);const o=-1*Math.PI/2+s,l=Math.PI*2/n,c=[];for(let f=0;f<n;f++){const _=o-f*l;c.push(t+r*Math.cos(_),e+r*Math.sin(_))}return this.poly(c,!0,a),this}roundPoly(t,e,r,n,s,a=0,o){if(n=Math.max(n|0,3),s<=0)return this.regularPoly(t,e,r,n,a);const l=r*Math.sin(Math.PI/n)-.001;s=Math.min(s,l);const c=-1*Math.PI/2+a,f=Math.PI*2/n,_=(n-2)*Math.PI/n/2;for(let x=0;x<n;x++){const y=x*f+c,M=t+r*Math.cos(y),G=e+r*Math.sin(y),h=y+Math.PI+_,v=y-Math.PI-_,C=M+s*Math.cos(h),E=G+s*Math.sin(h),k=M+s*Math.cos(v),J=G+s*Math.sin(v);x===0?this.moveTo(C,E):this.lineTo(C,E),this.quadraticCurveTo(M,G,k,J,o)}return this.closePath()}roundShape(t,e,r=!1,n){return t.length<3?this:(r?Wp(this,t,e,n):zp(this,t,e),this.closePath())}filletRect(t,e,r,n,s){if(s===0)return this.rect(t,e,r,n);const a=Math.min(r,n)/2,o=Math.min(a,Math.max(-a,s)),l=t+r,c=e+n,f=o<0?-o:0,_=Math.abs(o);return this.moveTo(t,e+_).arcTo(t+f,e+f,t+_,e,_).lineTo(l-_,e).arcTo(l-f,e+f,l,e+_,_).lineTo(l,c-_).arcTo(l-f,c-f,t+r-_,c,_).lineTo(t+_,c).arcTo(t+f,c-f,t,c-_,_).closePath()}chamferRect(t,e,r,n,s,a){if(s<=0)return this.rect(t,e,r,n);const o=Math.min(s,Math.min(r,n)/2),l=t+r,c=e+n,f=[t+o,e,l-o,e,l,e+o,l,c-o,l-o,c,t+o,c,t,c-o,t,e+o];for(let _=f.length-1;_>=2;_-=2)f[_]===f[_-2]&&f[_-1]===f[_-3]&&f.splice(_-1,2);return this.poly(f,!0,a)}ellipse(t,e,r,n,s){return this.drawShape(new zs(t,e,r,n),s),this}roundRect(t,e,r,n,s,a){return this.drawShape(new Ws(t,e,r,n,s),a),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let r=this._currentPoly;return r&&this.endPoly(),r=new Fi,r.points.push(t,e),this._currentPoly=r,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new Fi,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let r=e.shape.x,n=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const s=e.transform,a=r;r=s.a*r+s.c*n+s.tx,n=s.b*a+s.d*n+s.ty}this._currentPoly.points.push(r,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];this[r.action](...r.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let r=0;r<e.length;r++){const n=e[r],s=n.shape.getBounds(Up);n.transform?t.addRect(s,n.transform):t.addRect(s)}return t}}class We{constructor(t,e=!1){this.instructions=[],this.uid=Kt("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?pf(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new Jp(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,r,n,s){const a=this.instructions[this.instructions.length-1],o=this.getLastPoint(pe.shared);let l=0,c=0;if(!a||a.action!=="bezierCurveTo")l=o.x,c=o.y;else{l=a.data[2],c=a.data[3];const f=o.x,_=o.y;l=f+(f-l),c=_+(_-c)}return this.instructions.push({action:"bezierCurveTo",data:[l,c,t,e,r,n,s]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,r){const n=this.instructions[this.instructions.length-1],s=this.getLastPoint(pe.shared);let a=0,o=0;if(!n||n.action!=="quadraticCurveTo")a=s.x,o=s.y;else{a=n.data[0],o=n.data[1];const l=s.x,c=s.y;a=l+(l-a),o=c+(c-o)}return this.instructions.push({action:"quadraticCurveTo",data:[a,o,t,e,r]}),this._dirty=!0,this}rect(t,e,r,n,s){return this.instructions.push({action:"rect",data:[t,e,r,n,s]}),this._dirty=!0,this}circle(t,e,r,n){return this.instructions.push({action:"circle",data:[t,e,r,n]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,r,n,s,a,o){s||(s=n/2);const l=-1*Math.PI/2+a,c=r*2,f=Math.PI*2/c,_=[];for(let x=0;x<c;x++){const y=x%2?s:n,M=x*f+l;_.push(t+y*Math.cos(M),e+y*Math.sin(M))}return this.poly(_,!0,o),this}clone(t=!1){const e=new We;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let r=0;r<this.instructions.length;r++){const n=this.instructions[r];e.instructions.push({action:n.action,data:n.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,r=t.b,n=t.c,s=t.d,a=t.tx,o=t.ty;let l=0,c=0,f=0,_=0,x=0,y=0,M=0,G=0;for(let h=0;h<this.instructions.length;h++){const v=this.instructions[h],C=v.data;switch(v.action){case"moveTo":case"lineTo":l=C[0],c=C[1],C[0]=e*l+n*c+a,C[1]=r*l+s*c+o;break;case"bezierCurveTo":f=C[0],_=C[1],x=C[2],y=C[3],l=C[4],c=C[5],C[0]=e*f+n*_+a,C[1]=r*f+s*_+o,C[2]=e*x+n*y+a,C[3]=r*x+s*y+o,C[4]=e*l+n*c+a,C[5]=r*l+s*c+o;break;case"quadraticCurveTo":f=C[0],_=C[1],l=C[2],c=C[3],C[0]=e*f+n*_+a,C[1]=r*f+s*_+o,C[2]=e*l+n*c+a,C[3]=r*l+s*c+o;break;case"arcToSvg":l=C[5],c=C[6],M=C[0],G=C[1],C[0]=e*M+n*G,C[1]=r*M+s*G,C[5]=e*l+n*c+a,C[6]=r*l+s*c+o;break;case"circle":C[4]=Ci(C[3],t);break;case"rect":C[4]=Ci(C[4],t);break;case"ellipse":C[8]=Ci(C[8],t);break;case"roundRect":C[5]=Ci(C[5],t);break;case"addPath":C[0].transform(t);break;case"poly":C[2]=Ci(C[2],t);break;default:Jt("unknown transform action",v.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,r=this.instructions[e];if(!r)return t.x=0,t.y=0,t;for(;r.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;r=this.instructions[e]}switch(r.action){case"moveTo":case"lineTo":t.x=r.data[0],t.y=r.data[1];break;case"quadraticCurveTo":t.x=r.data[2],t.y=r.data[3];break;case"bezierCurveTo":t.x=r.data[4],t.y=r.data[5];break;case"arc":case"arcToSvg":t.x=r.data[5],t.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(t);break}return t}}function Ci(i,t){return i?i.prepend(t):t.clone()}function Yt(i,t,e){const r=i.getAttribute(t);return r?Number(r):e}function qp(i,t){const e=i.querySelectorAll("defs");for(let r=0;r<e.length;r++){const n=e[r];for(let s=0;s<n.children.length;s++){const a=n.children[s];switch(a.nodeName.toLowerCase()){case"lineargradient":t.defs[a.id]=Hp(a);break;case"radialgradient":t.defs[a.id]=$p();break}}}}function Hp(i){const t=Yt(i,"x1",0),e=Yt(i,"y1",0),r=Yt(i,"x2",1),n=Yt(i,"y2",0),s=i.getAttribute("gradientUnits")||"objectBoundingBox",a=new Je(t,e,r,n,s==="objectBoundingBox"?"local":"global");for(let o=0;o<i.children.length;o++){const l=i.children[o],c=Yt(l,"offset",0),f=le.shared.setValue(l.getAttribute("stop-color")).toNumber();a.addColorStop(c,f)}return a}function $p(i){return Jt("[SVG Parser] Radial gradients are not yet supported"),new Je(0,0,1,0)}function Yo(i){const t=i.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const Ko={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function Wc(i,t){const e=i.getAttribute("style"),r={},n={},s={strokeStyle:r,fillStyle:n,useFill:!1,useStroke:!1};for(const a in Ko){const o=i.getAttribute(a);o&&Zo(t,s,a,o.trim())}if(e){const a=e.split(";");for(let o=0;o<a.length;o++){const l=a[o].trim(),[c,f]=l.split(":");Ko[c]&&Zo(t,s,c,f.trim())}}return{strokeStyle:s.useStroke?r:null,fillStyle:s.useFill?n:null,useFill:s.useFill,useStroke:s.useStroke}}function Zo(i,t,e,r){switch(e){case"stroke":if(r!=="none"){if(r.startsWith("url(")){const n=Yo(r);t.strokeStyle.fill=i.defs[n]}else t.strokeStyle.color=le.shared.setValue(r).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(r);break;case"fill":if(r!=="none"){if(r.startsWith("url(")){const n=Yo(r);t.fillStyle.fill=i.defs[n]}else t.fillStyle.color=le.shared.setValue(r).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(r);break;case"stroke-opacity":t.strokeStyle.alpha=Number(r);break;case"opacity":t.fillStyle.alpha=Number(r),t.strokeStyle.alpha=Number(r);break}}function Xp(i){if(i.length<=2)return!0;const t=i.map(o=>o.area).sort((o,l)=>l-o),[e,r]=t,n=t[t.length-1],s=e/r,a=r/n;return!(s>3&&a<2)}function Yp(i){return i.split(/(?=[Mm])/).filter(r=>r.trim().length>0)}function Kp(i){const t=i.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),r=[],n=[];for(let f=0;f<e.length;f+=2)f+1<e.length&&(r.push(e[f]),n.push(e[f+1]));if(r.length===0||n.length===0)return 0;const s=Math.min(...r),a=Math.max(...r),o=Math.min(...n),l=Math.max(...n);return(a-s)*(l-o)}function Qo(i,t){const e=new We(i,!1);for(const r of e.instructions)t.instructions.push(r)}function Zp(i,t){if(typeof i=="string"){const a=document.createElement("div");a.innerHTML=i.trim(),i=a.querySelector("svg")}const e={context:t,defs:{},path:new We};qp(i,e);const r=i.children,{fillStyle:n,strokeStyle:s}=Wc(i,e);for(let a=0;a<r.length;a++){const o=r[a];o.nodeName.toLowerCase()!=="defs"&&Uc(o,e,n,s)}return t}function Uc(i,t,e,r){const n=i.children,{fillStyle:s,strokeStyle:a}=Wc(i,t);s&&e?e={...e,...s}:s&&(e=s),a&&r?r={...r,...a}:a&&(r=a);const o=!e&&!r;o&&(e={color:0});let l,c,f,_,x,y,M,G,h,v,C,E,k,J,N,H,$;switch(i.nodeName.toLowerCase()){case"path":{J=i.getAttribute("d");const j=i.getAttribute("fill-rule"),K=Yp(J),rt=j==="evenodd",B=K.length>1;if(rt&&B){const F=K.map(D=>({path:D,area:Kp(D)}));if(F.sort((D,W)=>W.area-D.area),K.length>3||!Xp(F))for(let D=0;D<F.length;D++){const W=F[D],U=D===0;t.context.beginPath();const u=new We(void 0,!0);Qo(W.path,u),t.context.path(u),U?(e&&t.context.fill(e),r&&t.context.stroke(r)):t.context.cut()}else for(let D=0;D<F.length;D++){const W=F[D],U=D%2===1;t.context.beginPath();const u=new We(void 0,!0);Qo(W.path,u),t.context.path(u),U?t.context.cut():(e&&t.context.fill(e),r&&t.context.stroke(r))}}else{const F=j?j==="evenodd":!0;N=new We(J,F),t.context.path(N),e&&t.context.fill(e),r&&t.context.stroke(r)}break}case"circle":M=Yt(i,"cx",0),G=Yt(i,"cy",0),h=Yt(i,"r",0),t.context.ellipse(M,G,h,h),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"rect":l=Yt(i,"x",0),c=Yt(i,"y",0),H=Yt(i,"width",0),$=Yt(i,"height",0),v=Yt(i,"rx",0),C=Yt(i,"ry",0),v||C?t.context.roundRect(l,c,H,$,v||C):t.context.rect(l,c,H,$),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"ellipse":M=Yt(i,"cx",0),G=Yt(i,"cy",0),v=Yt(i,"rx",0),C=Yt(i,"ry",0),t.context.beginPath(),t.context.ellipse(M,G,v,C),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"line":f=Yt(i,"x1",0),_=Yt(i,"y1",0),x=Yt(i,"x2",0),y=Yt(i,"y2",0),t.context.beginPath(),t.context.moveTo(f,_),t.context.lineTo(x,y),r&&t.context.stroke(r);break;case"polygon":k=i.getAttribute("points"),E=k.match(/\d+/g).map(j=>parseInt(j,10)),t.context.poly(E,!0),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"polyline":k=i.getAttribute("points"),E=k.match(/\d+/g).map(j=>parseInt(j,10)),t.context.poly(E,!1),r&&t.context.stroke(r);break;case"g":case"svg":break;default:{Jt(`[SVG parser] <${i.nodeName}> elements unsupported`);break}}o&&(e=null);for(let j=0;j<n.length;j++)Uc(n[j],t,e,r)}function Qp(i){return le.isColorLike(i)}function jo(i){return i instanceof Sr}function ta(i){return i instanceof Je}function jp(i){return i instanceof Pt}function tm(i,t,e){const r=le.shared.setValue(t??0);return i.color=r.toNumber(),i.alpha=r.alpha===1?e.alpha:r.alpha,i.texture=Pt.WHITE,{...e,...i}}function em(i,t,e){return i.texture=t,{...e,...i}}function ea(i,t,e){return i.fill=t,i.color=16777215,i.texture=t.texture,i.matrix=t.transform,{...e,...i}}function ia(i,t,e){return t.buildGradient(),i.fill=t,i.color=16777215,i.texture=t.texture,i.matrix=t.transform,i.textureSpace=t.textureSpace,{...e,...i}}function im(i,t){const e={...t,...i},r=le.shared.setValue(e.color);return e.alpha*=r.alpha,e.color=r.toNumber(),e}function ii(i,t){if(i==null)return null;const e={},r=i;return Qp(i)?tm(e,i,t):jp(i)?em(e,i,t):jo(i)?ea(e,i,t):ta(i)?ia(e,i,t):r.fill&&jo(r.fill)?ea(r,r.fill,t):r.fill&&ta(r.fill)?ia(r,r.fill,t):im(r,t)}function gr(i,t){const{width:e,alignment:r,miterLimit:n,cap:s,join:a,pixelLine:o,...l}=t,c=ii(i,l);return c?{width:e,alignment:r,miterLimit:n,cap:s,join:a,pixelLine:o,...c}:null}const rm=new pe,ra=new Bt,Js=class Ge extends Re{constructor(){super(...arguments),this.uid=Kt("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new We,this._transform=new Bt,this._fillStyle={...Ge.defaultFillStyle},this._strokeStyle={...Ge.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new De,this._boundsDirty=!0}clone(){const t=new Ge;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=ii(t,Ge.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=gr(t,Ge.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=ii(t,Ge.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=ii(t,Ge.defaultStrokeStyle),this}texture(t,e,r,n,s,a){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:n||0,dw:s||t.frame.width,dh:a||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?le.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new We,this}fill(t,e){let r;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n?.action==="stroke"?r=n.data.path:r=this._activePath.clone(),r?(t!=null&&(e!==void 0&&typeof t=="number"&&(Gt(ae,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=ii(t,Ge.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(pe.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const r=this.instructions[this.instructions.length-1];return this._tick===0&&r?.action==="fill"?e=r.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=gr(t,Ge.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(r);else{e.data.hole=r;break}}return this._initNextPathLocation(),this}arc(t,e,r,n,s,a){this._tick++;const o=this._transform;return this._activePath.arc(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,r,n,s,a),this}arcTo(t,e,r,n,s){this._tick++;const a=this._transform;return this._activePath.arcTo(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,a.a*r+a.c*n+a.tx,a.b*r+a.d*n+a.ty,s),this}arcToSvg(t,e,r,n,s,a,o){this._tick++;const l=this._transform;return this._activePath.arcToSvg(t,e,r,n,s,l.a*a+l.c*o+l.tx,l.b*a+l.d*o+l.ty),this}bezierCurveTo(t,e,r,n,s,a,o){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*t+l.c*e+l.tx,l.b*t+l.d*e+l.ty,l.a*r+l.c*n+l.tx,l.b*r+l.d*n+l.ty,l.a*s+l.c*a+l.tx,l.b*s+l.d*a+l.ty,o),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,r,n){return this._tick++,this._activePath.ellipse(t,e,r,n,this._transform.clone()),this}circle(t,e,r){return this._tick++,this._activePath.circle(t,e,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const r=this._transform;return this._activePath.lineTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}moveTo(t,e){this._tick++;const r=this._transform,n=this._activePath.instructions,s=r.a*t+r.c*e+r.tx,a=r.b*t+r.d*e+r.ty;return n.length===1&&n[0].action==="moveTo"?(n[0].data[0]=s,n[0].data[1]=a,this):(this._activePath.moveTo(s,a),this)}quadraticCurveTo(t,e,r,n,s){this._tick++;const a=this._transform;return this._activePath.quadraticCurveTo(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,a.a*r+a.c*n+a.tx,a.b*r+a.d*n+a.ty,s),this}rect(t,e,r,n){return this._tick++,this._activePath.rect(t,e,r,n,this._transform.clone()),this}roundRect(t,e,r,n,s){return this._tick++,this._activePath.roundRect(t,e,r,n,s,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,r,n,s=0,a){return this._tick++,this._activePath.regularPoly(t,e,r,n,s,a),this}roundPoly(t,e,r,n,s,a){return this._tick++,this._activePath.roundPoly(t,e,r,n,s,a),this}roundShape(t,e,r,n){return this._tick++,this._activePath.roundShape(t,e,r,n),this}filletRect(t,e,r,n,s){return this._tick++,this._activePath.filletRect(t,e,r,n,s),this}chamferRect(t,e,r,n,s,a){return this._tick++,this._activePath.chamferRect(t,e,r,n,s,a),this}star(t,e,r,n,s=0,a=0){return this._tick++,this._activePath.star(t,e,r,n,s,a,this._transform.clone()),this}svg(t){return this._tick++,Zp(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,r,n,s,a){return t instanceof Bt?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,r,n,s,a),this)}transform(t,e,r,n,s,a){return t instanceof Bt?(this._transform.append(t),this):(ra.set(t,e,r,n,s,a),this._transform.append(ra),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const r=this.instructions[e],n=r.action;if(n==="fill"){const s=r.data;t.addBounds(s.path.bounds)}else if(n==="texture"){const s=r.data;t.addFrame(s.dx,s.dy,s.dx+s.dw,s.dy+s.dh,s.transform)}if(n==="stroke"){const s=r.data,a=s.style.alignment,o=s.style.width*(1-a),l=s.path.bounds;t.addFrame(l.minX-o,l.minY-o,l.maxX+o,l.maxY+o)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let r=!1;for(let n=0;n<e.length;n++){const s=e[n],a=s.data,o=a.path;if(!s.action||!o)continue;const l=a.style,c=o.shapePath.shapePrimitives;for(let f=0;f<c.length;f++){const _=c[f].shape;if(!l||!_)continue;const x=c[f].transform,y=x?x.applyInverse(t,rm):t;if(s.action==="fill")r=_.contains(y.x,y.y);else{const G=l;r=_.strokeContains(y.x,y.y,G.width,G.alignment)}const M=a.hole;if(M){const G=M.shapePath?.shapePrimitives;if(G)for(let h=0;h<G.length;h++)G[h].shape.contains(y.x,y.y)&&(r=!1)}if(r)return!0}}return r}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(r)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(r))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Js.defaultFillStyle={color:16777215,alpha:1,texture:Pt.WHITE,matrix:null,fill:null,textureSpace:"local"};Js.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:Pt.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let ei=Js;const qs=class ai extends Re{constructor(t={}){super(),this.uid=Kt("textStyle"),this._tick=0,nm(t);const e={...ai.defaultTextStyle,...t};for(const r in e){const n=r;this[n]=e[r]}this.update(),this._tick=0}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.update())}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.update())}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...ai.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...ai.defaultDropShadow}):null,this.update())}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this.update())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t.toLowerCase(),this.update())}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.update())}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.update())}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.update())}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.update())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.update())}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.update())}get filters(){return this._filters}set filters(t){this._filters!==t&&(this._filters=Object.freeze(t),this.update())}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.update())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.update())}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.update())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.update())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.update())}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...ei.defaultFillStyle,...t},()=>{this._fill=ii({...this._originalFill},ei.defaultFillStyle)})),this._fill=ii(t===0?"black":t,ei.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...ei.defaultStrokeStyle,...t},()=>{this._stroke=gr({...this._originalStroke},ei.defaultStrokeStyle)})),this._stroke=gr(t,ei.defaultStrokeStyle),this.update())}update(){this._tick++,this.emit("update",this)}reset(){const t=ai.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return`${this.uid}-${this._tick}`}clone(){return new ai({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){if(this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(r),this._originalFill?.texture&&this._originalFill.texture.destroy(r),this._stroke?.texture&&this._stroke.texture.destroy(r),this._originalStroke?.texture&&this._originalStroke.texture.destroy(r)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(r,n,s)=>(r[n]===s||(r[n]=s,e?.(n,s),this.update()),!0)})}_isFillStyle(t){return(t??null)!==null&&!(le.isColorLike(t)||t instanceof Je||t instanceof Sr)}};qs.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};qs.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let xr=qs;function nm(i){const t=i;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=xr.defaultDropShadow;i.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){Gt(ae,"strokeThickness is now a part of stroke");const e=t.stroke;let r={};if(le.isColorLike(e))r.color=e;else if(e instanceof Je||e instanceof Sr)r.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))r=e;else throw new Error("Invalid stroke value.");i.stroke={...r,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if(Gt(ae,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&Jt("The number of fill colors must match the number of fill gradient stops.");const e=new Je({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),r=t.fillGradientStops.slice(),n=t.fill.map(s=>le.shared.setValue(s).toNumber());r.forEach((s,a)=>{e.addColorStop(s,n[a])}),i.fill={fill:e}}}class sm{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const r=qt.get().createCanvas();r.width=t,r.height=e;const n=r.getContext("2d");return{canvas:r,context:n}}getOptimalCanvasAndContext(t,e,r=1){t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6),t=pr(t),e=pr(e);const n=(t<<17)+(e<<1);this._canvasPool[n]||(this._canvasPool[n]=[]);let s=this._canvasPool[n].pop();return s||(s=this._createCanvasAndContext(t,e)),s}returnCanvasAndContext(t){const e=t.canvas,{width:r,height:n}=e,s=(r<<17)+(n<<1);t.context.resetTransform(),t.context.clearRect(0,0,r,n),this._canvasPool[s].push(t)}clear(){this._canvasPool={}}}const Es=new sm;Ui.register(Es);const na=1e5;function sa(i,t,e,r=0){if(i.texture===Pt.WHITE&&!i.fill)return le.shared.setValue(i.color).setAlpha(i.alpha??1).toHexa();if(i.fill){if(i.fill instanceof Sr){const n=i.fill,s=t.createPattern(n.texture.source.resource,"repeat"),a=n.transform.copyTo(Bt.shared);return a.scale(n.texture.frame.width,n.texture.frame.height),s.setTransform(a),s}else if(i.fill instanceof Je){const n=i.fill,s=n.type==="linear",a=n.textureSpace==="local";let o=1,l=1;a&&e&&(o=e.width+r,l=e.height+r);let c,f=!1;if(s){const{start:_,end:x}=n;c=t.createLinearGradient(_.x*o,_.y*l,x.x*o,x.y*l),f=Math.abs(x.x-_.x)<Math.abs((x.y-_.y)*.1)}else{const{center:_,innerRadius:x,outerCenter:y,outerRadius:M}=n;c=t.createRadialGradient(_.x*o,_.y*l,x*o,y.x*o,y.y*l,M*o)}if(f&&a&&e){const _=e.lineHeight/l;for(let x=0;x<e.lines.length;x++){const y=(x*e.lineHeight+r/2)/l;n.colorStops.forEach(M=>{const G=y+M.offset*_;c.addColorStop(Math.floor(G*na)/na,le.shared.setValue(M.color).toHex())})}}else n.colorStops.forEach(_=>{c.addColorStop(_.offset,le.shared.setValue(_.color).toHex())});return c}}else{const n=t.createPattern(i.texture.source.resource,"repeat"),s=i.matrix.copyTo(Bt.shared);return s.scale(i.texture.frame.width,i.texture.frame.height),n.setTransform(s),n}return Jt("FillStyle not recognised",i),"red"}const Jc=class qc extends Ac{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const e={...qc.defaultOptions,...t};this._textureSize=e.textureSize,this._mipmap=e.mipmap;const r=e.style.clone();e.overrideFill&&(r._fill.color=16777215,r._fill.alpha=1,r._fill.texture=Pt.WHITE,r._fill.fill=null),this.applyFillAsTint=e.overrideFill;const n=r.fontSize;r.fontSize=this.baseMeasurementFontSize;const s=Ps(r);e.overrideSize?r._stroke&&(r._stroke.width*=this.baseRenderedFontSize/n):r.fontSize=this.baseRenderedFontSize=n,this._style=r,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,e.textureStyle&&(this._textureStyle=e.textureStyle instanceof mr?e.textureStyle:new mr(e.textureStyle)),this.fontMetrics=hr.measureFont(s),this.lineHeight=r.lineHeight||this.fontMetrics.fontSize||r.fontSize}ensureCharacters(t){const e=hr.graphemeSegmenter(t).filter(h=>!this._currentChars.includes(h)).filter((h,v,C)=>C.indexOf(h)===v);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let r;this._currentPageIndex===-1?r=this._nextPage():r=this.pages[this._currentPageIndex];let{canvas:n,context:s}=r.canvasAndContext,a=r.texture.source;const o=this._style;let l=this._currentX,c=this._currentY,f=this._currentMaxCharHeight;const _=this.baseRenderedFontSize/this.baseMeasurementFontSize,x=this._padding*_;let y=!1;const M=n.width/this.resolution,G=n.height/this.resolution;for(let h=0;h<e.length;h++){const v=e[h],C=hr.measureText(v,o,n,!1);C.lineHeight=C.height;const E=C.width*_,k=Math.ceil((o.fontStyle==="italic"?2:1)*E),J=C.height*_,N=k+x*2,H=J+x*2;if(y=!1,v!==`
`&&v!=="\r"&&v!=="	"&&v!==" "&&(y=!0,f=Math.ceil(Math.max(H,f))),l+N>M&&(c+=f,f=H,l=0,c+f>G)){a.update();const j=this._nextPage();n=j.canvasAndContext.canvas,s=j.canvasAndContext.context,a=j.texture.source,l=0,c=0,f=0}const $=E/_-(o.dropShadow?.distance??0)-(o._stroke?.width??0);if(this.chars[v]={id:v.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:$,kerning:{}},y){this._drawGlyph(s,C,l+x,c+x,_,o);const j=a.width*_,K=a.height*_,rt=new Zt(l/j*a.width,c/K*a.height,N/j*a.width,H/K*a.height);this.chars[v].texture=new Pt({source:a,frame:rt}),l+=Math.ceil(N)}}a.update(),this._currentX=l,this._currentY=c,this._currentMaxCharHeight=f,this._skipKerning&&this._applyKerning(e,s)}get pageTextures(){return Gt(ae,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const r=this._measureCache;for(let n=0;n<t.length;n++){const s=t[n];for(let a=0;a<this._currentChars.length;a++){const o=this._currentChars[a];let l=r[s];l||(l=r[s]=e.measureText(s).width);let c=r[o];c||(c=r[o]=e.measureText(o).width);let f=e.measureText(s+o).width,_=f-(l+c);_&&(this.chars[s].kerning[o]=_),f=e.measureText(s+o).width,_=f-(l+c),_&&(this.chars[o].kerning[s]=_)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=Es.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const r=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),n=new Pt({source:new ni({resource:e.canvas,resolution:r,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(n.source.style=this._textureStyle);const s={canvasAndContext:e,texture:n};return this.pages[this._currentPageIndex]=s,s}_setupContext(t,e,r){e.fontSize=this.baseRenderedFontSize,t.scale(r,r),t.font=Ps(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const n=e._stroke,s=n?.width??0;if(n&&(t.lineWidth=s,t.lineJoin=n.join,t.miterLimit=n.miterLimit,t.strokeStyle=sa(n,t)),e._fill&&(t.fillStyle=sa(e._fill,t)),e.dropShadow){const a=e.dropShadow,o=le.shared.setValue(a.color).toArray(),l=a.blur*r,c=a.distance*r;t.shadowColor=`rgba(${o[0]*255},${o[1]*255},${o[2]*255},${a.alpha})`,t.shadowBlur=l,t.shadowOffsetX=Math.cos(a.angle)*c,t.shadowOffsetY=Math.sin(a.angle)*c}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,r,n,s,a){const o=e.text,l=e.fontProperties,f=(a._stroke?.width??0)*s,_=r+f/2,x=n-f/2,y=l.descent*s,M=e.lineHeight*s;let G=!1;a.stroke&&f&&(G=!0,t.strokeText(o,_,x+M-y));const{shadowBlur:h,shadowOffsetX:v,shadowOffsetY:C}=t;a._fill&&(G&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(o,_,x+M-y)),G&&(t.shadowBlur=h,t.shadowOffsetX=v,t.shadowOffsetY=C)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:r}=this.pages[t];Es.returnCanvasAndContext(e),r.destroy(!0)}this.pages=null}};Jc.defaultOptions={textureSize:512,style:new xr,mipmap:!0};let oa=Jc;function om(i,t,e,r){const n={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=e.baseLineOffset;let s=n.lines[0],a=null,o=!0;const l={width:0,start:0,index:0,positions:[],chars:[]},c=e.baseMeasurementFontSize/t.fontSize,f=t.letterSpacing*c,_=t.wordWrapWidth*c,x=t.lineHeight?t.lineHeight*c:e.lineHeight,y=t.wordWrap&&t.breakWords,M=v=>{const C=s.width;for(let E=0;E<l.index;E++){const k=v.positions[E];s.chars.push(v.chars[E]),s.charPositions.push(k+C)}s.width+=v.width,o=!1,l.width=0,l.index=0,l.chars.length=0},G=()=>{let v=s.chars.length-1;if(r){let C=s.chars[v];for(;C===" ";)s.width-=e.chars[C].xAdvance,C=s.chars[--v]}n.width=Math.max(n.width,s.width),s={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,n.lines.push(s),n.height+=x},h=v=>v-f>_;for(let v=0;v<i.length+1;v++){let C;const E=v===i.length;E||(C=i[v]);const k=e.chars[C]||e.chars[" "];if(/(?:\s)/.test(C)||C==="\r"||C===`
`||E){if(!o&&t.wordWrap&&h(s.width+l.width)?(G(),M(l),E||s.charPositions.push(0)):(l.start=s.width,M(l),E||s.charPositions.push(0)),C==="\r"||C===`
`)G();else if(!E){const $=k.xAdvance+(k.kerning[a]||0)+f;s.width+=$,s.spaceWidth=$,s.spacesIndex.push(s.charPositions.length),s.chars.push(C)}}else{const H=k.kerning[a]||0,$=k.xAdvance+H+f;y&&h(s.width+l.width+$)&&(M(l),G()),l.positions[l.index++]=l.width+H,l.chars.push(C),l.width+=$}a=C}return G(),t.align==="center"?am(n):t.align==="right"?lm(n):t.align==="justify"&&cm(n),n}function am(i){for(let t=0;t<i.lines.length;t++){const e=i.lines[t],r=i.width/2-e.width/2;for(let n=0;n<e.charPositions.length;n++)e.charPositions[n]+=r}}function lm(i){for(let t=0;t<i.lines.length;t++){const e=i.lines[t],r=i.width-e.width;for(let n=0;n<e.charPositions.length;n++)e.charPositions[n]+=r}}function cm(i){const t=i.width;for(let e=0;e<i.lines.length;e++){const r=i.lines[e];let n=0,s=r.spacesIndex[n++],a=0;const o=r.spacesIndex.length,c=(t-r.width)/o;for(let f=0;f<r.charPositions.length;f++)f===s&&(s=r.spacesIndex[n++],a+=c),r.charPositions[f]+=a}}function hm(i){if(i==="")return[];typeof i=="string"&&(i=[i]);const t=[];for(let e=0,r=i.length;e<r;e++){const n=i[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);if(n[0].length===0||n[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const s=n[0].charCodeAt(0),a=n[1].charCodeAt(0);if(a<s)throw new Error("[BitmapFont]: Invalid character range.");for(let o=s,l=a;o<=l;o++)t.push(String.fromCharCode(o))}else t.push(...Array.from(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}let sr=0;class um{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=Mc(1e3)}getFont(t,e){let r=`${e.fontFamily}-bitmap`,n=!0;if(e._fill.fill&&!e._stroke?(r+=e._fill.fill.styleKey,n=!1):(e._stroke||e.dropShadow)&&(r=`${e.styleKey}-bitmap`,n=!1),!Ut.has(r)){const a=Object.create(e);a.lineHeight=0;const o=new oa({style:a,overrideFill:n,overrideSize:!0,...this.defaultOptions});sr++,sr>50&&Jt("BitmapText",`You have dynamically created ${sr} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),o.once("destroy",()=>{sr--,Ut.remove(r)}),Ut.set(r,o)}const s=Ut.get(r);return s.ensureCharacters?.(t),s}getLayout(t,e,r=!0){const n=this.getFont(t,e),s=`${t}-${e.styleKey}-${r}`;if(this.measureCache.has(s))return this.measureCache.get(s);const a=hr.graphemeSegmenter(t),o=om(a,e,n,r);return this.measureCache.set(s,o),o}measureText(t,e,r=!0){return this.getLayout(t,e,r)}install(...t){let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:t[2]?.chars,resolution:t[2]?.resolution,padding:t[2]?.padding,skipKerning:t[2]?.skipKerning},Gt(ae,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const r=e?.name;if(!r)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const n=e.style,s=n instanceof xr?n:new xr(n),a=e.dynamicFill??this._canUseTintForStyle(s),o=new oa({style:s,overrideFill:a,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),l=hm(e.chars);return o.ensureCharacters(l.join("")),Ut.set(`${r}-bitmap`,o),o.once("destroy",()=>Ut.remove(`${r}-bitmap`)),o}uninstall(t){const e=`${t}-bitmap`,r=Ut.get(e);r&&r.destroy()}_canUseTintForStyle(t){return!t._stroke&&(!t.dropShadow||t.dropShadow.color===0)&&!t._fill.fill&&t._fill.color===16777215}}const aa=new um;class Hc extends Ac{constructor(t,e){super();const{textures:r,data:n}=t;Object.keys(n.pages).forEach(s=>{const a=n.pages[parseInt(s,10)],o=r[a.id];this.pages.push({texture:o})}),Object.keys(n.chars).forEach(s=>{const a=n.chars[s],{frame:o,source:l,rotate:c}=r[a.page],f=Lt.transformRectCoords(a,o,c,new Zt),_=new Pt({frame:f,orig:new Zt(0,0,a.width,a.height),source:l,rotate:c});this.chars[s]={id:s.codePointAt(0),xOffset:a.xOffset,yOffset:a.yOffset,xAdvance:a.xAdvance,kerning:a.kerning??{},texture:_}}),this.baseRenderedFontSize=n.fontSize,this.baseMeasurementFontSize=n.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:n.fontSize},this.baseLineOffset=n.baseLineOffset,this.lineHeight=n.lineHeight,this.fontFamily=n.fontFamily,this.distanceField=n.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){aa.install(t)}static uninstall(t){aa.uninstall(t)}}const tn={test(i){return typeof i=="string"&&i.startsWith("info face=")},parse(i){const t=i.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const _ in t){const x=t[_].match(/^[a-z]+/gm)[0],y=t[_].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),M={};for(const G in y){const h=y[G].split("="),v=h[0],C=h[1].replace(/"/gm,""),E=parseFloat(C),k=isNaN(E)?C:E;M[v]=k}e[x].push(M)}const r={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[n]=e.info,[s]=e.common,[a]=e.distanceField??[];a&&(r.distanceField={range:parseInt(a.distanceRange,10),type:a.fieldType}),r.fontSize=parseInt(n.size,10),r.fontFamily=n.face,r.lineHeight=parseInt(s.lineHeight,10);const o=e.page;for(let _=0;_<o.length;_++)r.pages.push({id:parseInt(o[_].id,10)||0,file:o[_].file});const l={};r.baseLineOffset=r.lineHeight-parseInt(s.base,10);const c=e.char;for(let _=0;_<c.length;_++){const x=c[_],y=parseInt(x.id,10);let M=x.letter??x.char??String.fromCharCode(y);M==="space"&&(M=" "),l[y]=M,r.chars[M]={id:y,page:parseInt(x.page,10)||0,x:parseInt(x.x,10),y:parseInt(x.y,10),width:parseInt(x.width,10),height:parseInt(x.height,10),xOffset:parseInt(x.xoffset,10),yOffset:parseInt(x.yoffset,10),xAdvance:parseInt(x.xadvance,10),kerning:{}}}const f=e.kerning||[];for(let _=0;_<f.length;_++){const x=parseInt(f[_].first,10),y=parseInt(f[_].second,10),M=parseInt(f[_].amount,10);r.chars[l[y]].kerning[l[x]]=M}return r}},la={test(i){const t=i;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(i){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=i.getElementsByTagName("info")[0],r=i.getElementsByTagName("common")[0],n=i.getElementsByTagName("distanceField")[0];n&&(t.distanceField={type:n.getAttribute("fieldType"),range:parseInt(n.getAttribute("distanceRange"),10)});const s=i.getElementsByTagName("page"),a=i.getElementsByTagName("char"),o=i.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(r.getAttribute("lineHeight"),10);for(let c=0;c<s.length;c++)t.pages.push({id:parseInt(s[c].getAttribute("id"),10)||0,file:s[c].getAttribute("file")});const l={};t.baseLineOffset=t.lineHeight-parseInt(r.getAttribute("base"),10);for(let c=0;c<a.length;c++){const f=a[c],_=parseInt(f.getAttribute("id"),10);let x=f.getAttribute("letter")??f.getAttribute("char")??String.fromCharCode(_);x==="space"&&(x=" "),l[_]=x,t.chars[x]={id:_,page:parseInt(f.getAttribute("page"),10)||0,x:parseInt(f.getAttribute("x"),10),y:parseInt(f.getAttribute("y"),10),width:parseInt(f.getAttribute("width"),10),height:parseInt(f.getAttribute("height"),10),xOffset:parseInt(f.getAttribute("xoffset"),10),yOffset:parseInt(f.getAttribute("yoffset"),10),xAdvance:parseInt(f.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<o.length;c++){const f=parseInt(o[c].getAttribute("first"),10),_=parseInt(o[c].getAttribute("second"),10),x=parseInt(o[c].getAttribute("amount"),10);t.chars[l[_]].kerning[l[f]]=x}return t}},ca={test(i){return typeof i=="string"&&i.match(/<font(\s|>)/)?la.test(qt.get().parseXML(i)):!1},parse(i){return la.parse(qt.get().parseXML(i))}},fm=[".xml",".fnt"],pm={extension:{type:wt.CacheParser,name:"cacheBitmapFont"},test:i=>i instanceof Hc,getCacheableAssets(i,t){const e={};return i.forEach(r=>{e[r]=t,e[`${r}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},mm={extension:{type:wt.LoadParser,priority:Xe.Normal},name:"loadBitmapFont",id:"bitmap-font",test(i){return fm.includes(be.extname(i).toLowerCase())},async testParse(i){return tn.test(i)||ca.test(i)},async parse(i,t,e){const r=tn.test(i)?tn.parse(i):ca.parse(i),{src:n}=t,{pages:s}=r,a=[],o=r.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let _=0;_<s.length;++_){const x=s[_].file;let y=be.join(be.dirname(n),x);y=vs(y,n),a.push({src:y,data:o})}const l=await e.load(a),c=a.map(_=>l[_.src]);return new Hc({data:r,textures:c},n)},async load(i,t){return await(await qt.get().fetch(i)).text()},async unload(i,t,e){await Promise.all(i.pages.map(r=>e.unload(r.texture.source._sourceOrigin))),i.destroy()}};class dm{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const ym={extension:{type:wt.CacheParser,name:"cacheTextureArray"},test:i=>Array.isArray(i)&&i.every(t=>t instanceof Pt),getCacheableAssets:(i,t)=>{const e={};return i.forEach(r=>{t.forEach((n,s)=>{e[r+(s===0?"":s+1)]=n})}),e}};async function $c(i){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(i)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const _m={extension:{type:wt.DetectionParser,priority:1},test:async()=>$c("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")},ha=["png","jpg","jpeg"],gm={extension:{type:wt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...ha],remove:async i=>i.filter(t=>!ha.includes(t))},xm="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Ar(i){return xm?!1:document.createElement("video").canPlayType(i)!==""}const vm={extension:{type:wt.DetectionParser,priority:0},test:async()=>Ar("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(t=>t!=="mp4"&&t!=="m4v")},bm={extension:{type:wt.DetectionParser,priority:0},test:async()=>Ar("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(t=>t!=="ogv")},wm={extension:{type:wt.DetectionParser,priority:0},test:async()=>Ar("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(t=>t!=="webm")},Sm={extension:{type:wt.DetectionParser,priority:0},test:async()=>$c("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")},Xc=class ur{constructor(){this.loadOptions={...ur.defaultOptions},this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{let n=null,s=null;if((e.parser||e.loadParser)&&(s=this._parserHash[e.parser||e.loadParser],e.loadParser&&Jt(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),s||Jt(`[Assets] specified load parser "${e.parser||e.loadParser}" not found while loading ${t}`)),!s){for(let a=0;a<this.parsers.length;a++){const o=this.parsers[a];if(o.load&&o.test?.(t,e,this)){s=o;break}}if(!s)return Jt(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(t,e,this),r.parser=s;for(let a=0;a<this.parsers.length;a++){const o=this.parsers[a];o.parse&&o.parse&&await o.testParse?.(n,e,this)&&(n=await o.parse(n,e,this)||n,r.parser=o)}return n})(),r}async load(t,e){this._parsersValidated||this._validateParsers();const r=typeof e=="function"?{...ur.defaultOptions,...this.loadOptions,onProgress:e}:{...ur.defaultOptions,...this.loadOptions,...e||{}},{onProgress:n,onError:s,strategy:a,retryCount:o,retryDelay:l}=r;let c=0;const f={},_=yr(t),x=Ie(t,G=>({alias:[G],src:G,data:{}})),y=x.reduce((G,h)=>G+(h.progressSize||1),0),M=x.map(async G=>{const h=be.toAbsolute(G.src);f[G.src]||(await this._loadAssetWithRetry(h,G,{onProgress:n,onError:s,strategy:a,retryCount:o,retryDelay:l},f),c+=G.progressSize||1,n&&n(c/y))});return await Promise.all(M),_?f[x[0].src]:f}async unload(t){const r=Ie(t,n=>({alias:[n],src:n})).map(async n=>{const s=be.toAbsolute(n.src),a=this.promiseCache[s];if(a){const o=await a.promise;delete this.promiseCache[s],await a.parser?.unload?.(o,n,this)}});await Promise.all(r)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,e)=>(!e.name&&!e.id?Jt("[Assets] parser should have an id"):(t[e.name]||t[e.id])&&Jt(`[Assets] parser id conflict "${e.id}"`),t[e.name]=e,e.id&&(t[e.id]=e),t),{})}async _loadAssetWithRetry(t,e,r,n){let s=0;const{onError:a,strategy:o,retryCount:l,retryDelay:c}=r,f=_=>new Promise(x=>setTimeout(x,_));for(;;)try{this.promiseCache[t]||(this.promiseCache[t]=this._getLoadPromiseAndParser(t,e)),n[e.src]=await this.promiseCache[t].promise;return}catch(_){delete this.promiseCache[t],delete n[e.src],s++;const x=o!=="retry"||s>l;if(o==="retry"&&!x){a&&a(_,e),await f(c);continue}if(o==="skip"){a&&a(_,e);return}throw a&&a(_,e),new Error(`[Loader.load] Failed to load ${t}.
${_}`)}}};Xc.defaultOptions={onProgress:void 0,onError:void 0,strategy:"throw",retryCount:3,retryDelay:250};let Cm=Xc;function mi(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function di(i,t){const e=i.split("?")[0],r=be.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const Am=".json",Mm="application/json",Pm={extension:{type:wt.LoadParser,priority:Xe.Low},name:"loadJson",id:"json",test(i){return mi(i,Mm)||di(i,Am)},async load(i){return await(await qt.get().fetch(i)).json()}},Bm=".txt",Tm="text/plain",Im={name:"loadTxt",id:"text",extension:{type:wt.LoadParser,priority:Xe.Low,name:"loadTxt"},test(i){return mi(i,Tm)||di(i,Bm)},async load(i){return await(await qt.get().fetch(i)).text()}},Dm=["normal","bold","100","200","300","400","500","600","700","800","900"],Em=[".ttf",".otf",".woff",".woff2"],Rm=["font/ttf","font/otf","font/woff","font/woff2"],Fm=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function km(i){const t=be.extname(i),n=be.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1));let s=n.length>0;for(const o of n)if(!o.match(Fm)){s=!1;break}let a=n.join(" ");return s||(a=`"${a.replace(/[\\"]/g,"\\$&")}"`),a}const Vm=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Lm(i){return Vm.test(i)?i:encodeURI(i)}const Gm={extension:{type:wt.LoadParser,priority:Xe.Low},name:"loadWebFont",id:"web-font",test(i){return mi(i,Rm)||di(i,Em)},async load(i,t){const e=qt.get().getFontFaceSet();if(e){const r=[],n=t.data?.family??km(i),s=t.data?.weights?.filter(o=>Dm.includes(o))??["normal"],a=t.data??{};for(let o=0;o<s.length;o++){const l=s[o],c=new FontFace(n,`url(${Lm(i)})`,{...a,weight:l});await c.load(),e.add(c),r.push(c)}return Ut.has(`${n}-and-url`)?Ut.get(`${n}-and-url`).entries.push({url:i,faces:r}):Ut.set(`${n}-and-url`,{entries:[{url:i,faces:r}]}),r.length===1?r[0]:r}return Jt("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){const t=Array.isArray(i)?i:[i],e=t[0].family,r=Ut.get(`${e}-and-url`),n=r.entries.find(s=>s.faces.some(a=>t.indexOf(a)!==-1));n.faces=n.faces.filter(s=>t.indexOf(s)===-1),n.faces.length===0&&(r.entries=r.entries.filter(s=>s!==n)),t.forEach(s=>{qt.get().getFontFaceSet().delete(s)}),r.entries.length===0&&Ut.remove(`${e}-and-url`)}};function Hs(i,t=1){const e=pi.RETINA_PREFIX?.exec(i);return e?parseFloat(e[1]):t}function $s(i,t,e){i.label=e,i._sourceOrigin=e;const r=new Pt({source:i,label:e}),n=()=>{delete t.promiseCache[e],Ut.has(e)&&Ut.remove(e)};return r.source.once("destroy",()=>{t.promiseCache[e]&&(Jt("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),n())}),r.once("destroy",()=>{i.destroyed||(Jt("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),r}const Om=".svg",Nm="image/svg+xml",zm={extension:{type:wt.LoadParser,priority:Xe.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(i){return mi(i,Nm)||di(i,Om)},async load(i,t,e){return t.data?.parseAsGraphicsContext??this.config.parseAsGraphicsContext?Um(i):Wm(i,t,e,this.config.crossOrigin)},unload(i){i.destroy(!0)}};async function Wm(i,t,e,r){const n=await qt.get().fetch(i),s=qt.get().createImage();s.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await n.text())}`,s.crossOrigin=r,await s.decode();const a=t.data?.width??s.width,o=t.data?.height??s.height,l=t.data?.resolution||Hs(i),c=Math.ceil(a*l),f=Math.ceil(o*l),_=qt.get().createCanvas(c,f),x=_.getContext("2d");x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(s,0,0,a*l,o*l);const{parseAsGraphicsContext:y,...M}=t.data??{},G=new ni({resource:_,alphaMode:"premultiply-alpha-on-upload",resolution:l,...M});return $s(G,e,i)}async function Um(i){const e=await(await qt.get().fetch(i)).text(),r=new ei;return r.svg(e),r}const Jm=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let ci=null,Rs=class{constructor(){ci||(ci=URL.createObjectURL(new Blob([Jm],{type:"application/javascript"}))),this.worker=new Worker(ci)}};Rs.revokeObjectURL=function(){ci&&(URL.revokeObjectURL(ci),ci=null)};const qm=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let hi=null;class Yc{constructor(){hi||(hi=URL.createObjectURL(new Blob([qm],{type:"application/javascript"}))),this.worker=new Worker(hi)}}Yc.revokeObjectURL=function(){hi&&(URL.revokeObjectURL(hi),hi=null)};let ua=0,en;class Hm{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new Rs;e.addEventListener("message",r=>{e.terminate(),Rs.revokeObjectURL(),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t,e){return this._run("loadImageBitmap",[t,e?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){en===void 0&&(en=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<en&&(this._createdWorkers++,t=new Yc().worker,t.addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){this._resolveHash[t.uuid]&&(t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),delete this._resolveHash[t.uuid])}async _run(t,e){await this._initWorkers();const r=new Promise((n,s)=>{this._queue.push({id:t,arguments:e,resolve:n,reject:s})});return this._next(),r}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),r=e.id;this._resolveHash[ua]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:ua++,id:r})}reset(){this._workerPool.forEach(t=>t.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:t})=>{t?.(new Error("WorkerManager has been reset before completion"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const fa=new Hm,$m=[".jpeg",".jpg",".png",".webp",".avif"],Xm=["image/jpeg","image/png","image/webp","image/avif"];async function Ym(i,t){const e=await qt.get().fetch(i);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${e.status} ${e.statusText}`);const r=await e.blob();return t?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(r,{premultiplyAlpha:"none"}):createImageBitmap(r)}const Kc={name:"loadTextures",id:"texture",extension:{type:wt.LoadParser,priority:Xe.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return mi(i,Xm)||di(i,$m)},async load(i,t,e){let r=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await fa.isImageBitmapSupported()?r=await fa.loadImageBitmap(i,t):r=await Ym(i,t):r=await new Promise((s,a)=>{r=qt.get().createImage(),r.crossOrigin=this.config.crossOrigin,r.src=i,r.complete?s(r):(r.onload=()=>{s(r)},r.onerror=a)});const n=new ni({resource:r,alphaMode:"premultiply-alpha-on-upload",resolution:t.data?.resolution||Hs(i),...t.data});return $s(n,e,i)},unload(i){i.destroy(!0)}},Km=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let rn,nn;function Zm(i,t,e){e===void 0&&!t.startsWith("data:")?i.crossOrigin=jm(t):e!==!1&&(i.crossOrigin=typeof e=="string"?e:"anonymous")}function Qm(i){return new Promise((t,e)=>{i.addEventListener("canplaythrough",r),i.addEventListener("error",n),i.load();function r(){s(),t()}function n(a){s(),e(a)}function s(){i.removeEventListener("canplaythrough",r),i.removeEventListener("error",n)}})}function jm(i,t=globalThis.location){if(i.startsWith("data:"))return"";t||(t=globalThis.location);const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function td(){const i=[],t=[];for(const e of Km){const r=Ri.MIME_TYPES[e.substring(1)]||`video/${e.substring(1)}`;Ar(r)&&(i.push(e),t.includes(r)||t.push(r))}return{validVideoExtensions:i,validVideoMime:t}}const ed={name:"loadVideo",id:"video",extension:{type:wt.LoadParser,name:"loadVideo"},test(i){if(!rn||!nn){const{validVideoExtensions:r,validVideoMime:n}=td();rn=r,nn=n}const t=mi(i,nn),e=di(i,rn);return t||e},async load(i,t,e){const r={...Ri.defaultOptions,resolution:t.data?.resolution||Hs(i),alphaMode:t.data?.alphaMode||await tc(),...t.data},n=document.createElement("video"),s={preload:r.autoLoad!==!1?"auto":void 0,"webkit-playsinline":r.playsinline!==!1?"":void 0,playsinline:r.playsinline!==!1?"":void 0,muted:r.muted===!0?"":void 0,loop:r.loop===!0?"":void 0,autoplay:r.autoPlay!==!1?"":void 0};Object.keys(s).forEach(l=>{const c=s[l];c!==void 0&&n.setAttribute(l,c)}),r.muted===!0&&(n.muted=!0),Zm(n,i,r.crossorigin);const a=document.createElement("source");let o;if(r.mime)o=r.mime;else if(i.startsWith("data:"))o=i.slice(5,i.indexOf(";"));else if(!i.startsWith("blob:")){const l=i.split("?")[0].slice(i.lastIndexOf(".")+1).toLowerCase();o=Ri.MIME_TYPES[l]||`video/${l}`}return a.src=i,o&&(a.type=o),new Promise(l=>{const c=async()=>{const f=new Ri({...r,resource:n});n.removeEventListener("canplay",c),t.data.preload&&await Qm(n),l($s(f,e,i))};r.preload&&!r.autoPlay&&n.load(),n.addEventListener("canplay",c),n.appendChild(a)})},unload(i){i.destroy(!0)}},Zc={extension:{type:wt.ResolveParser,name:"resolveTexture"},test:Kc.test,parse:i=>({resolution:parseFloat(pi.RETINA_PREFIX.exec(i)?.[1]??"1"),format:i.split(".").pop(),src:i})},id={extension:{type:wt.ResolveParser,priority:-2,name:"resolveJson"},test:i=>pi.RETINA_PREFIX.test(i)&&i.endsWith(".json"),parse:Zc.parse};class rd{constructor(){this._detections=[],this._initialized=!1,this.resolver=new pi,this.loader=new Cm,this.cache=Ut,this._backgroundLoader=new dm(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){Jt("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let s=t.manifest;typeof s=="string"&&(s=await this.load(s)),this.resolver.addManifest(s)}const e=t.texturePreference?.resolution??1,r=typeof e=="number"?[e]:e,n=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:r}}),t.preferences&&this.setPreferences(t.preferences),t.loadOptions&&(this.loader.loadOptions={...this.loader.loadOptions,...t.loadOptions})}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const r=yr(t),n=Ie(t).map(o=>{if(typeof o!="string"){const l=this.resolver.getAlias(o);return l.some(c=>!this.resolver.hasKey(c))&&this.add(o),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(o)||this.add({alias:o,src:o}),o}),s=this.resolver.resolve(n),a=await this._mapLoadToResolve(s,e);return r?a[n[0]]:a}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},a=Object.keys(n);let o=0;const l=[],c=()=>{e?.(l.reduce((_,x)=>_+x,0)/o)},f=a.map((_,x)=>{const y=n[_],M=Object.values(y),h=[...new Set(M.flat())].reduce((v,C)=>v+(C.progressSize||1),0);return l.push(0),o+=h,this._mapLoadToResolve(y,v=>{l[x]=v*h,c()}).then(v=>{s[_]=v})});return await Promise.all(f),r?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Ut.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=Ut.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const n=await this.loader.load(r,e);this._backgroundLoader.active=!0;const s={};return r.forEach(a=>{const o=n[a.src],l=[a.src];a.alias&&l.push(...a.alias),l.forEach(c=>{s[c]=o}),Ut.set(l,o)}),s}async unload(t){this._initialized||await this.init();const e=Ie(t).map(n=>typeof n!="string"?n.src:n),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=Ie(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(r=>{Ut.remove(r.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter((r,n)=>e.indexOf(r)===n),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(r=>r in t).forEach(r=>{e.config[r]=t[r]})})}}const Ti=new rd;ue.handleByList(wt.LoadParser,Ti.loader.parsers).handleByList(wt.ResolveParser,Ti.resolver.parsers).handleByList(wt.CacheParser,Ti.cache.parsers).handleByList(wt.DetectionParser,Ti.detections);ue.add(ym,gm,_m,Sm,vm,bm,wm,Pm,Im,Gm,zm,Kc,ed,mm,pm,Zc,id);const pa={loader:wt.LoadParser,resolver:wt.ResolveParser,cache:wt.CacheParser,detection:wt.DetectionParser};ue.handle(wt.Asset,i=>{const t=i.ref;Object.entries(pa).filter(([e])=>!!t[e]).forEach(([e,r])=>ue.add(Object.assign(t[e],{extension:t[e].extension??r})))},i=>{const t=i.ref;Object.keys(pa).filter(e=>!!t[e]).forEach(e=>ue.remove(t[e]))});class vr extends ri{constructor(...t){let e=t[0];Array.isArray(t[0])&&(e={textures:t[0],autoUpdate:t[1]});const{animationSpeed:r=1,autoPlay:n=!1,autoUpdate:s=!0,loop:a=!0,onComplete:o=null,onFrameChange:l=null,onLoop:c=null,textures:f,updateAnchor:_=!1,...x}=e,[y]=f;super({...x,texture:y instanceof Pt?y:y.texture}),this._textures=null,this._durations=null,this._autoUpdate=s,this._isConnectedToTicker=!1,this.animationSpeed=r,this.loop=a,this.updateAnchor=_,this.onComplete=o,this.onFrameChange=l,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=f,n&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(He.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(He.shared.add(this.update,this,dr.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=t.deltaTime,r=this.animationSpeed*e,n=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const a=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*a,this._currentTime+=a;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n||this.animationSpeed<0&&this.currentFrame>n)&&this.onLoop(),this._updateTexture())}_updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this.texture=this._textures[t],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t=!1){if(typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._textures.forEach(n=>{this.texture!==n&&n.destroy(r)})}this._textures=[],this._durations=null,this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let r=0;r<t.length;++r)e.push(Pt.from(t[r]));return new vr(e)}static fromImages(t){const e=[];for(let r=0;r<t.length;++r)e.push(Pt.from(t[r]));return new vr(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof Pt)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(He.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(He.shared.add(this.update,this),this._isConnectedToTicker=!0))}}ue.add(fh,ph);var Ji=function(){this.app=new Cc,this.app.init({width:Ot.consts.STAGE_WIDTH_PIXEL,height:Ot.consts.STAGE_HEIGHT_PIXEL,backgroundColor:3355443}).then(()=>{document.getElementById("gameContainer").appendChild(this.app.canvas),console.log("Pixi stage created")}),this.container=new Ue,this.container.sortableChildren=!0,this.app.stage.addChild(this.container)};Ji.prototype.loadAtlas=function(i){Ti.load(Ot.atlas).then(t=>{i(null,{atlas:t})})};Ji.prototype.createThenAddSprite=function(i){var t,e;return t=Pt.from(i.frameId),e=new ri(t),e.anchor.set(typeof i.anchor<"u"?i.anchor:.5),this.container.addChild(e),e};Ji.prototype.step=function(){this.app.renderer.render(this.app.stage)};Ji.prototype.setVisible=function(i){this.app.canvas.style.display=i?"block":"none"};var p={};(function(i,t){!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(r,n,s){s.get instanceof Function&&r.__defineGetter__(n,s.get),s.set instanceof Function&&r.__defineSetter__(n,s.set)});function e(){}i.inherit=function(r,n){var s=r;e.prototype=n.prototype,r.prototype=new e,r.prototype.constructor=s},i.generateCallback=function(n,s){return function(){s.apply(n,arguments)}},i.NVector=function(n){n===t&&(n=0);for(var s=new Array(n||0),a=0;a<n;++a)s[a]=0;return s},i.is=function(n,s){return n===null?!1:!!(s instanceof Function&&n instanceof s||n.constructor.__implements!=t&&n.constructor.__implements[s])},i.parseUInt=function(r){return Math.abs(parseInt(r))}})(p);var Wt=Array,we=p.NVector;typeof p>"u"&&(p={});typeof p.Collision>"u"&&(p.Collision={});typeof p.Collision.Shapes>"u"&&(p.Collision.Shapes={});typeof p.Common>"u"&&(p.Common={});typeof p.Common.Math>"u"&&(p.Common.Math={});typeof p.Dynamics>"u"&&(p.Dynamics={});typeof p.Dynamics.Contacts>"u"&&(p.Dynamics.Contacts={});typeof p.Dynamics.Controllers>"u"&&(p.Dynamics.Controllers={});typeof p.Dynamics.Joints>"u"&&(p.Dynamics.Joints={});(function(){p.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";function i(){i.b2AABB.apply(this,arguments)}p.Collision.b2AABB=i;function t(){t.b2Bound.apply(this,arguments)}p.Collision.b2Bound=t;function e(){e.b2BoundValues.apply(this,arguments),this.constructor===e&&this.b2BoundValues.apply(this,arguments)}p.Collision.b2BoundValues=e;function r(){r.b2Collision.apply(this,arguments)}p.Collision.b2Collision=r;function n(){n.b2ContactID.apply(this,arguments),this.constructor===n&&this.b2ContactID.apply(this,arguments)}p.Collision.b2ContactID=n;function s(){s.b2ContactPoint.apply(this,arguments)}p.Collision.b2ContactPoint=s;function a(){a.b2Distance.apply(this,arguments)}p.Collision.b2Distance=a;function o(){o.b2DistanceInput.apply(this,arguments)}p.Collision.b2DistanceInput=o;function l(){l.b2DistanceOutput.apply(this,arguments)}p.Collision.b2DistanceOutput=l;function c(){c.b2DistanceProxy.apply(this,arguments)}p.Collision.b2DistanceProxy=c;function f(){f.b2DynamicTree.apply(this,arguments),this.constructor===f&&this.b2DynamicTree.apply(this,arguments)}p.Collision.b2DynamicTree=f;function _(){_.b2DynamicTreeBroadPhase.apply(this,arguments)}p.Collision.b2DynamicTreeBroadPhase=_;function x(){x.b2DynamicTreeNode.apply(this,arguments)}p.Collision.b2DynamicTreeNode=x;function y(){y.b2DynamicTreePair.apply(this,arguments)}p.Collision.b2DynamicTreePair=y;function M(){M.b2Manifold.apply(this,arguments),this.constructor===M&&this.b2Manifold.apply(this,arguments)}p.Collision.b2Manifold=M;function G(){G.b2ManifoldPoint.apply(this,arguments),this.constructor===G&&this.b2ManifoldPoint.apply(this,arguments)}p.Collision.b2ManifoldPoint=G;function h(){h.b2Point.apply(this,arguments)}p.Collision.b2Point=h;function v(){v.b2RayCastInput.apply(this,arguments),this.constructor===v&&this.b2RayCastInput.apply(this,arguments)}p.Collision.b2RayCastInput=v;function C(){C.b2RayCastOutput.apply(this,arguments)}p.Collision.b2RayCastOutput=C;function E(){E.b2Segment.apply(this,arguments)}p.Collision.b2Segment=E;function k(){k.b2SeparationFunction.apply(this,arguments)}p.Collision.b2SeparationFunction=k;function J(){J.b2Simplex.apply(this,arguments),this.constructor===J&&this.b2Simplex.apply(this,arguments)}p.Collision.b2Simplex=J;function N(){N.b2SimplexCache.apply(this,arguments)}p.Collision.b2SimplexCache=N;function H(){H.b2SimplexVertex.apply(this,arguments)}p.Collision.b2SimplexVertex=H;function $(){$.b2TimeOfImpact.apply(this,arguments)}p.Collision.b2TimeOfImpact=$;function j(){j.b2TOIInput.apply(this,arguments)}p.Collision.b2TOIInput=j;function K(){K.b2WorldManifold.apply(this,arguments),this.constructor===K&&this.b2WorldManifold.apply(this,arguments)}p.Collision.b2WorldManifold=K;function rt(){rt.ClipVertex.apply(this,arguments)}p.Collision.ClipVertex=rt;function B(){B.Features.apply(this,arguments)}p.Collision.Features=B;function I(){I.b2CircleShape.apply(this,arguments),this.constructor===I&&this.b2CircleShape.apply(this,arguments)}p.Collision.Shapes.b2CircleShape=I;function F(){F.b2EdgeChainDef.apply(this,arguments),this.constructor===F&&this.b2EdgeChainDef.apply(this,arguments)}p.Collision.Shapes.b2EdgeChainDef=F;function A(){A.b2EdgeShape.apply(this,arguments),this.constructor===A&&this.b2EdgeShape.apply(this,arguments)}p.Collision.Shapes.b2EdgeShape=A;function D(){D.b2MassData.apply(this,arguments)}p.Collision.Shapes.b2MassData=D;function W(){W.b2PolygonShape.apply(this,arguments),this.constructor===W&&this.b2PolygonShape.apply(this,arguments)}p.Collision.Shapes.b2PolygonShape=W;function U(){U.b2Shape.apply(this,arguments),this.constructor===U&&this.b2Shape.apply(this,arguments)}p.Collision.Shapes.b2Shape=U,p.Common.b2internal="Box2D.Common.b2internal";function u(){u.b2Color.apply(this,arguments),this.constructor===u&&this.b2Color.apply(this,arguments)}p.Common.b2Color=u;function g(){g.b2Settings.apply(this,arguments)}p.Common.b2Settings=g;function V(){V.b2Mat22.apply(this,arguments),this.constructor===V&&this.b2Mat22.apply(this,arguments)}p.Common.Math.b2Mat22=V;function d(){d.b2Mat33.apply(this,arguments),this.constructor===d&&this.b2Mat33.apply(this,arguments)}p.Common.Math.b2Mat33=d;function w(){w.b2Math.apply(this,arguments)}p.Common.Math.b2Math=w;function m(){m.b2Sweep.apply(this,arguments)}p.Common.Math.b2Sweep=m;function P(){P.b2Transform.apply(this,arguments),this.constructor===P&&this.b2Transform.apply(this,arguments)}p.Common.Math.b2Transform=P;function T(){T.b2Vec2.apply(this,arguments),this.constructor===T&&this.b2Vec2.apply(this,arguments)}p.Common.Math.b2Vec2=T;function L(){L.b2Vec3.apply(this,arguments),this.constructor===L&&this.b2Vec3.apply(this,arguments)}p.Common.Math.b2Vec3=L;function O(){O.b2Body.apply(this,arguments),this.constructor===O&&this.b2Body.apply(this,arguments)}p.Dynamics.b2Body=O;function R(){R.b2BodyDef.apply(this,arguments),this.constructor===R&&this.b2BodyDef.apply(this,arguments)}p.Dynamics.b2BodyDef=R;function z(){z.b2ContactFilter.apply(this,arguments)}p.Dynamics.b2ContactFilter=z;function q(){q.b2ContactImpulse.apply(this,arguments)}p.Dynamics.b2ContactImpulse=q;function X(){X.b2ContactListener.apply(this,arguments)}p.Dynamics.b2ContactListener=X;function Y(){Y.b2ContactManager.apply(this,arguments),this.constructor===Y&&this.b2ContactManager.apply(this,arguments)}p.Dynamics.b2ContactManager=Y;function Q(){Q.b2DebugDraw.apply(this,arguments),this.constructor===Q&&this.b2DebugDraw.apply(this,arguments)}p.Dynamics.b2DebugDraw=Q;function tt(){tt.b2DestructionListener.apply(this,arguments)}p.Dynamics.b2DestructionListener=tt;function at(){at.b2FilterData.apply(this,arguments)}p.Dynamics.b2FilterData=at;function et(){et.b2Fixture.apply(this,arguments),this.constructor===et&&this.b2Fixture.apply(this,arguments)}p.Dynamics.b2Fixture=et;function st(){st.b2FixtureDef.apply(this,arguments),this.constructor===st&&this.b2FixtureDef.apply(this,arguments)}p.Dynamics.b2FixtureDef=st;function lt(){lt.b2Island.apply(this,arguments),this.constructor===lt&&this.b2Island.apply(this,arguments)}p.Dynamics.b2Island=lt;function Z(){Z.b2TimeStep.apply(this,arguments)}p.Dynamics.b2TimeStep=Z;function it(){it.b2World.apply(this,arguments),this.constructor===it&&this.b2World.apply(this,arguments)}p.Dynamics.b2World=it;function ft(){ft.b2CircleContact.apply(this,arguments)}p.Dynamics.Contacts.b2CircleContact=ft;function ut(){ut.b2Contact.apply(this,arguments),this.constructor===ut&&this.b2Contact.apply(this,arguments)}p.Dynamics.Contacts.b2Contact=ut;function dt(){dt.b2ContactConstraint.apply(this,arguments),this.constructor===dt&&this.b2ContactConstraint.apply(this,arguments)}p.Dynamics.Contacts.b2ContactConstraint=dt;function pt(){pt.b2ContactConstraintPoint.apply(this,arguments)}p.Dynamics.Contacts.b2ContactConstraintPoint=pt;function mt(){mt.b2ContactEdge.apply(this,arguments)}p.Dynamics.Contacts.b2ContactEdge=mt;function Ct(){Ct.b2ContactFactory.apply(this,arguments),this.constructor===Ct&&this.b2ContactFactory.apply(this,arguments)}p.Dynamics.Contacts.b2ContactFactory=Ct;function kt(){kt.b2ContactRegister.apply(this,arguments)}p.Dynamics.Contacts.b2ContactRegister=kt;function Mt(){Mt.b2ContactResult.apply(this,arguments)}p.Dynamics.Contacts.b2ContactResult=Mt;function yt(){yt.b2ContactSolver.apply(this,arguments),this.constructor===yt&&this.b2ContactSolver.apply(this,arguments)}p.Dynamics.Contacts.b2ContactSolver=yt;function St(){St.b2EdgeAndCircleContact.apply(this,arguments)}p.Dynamics.Contacts.b2EdgeAndCircleContact=St;function Et(){Et.b2NullContact.apply(this,arguments),this.constructor===Et&&this.b2NullContact.apply(this,arguments)}p.Dynamics.Contacts.b2NullContact=Et;function Nt(){Nt.b2PolyAndCircleContact.apply(this,arguments)}p.Dynamics.Contacts.b2PolyAndCircleContact=Nt;function Vt(){Vt.b2PolyAndEdgeContact.apply(this,arguments)}p.Dynamics.Contacts.b2PolyAndEdgeContact=Vt;function Ft(){Ft.b2PolygonContact.apply(this,arguments)}p.Dynamics.Contacts.b2PolygonContact=Ft;function b(){b.b2PositionSolverManifold.apply(this,arguments),this.constructor===b&&this.b2PositionSolverManifold.apply(this,arguments)}p.Dynamics.Contacts.b2PositionSolverManifold=b;function S(){S.b2BuoyancyController.apply(this,arguments)}p.Dynamics.Controllers.b2BuoyancyController=S;function ot(){ot.b2ConstantAccelController.apply(this,arguments)}p.Dynamics.Controllers.b2ConstantAccelController=ot;function ct(){ct.b2ConstantForceController.apply(this,arguments)}p.Dynamics.Controllers.b2ConstantForceController=ct;function ht(){ht.b2Controller.apply(this,arguments)}p.Dynamics.Controllers.b2Controller=ht;function nt(){nt.b2ControllerEdge.apply(this,arguments)}p.Dynamics.Controllers.b2ControllerEdge=nt;function gt(){gt.b2GravityController.apply(this,arguments)}p.Dynamics.Controllers.b2GravityController=gt;function vt(){vt.b2TensorDampingController.apply(this,arguments)}p.Dynamics.Controllers.b2TensorDampingController=vt;function _t(){_t.b2DistanceJoint.apply(this,arguments),this.constructor===_t&&this.b2DistanceJoint.apply(this,arguments)}p.Dynamics.Joints.b2DistanceJoint=_t;function At(){At.b2DistanceJointDef.apply(this,arguments),this.constructor===At&&this.b2DistanceJointDef.apply(this,arguments)}p.Dynamics.Joints.b2DistanceJointDef=At;function zt(){zt.b2FrictionJoint.apply(this,arguments),this.constructor===zt&&this.b2FrictionJoint.apply(this,arguments)}p.Dynamics.Joints.b2FrictionJoint=zt;function Tt(){Tt.b2FrictionJointDef.apply(this,arguments),this.constructor===Tt&&this.b2FrictionJointDef.apply(this,arguments)}p.Dynamics.Joints.b2FrictionJointDef=Tt;function bt(){bt.b2GearJoint.apply(this,arguments),this.constructor===bt&&this.b2GearJoint.apply(this,arguments)}p.Dynamics.Joints.b2GearJoint=bt;function jt(){jt.b2GearJointDef.apply(this,arguments),this.constructor===jt&&this.b2GearJointDef.apply(this,arguments)}p.Dynamics.Joints.b2GearJointDef=jt;function te(){te.b2Jacobian.apply(this,arguments)}p.Dynamics.Joints.b2Jacobian=te;function ce(){ce.b2Joint.apply(this,arguments),this.constructor===ce&&this.b2Joint.apply(this,arguments)}p.Dynamics.Joints.b2Joint=ce;function It(){It.b2JointDef.apply(this,arguments),this.constructor===It&&this.b2JointDef.apply(this,arguments)}p.Dynamics.Joints.b2JointDef=It;function Qt(){Qt.b2JointEdge.apply(this,arguments)}p.Dynamics.Joints.b2JointEdge=Qt;function Ht(){Ht.b2LineJoint.apply(this,arguments),this.constructor===Ht&&this.b2LineJoint.apply(this,arguments)}p.Dynamics.Joints.b2LineJoint=Ht;function ee(){ee.b2LineJointDef.apply(this,arguments),this.constructor===ee&&this.b2LineJointDef.apply(this,arguments)}p.Dynamics.Joints.b2LineJointDef=ee;function ie(){ie.b2MouseJoint.apply(this,arguments),this.constructor===ie&&this.b2MouseJoint.apply(this,arguments)}p.Dynamics.Joints.b2MouseJoint=ie;function me(){me.b2MouseJointDef.apply(this,arguments),this.constructor===me&&this.b2MouseJointDef.apply(this,arguments)}p.Dynamics.Joints.b2MouseJointDef=me;function de(){de.b2PrismaticJoint.apply(this,arguments),this.constructor===de&&this.b2PrismaticJoint.apply(this,arguments)}p.Dynamics.Joints.b2PrismaticJoint=de;function re(){re.b2PrismaticJointDef.apply(this,arguments),this.constructor===re&&this.b2PrismaticJointDef.apply(this,arguments)}p.Dynamics.Joints.b2PrismaticJointDef=re;function ye(){ye.b2PulleyJoint.apply(this,arguments),this.constructor===ye&&this.b2PulleyJoint.apply(this,arguments)}p.Dynamics.Joints.b2PulleyJoint=ye;function ne(){ne.b2PulleyJointDef.apply(this,arguments),this.constructor===ne&&this.b2PulleyJointDef.apply(this,arguments)}p.Dynamics.Joints.b2PulleyJointDef=ne;function _e(){_e.b2RevoluteJoint.apply(this,arguments),this.constructor===_e&&this.b2RevoluteJoint.apply(this,arguments)}p.Dynamics.Joints.b2RevoluteJoint=_e;function Pe(){Pe.b2RevoluteJointDef.apply(this,arguments),this.constructor===Pe&&this.b2RevoluteJointDef.apply(this,arguments)}p.Dynamics.Joints.b2RevoluteJointDef=Pe;function se(){se.b2WeldJoint.apply(this,arguments),this.constructor===se&&this.b2WeldJoint.apply(this,arguments)}p.Dynamics.Joints.b2WeldJoint=se;function Rt(){Rt.b2WeldJointDef.apply(this,arguments),this.constructor===Rt&&this.b2WeldJointDef.apply(this,arguments)}p.Dynamics.Joints.b2WeldJointDef=Rt})();p.postDefs=[];(function(){var i=p.Collision.Shapes.b2CircleShape;p.Collision.Shapes.b2EdgeChainDef,p.Collision.Shapes.b2EdgeShape,p.Collision.Shapes.b2MassData;var t=p.Collision.Shapes.b2PolygonShape,e=p.Collision.Shapes.b2Shape;p.Common.b2Color,p.Common.b2internal;var r=p.Common.b2Settings;p.Common.Math.b2Mat22,p.Common.Math.b2Mat33;var n=p.Common.Math.b2Math,s=p.Common.Math.b2Sweep,a=p.Common.Math.b2Transform,o=p.Common.Math.b2Vec2;p.Common.Math.b2Vec3;var l=p.Collision.b2AABB,c=p.Collision.b2Bound,f=p.Collision.b2BoundValues,_=p.Collision.b2Collision,x=p.Collision.b2ContactID,y=p.Collision.b2ContactPoint,M=p.Collision.b2Distance,G=p.Collision.b2DistanceInput,h=p.Collision.b2DistanceOutput,v=p.Collision.b2DistanceProxy,C=p.Collision.b2DynamicTree,E=p.Collision.b2DynamicTreeBroadPhase,k=p.Collision.b2DynamicTreeNode,J=p.Collision.b2DynamicTreePair,N=p.Collision.b2Manifold,H=p.Collision.b2ManifoldPoint,$=p.Collision.b2Point,j=p.Collision.b2RayCastInput,K=p.Collision.b2RayCastOutput,rt=p.Collision.b2Segment,B=p.Collision.b2SeparationFunction,I=p.Collision.b2Simplex,F=p.Collision.b2SimplexCache,A=p.Collision.b2SimplexVertex,D=p.Collision.b2TimeOfImpact,W=p.Collision.b2TOIInput,U=p.Collision.b2WorldManifold,u=p.Collision.ClipVertex,g=p.Collision.Features,V=p.Collision.IBroadPhase;l.b2AABB=function(){this.lowerBound=new o,this.upperBound=new o},l.prototype.IsValid=function(){var d=this.upperBound.x-this.lowerBound.x,w=this.upperBound.y-this.lowerBound.y,m=d>=0&&w>=0;return m=m&&this.lowerBound.IsValid()&&this.upperBound.IsValid(),m},l.prototype.GetCenter=function(){return new o((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},l.prototype.GetExtents=function(){return new o((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},l.prototype.Contains=function(d){var w=!0;return w=w&&this.lowerBound.x<=d.lowerBound.x,w=w&&this.lowerBound.y<=d.lowerBound.y,w=w&&d.upperBound.x<=this.upperBound.x,w=w&&d.upperBound.y<=this.upperBound.y,w},l.prototype.RayCast=function(d,w){var m=-Number.MAX_VALUE,P=Number.MAX_VALUE,T=w.p1.x,L=w.p1.y,O=w.p2.x-w.p1.x,R=w.p2.y-w.p1.y,z=Math.abs(O),q=Math.abs(R),X=d.normal,Y=0,Q=0,tt=0,at=0,et=0;if(z<Number.MIN_VALUE){if(T<this.lowerBound.x||this.upperBound.x<T)return!1}else if(Y=1/O,Q=(this.lowerBound.x-T)*Y,tt=(this.upperBound.x-T)*Y,et=-1,Q>tt&&(at=Q,Q=tt,tt=at,et=1),Q>m&&(X.x=et,X.y=0,m=Q),P=Math.min(P,tt),m>P)return!1;if(q<Number.MIN_VALUE){if(L<this.lowerBound.y||this.upperBound.y<L)return!1}else if(Y=1/R,Q=(this.lowerBound.y-L)*Y,tt=(this.upperBound.y-L)*Y,et=-1,Q>tt&&(at=Q,Q=tt,tt=at,et=1),Q>m&&(X.y=et,X.x=0,m=Q),P=Math.min(P,tt),m>P)return!1;return d.fraction=m,!0},l.prototype.TestOverlap=function(d){var w=d.lowerBound.x-this.upperBound.x,m=d.lowerBound.y-this.upperBound.y,P=this.lowerBound.x-d.upperBound.x,T=this.lowerBound.y-d.upperBound.y;return!(w>0||m>0||P>0||T>0)},l.Combine=function(d,w){var m=new l;return m.Combine(d,w),m},l.prototype.Combine=function(d,w){this.lowerBound.x=Math.min(d.lowerBound.x,w.lowerBound.x),this.lowerBound.y=Math.min(d.lowerBound.y,w.lowerBound.y),this.upperBound.x=Math.max(d.upperBound.x,w.upperBound.x),this.upperBound.y=Math.max(d.upperBound.y,w.upperBound.y)},c.b2Bound=function(){},c.prototype.IsLower=function(){return(this.value&1)==0},c.prototype.IsUpper=function(){return(this.value&1)==1},c.prototype.Swap=function(d){var w=this.value,m=this.proxy,P=this.stabbingCount;this.value=d.value,this.proxy=d.proxy,this.stabbingCount=d.stabbingCount,d.value=w,d.proxy=m,d.stabbingCount=P},f.b2BoundValues=function(){},f.prototype.b2BoundValues=function(){this.lowerValues=new we,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new we,this.upperValues[0]=0,this.upperValues[1]=0},_.b2Collision=function(){},_.ClipSegmentToLine=function(d,w,m,P){P===void 0&&(P=0);var T,L=0;T=w[0];var O=T.v;T=w[1];var R=T.v,z=m.x*O.x+m.y*O.y-P,q=m.x*R.x+m.y*R.y-P;if(z<=0&&d[L++].Set(w[0]),q<=0&&d[L++].Set(w[1]),z*q<0){var X=z/(z-q);T=d[L];var Y=T.v;Y.x=O.x+X*(R.x-O.x),Y.y=O.y+X*(R.y-O.y),T=d[L];var Q;z>0?(Q=w[0],T.id=Q.id):(Q=w[1],T.id=Q.id),++L}return L},_.EdgeSeparation=function(d,w,m,P,T){m===void 0&&(m=0),parseInt(d.m_vertexCount);var L=d.m_vertices,O=d.m_normals,R=parseInt(P.m_vertexCount),z=P.m_vertices,q,X;q=w.R,X=O[m];var Y=q.col1.x*X.x+q.col2.x*X.y,Q=q.col1.y*X.x+q.col2.y*X.y;q=T.R;for(var tt=q.col1.x*Y+q.col1.y*Q,at=q.col2.x*Y+q.col2.y*Q,et=0,st=Number.MAX_VALUE,lt=0;lt<R;++lt){X=z[lt];var Z=X.x*tt+X.y*at;Z<st&&(st=Z,et=lt)}X=L[m],q=w.R;var it=w.position.x+(q.col1.x*X.x+q.col2.x*X.y),ft=w.position.y+(q.col1.y*X.x+q.col2.y*X.y);X=z[et],q=T.R;var ut=T.position.x+(q.col1.x*X.x+q.col2.x*X.y),dt=T.position.y+(q.col1.y*X.x+q.col2.y*X.y);ut-=it,dt-=ft;var pt=ut*Y+dt*Q;return pt},_.FindMaxSeparation=function(d,w,m,P,T){var L=parseInt(w.m_vertexCount),O=w.m_normals,R,z;z=T.R,R=P.m_centroid;var q=T.position.x+(z.col1.x*R.x+z.col2.x*R.y),X=T.position.y+(z.col1.y*R.x+z.col2.y*R.y);z=m.R,R=w.m_centroid,q-=m.position.x+(z.col1.x*R.x+z.col2.x*R.y),X-=m.position.y+(z.col1.y*R.x+z.col2.y*R.y);for(var Y=q*m.R.col1.x+X*m.R.col1.y,Q=q*m.R.col2.x+X*m.R.col2.y,tt=0,at=-Number.MAX_VALUE,et=0;et<L;++et){R=O[et];var st=R.x*Y+R.y*Q;st>at&&(at=st,tt=et)}var lt=_.EdgeSeparation(w,m,tt,P,T),Z=parseInt(tt-1>=0?tt-1:L-1),it=_.EdgeSeparation(w,m,Z,P,T),ft=parseInt(tt+1<L?tt+1:0),ut=_.EdgeSeparation(w,m,ft,P,T),dt=0,pt=0,mt=0;if(it>lt&&it>ut)mt=-1,dt=Z,pt=it;else if(ut>lt)mt=1,dt=ft,pt=ut;else return d[0]=tt,lt;for(;mt==-1?tt=dt-1>=0?dt-1:L-1:tt=dt+1<L?dt+1:0,lt=_.EdgeSeparation(w,m,tt,P,T),lt>pt;)dt=tt,pt=lt;return d[0]=dt,pt},_.FindIncidentEdge=function(d,w,m,P,T,L){P===void 0&&(P=0),parseInt(w.m_vertexCount);var O=w.m_normals,R=parseInt(T.m_vertexCount),z=T.m_vertices,q=T.m_normals,X,Y;X=m.R,Y=O[P];var Q=X.col1.x*Y.x+X.col2.x*Y.y,tt=X.col1.y*Y.x+X.col2.y*Y.y;X=L.R;var at=X.col1.x*Q+X.col1.y*tt;tt=X.col2.x*Q+X.col2.y*tt,Q=at;for(var et=0,st=Number.MAX_VALUE,lt=0;lt<R;++lt){Y=q[lt];var Z=Q*Y.x+tt*Y.y;Z<st&&(st=Z,et=lt)}var it,ft=parseInt(et),ut=parseInt(ft+1<R?ft+1:0);it=d[0],Y=z[ft],X=L.R,it.v.x=L.position.x+(X.col1.x*Y.x+X.col2.x*Y.y),it.v.y=L.position.y+(X.col1.y*Y.x+X.col2.y*Y.y),it.id.features.referenceEdge=P,it.id.features.incidentEdge=ft,it.id.features.incidentVertex=0,it=d[1],Y=z[ut],X=L.R,it.v.x=L.position.x+(X.col1.x*Y.x+X.col2.x*Y.y),it.v.y=L.position.y+(X.col1.y*Y.x+X.col2.y*Y.y),it.id.features.referenceEdge=P,it.id.features.incidentEdge=ut,it.id.features.incidentVertex=1},_.MakeClipPointVector=function(){var d=new Wt(2);return d[0]=new u,d[1]=new u,d},_.CollidePolygons=function(d,w,m,P,T){var L;d.m_pointCount=0;var O=w.m_radius+P.m_radius,R=0;_.s_edgeAO[0]=R;var z=_.FindMaxSeparation(_.s_edgeAO,w,m,P,T);if(R=_.s_edgeAO[0],!(z>O)){var q=0;_.s_edgeBO[0]=q;var X=_.FindMaxSeparation(_.s_edgeBO,P,T,w,m);if(q=_.s_edgeBO[0],!(X>O)){var Y,Q,tt,at,et=0,st=0,lt=.98,Z=.001,it;X>lt*z+Z?(Y=P,Q=w,tt=T,at=m,et=q,d.m_type=N.e_faceB,st=1):(Y=w,Q=P,tt=m,at=T,et=R,d.m_type=N.e_faceA,st=0);var ft=_.s_incidentEdge;_.FindIncidentEdge(ft,Y,tt,et,Q,at);var ut=parseInt(Y.m_vertexCount),dt=Y.m_vertices,pt=dt[et],mt;et+1<ut?mt=dt[parseInt(et+1)]:mt=dt[0];var Ct=_.s_localTangent;Ct.Set(mt.x-pt.x,mt.y-pt.y),Ct.Normalize();var kt=_.s_localNormal;kt.x=Ct.y,kt.y=-Ct.x;var Mt=_.s_planePoint;Mt.Set(.5*(pt.x+mt.x),.5*(pt.y+mt.y));var yt=_.s_tangent;it=tt.R,yt.x=it.col1.x*Ct.x+it.col2.x*Ct.y,yt.y=it.col1.y*Ct.x+it.col2.y*Ct.y;var St=_.s_tangent2;St.x=-yt.x,St.y=-yt.y;var Et=_.s_normal;Et.x=yt.y,Et.y=-yt.x;var Nt=_.s_v11,Vt=_.s_v12;Nt.x=tt.position.x+(it.col1.x*pt.x+it.col2.x*pt.y),Nt.y=tt.position.y+(it.col1.y*pt.x+it.col2.y*pt.y),Vt.x=tt.position.x+(it.col1.x*mt.x+it.col2.x*mt.y),Vt.y=tt.position.y+(it.col1.y*mt.x+it.col2.y*mt.y);var Ft=Et.x*Nt.x+Et.y*Nt.y,b=-yt.x*Nt.x-yt.y*Nt.y+O,S=yt.x*Vt.x+yt.y*Vt.y+O,ot=_.s_clipPoints1,ct=_.s_clipPoints2,ht=0;if(ht=_.ClipSegmentToLine(ot,ft,St,b),!(ht<2)&&(ht=_.ClipSegmentToLine(ct,ot,yt,S),!(ht<2))){d.m_localPlaneNormal.SetV(kt),d.m_localPoint.SetV(Mt);for(var nt=0,gt=0;gt<r.b2_maxManifoldPoints;++gt){L=ct[gt];var vt=Et.x*L.v.x+Et.y*L.v.y-Ft;if(vt<=O){var _t=d.m_points[nt];it=at.R;var At=L.v.x-at.position.x,zt=L.v.y-at.position.y;_t.m_localPoint.x=At*it.col1.x+zt*it.col1.y,_t.m_localPoint.y=At*it.col2.x+zt*it.col2.y,_t.m_id.Set(L.id),_t.m_id.features.flip=st,++nt}}d.m_pointCount=nt}}}},_.CollideCircles=function(d,w,m,P,T){d.m_pointCount=0;var L,O;L=m.R,O=w.m_p;var R=m.position.x+(L.col1.x*O.x+L.col2.x*O.y),z=m.position.y+(L.col1.y*O.x+L.col2.y*O.y);L=T.R,O=P.m_p;var q=T.position.x+(L.col1.x*O.x+L.col2.x*O.y),X=T.position.y+(L.col1.y*O.x+L.col2.y*O.y),Y=q-R,Q=X-z,tt=Y*Y+Q*Q,at=w.m_radius+P.m_radius;tt>at*at||(d.m_type=N.e_circles,d.m_localPoint.SetV(w.m_p),d.m_localPlaneNormal.SetZero(),d.m_pointCount=1,d.m_points[0].m_localPoint.SetV(P.m_p),d.m_points[0].m_id.key=0)},_.CollidePolygonAndCircle=function(d,w,m,P,T){d.m_pointCount=0;var L=0,O=0,R,z;z=T.R,R=P.m_p;var q=T.position.x+(z.col1.x*R.x+z.col2.x*R.y),X=T.position.y+(z.col1.y*R.x+z.col2.y*R.y);L=q-m.position.x,O=X-m.position.y,z=m.R;for(var Y=L*z.col1.x+O*z.col1.y,Q=L*z.col2.x+O*z.col2.y,tt=0,at=-Number.MAX_VALUE,et=w.m_radius+P.m_radius,st=parseInt(w.m_vertexCount),lt=w.m_vertices,Z=w.m_normals,it=0;it<st;++it){R=lt[it],L=Y-R.x,O=Q-R.y,R=Z[it];var ft=R.x*L+R.y*O;if(ft>et)return;ft>at&&(at=ft,tt=it)}var ut=parseInt(tt),dt=parseInt(ut+1<st?ut+1:0),pt=lt[ut],mt=lt[dt];if(at<Number.MIN_VALUE){d.m_pointCount=1,d.m_type=N.e_faceA,d.m_localPlaneNormal.SetV(Z[tt]),d.m_localPoint.x=.5*(pt.x+mt.x),d.m_localPoint.y=.5*(pt.y+mt.y),d.m_points[0].m_localPoint.SetV(P.m_p),d.m_points[0].m_id.key=0;return}var Ct=(Y-pt.x)*(mt.x-pt.x)+(Q-pt.y)*(mt.y-pt.y),kt=(Y-mt.x)*(pt.x-mt.x)+(Q-mt.y)*(pt.y-mt.y);if(Ct<=0){if((Y-pt.x)*(Y-pt.x)+(Q-pt.y)*(Q-pt.y)>et*et)return;d.m_pointCount=1,d.m_type=N.e_faceA,d.m_localPlaneNormal.x=Y-pt.x,d.m_localPlaneNormal.y=Q-pt.y,d.m_localPlaneNormal.Normalize(),d.m_localPoint.SetV(pt),d.m_points[0].m_localPoint.SetV(P.m_p),d.m_points[0].m_id.key=0}else if(kt<=0){if((Y-mt.x)*(Y-mt.x)+(Q-mt.y)*(Q-mt.y)>et*et)return;d.m_pointCount=1,d.m_type=N.e_faceA,d.m_localPlaneNormal.x=Y-mt.x,d.m_localPlaneNormal.y=Q-mt.y,d.m_localPlaneNormal.Normalize(),d.m_localPoint.SetV(mt),d.m_points[0].m_localPoint.SetV(P.m_p),d.m_points[0].m_id.key=0}else{var Mt=.5*(pt.x+mt.x),yt=.5*(pt.y+mt.y);if(at=(Y-Mt)*Z[ut].x+(Q-yt)*Z[ut].y,at>et)return;d.m_pointCount=1,d.m_type=N.e_faceA,d.m_localPlaneNormal.x=Z[ut].x,d.m_localPlaneNormal.y=Z[ut].y,d.m_localPlaneNormal.Normalize(),d.m_localPoint.Set(Mt,yt),d.m_points[0].m_localPoint.SetV(P.m_p),d.m_points[0].m_id.key=0}},_.TestOverlap=function(d,w){var m=w.lowerBound,P=d.upperBound,T=m.x-P.x,L=m.y-P.y;m=d.lowerBound,P=w.upperBound;var O=m.x-P.x,R=m.y-P.y;return!(T>0||L>0||O>0||R>0)},p.postDefs.push(function(){p.Collision.b2Collision.s_incidentEdge=_.MakeClipPointVector(),p.Collision.b2Collision.s_clipPoints1=_.MakeClipPointVector(),p.Collision.b2Collision.s_clipPoints2=_.MakeClipPointVector(),p.Collision.b2Collision.s_edgeAO=new we(1),p.Collision.b2Collision.s_edgeBO=new we(1),p.Collision.b2Collision.s_localTangent=new o,p.Collision.b2Collision.s_localNormal=new o,p.Collision.b2Collision.s_planePoint=new o,p.Collision.b2Collision.s_normal=new o,p.Collision.b2Collision.s_tangent=new o,p.Collision.b2Collision.s_tangent2=new o,p.Collision.b2Collision.s_v11=new o,p.Collision.b2Collision.s_v12=new o,p.Collision.b2Collision.b2CollidePolyTempVec=new o,p.Collision.b2Collision.b2_nullFeature=255}),x.b2ContactID=function(){this.features=new g},x.prototype.b2ContactID=function(){this.features._m_id=this},x.prototype.Set=function(d){this.key=d._key},x.prototype.Copy=function(){var d=new x;return d.key=this.key,d},Object.defineProperty(x.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(x.prototype,"key",{enumerable:!1,configurable:!0,set:function(d){d===void 0&&(d=0),this._key=d,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}}),y.b2ContactPoint=function(){this.position=new o,this.velocity=new o,this.normal=new o,this.id=new x},M.b2Distance=function(){},M.Distance=function(d,w,m){++M.b2_gjkCalls;var P=m.proxyA,T=m.proxyB,L=m.transformA,O=m.transformB,R=M.s_simplex;R.ReadCache(w,P,L,T,O);var z=R.m_vertices,q=20,X=M.s_saveA,Y=M.s_saveB,Q=0,tt=R.GetClosestPoint();tt.LengthSquared();for(var at=0,et,st=0;st<q;){for(Q=R.m_count,at=0;at<Q;at++)X[at]=z[at].indexA,Y[at]=z[at].indexB;switch(R.m_count){case 1:break;case 2:R.Solve2();break;case 3:R.Solve3();break;default:r.b2Assert(!1)}if(R.m_count==3)break;et=R.GetClosestPoint(),et.LengthSquared();var lt=R.GetSearchDirection();if(lt.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var Z=z[R.m_count];Z.indexA=P.GetSupport(n.MulTMV(L.R,lt.GetNegative())),Z.wA=n.MulX(L,P.GetVertex(Z.indexA)),Z.indexB=T.GetSupport(n.MulTMV(O.R,lt)),Z.wB=n.MulX(O,T.GetVertex(Z.indexB)),Z.w=n.SubtractVV(Z.wB,Z.wA),++st,++M.b2_gjkIters;var it=!1;for(at=0;at<Q;at++)if(Z.indexA==X[at]&&Z.indexB==Y[at]){it=!0;break}if(it)break;++R.m_count}if(M.b2_gjkMaxIters=n.Max(M.b2_gjkMaxIters,st),R.GetWitnessPoints(d.pointA,d.pointB),d.distance=n.SubtractVV(d.pointA,d.pointB).Length(),d.iterations=st,R.WriteCache(w),m.useRadii){var ft=P.m_radius,ut=T.m_radius;if(d.distance>ft+ut&&d.distance>Number.MIN_VALUE){d.distance-=ft+ut;var dt=n.SubtractVV(d.pointB,d.pointA);dt.Normalize(),d.pointA.x+=ft*dt.x,d.pointA.y+=ft*dt.y,d.pointB.x-=ut*dt.x,d.pointB.y-=ut*dt.y}else et=new o,et.x=.5*(d.pointA.x+d.pointB.x),et.y=.5*(d.pointA.y+d.pointB.y),d.pointA.x=d.pointB.x=et.x,d.pointA.y=d.pointB.y=et.y,d.distance=0}},p.postDefs.push(function(){p.Collision.b2Distance.s_simplex=new I,p.Collision.b2Distance.s_saveA=new we(3),p.Collision.b2Distance.s_saveB=new we(3)}),G.b2DistanceInput=function(){},h.b2DistanceOutput=function(){this.pointA=new o,this.pointB=new o},v.b2DistanceProxy=function(){},v.prototype.Set=function(d){switch(d.GetType()){case e.e_circleShape:{var w=d instanceof i?d:null;this.m_vertices=new Wt(1,!0),this.m_vertices[0]=w.m_p,this.m_count=1,this.m_radius=w.m_radius}break;case e.e_polygonShape:{var m=d instanceof t?d:null;this.m_vertices=m.m_vertices,this.m_count=m.m_vertexCount,this.m_radius=m.m_radius}break;default:r.b2Assert(!1)}},v.prototype.GetSupport=function(d){for(var w=0,m=this.m_vertices[0].x*d.x+this.m_vertices[0].y*d.y,P=1;P<this.m_count;++P){var T=this.m_vertices[P].x*d.x+this.m_vertices[P].y*d.y;T>m&&(w=P,m=T)}return w},v.prototype.GetSupportVertex=function(d){for(var w=0,m=this.m_vertices[0].x*d.x+this.m_vertices[0].y*d.y,P=1;P<this.m_count;++P){var T=this.m_vertices[P].x*d.x+this.m_vertices[P].y*d.y;T>m&&(w=P,m=T)}return this.m_vertices[w]},v.prototype.GetVertexCount=function(){return this.m_count},v.prototype.GetVertex=function(d){return d===void 0&&(d=0),r.b2Assert(0<=d&&d<this.m_count),this.m_vertices[d]},C.b2DynamicTree=function(){},C.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},C.prototype.CreateProxy=function(d,w){var m=this.AllocateNode(),P=r.b2_aabbExtension,T=r.b2_aabbExtension;return m.aabb.lowerBound.x=d.lowerBound.x-P,m.aabb.lowerBound.y=d.lowerBound.y-T,m.aabb.upperBound.x=d.upperBound.x+P,m.aabb.upperBound.y=d.upperBound.y+T,m.userData=w,this.InsertLeaf(m),m},C.prototype.DestroyProxy=function(d){this.RemoveLeaf(d),this.FreeNode(d)},C.prototype.MoveProxy=function(d,w,m){if(r.b2Assert(d.IsLeaf()),d.aabb.Contains(w))return!1;this.RemoveLeaf(d);var P=r.b2_aabbExtension+r.b2_aabbMultiplier*(m.x>0?m.x:-m.x),T=r.b2_aabbExtension+r.b2_aabbMultiplier*(m.y>0?m.y:-m.y);return d.aabb.lowerBound.x=w.lowerBound.x-P,d.aabb.lowerBound.y=w.lowerBound.y-T,d.aabb.upperBound.x=w.upperBound.x+P,d.aabb.upperBound.y=w.upperBound.y+T,this.InsertLeaf(d),!0},C.prototype.Rebalance=function(d){if(d===void 0&&(d=0),this.m_root!=null)for(var w=0;w<d;w++){for(var m=this.m_root,P=0;m.IsLeaf()==!1;)m=this.m_path>>P&1?m.child2:m.child1,P=P+1&31;++this.m_path,this.RemoveLeaf(m),this.InsertLeaf(m)}},C.prototype.GetFatAABB=function(d){return d.aabb},C.prototype.GetUserData=function(d){return d.userData},C.prototype.Query=function(d,w){if(this.m_root!=null){var m=new Wt,P=0;for(m[P++]=this.m_root;P>0;){var T=m[--P];if(T.aabb.TestOverlap(w))if(T.IsLeaf()){var L=d(T);if(!L)return}else m[P++]=T.child1,m[P++]=T.child2}}},C.prototype.RayCast=function(d,w){if(this.m_root!=null){var m=w.p1,P=w.p2,T=n.SubtractVV(m,P);T.Normalize();var L=n.CrossFV(1,T),O=n.AbsV(L),R=w.maxFraction,z=new l,q=0,X=0;q=m.x+R*(P.x-m.x),X=m.y+R*(P.y-m.y),z.lowerBound.x=Math.min(m.x,q),z.lowerBound.y=Math.min(m.y,X),z.upperBound.x=Math.max(m.x,q),z.upperBound.y=Math.max(m.y,X);var Y=new Wt,Q=0;for(Y[Q++]=this.m_root;Q>0;){var tt=Y[--Q];if(tt.aabb.TestOverlap(z)!=!1){var at=tt.aabb.GetCenter(),et=tt.aabb.GetExtents(),st=Math.abs(L.x*(m.x-at.x)+L.y*(m.y-at.y))-O.x*et.x-O.y*et.y;if(!(st>0))if(tt.IsLeaf()){var lt=new j;if(lt.p1=w.p1,lt.p2=w.p2,lt.maxFraction=w.maxFraction,R=d(lt,tt),R==0)return;R>0&&(q=m.x+R*(P.x-m.x),X=m.y+R*(P.y-m.y),z.lowerBound.x=Math.min(m.x,q),z.lowerBound.y=Math.min(m.y,X),z.upperBound.x=Math.max(m.x,q),z.upperBound.y=Math.max(m.y,X))}else Y[Q++]=tt.child1,Y[Q++]=tt.child2}}}},C.prototype.AllocateNode=function(){if(this.m_freeList){var d=this.m_freeList;return this.m_freeList=d.parent,d.parent=null,d.child1=null,d.child2=null,d}return new k},C.prototype.FreeNode=function(d){d.parent=this.m_freeList,this.m_freeList=d},C.prototype.InsertLeaf=function(d){if(++this.m_insertionCount,this.m_root==null){this.m_root=d,this.m_root.parent=null;return}var w=d.aabb.GetCenter(),m=this.m_root;if(m.IsLeaf()==!1)do{var P=m.child1,T=m.child2,L=Math.abs((P.aabb.lowerBound.x+P.aabb.upperBound.x)/2-w.x)+Math.abs((P.aabb.lowerBound.y+P.aabb.upperBound.y)/2-w.y),O=Math.abs((T.aabb.lowerBound.x+T.aabb.upperBound.x)/2-w.x)+Math.abs((T.aabb.lowerBound.y+T.aabb.upperBound.y)/2-w.y);L<O?m=P:m=T}while(m.IsLeaf()==!1);var R=m.parent,z=this.AllocateNode();if(z.parent=R,z.userData=null,z.aabb.Combine(d.aabb,m.aabb),R){m.parent.child1==m?R.child1=z:R.child2=z,z.child1=m,z.child2=d,m.parent=z,d.parent=z;do{if(R.aabb.Contains(z.aabb))break;R.aabb.Combine(R.child1.aabb,R.child2.aabb),z=R,R=R.parent}while(R)}else z.child1=m,z.child2=d,m.parent=z,d.parent=z,this.m_root=z},C.prototype.RemoveLeaf=function(d){if(d==this.m_root){this.m_root=null;return}var w=d.parent,m=w.parent,P;if(w.child1==d?P=w.child2:P=w.child1,m)for(m.child1==w?m.child1=P:m.child2=P,P.parent=m,this.FreeNode(w);m;){var T=m.aabb;if(m.aabb=l.Combine(m.child1.aabb,m.child2.aabb),T.Contains(m.aabb))break;m=m.parent}else this.m_root=P,P.parent=null,this.FreeNode(w)},E.b2DynamicTreeBroadPhase=function(){this.m_tree=new C,this.m_moveBuffer=new Wt,this.m_pairBuffer=new Wt,this.m_pairCount=0},E.prototype.CreateProxy=function(d,w){var m=this.m_tree.CreateProxy(d,w);return++this.m_proxyCount,this.BufferMove(m),m},E.prototype.DestroyProxy=function(d){this.UnBufferMove(d),--this.m_proxyCount,this.m_tree.DestroyProxy(d)},E.prototype.MoveProxy=function(d,w,m){var P=this.m_tree.MoveProxy(d,w,m);P&&this.BufferMove(d)},E.prototype.TestOverlap=function(d,w){var m=this.m_tree.GetFatAABB(d),P=this.m_tree.GetFatAABB(w);return m.TestOverlap(P)},E.prototype.GetUserData=function(d){return this.m_tree.GetUserData(d)},E.prototype.GetFatAABB=function(d){return this.m_tree.GetFatAABB(d)},E.prototype.GetProxyCount=function(){return this.m_proxyCount},E.prototype.UpdatePairs=function(d){var w=this;w.m_pairCount=0;var m=0,P;for(m=0;m<w.m_moveBuffer.length;++m){let q=function(X){if(X==P)return!0;w.m_pairCount==w.m_pairBuffer.length&&(w.m_pairBuffer[w.m_pairCount]=new J);var Y=w.m_pairBuffer[w.m_pairCount];return Y.proxyA=X<P?X:P,Y.proxyB=X>=P?X:P,++w.m_pairCount,!0};P=w.m_moveBuffer[m];var T=w.m_tree.GetFatAABB(P);w.m_tree.Query(q,T)}w.m_moveBuffer.length=0;for(var m=0;m<w.m_pairCount;){var L=w.m_pairBuffer[m],O=w.m_tree.GetUserData(L.proxyA),R=w.m_tree.GetUserData(L.proxyB);for(d(O,R),++m;m<w.m_pairCount;){var z=w.m_pairBuffer[m];if(z.proxyA!=L.proxyA||z.proxyB!=L.proxyB)break;++m}}},E.prototype.Query=function(d,w){this.m_tree.Query(d,w)},E.prototype.RayCast=function(d,w){this.m_tree.RayCast(d,w)},E.prototype.Validate=function(){},E.prototype.Rebalance=function(d){d===void 0&&(d=0),this.m_tree.Rebalance(d)},E.prototype.BufferMove=function(d){this.m_moveBuffer[this.m_moveBuffer.length]=d},E.prototype.UnBufferMove=function(d){var w=parseInt(this.m_moveBuffer.indexOf(d));this.m_moveBuffer.splice(w,1)},E.prototype.ComparePairs=function(d,w){return 0},E.__implements={},E.__implements[V]=!0,k.b2DynamicTreeNode=function(){this.aabb=new l},k.prototype.IsLeaf=function(){return this.child1==null},J.b2DynamicTreePair=function(){},N.b2Manifold=function(){this.m_pointCount=0},N.prototype.b2Manifold=function(){this.m_points=new Wt(r.b2_maxManifoldPoints);for(var d=0;d<r.b2_maxManifoldPoints;d++)this.m_points[d]=new H;this.m_localPlaneNormal=new o,this.m_localPoint=new o},N.prototype.Reset=function(){for(var d=0;d<r.b2_maxManifoldPoints;d++)(this.m_points[d]instanceof H?this.m_points[d]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},N.prototype.Set=function(d){this.m_pointCount=d.m_pointCount;for(var w=0;w<r.b2_maxManifoldPoints;w++)(this.m_points[w]instanceof H?this.m_points[w]:null).Set(d.m_points[w]);this.m_localPlaneNormal.SetV(d.m_localPlaneNormal),this.m_localPoint.SetV(d.m_localPoint),this.m_type=d.m_type},N.prototype.Copy=function(){var d=new N;return d.Set(this),d},p.postDefs.push(function(){p.Collision.b2Manifold.e_circles=1,p.Collision.b2Manifold.e_faceA=2,p.Collision.b2Manifold.e_faceB=4}),H.b2ManifoldPoint=function(){this.m_localPoint=new o,this.m_id=new x},H.prototype.b2ManifoldPoint=function(){this.Reset()},H.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},H.prototype.Set=function(d){this.m_localPoint.SetV(d.m_localPoint),this.m_normalImpulse=d.m_normalImpulse,this.m_tangentImpulse=d.m_tangentImpulse,this.m_id.Set(d.m_id)},$.b2Point=function(){this.p=new o},$.prototype.Support=function(d,w,m){return this.p},$.prototype.GetFirstVertex=function(d){return this.p},j.b2RayCastInput=function(){this.p1=new o,this.p2=new o},j.prototype.b2RayCastInput=function(d,w,m){d===void 0&&(d=null),w===void 0&&(w=null),m===void 0&&(m=1),d&&this.p1.SetV(d),w&&this.p2.SetV(w),this.maxFraction=m},K.b2RayCastOutput=function(){this.normal=new o},rt.b2Segment=function(){this.p1=new o,this.p2=new o},rt.prototype.TestSegment=function(d,w,m,P){P===void 0&&(P=0);var T=m.p1,L=m.p2.x-T.x,O=m.p2.y-T.y,R=this.p2.x-this.p1.x,z=this.p2.y-this.p1.y,q=z,X=-R,Y=100*Number.MIN_VALUE,Q=-(L*q+O*X);if(Q>Y){var tt=T.x-this.p1.x,at=T.y-this.p1.y,et=tt*q+at*X;if(0<=et&&et<=P*Q){var st=-L*at+O*tt;if(-Y*Q<=st&&st<=Q*(1+Y)){et/=Q;var lt=Math.sqrt(q*q+X*X);return q/=lt,X/=lt,d[0]=et,w.Set(q,X),!0}}}return!1},rt.prototype.Extend=function(d){this.ExtendForward(d),this.ExtendBackward(d)},rt.prototype.ExtendForward=function(d){var w=this.p2.x-this.p1.x,m=this.p2.y-this.p1.y,P=Math.min(w>0?(d.upperBound.x-this.p1.x)/w:w<0?(d.lowerBound.x-this.p1.x)/w:Number.POSITIVE_INFINITY,m>0?(d.upperBound.y-this.p1.y)/m:m<0?(d.lowerBound.y-this.p1.y)/m:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+w*P,this.p2.y=this.p1.y+m*P},rt.prototype.ExtendBackward=function(d){var w=-this.p2.x+this.p1.x,m=-this.p2.y+this.p1.y,P=Math.min(w>0?(d.upperBound.x-this.p2.x)/w:w<0?(d.lowerBound.x-this.p2.x)/w:Number.POSITIVE_INFINITY,m>0?(d.upperBound.y-this.p2.y)/m:m<0?(d.lowerBound.y-this.p2.y)/m:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+w*P,this.p1.y=this.p2.y+m*P},B.b2SeparationFunction=function(){this.m_localPoint=new o,this.m_axis=new o},B.prototype.Initialize=function(d,w,m,P,T){this.m_proxyA=w,this.m_proxyB=P;var L=parseInt(d.count);r.b2Assert(0<L&&L<3);var O,R,z,q,X,Y,Q=0,tt=0,at=0,et=0,st=0,lt=0,Z,it,ft=0;if(L==1)this.m_type=B.e_points,O=this.m_proxyA.GetVertex(d.indexA[0]),q=this.m_proxyB.GetVertex(d.indexB[0]),it=O,Z=m.R,Q=m.position.x+(Z.col1.x*it.x+Z.col2.x*it.y),tt=m.position.y+(Z.col1.y*it.x+Z.col2.y*it.y),it=q,Z=T.R,at=T.position.x+(Z.col1.x*it.x+Z.col2.x*it.y),et=T.position.y+(Z.col1.y*it.x+Z.col2.y*it.y),this.m_axis.x=at-Q,this.m_axis.y=et-tt,this.m_axis.Normalize();else if(d.indexB[0]==d.indexB[1])this.m_type=B.e_faceA,R=this.m_proxyA.GetVertex(d.indexA[0]),z=this.m_proxyA.GetVertex(d.indexA[1]),q=this.m_proxyB.GetVertex(d.indexB[0]),this.m_localPoint.x=.5*(R.x+z.x),this.m_localPoint.y=.5*(R.y+z.y),this.m_axis=n.CrossVF(n.SubtractVV(z,R),1),this.m_axis.Normalize(),it=this.m_axis,Z=m.R,st=Z.col1.x*it.x+Z.col2.x*it.y,lt=Z.col1.y*it.x+Z.col2.y*it.y,it=this.m_localPoint,Z=m.R,Q=m.position.x+(Z.col1.x*it.x+Z.col2.x*it.y),tt=m.position.y+(Z.col1.y*it.x+Z.col2.y*it.y),it=q,Z=T.R,at=T.position.x+(Z.col1.x*it.x+Z.col2.x*it.y),et=T.position.y+(Z.col1.y*it.x+Z.col2.y*it.y),ft=(at-Q)*st+(et-tt)*lt,ft<0&&this.m_axis.NegativeSelf();else if(d.indexA[0]==d.indexA[0])this.m_type=B.e_faceB,X=this.m_proxyB.GetVertex(d.indexB[0]),Y=this.m_proxyB.GetVertex(d.indexB[1]),O=this.m_proxyA.GetVertex(d.indexA[0]),this.m_localPoint.x=.5*(X.x+Y.x),this.m_localPoint.y=.5*(X.y+Y.y),this.m_axis=n.CrossVF(n.SubtractVV(Y,X),1),this.m_axis.Normalize(),it=this.m_axis,Z=T.R,st=Z.col1.x*it.x+Z.col2.x*it.y,lt=Z.col1.y*it.x+Z.col2.y*it.y,it=this.m_localPoint,Z=T.R,at=T.position.x+(Z.col1.x*it.x+Z.col2.x*it.y),et=T.position.y+(Z.col1.y*it.x+Z.col2.y*it.y),it=O,Z=m.R,Q=m.position.x+(Z.col1.x*it.x+Z.col2.x*it.y),tt=m.position.y+(Z.col1.y*it.x+Z.col2.y*it.y),ft=(Q-at)*st+(tt-et)*lt,ft<0&&this.m_axis.NegativeSelf();else{R=this.m_proxyA.GetVertex(d.indexA[0]),z=this.m_proxyA.GetVertex(d.indexA[1]),X=this.m_proxyB.GetVertex(d.indexB[0]),Y=this.m_proxyB.GetVertex(d.indexB[1]),n.MulX(m,O);var ut=n.MulMV(m.R,n.SubtractVV(z,R));n.MulX(T,q);var dt=n.MulMV(T.R,n.SubtractVV(Y,X)),pt=ut.x*ut.x+ut.y*ut.y,mt=dt.x*dt.x+dt.y*dt.y,Ct=n.SubtractVV(dt,ut),kt=ut.x*Ct.x+ut.y*Ct.y,Mt=dt.x*Ct.x+dt.y*Ct.y,yt=ut.x*dt.x+ut.y*dt.y,St=pt*mt-yt*yt;ft=0,St!=0&&(ft=n.Clamp((yt*Mt-kt*mt)/St,0,1));var Et=(yt*ft+Mt)/mt;Et<0&&(Et=0,ft=n.Clamp((yt-kt)/pt,0,1)),O=new o,O.x=R.x+ft*(z.x-R.x),O.y=R.y+ft*(z.y-R.y),q=new o,q.x=X.x+ft*(Y.x-X.x),q.y=X.y+ft*(Y.y-X.y),ft==0||ft==1?(this.m_type=B.e_faceB,this.m_axis=n.CrossVF(n.SubtractVV(Y,X),1),this.m_axis.Normalize(),this.m_localPoint=q,it=this.m_axis,Z=T.R,st=Z.col1.x*it.x+Z.col2.x*it.y,lt=Z.col1.y*it.x+Z.col2.y*it.y,it=this.m_localPoint,Z=T.R,at=T.position.x+(Z.col1.x*it.x+Z.col2.x*it.y),et=T.position.y+(Z.col1.y*it.x+Z.col2.y*it.y),it=O,Z=m.R,Q=m.position.x+(Z.col1.x*it.x+Z.col2.x*it.y),tt=m.position.y+(Z.col1.y*it.x+Z.col2.y*it.y),ft<0&&this.m_axis.NegativeSelf()):(this.m_type=B.e_faceA,this.m_axis=n.CrossVF(n.SubtractVV(z,R),1),this.m_localPoint=O,it=this.m_axis,Z=m.R,st=Z.col1.x*it.x+Z.col2.x*it.y,lt=Z.col1.y*it.x+Z.col2.y*it.y,it=this.m_localPoint,Z=m.R,Q=m.position.x+(Z.col1.x*it.x+Z.col2.x*it.y),tt=m.position.y+(Z.col1.y*it.x+Z.col2.y*it.y),it=q,Z=T.R,at=T.position.x+(Z.col1.x*it.x+Z.col2.x*it.y),et=T.position.y+(Z.col1.y*it.x+Z.col2.y*it.y),ft<0&&this.m_axis.NegativeSelf())}},B.prototype.Evaluate=function(d,w){var m,P,T,L,O,R,z=0,q;switch(this.m_type){case B.e_points:return m=n.MulTMV(d.R,this.m_axis),P=n.MulTMV(w.R,this.m_axis.GetNegative()),T=this.m_proxyA.GetSupportVertex(m),L=this.m_proxyB.GetSupportVertex(P),O=n.MulX(d,T),R=n.MulX(w,L),z=(R.x-O.x)*this.m_axis.x+(R.y-O.y)*this.m_axis.y,z;case B.e_faceA:return q=n.MulMV(d.R,this.m_axis),O=n.MulX(d,this.m_localPoint),P=n.MulTMV(w.R,q.GetNegative()),L=this.m_proxyB.GetSupportVertex(P),R=n.MulX(w,L),z=(R.x-O.x)*q.x+(R.y-O.y)*q.y,z;case B.e_faceB:return q=n.MulMV(w.R,this.m_axis),R=n.MulX(w,this.m_localPoint),m=n.MulTMV(d.R,q.GetNegative()),T=this.m_proxyA.GetSupportVertex(m),O=n.MulX(d,T),z=(O.x-R.x)*q.x+(O.y-R.y)*q.y,z;default:return r.b2Assert(!1),0}},p.postDefs.push(function(){p.Collision.b2SeparationFunction.e_points=1,p.Collision.b2SeparationFunction.e_faceA=2,p.Collision.b2SeparationFunction.e_faceB=4}),I.b2Simplex=function(){this.m_v1=new A,this.m_v2=new A,this.m_v3=new A,this.m_vertices=new Wt(3)},I.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},I.prototype.ReadCache=function(d,w,m,P,T){r.b2Assert(0<=d.count&&d.count<=3);var L,O;this.m_count=d.count;for(var R=this.m_vertices,z=0;z<this.m_count;z++){var q=R[z];q.indexA=d.indexA[z],q.indexB=d.indexB[z],L=w.GetVertex(q.indexA),O=P.GetVertex(q.indexB),q.wA=n.MulX(m,L),q.wB=n.MulX(T,O),q.w=n.SubtractVV(q.wB,q.wA),q.a=0}if(this.m_count>1){var X=d.metric,Y=this.GetMetric();(Y<.5*X||2*X<Y||Y<Number.MIN_VALUE)&&(this.m_count=0)}this.m_count==0&&(q=R[0],q.indexA=0,q.indexB=0,L=w.GetVertex(0),O=P.GetVertex(0),q.wA=n.MulX(m,L),q.wB=n.MulX(T,O),q.w=n.SubtractVV(q.wB,q.wA),this.m_count=1)},I.prototype.WriteCache=function(d){d.metric=this.GetMetric(),d.count=p.parseUInt(this.m_count);for(var w=this.m_vertices,m=0;m<this.m_count;m++)d.indexA[m]=p.parseUInt(w[m].indexA),d.indexB[m]=p.parseUInt(w[m].indexB)},I.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:{var d=n.SubtractVV(this.m_v2.w,this.m_v1.w),w=n.CrossVV(d,this.m_v1.w.GetNegative());return w>0?n.CrossFV(1,d):n.CrossVF(d,1)}default:return r.b2Assert(!1),new o}},I.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return r.b2Assert(!1),new o;case 1:return this.m_v1.w;case 2:return new o(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return r.b2Assert(!1),new o}},I.prototype.GetWitnessPoints=function(d,w){switch(this.m_count){case 0:r.b2Assert(!1);break;case 1:d.SetV(this.m_v1.wA),w.SetV(this.m_v1.wB);break;case 2:d.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,d.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,w.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,w.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:w.x=d.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,w.y=d.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:r.b2Assert(!1);break}},I.prototype.GetMetric=function(){switch(this.m_count){case 0:return r.b2Assert(!1),0;case 1:return 0;case 2:return n.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return n.CrossVV(n.SubtractVV(this.m_v2.w,this.m_v1.w),n.SubtractVV(this.m_v3.w,this.m_v1.w));default:return r.b2Assert(!1),0}},I.prototype.Solve2=function(){var d=this.m_v1.w,w=this.m_v2.w,m=n.SubtractVV(w,d),P=-(d.x*m.x+d.y*m.y);if(P<=0){this.m_v1.a=1,this.m_count=1;return}var T=w.x*m.x+w.y*m.y;if(T<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2);return}var L=1/(T+P);this.m_v1.a=T*L,this.m_v2.a=P*L,this.m_count=2},I.prototype.Solve3=function(){var d=this.m_v1.w,w=this.m_v2.w,m=this.m_v3.w,P=n.SubtractVV(w,d),T=n.Dot(d,P),L=n.Dot(w,P),O=L,R=-T,z=n.SubtractVV(m,d),q=n.Dot(d,z),X=n.Dot(m,z),Y=X,Q=-q,tt=n.SubtractVV(m,w),at=n.Dot(w,tt),et=n.Dot(m,tt),st=et,lt=-at,Z=n.CrossVV(P,z),it=Z*n.CrossVV(w,m),ft=Z*n.CrossVV(m,d),ut=Z*n.CrossVV(d,w);if(R<=0&&Q<=0){this.m_v1.a=1,this.m_count=1;return}if(O>0&&R>0&&ut<=0){var dt=1/(O+R);this.m_v1.a=O*dt,this.m_v2.a=R*dt,this.m_count=2;return}if(Y>0&&Q>0&&ft<=0){var pt=1/(Y+Q);this.m_v1.a=Y*pt,this.m_v3.a=Q*pt,this.m_count=2,this.m_v2.Set(this.m_v3);return}if(O<=0&&lt<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2);return}if(Y<=0&&st<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.Set(this.m_v3);return}if(st>0&&lt>0&&it<=0){var mt=1/(st+lt);this.m_v2.a=st*mt,this.m_v3.a=lt*mt,this.m_count=2,this.m_v1.Set(this.m_v3);return}var Ct=1/(it+ft+ut);this.m_v1.a=it*Ct,this.m_v2.a=ft*Ct,this.m_v3.a=ut*Ct,this.m_count=3},F.b2SimplexCache=function(){this.indexA=new we(3),this.indexB=new we(3)},A.b2SimplexVertex=function(){},A.prototype.Set=function(d){this.wA.SetV(d.wA),this.wB.SetV(d.wB),this.w.SetV(d.w),this.a=d.a,this.indexA=d.indexA,this.indexB=d.indexB},D.b2TimeOfImpact=function(){},D.TimeOfImpact=function(d){++D.b2_toiCalls;var w=d.proxyA,m=d.proxyB,P=d.sweepA,T=d.sweepB;r.b2Assert(P.t0==T.t0),r.b2Assert(1-P.t0>Number.MIN_VALUE);var L=w.m_radius+m.m_radius,O=d.tolerance,R=0,z=1e3,q=0,X=0;for(D.s_cache.count=0,D.s_distanceInput.useRadii=!1;;){if(P.GetTransform(D.s_xfA,R),T.GetTransform(D.s_xfB,R),D.s_distanceInput.proxyA=w,D.s_distanceInput.proxyB=m,D.s_distanceInput.transformA=D.s_xfA,D.s_distanceInput.transformB=D.s_xfB,M.Distance(D.s_distanceOutput,D.s_cache,D.s_distanceInput),D.s_distanceOutput.distance<=0){R=1;break}D.s_fcn.Initialize(D.s_cache,w,D.s_xfA,m,D.s_xfB);var Y=D.s_fcn.Evaluate(D.s_xfA,D.s_xfB);if(Y<=0){R=1;break}if(q==0&&(Y>L?X=n.Max(L-O,.75*L):X=n.Max(Y-O,.02*L)),Y-X<.5*O){if(q==0){R=1;break}break}var Q=R;{var tt=R,at=1,et=Y;P.GetTransform(D.s_xfA,at),T.GetTransform(D.s_xfB,at);var st=D.s_fcn.Evaluate(D.s_xfA,D.s_xfB);if(st>=X){R=1;break}for(var lt=0;;){var Z=0;lt&1?Z=tt+(X-et)*(at-tt)/(st-et):Z=.5*(tt+at),P.GetTransform(D.s_xfA,Z),T.GetTransform(D.s_xfB,Z);var it=D.s_fcn.Evaluate(D.s_xfA,D.s_xfB);if(n.Abs(it-X)<.025*O){Q=Z;break}if(it>X?(tt=Z,et=it):(at=Z,st=it),++lt,++D.b2_toiRootIters,lt==50)break}D.b2_toiMaxRootIters=n.Max(D.b2_toiMaxRootIters,lt)}if(Q<(1+100*Number.MIN_VALUE)*R||(R=Q,q++,++D.b2_toiIters,q==z))break}return D.b2_toiMaxIters=n.Max(D.b2_toiMaxIters,q),R},p.postDefs.push(function(){p.Collision.b2TimeOfImpact.b2_toiCalls=0,p.Collision.b2TimeOfImpact.b2_toiIters=0,p.Collision.b2TimeOfImpact.b2_toiMaxIters=0,p.Collision.b2TimeOfImpact.b2_toiRootIters=0,p.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,p.Collision.b2TimeOfImpact.s_cache=new F,p.Collision.b2TimeOfImpact.s_distanceInput=new G,p.Collision.b2TimeOfImpact.s_xfA=new a,p.Collision.b2TimeOfImpact.s_xfB=new a,p.Collision.b2TimeOfImpact.s_fcn=new B,p.Collision.b2TimeOfImpact.s_distanceOutput=new h}),W.b2TOIInput=function(){this.proxyA=new v,this.proxyB=new v,this.sweepA=new s,this.sweepB=new s},U.b2WorldManifold=function(){this.m_normal=new o},U.prototype.b2WorldManifold=function(){this.m_points=new Wt(r.b2_maxManifoldPoints);for(var d=0;d<r.b2_maxManifoldPoints;d++)this.m_points[d]=new o},U.prototype.Initialize=function(d,w,m,P,T){if(m===void 0&&(m=0),T===void 0&&(T=0),d.m_pointCount!=0){var L=0,O,R,z=0,q=0,X=0,Y=0,Q=0,tt=0;switch(d.m_type){case N.e_circles:{R=w.R,O=d.m_localPoint;var at=w.position.x+R.col1.x*O.x+R.col2.x*O.y,et=w.position.y+R.col1.y*O.x+R.col2.y*O.y;R=P.R,O=d.m_points[0].m_localPoint;var st=P.position.x+R.col1.x*O.x+R.col2.x*O.y,lt=P.position.y+R.col1.y*O.x+R.col2.y*O.y,Z=st-at,it=lt-et,ft=Z*Z+it*it;if(ft>Number.MIN_VALUE*Number.MIN_VALUE){var ut=Math.sqrt(ft);this.m_normal.x=Z/ut,this.m_normal.y=it/ut}else this.m_normal.x=1,this.m_normal.y=0;var dt=at+m*this.m_normal.x,pt=et+m*this.m_normal.y,mt=st-T*this.m_normal.x,Ct=lt-T*this.m_normal.y;this.m_points[0].x=.5*(dt+mt),this.m_points[0].y=.5*(pt+Ct)}break;case N.e_faceA:for(R=w.R,O=d.m_localPlaneNormal,z=R.col1.x*O.x+R.col2.x*O.y,q=R.col1.y*O.x+R.col2.y*O.y,R=w.R,O=d.m_localPoint,X=w.position.x+R.col1.x*O.x+R.col2.x*O.y,Y=w.position.y+R.col1.y*O.x+R.col2.y*O.y,this.m_normal.x=z,this.m_normal.y=q,L=0;L<d.m_pointCount;L++)R=P.R,O=d.m_points[L].m_localPoint,Q=P.position.x+R.col1.x*O.x+R.col2.x*O.y,tt=P.position.y+R.col1.y*O.x+R.col2.y*O.y,this.m_points[L].x=Q+.5*(m-(Q-X)*z-(tt-Y)*q-T)*z,this.m_points[L].y=tt+.5*(m-(Q-X)*z-(tt-Y)*q-T)*q;break;case N.e_faceB:for(R=P.R,O=d.m_localPlaneNormal,z=R.col1.x*O.x+R.col2.x*O.y,q=R.col1.y*O.x+R.col2.y*O.y,R=P.R,O=d.m_localPoint,X=P.position.x+R.col1.x*O.x+R.col2.x*O.y,Y=P.position.y+R.col1.y*O.x+R.col2.y*O.y,this.m_normal.x=-z,this.m_normal.y=-q,L=0;L<d.m_pointCount;L++)R=w.R,O=d.m_points[L].m_localPoint,Q=w.position.x+R.col1.x*O.x+R.col2.x*O.y,tt=w.position.y+R.col1.y*O.x+R.col2.y*O.y,this.m_points[L].x=Q+.5*(T-(Q-X)*z-(tt-Y)*q-m)*z,this.m_points[L].y=tt+.5*(T-(Q-X)*z-(tt-Y)*q-m)*q;break}}},u.ClipVertex=function(){this.v=new o,this.id=new x},u.prototype.Set=function(d){this.v.SetV(d.v),this.id.Set(d.id)},g.Features=function(){},Object.defineProperty(g.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(g.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(d){d===void 0&&(d=0),this._referenceEdge=d,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}}),Object.defineProperty(g.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(g.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(d){d===void 0&&(d=0),this._incidentEdge=d,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}}),Object.defineProperty(g.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(g.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(d){d===void 0&&(d=0),this._incidentVertex=d,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}}),Object.defineProperty(g.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(g.prototype,"flip",{enumerable:!1,configurable:!0,set:function(d){d===void 0&&(d=0),this._flip=d,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){p.Common.b2Color,p.Common.b2internal;var i=p.Common.b2Settings,t=p.Collision.Shapes.b2CircleShape,e=p.Collision.Shapes.b2EdgeChainDef,r=p.Collision.Shapes.b2EdgeShape,n=p.Collision.Shapes.b2MassData,s=p.Collision.Shapes.b2PolygonShape,a=p.Collision.Shapes.b2Shape,o=p.Common.Math.b2Mat22;p.Common.Math.b2Mat33;var l=p.Common.Math.b2Math;p.Common.Math.b2Sweep;var c=p.Common.Math.b2Transform,f=p.Common.Math.b2Vec2;p.Common.Math.b2Vec3,p.Dynamics.b2Body,p.Dynamics.b2BodyDef,p.Dynamics.b2ContactFilter,p.Dynamics.b2ContactImpulse,p.Dynamics.b2ContactListener,p.Dynamics.b2ContactManager,p.Dynamics.b2DebugDraw,p.Dynamics.b2DestructionListener,p.Dynamics.b2FilterData,p.Dynamics.b2Fixture,p.Dynamics.b2FixtureDef,p.Dynamics.b2Island,p.Dynamics.b2TimeStep,p.Dynamics.b2World,p.Collision.b2AABB,p.Collision.b2Bound,p.Collision.b2BoundValues,p.Collision.b2Collision,p.Collision.b2ContactID,p.Collision.b2ContactPoint;var _=p.Collision.b2Distance,x=p.Collision.b2DistanceInput,y=p.Collision.b2DistanceOutput,M=p.Collision.b2DistanceProxy;p.Collision.b2DynamicTree,p.Collision.b2DynamicTreeBroadPhase,p.Collision.b2DynamicTreeNode,p.Collision.b2DynamicTreePair,p.Collision.b2Manifold,p.Collision.b2ManifoldPoint,p.Collision.b2Point,p.Collision.b2RayCastInput,p.Collision.b2RayCastOutput,p.Collision.b2Segment,p.Collision.b2SeparationFunction,p.Collision.b2Simplex;var G=p.Collision.b2SimplexCache;p.Collision.b2SimplexVertex,p.Collision.b2TimeOfImpact,p.Collision.b2TOIInput,p.Collision.b2WorldManifold,p.Collision.ClipVertex,p.Collision.Features,p.Collision.IBroadPhase,p.inherit(t,p.Collision.Shapes.b2Shape),t.prototype.__super=p.Collision.Shapes.b2Shape.prototype,t.b2CircleShape=function(){p.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new f},t.prototype.Copy=function(){var h=new t;return h.Set(this),h},t.prototype.Set=function(h){if(this.__super.Set.call(this,h),p.is(h,t)){var v=h instanceof t?h:null;this.m_p.SetV(v.m_p)}},t.prototype.TestPoint=function(h,v){var C=h.R,E=h.position.x+(C.col1.x*this.m_p.x+C.col2.x*this.m_p.y),k=h.position.y+(C.col1.y*this.m_p.x+C.col2.y*this.m_p.y);return E=v.x-E,k=v.y-k,E*E+k*k<=this.m_radius*this.m_radius},t.prototype.RayCast=function(h,v,C){var E=C.R,k=C.position.x+(E.col1.x*this.m_p.x+E.col2.x*this.m_p.y),J=C.position.y+(E.col1.y*this.m_p.x+E.col2.y*this.m_p.y),N=v.p1.x-k,H=v.p1.y-J,$=N*N+H*H-this.m_radius*this.m_radius,j=v.p2.x-v.p1.x,K=v.p2.y-v.p1.y,rt=N*j+H*K,B=j*j+K*K,I=rt*rt-B*$;if(I<0||B<Number.MIN_VALUE)return!1;var F=-(rt+Math.sqrt(I));return 0<=F&&F<=v.maxFraction*B?(F/=B,h.fraction=F,h.normal.x=N+F*j,h.normal.y=H+F*K,h.normal.Normalize(),!0):!1},t.prototype.ComputeAABB=function(h,v){var C=v.R,E=v.position.x+(C.col1.x*this.m_p.x+C.col2.x*this.m_p.y),k=v.position.y+(C.col1.y*this.m_p.x+C.col2.y*this.m_p.y);h.lowerBound.Set(E-this.m_radius,k-this.m_radius),h.upperBound.Set(E+this.m_radius,k+this.m_radius)},t.prototype.ComputeMass=function(h,v){v===void 0&&(v=0),h.mass=v*i.b2_pi*this.m_radius*this.m_radius,h.center.SetV(this.m_p),h.I=h.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},t.prototype.ComputeSubmergedArea=function(h,v,C,E){v===void 0&&(v=0);var k=l.MulX(C,this.m_p),J=-(l.Dot(h,k)-v);if(J<-this.m_radius+Number.MIN_VALUE)return 0;if(J>this.m_radius)return E.SetV(k),Math.PI*this.m_radius*this.m_radius;var N=this.m_radius*this.m_radius,H=J*J,$=N*(Math.asin(J/this.m_radius)+Math.PI/2)+J*Math.sqrt(N-H),j=-2/3*Math.pow(N-H,1.5)/$;return E.x=k.x+h.x*j,E.y=k.y+h.y*j,$},t.prototype.GetLocalPosition=function(){return this.m_p},t.prototype.SetLocalPosition=function(h){this.m_p.SetV(h)},t.prototype.GetRadius=function(){return this.m_radius},t.prototype.SetRadius=function(h){h===void 0&&(h=0),this.m_radius=h},t.prototype.b2CircleShape=function(h){h===void 0&&(h=0),this.__super.b2Shape.call(this),this.m_type=a.e_circleShape,this.m_radius=h},e.b2EdgeChainDef=function(){},e.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},p.inherit(r,p.Collision.Shapes.b2Shape),r.prototype.__super=p.Collision.Shapes.b2Shape.prototype,r.b2EdgeShape=function(){p.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new f,this.m_v1=new f,this.m_v2=new f,this.m_coreV1=new f,this.m_coreV2=new f,this.m_normal=new f,this.m_direction=new f,this.m_cornerDir1=new f,this.m_cornerDir2=new f},r.prototype.TestPoint=function(h,v){return!1},r.prototype.RayCast=function(h,v,C){var E,k=v.p2.x-v.p1.x,J=v.p2.y-v.p1.y;E=C.R;var N=C.position.x+(E.col1.x*this.m_v1.x+E.col2.x*this.m_v1.y),H=C.position.y+(E.col1.y*this.m_v1.x+E.col2.y*this.m_v1.y),$=C.position.y+(E.col1.y*this.m_v2.x+E.col2.y*this.m_v2.y)-H,j=-(C.position.x+(E.col1.x*this.m_v2.x+E.col2.x*this.m_v2.y)-N),K=100*Number.MIN_VALUE,rt=-(k*$+J*j);if(rt>K){var B=v.p1.x-N,I=v.p1.y-H,F=B*$+I*j;if(0<=F&&F<=v.maxFraction*rt){var A=-k*I+J*B;if(-K*rt<=A&&A<=rt*(1+K)){F/=rt,h.fraction=F;var D=Math.sqrt($*$+j*j);return h.normal.x=$/D,h.normal.y=j/D,!0}}}return!1},r.prototype.ComputeAABB=function(h,v){var C=v.R,E=v.position.x+(C.col1.x*this.m_v1.x+C.col2.x*this.m_v1.y),k=v.position.y+(C.col1.y*this.m_v1.x+C.col2.y*this.m_v1.y),J=v.position.x+(C.col1.x*this.m_v2.x+C.col2.x*this.m_v2.y),N=v.position.y+(C.col1.y*this.m_v2.x+C.col2.y*this.m_v2.y);E<J?(h.lowerBound.x=E,h.upperBound.x=J):(h.lowerBound.x=J,h.upperBound.x=E),k<N?(h.lowerBound.y=k,h.upperBound.y=N):(h.lowerBound.y=N,h.upperBound.y=k)},r.prototype.ComputeMass=function(h,v){h.mass=0,h.center.SetV(this.m_v1),h.I=0},r.prototype.ComputeSubmergedArea=function(h,v,C,E){v===void 0&&(v=0);var k=new f(h.x*v,h.y*v),J=l.MulX(C,this.m_v1),N=l.MulX(C,this.m_v2),H=l.Dot(h,J)-v,$=l.Dot(h,N)-v;if(H>0){if($>0)return 0;J.x=-$/(H-$)*J.x+H/(H-$)*N.x,J.y=-$/(H-$)*J.y+H/(H-$)*N.y}else $>0&&(N.x=-$/(H-$)*J.x+H/(H-$)*N.x,N.y=-$/(H-$)*J.y+H/(H-$)*N.y);return E.x=(k.x+J.x+N.x)/3,E.y=(k.y+J.y+N.y)/3,.5*((J.x-k.x)*(N.y-k.y)-(J.y-k.y)*(N.x-k.x))},r.prototype.GetLength=function(){return this.m_length},r.prototype.GetVertex1=function(){return this.m_v1},r.prototype.GetVertex2=function(){return this.m_v2},r.prototype.GetCoreVertex1=function(){return this.m_coreV1},r.prototype.GetCoreVertex2=function(){return this.m_coreV2},r.prototype.GetNormalVector=function(){return this.m_normal},r.prototype.GetDirectionVector=function(){return this.m_direction},r.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},r.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},r.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},r.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},r.prototype.GetFirstVertex=function(h){var v=h.R;return new f(h.position.x+(v.col1.x*this.m_coreV1.x+v.col2.x*this.m_coreV1.y),h.position.y+(v.col1.y*this.m_coreV1.x+v.col2.y*this.m_coreV1.y))},r.prototype.GetNextEdge=function(){return this.m_nextEdge},r.prototype.GetPrevEdge=function(){return this.m_prevEdge},r.prototype.Support=function(h,v,C){v===void 0&&(v=0),C===void 0&&(C=0);var E=h.R,k=h.position.x+(E.col1.x*this.m_coreV1.x+E.col2.x*this.m_coreV1.y),J=h.position.y+(E.col1.y*this.m_coreV1.x+E.col2.y*this.m_coreV1.y),N=h.position.x+(E.col1.x*this.m_coreV2.x+E.col2.x*this.m_coreV2.y),H=h.position.y+(E.col1.y*this.m_coreV2.x+E.col2.y*this.m_coreV2.y);return k*v+J*C>N*v+H*C?(this.s_supportVec.x=k,this.s_supportVec.y=J):(this.s_supportVec.x=N,this.s_supportVec.y=H),this.s_supportVec},r.prototype.b2EdgeShape=function(h,v){this.__super.b2Shape.call(this),this.m_type=a.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=h,this.m_v2=v,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-i.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-i.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-i.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-i.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},r.prototype.SetPrevEdge=function(h,v,C,E){this.m_prevEdge=h,this.m_coreV1=v,this.m_cornerDir1=C,this.m_cornerConvex1=E},r.prototype.SetNextEdge=function(h,v,C,E){this.m_nextEdge=h,this.m_coreV2=v,this.m_cornerDir2=C,this.m_cornerConvex2=E},n.b2MassData=function(){this.mass=0,this.center=new f(0,0),this.I=0},p.inherit(s,p.Collision.Shapes.b2Shape),s.prototype.__super=p.Collision.Shapes.b2Shape.prototype,s.b2PolygonShape=function(){p.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},s.prototype.Copy=function(){var h=new s;return h.Set(this),h},s.prototype.Set=function(h){if(this.__super.Set.call(this,h),p.is(h,s)){var v=h instanceof s?h:null;this.m_centroid.SetV(v.m_centroid),this.m_vertexCount=v.m_vertexCount,this.Reserve(this.m_vertexCount);for(var C=0;C<this.m_vertexCount;C++)this.m_vertices[C].SetV(v.m_vertices[C]),this.m_normals[C].SetV(v.m_normals[C])}},s.prototype.SetAsArray=function(h,v){v===void 0&&(v=0);var C=new Wt,E=0,k;for(E=0;E<h.length;++E)k=h[E],C.push(k);this.SetAsVector(C,v)},s.AsArray=function(h,v){v===void 0&&(v=0);var C=new s;return C.SetAsArray(h,v),C},s.prototype.SetAsVector=function(h,v){v===void 0&&(v=0),v==0&&(v=h.length),i.b2Assert(2<=v),this.m_vertexCount=v,this.Reserve(v);var C=0;for(C=0;C<this.m_vertexCount;C++)this.m_vertices[C].SetV(h[C]);for(C=0;C<this.m_vertexCount;++C){var E=parseInt(C),k=parseInt(C+1<this.m_vertexCount?C+1:0),J=l.SubtractVV(this.m_vertices[k],this.m_vertices[E]);i.b2Assert(J.LengthSquared()>Number.MIN_VALUE),this.m_normals[C].SetV(l.CrossVF(J,1)),this.m_normals[C].Normalize()}this.m_centroid=s.ComputeCentroid(this.m_vertices,this.m_vertexCount)},s.AsVector=function(h,v){v===void 0&&(v=0);var C=new s;return C.SetAsVector(h,v),C},s.prototype.SetAsBox=function(h,v){h===void 0&&(h=0),v===void 0&&(v=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-h,-v),this.m_vertices[1].Set(h,-v),this.m_vertices[2].Set(h,v),this.m_vertices[3].Set(-h,v),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},s.AsBox=function(h,v){h===void 0&&(h=0),v===void 0&&(v=0);var C=new s;return C.SetAsBox(h,v),C},s.prototype.SetAsOrientedBox=function(h,v,C,E){h===void 0&&(h=0),v===void 0&&(v=0),C===void 0&&(C=null),E===void 0&&(E=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-h,-v),this.m_vertices[1].Set(h,-v),this.m_vertices[2].Set(h,v),this.m_vertices[3].Set(-h,v),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=C;var k=new c;k.position=C,k.R.Set(E);for(var J=0;J<this.m_vertexCount;++J)this.m_vertices[J]=l.MulX(k,this.m_vertices[J]),this.m_normals[J]=l.MulMV(k.R,this.m_normals[J])},s.AsOrientedBox=function(h,v,C,E){h===void 0&&(h=0),v===void 0&&(v=0),C===void 0&&(C=null),E===void 0&&(E=0);var k=new s;return k.SetAsOrientedBox(h,v,C,E),k},s.prototype.SetAsEdge=function(h,v){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(h),this.m_vertices[1].SetV(v),this.m_centroid.x=.5*(h.x+v.x),this.m_centroid.y=.5*(h.y+v.y),this.m_normals[0]=l.CrossVF(l.SubtractVV(v,h),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},s.AsEdge=function(h,v){var C=new s;return C.SetAsEdge(h,v),C},s.prototype.TestPoint=function(h,v){for(var C,E=h.R,k=v.x-h.position.x,J=v.y-h.position.y,N=k*E.col1.x+J*E.col1.y,H=k*E.col2.x+J*E.col2.y,$=0;$<this.m_vertexCount;++$){C=this.m_vertices[$],k=N-C.x,J=H-C.y,C=this.m_normals[$];var j=C.x*k+C.y*J;if(j>0)return!1}return!0},s.prototype.RayCast=function(h,v,C){var E=0,k=v.maxFraction,J=0,N=0,H,$;J=v.p1.x-C.position.x,N=v.p1.y-C.position.y,H=C.R;var j=J*H.col1.x+N*H.col1.y,K=J*H.col2.x+N*H.col2.y;J=v.p2.x-C.position.x,N=v.p2.y-C.position.y,H=C.R;for(var rt=J*H.col1.x+N*H.col1.y,B=J*H.col2.x+N*H.col2.y,I=rt-j,F=B-K,A=parseInt(-1),D=0;D<this.m_vertexCount;++D){$=this.m_vertices[D],J=$.x-j,N=$.y-K,$=this.m_normals[D];var W=$.x*J+$.y*N,U=$.x*I+$.y*F;if(U==0){if(W<0)return!1}else U<0&&W<E*U?(E=W/U,A=D):U>0&&W<k*U&&(k=W/U);if(k<E-Number.MIN_VALUE)return!1}return A>=0?(h.fraction=E,H=C.R,$=this.m_normals[A],h.normal.x=H.col1.x*$.x+H.col2.x*$.y,h.normal.y=H.col1.y*$.x+H.col2.y*$.y,!0):!1},s.prototype.ComputeAABB=function(h,v){for(var C=v.R,E=this.m_vertices[0],k=v.position.x+(C.col1.x*E.x+C.col2.x*E.y),J=v.position.y+(C.col1.y*E.x+C.col2.y*E.y),N=k,H=J,$=1;$<this.m_vertexCount;++$){E=this.m_vertices[$];var j=v.position.x+(C.col1.x*E.x+C.col2.x*E.y),K=v.position.y+(C.col1.y*E.x+C.col2.y*E.y);k=k<j?k:j,J=J<K?J:K,N=N>j?N:j,H=H>K?H:K}h.lowerBound.x=k-this.m_radius,h.lowerBound.y=J-this.m_radius,h.upperBound.x=N+this.m_radius,h.upperBound.y=H+this.m_radius},s.prototype.ComputeMass=function(h,v){if(v===void 0&&(v=0),this.m_vertexCount==2){h.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),h.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),h.mass=0,h.I=0;return}for(var C=0,E=0,k=0,J=0,N=0,H=0,$=1/3,j=0;j<this.m_vertexCount;++j){var K=this.m_vertices[j],rt=j+1<this.m_vertexCount?this.m_vertices[parseInt(j+1)]:this.m_vertices[0],B=K.x-N,I=K.y-H,F=rt.x-N,A=rt.y-H,D=B*A-I*F,W=.5*D;k+=W,C+=W*$*(N+K.x+rt.x),E+=W*$*(H+K.y+rt.y);var U=N,u=H,g=B,V=I,d=F,w=A,m=$*(.25*(g*g+d*g+d*d)+(U*g+U*d))+.5*U*U,P=$*(.25*(V*V+w*V+w*w)+(u*V+u*w))+.5*u*u;J+=D*(m+P)}h.mass=v*k,C*=1/k,E*=1/k,h.center.Set(C,E),h.I=v*J},s.prototype.ComputeSubmergedArea=function(h,v,C,E){v===void 0&&(v=0);var k=l.MulTMV(C.R,h),J=v-l.Dot(h,C.position),N=new we,H=0,$=parseInt(-1),j=parseInt(-1),K=!1,rt=0;for(rt=0;rt<this.m_vertexCount;++rt){N[rt]=l.Dot(k,this.m_vertices[rt])-J;var B=N[rt]<-Number.MIN_VALUE;rt>0&&(B?K||($=rt-1,H++):K&&(j=rt-1,H++)),K=B}switch(H){case 0:if(K){var I=new n;return this.ComputeMass(I,1),E.SetV(l.MulX(C,I.center)),I.mass}else return 0;case 1:$==-1?$=this.m_vertexCount-1:j=this.m_vertexCount-1;break}var F=parseInt(($+1)%this.m_vertexCount),A=parseInt((j+1)%this.m_vertexCount),D=(0-N[$])/(N[F]-N[$]),W=(0-N[j])/(N[A]-N[j]),U=new f(this.m_vertices[$].x*(1-D)+this.m_vertices[F].x*D,this.m_vertices[$].y*(1-D)+this.m_vertices[F].y*D),u=new f(this.m_vertices[j].x*(1-W)+this.m_vertices[A].x*W,this.m_vertices[j].y*(1-W)+this.m_vertices[A].y*W),g=0,V=new f,d=this.m_vertices[F],w;for(rt=F;rt!=A;){rt=(rt+1)%this.m_vertexCount,rt==A?w=u:w=this.m_vertices[rt];var m=.5*((d.x-U.x)*(w.y-U.y)-(d.y-U.y)*(w.x-U.x));g+=m,V.x+=m*(U.x+d.x+w.x)/3,V.y+=m*(U.y+d.y+w.y)/3,d=w}return V.Multiply(1/g),E.SetV(l.MulX(C,V)),g},s.prototype.GetVertexCount=function(){return this.m_vertexCount},s.prototype.GetVertices=function(){return this.m_vertices},s.prototype.GetNormals=function(){return this.m_normals},s.prototype.GetSupport=function(h){for(var v=0,C=this.m_vertices[0].x*h.x+this.m_vertices[0].y*h.y,E=1;E<this.m_vertexCount;++E){var k=this.m_vertices[E].x*h.x+this.m_vertices[E].y*h.y;k>C&&(v=E,C=k)}return v},s.prototype.GetSupportVertex=function(h){for(var v=0,C=this.m_vertices[0].x*h.x+this.m_vertices[0].y*h.y,E=1;E<this.m_vertexCount;++E){var k=this.m_vertices[E].x*h.x+this.m_vertices[E].y*h.y;k>C&&(v=E,C=k)}return this.m_vertices[v]},s.prototype.Validate=function(){return!1},s.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=a.e_polygonShape,this.m_centroid=new f,this.m_vertices=new Wt,this.m_normals=new Wt},s.prototype.Reserve=function(h){h===void 0&&(h=0);for(var v=parseInt(this.m_vertices.length);v<h;v++)this.m_vertices[v]=new f,this.m_normals[v]=new f},s.ComputeCentroid=function(h,v){v===void 0&&(v=0);for(var C=new f,E=0,k=0,J=0,N=1/3,H=0;H<v;++H){var $=h[H],j=H+1<v?h[parseInt(H+1)]:h[0],K=$.x-k,rt=$.y-J,B=j.x-k,I=j.y-J,F=K*I-rt*B,A=.5*F;E+=A,C.x+=A*N*(k+$.x+j.x),C.y+=A*N*(J+$.y+j.y)}return C.x*=1/E,C.y*=1/E,C},s.ComputeOBB=function(h,v,C){C===void 0&&(C=0);var E=0,k=new Wt(C+1);for(E=0;E<C;++E)k[E]=v[E];k[C]=k[0];var J=Number.MAX_VALUE;for(E=1;E<=C;++E){var N=k[parseInt(E-1)],H=k[E].x-N.x,$=k[E].y-N.y,j=Math.sqrt(H*H+$*$);H/=j,$/=j;for(var K=-$,rt=H,B=Number.MAX_VALUE,I=Number.MAX_VALUE,F=-Number.MAX_VALUE,A=-Number.MAX_VALUE,D=0;D<C;++D){var W=k[D].x-N.x,U=k[D].y-N.y,u=H*W+$*U,g=K*W+rt*U;u<B&&(B=u),g<I&&(I=g),u>F&&(F=u),g>A&&(A=g)}var V=(F-B)*(A-I);if(V<.95*J){J=V,h.R.col1.x=H,h.R.col1.y=$,h.R.col2.x=K,h.R.col2.y=rt;var d=.5*(B+F),w=.5*(I+A),m=h.R;h.center.x=N.x+(m.col1.x*d+m.col2.x*w),h.center.y=N.y+(m.col1.y*d+m.col2.y*w),h.extents.x=.5*(F-B),h.extents.y=.5*(A-I)}}},p.postDefs.push(function(){p.Collision.Shapes.b2PolygonShape.s_mat=new o}),a.b2Shape=function(){},a.prototype.Copy=function(){return null},a.prototype.Set=function(h){this.m_radius=h.m_radius},a.prototype.GetType=function(){return this.m_type},a.prototype.TestPoint=function(h,v){return!1},a.prototype.RayCast=function(h,v,C){return!1},a.prototype.ComputeAABB=function(h,v){},a.prototype.ComputeMass=function(h,v){},a.prototype.ComputeSubmergedArea=function(h,v,C,E){return 0},a.TestOverlap=function(h,v,C,E){var k=new x;k.proxyA=new M,k.proxyA.Set(h),k.proxyB=new M,k.proxyB.Set(C),k.transformA=v,k.transformB=E,k.useRadii=!0;var J=new G;J.count=0;var N=new y;return _.Distance(N,J,k),N.distance<10*Number.MIN_VALUE},a.prototype.b2Shape=function(){this.m_type=a.e_unknownShape,this.m_radius=i.b2_linearSlop},p.postDefs.push(function(){p.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),p.Collision.Shapes.b2Shape.e_circleShape=0,p.Collision.Shapes.b2Shape.e_polygonShape=1,p.Collision.Shapes.b2Shape.e_edgeShape=2,p.Collision.Shapes.b2Shape.e_shapeTypeCount=3,p.Collision.Shapes.b2Shape.e_hitCollide=1,p.Collision.Shapes.b2Shape.e_missCollide=0,p.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var i=p.Common.b2Color;p.Common.b2internal;var t=p.Common.b2Settings;p.Common.Math.b2Mat22,p.Common.Math.b2Mat33;var e=p.Common.Math.b2Math;p.Common.Math.b2Sweep,p.Common.Math.b2Transform,p.Common.Math.b2Vec2,p.Common.Math.b2Vec3,i.b2Color=function(){this._r=0,this._g=0,this._b=0},i.prototype.b2Color=function(r,n,s){r===void 0&&(r=0),n===void 0&&(n=0),s===void 0&&(s=0),this._r=p.parseUInt(255*e.Clamp(r,0,1)),this._g=p.parseUInt(255*e.Clamp(n,0,1)),this._b=p.parseUInt(255*e.Clamp(s,0,1))},i.prototype.Set=function(r,n,s){r===void 0&&(r=0),n===void 0&&(n=0),s===void 0&&(s=0),this._r=p.parseUInt(255*e.Clamp(r,0,1)),this._g=p.parseUInt(255*e.Clamp(n,0,1)),this._b=p.parseUInt(255*e.Clamp(s,0,1))},Object.defineProperty(i.prototype,"r",{enumerable:!1,configurable:!0,set:function(r){r===void 0&&(r=0),this._r=p.parseUInt(255*e.Clamp(r,0,1))}}),Object.defineProperty(i.prototype,"g",{enumerable:!1,configurable:!0,set:function(r){r===void 0&&(r=0),this._g=p.parseUInt(255*e.Clamp(r,0,1))}}),Object.defineProperty(i.prototype,"b",{enumerable:!1,configurable:!0,set:function(r){r===void 0&&(r=0),this._b=p.parseUInt(255*e.Clamp(r,0,1))}}),Object.defineProperty(i.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),t.b2Settings=function(){},t.b2MixFriction=function(r,n){return r===void 0&&(r=0),n===void 0&&(n=0),Math.sqrt(r*n)},t.b2MixRestitution=function(r,n){return r===void 0&&(r=0),n===void 0&&(n=0),r>n?r:n},t.b2Assert=function(r){if(!r)throw"Assertion Failed"},p.postDefs.push(function(){p.Common.b2Settings.VERSION="2.1alpha",p.Common.b2Settings.USHRT_MAX=65535,p.Common.b2Settings.b2_pi=Math.PI,p.Common.b2Settings.b2_maxManifoldPoints=2,p.Common.b2Settings.b2_aabbExtension=.1,p.Common.b2Settings.b2_aabbMultiplier=2,p.Common.b2Settings.b2_polygonRadius=2*t.b2_linearSlop,p.Common.b2Settings.b2_linearSlop=.005,p.Common.b2Settings.b2_angularSlop=2/180*t.b2_pi,p.Common.b2Settings.b2_toiSlop=8*t.b2_linearSlop,p.Common.b2Settings.b2_maxTOIContactsPerIsland=32,p.Common.b2Settings.b2_maxTOIJointsPerIsland=32,p.Common.b2Settings.b2_velocityThreshold=1,p.Common.b2Settings.b2_maxLinearCorrection=.2,p.Common.b2Settings.b2_maxAngularCorrection=8/180*t.b2_pi,p.Common.b2Settings.b2_maxTranslation=2,p.Common.b2Settings.b2_maxTranslationSquared=t.b2_maxTranslation*t.b2_maxTranslation,p.Common.b2Settings.b2_maxRotation=.5*t.b2_pi,p.Common.b2Settings.b2_maxRotationSquared=t.b2_maxRotation*t.b2_maxRotation,p.Common.b2Settings.b2_contactBaumgarte=.2,p.Common.b2Settings.b2_timeToSleep=.5,p.Common.b2Settings.b2_linearSleepTolerance=.01,p.Common.b2Settings.b2_angularSleepTolerance=2/180*t.b2_pi})})();(function(){p.Collision.b2AABB,p.Common.b2Color,p.Common.b2internal,p.Common.b2Settings;var i=p.Common.Math.b2Mat22,t=p.Common.Math.b2Mat33,e=p.Common.Math.b2Math,r=p.Common.Math.b2Sweep,n=p.Common.Math.b2Transform,s=p.Common.Math.b2Vec2,a=p.Common.Math.b2Vec3;i.b2Mat22=function(){this.col1=new s,this.col2=new s},i.prototype.b2Mat22=function(){this.SetIdentity()},i.FromAngle=function(o){o===void 0&&(o=0);var l=new i;return l.Set(o),l},i.FromVV=function(o,l){var c=new i;return c.SetVV(o,l),c},i.prototype.Set=function(o){o===void 0&&(o=0);var l=Math.cos(o),c=Math.sin(o);this.col1.x=l,this.col2.x=-c,this.col1.y=c,this.col2.y=l},i.prototype.SetVV=function(o,l){this.col1.SetV(o),this.col2.SetV(l)},i.prototype.Copy=function(){var o=new i;return o.SetM(this),o},i.prototype.SetM=function(o){this.col1.SetV(o.col1),this.col2.SetV(o.col2)},i.prototype.AddM=function(o){this.col1.x+=o.col1.x,this.col1.y+=o.col1.y,this.col2.x+=o.col2.x,this.col2.y+=o.col2.y},i.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},i.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},i.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},i.prototype.GetInverse=function(o){var l=this.col1.x,c=this.col2.x,f=this.col1.y,_=this.col2.y,x=l*_-c*f;return x!=0&&(x=1/x),o.col1.x=x*_,o.col2.x=-x*c,o.col1.y=-x*f,o.col2.y=x*l,o},i.prototype.Solve=function(o,l,c){l===void 0&&(l=0),c===void 0&&(c=0);var f=this.col1.x,_=this.col2.x,x=this.col1.y,y=this.col2.y,M=f*y-_*x;return M!=0&&(M=1/M),o.x=M*(y*l-_*c),o.y=M*(f*c-x*l),o},i.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},t.b2Mat33=function(){this.col1=new a,this.col2=new a,this.col3=new a},t.prototype.b2Mat33=function(o,l,c){o===void 0&&(o=null),l===void 0&&(l=null),c===void 0&&(c=null),!o&&!l&&!c?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(o),this.col2.SetV(l),this.col3.SetV(c))},t.prototype.SetVVV=function(o,l,c){this.col1.SetV(o),this.col2.SetV(l),this.col3.SetV(c)},t.prototype.Copy=function(){return new t(this.col1,this.col2,this.col3)},t.prototype.SetM=function(o){this.col1.SetV(o.col1),this.col2.SetV(o.col2),this.col3.SetV(o.col3)},t.prototype.AddM=function(o){this.col1.x+=o.col1.x,this.col1.y+=o.col1.y,this.col1.z+=o.col1.z,this.col2.x+=o.col2.x,this.col2.y+=o.col2.y,this.col2.z+=o.col2.z,this.col3.x+=o.col3.x,this.col3.y+=o.col3.y,this.col3.z+=o.col3.z},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},t.prototype.Solve22=function(o,l,c){l===void 0&&(l=0),c===void 0&&(c=0);var f=this.col1.x,_=this.col2.x,x=this.col1.y,y=this.col2.y,M=f*y-_*x;return M!=0&&(M=1/M),o.x=M*(y*l-_*c),o.y=M*(f*c-x*l),o},t.prototype.Solve33=function(o,l,c,f){l===void 0&&(l=0),c===void 0&&(c=0),f===void 0&&(f=0);var _=this.col1.x,x=this.col1.y,y=this.col1.z,M=this.col2.x,G=this.col2.y,h=this.col2.z,v=this.col3.x,C=this.col3.y,E=this.col3.z,k=_*(G*E-h*C)+x*(h*v-M*E)+y*(M*C-G*v);return k!=0&&(k=1/k),o.x=k*(l*(G*E-h*C)+c*(h*v-M*E)+f*(M*C-G*v)),o.y=k*(_*(c*E-f*C)+x*(f*v-l*E)+y*(l*C-c*v)),o.z=k*(_*(G*f-h*c)+x*(h*l-M*f)+y*(M*c-G*l)),o},e.b2Math=function(){},e.IsValid=function(o){return o===void 0&&(o=0),isFinite(o)},e.Dot=function(o,l){return o.x*l.x+o.y*l.y},e.CrossVV=function(o,l){return o.x*l.y-o.y*l.x},e.CrossVF=function(o,l){l===void 0&&(l=0);var c=new s(l*o.y,-l*o.x);return c},e.CrossFV=function(o,l){o===void 0&&(o=0);var c=new s(-o*l.y,o*l.x);return c},e.MulMV=function(o,l){var c=new s(o.col1.x*l.x+o.col2.x*l.y,o.col1.y*l.x+o.col2.y*l.y);return c},e.MulTMV=function(o,l){var c=new s(e.Dot(l,o.col1),e.Dot(l,o.col2));return c},e.MulX=function(o,l){var c=e.MulMV(o.R,l);return c.x+=o.position.x,c.y+=o.position.y,c},e.MulXT=function(o,l){var c=e.SubtractVV(l,o.position),f=c.x*o.R.col1.x+c.y*o.R.col1.y;return c.y=c.x*o.R.col2.x+c.y*o.R.col2.y,c.x=f,c},e.AddVV=function(o,l){var c=new s(o.x+l.x,o.y+l.y);return c},e.SubtractVV=function(o,l){var c=new s(o.x-l.x,o.y-l.y);return c},e.Distance=function(o,l){var c=o.x-l.x,f=o.y-l.y;return Math.sqrt(c*c+f*f)},e.DistanceSquared=function(o,l){var c=o.x-l.x,f=o.y-l.y;return c*c+f*f},e.MulFV=function(o,l){o===void 0&&(o=0);var c=new s(o*l.x,o*l.y);return c},e.AddMM=function(o,l){var c=i.FromVV(e.AddVV(o.col1,l.col1),e.AddVV(o.col2,l.col2));return c},e.MulMM=function(o,l){var c=i.FromVV(e.MulMV(o,l.col1),e.MulMV(o,l.col2));return c},e.MulTMM=function(o,l){var c=new s(e.Dot(o.col1,l.col1),e.Dot(o.col2,l.col1)),f=new s(e.Dot(o.col1,l.col2),e.Dot(o.col2,l.col2)),_=i.FromVV(c,f);return _},e.Abs=function(o){return o===void 0&&(o=0),o>0?o:-o},e.AbsV=function(o){var l=new s(e.Abs(o.x),e.Abs(o.y));return l},e.AbsM=function(o){var l=i.FromVV(e.AbsV(o.col1),e.AbsV(o.col2));return l},e.Min=function(o,l){return o===void 0&&(o=0),l===void 0&&(l=0),o<l?o:l},e.MinV=function(o,l){var c=new s(e.Min(o.x,l.x),e.Min(o.y,l.y));return c},e.Max=function(o,l){return o===void 0&&(o=0),l===void 0&&(l=0),o>l?o:l},e.MaxV=function(o,l){var c=new s(e.Max(o.x,l.x),e.Max(o.y,l.y));return c},e.Clamp=function(o,l,c){return o===void 0&&(o=0),l===void 0&&(l=0),c===void 0&&(c=0),o<l?l:o>c?c:o},e.ClampV=function(o,l,c){return e.MaxV(l,e.MinV(o,c))},e.Swap=function(o,l){var c=o[0];o[0]=l[0],l[0]=c},e.Random=function(){return Math.random()*2-1},e.RandomRange=function(o,l){o===void 0&&(o=0),l===void 0&&(l=0);var c=Math.random();return c=(l-o)*c+o,c},e.NextPowerOfTwo=function(o){return o===void 0&&(o=0),o|=o>>1&2147483647,o|=o>>2&1073741823,o|=o>>4&268435455,o|=o>>8&16777215,o|=o>>16&65535,o+1},e.IsPowerOfTwo=function(o){o===void 0&&(o=0);var l=o>0&&(o&o-1)==0;return l},p.postDefs.push(function(){p.Common.Math.b2Math.b2Vec2_zero=new s(0,0),p.Common.Math.b2Math.b2Mat22_identity=i.FromVV(new s(1,0),new s(0,1)),p.Common.Math.b2Math.b2Transform_identity=new n(e.b2Vec2_zero,e.b2Mat22_identity)}),r.b2Sweep=function(){this.localCenter=new s,this.c0=new s,this.c=new s},r.prototype.Set=function(o){this.localCenter.SetV(o.localCenter),this.c0.SetV(o.c0),this.c.SetV(o.c),this.a0=o.a0,this.a=o.a,this.t0=o.t0},r.prototype.Copy=function(){var o=new r;return o.localCenter.SetV(this.localCenter),o.c0.SetV(this.c0),o.c.SetV(this.c),o.a0=this.a0,o.a=this.a,o.t0=this.t0,o},r.prototype.GetTransform=function(o,l){l===void 0&&(l=0),o.position.x=(1-l)*this.c0.x+l*this.c.x,o.position.y=(1-l)*this.c0.y+l*this.c.y;var c=(1-l)*this.a0+l*this.a;o.R.Set(c);var f=o.R;o.position.x-=f.col1.x*this.localCenter.x+f.col2.x*this.localCenter.y,o.position.y-=f.col1.y*this.localCenter.x+f.col2.y*this.localCenter.y},r.prototype.Advance=function(o){if(o===void 0&&(o=0),this.t0<o&&1-this.t0>Number.MIN_VALUE){var l=(o-this.t0)/(1-this.t0);this.c0.x=(1-l)*this.c0.x+l*this.c.x,this.c0.y=(1-l)*this.c0.y+l*this.c.y,this.a0=(1-l)*this.a0+l*this.a,this.t0=o}},n.b2Transform=function(){this.position=new s,this.R=new i},n.prototype.b2Transform=function(o,l){o===void 0&&(o=null),l===void 0&&(l=null),o&&(this.position.SetV(o),this.R.SetM(l))},n.prototype.Initialize=function(o,l){this.position.SetV(o),this.R.SetM(l)},n.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},n.prototype.Set=function(o){this.position.SetV(o.position),this.R.SetM(o.R)},n.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},s.b2Vec2=function(){},s.prototype.b2Vec2=function(o,l){o===void 0&&(o=0),l===void 0&&(l=0),this.x=o,this.y=l},s.prototype.SetZero=function(){this.x=0,this.y=0},s.prototype.Set=function(o,l){o===void 0&&(o=0),l===void 0&&(l=0),this.x=o,this.y=l},s.prototype.SetV=function(o){this.x=o.x,this.y=o.y},s.prototype.GetNegative=function(){return new s(-this.x,-this.y)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},s.Make=function(o,l){return o===void 0&&(o=0),l===void 0&&(l=0),new s(o,l)},s.prototype.Copy=function(){return new s(this.x,this.y)},s.prototype.Add=function(o){this.x+=o.x,this.y+=o.y},s.prototype.Subtract=function(o){this.x-=o.x,this.y-=o.y},s.prototype.Multiply=function(o){o===void 0&&(o=0),this.x*=o,this.y*=o},s.prototype.MulM=function(o){var l=this.x;this.x=o.col1.x*l+o.col2.x*this.y,this.y=o.col1.y*l+o.col2.y*this.y},s.prototype.MulTM=function(o){var l=e.Dot(this,o.col1);this.y=e.Dot(this,o.col2),this.x=l},s.prototype.CrossVF=function(o){o===void 0&&(o=0);var l=this.x;this.x=o*this.y,this.y=-o*l},s.prototype.CrossFV=function(o){o===void 0&&(o=0);var l=this.x;this.x=-o*this.y,this.y=o*l},s.prototype.MinV=function(o){this.x=this.x<o.x?this.x:o.x,this.y=this.y<o.y?this.y:o.y},s.prototype.MaxV=function(o){this.x=this.x>o.x?this.x:o.x,this.y=this.y>o.y?this.y:o.y},s.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},s.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},s.prototype.Normalize=function(){var o=Math.sqrt(this.x*this.x+this.y*this.y);if(o<Number.MIN_VALUE)return 0;var l=1/o;return this.x*=l,this.y*=l,o},s.prototype.IsValid=function(){return e.IsValid(this.x)&&e.IsValid(this.y)},a.b2Vec3=function(){},a.prototype.b2Vec3=function(o,l,c){o===void 0&&(o=0),l===void 0&&(l=0),c===void 0&&(c=0),this.x=o,this.y=l,this.z=c},a.prototype.SetZero=function(){this.x=this.y=this.z=0},a.prototype.Set=function(o,l,c){o===void 0&&(o=0),l===void 0&&(l=0),c===void 0&&(c=0),this.x=o,this.y=l,this.z=c},a.prototype.SetV=function(o){this.x=o.x,this.y=o.y,this.z=o.z},a.prototype.GetNegative=function(){return new a(-this.x,-this.y,-this.z)},a.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},a.prototype.Copy=function(){return new a(this.x,this.y,this.z)},a.prototype.Add=function(o){this.x+=o.x,this.y+=o.y,this.z+=o.z},a.prototype.Subtract=function(o){this.x-=o.x,this.y-=o.y,this.z-=o.z},a.prototype.Multiply=function(o){o===void 0&&(o=0),this.x*=o,this.y*=o,this.z*=o}})();(function(){p.Dynamics.Controllers.b2ControllerEdge,p.Common.Math.b2Mat22,p.Common.Math.b2Mat33;var i=p.Common.Math.b2Math,t=p.Common.Math.b2Sweep,e=p.Common.Math.b2Transform,r=p.Common.Math.b2Vec2;p.Common.Math.b2Vec3;var n=p.Common.b2Color;p.Common.b2internal;var s=p.Common.b2Settings,a=p.Collision.b2AABB;p.Collision.b2Bound,p.Collision.b2BoundValues,p.Collision.b2Collision,p.Collision.b2ContactID;var o=p.Collision.b2ContactPoint;p.Collision.b2Distance,p.Collision.b2DistanceInput,p.Collision.b2DistanceOutput,p.Collision.b2DistanceProxy,p.Collision.b2DynamicTree;var l=p.Collision.b2DynamicTreeBroadPhase;p.Collision.b2DynamicTreeNode,p.Collision.b2DynamicTreePair,p.Collision.b2Manifold,p.Collision.b2ManifoldPoint,p.Collision.b2Point;var c=p.Collision.b2RayCastInput,f=p.Collision.b2RayCastOutput;p.Collision.b2Segment,p.Collision.b2SeparationFunction,p.Collision.b2Simplex,p.Collision.b2SimplexCache,p.Collision.b2SimplexVertex,p.Collision.b2TimeOfImpact,p.Collision.b2TOIInput,p.Collision.b2WorldManifold,p.Collision.ClipVertex,p.Collision.Features,p.Collision.IBroadPhase;var _=p.Collision.Shapes.b2CircleShape;p.Collision.Shapes.b2EdgeChainDef;var x=p.Collision.Shapes.b2EdgeShape,y=p.Collision.Shapes.b2MassData,M=p.Collision.Shapes.b2PolygonShape,G=p.Collision.Shapes.b2Shape,h=p.Dynamics.b2Body,v=p.Dynamics.b2BodyDef,C=p.Dynamics.b2ContactFilter,E=p.Dynamics.b2ContactImpulse,k=p.Dynamics.b2ContactListener,J=p.Dynamics.b2ContactManager,N=p.Dynamics.b2DebugDraw,H=p.Dynamics.b2DestructionListener,$=p.Dynamics.b2FilterData,j=p.Dynamics.b2Fixture,K=p.Dynamics.b2FixtureDef,rt=p.Dynamics.b2Island,B=p.Dynamics.b2TimeStep,I=p.Dynamics.b2World;p.Dynamics.Contacts.b2CircleContact;var F=p.Dynamics.Contacts.b2Contact;p.Dynamics.Contacts.b2ContactConstraint,p.Dynamics.Contacts.b2ContactConstraintPoint,p.Dynamics.Contacts.b2ContactEdge;var A=p.Dynamics.Contacts.b2ContactFactory;p.Dynamics.Contacts.b2ContactRegister,p.Dynamics.Contacts.b2ContactResult;var D=p.Dynamics.Contacts.b2ContactSolver;p.Dynamics.Contacts.b2EdgeAndCircleContact,p.Dynamics.Contacts.b2NullContact,p.Dynamics.Contacts.b2PolyAndCircleContact,p.Dynamics.Contacts.b2PolyAndEdgeContact,p.Dynamics.Contacts.b2PolygonContact,p.Dynamics.Contacts.b2PositionSolverManifold,p.Dynamics.Controllers.b2Controller,p.Dynamics.Joints.b2DistanceJoint,p.Dynamics.Joints.b2DistanceJointDef,p.Dynamics.Joints.b2FrictionJoint,p.Dynamics.Joints.b2FrictionJointDef,p.Dynamics.Joints.b2GearJoint,p.Dynamics.Joints.b2GearJointDef,p.Dynamics.Joints.b2Jacobian;var W=p.Dynamics.Joints.b2Joint;p.Dynamics.Joints.b2JointDef,p.Dynamics.Joints.b2JointEdge,p.Dynamics.Joints.b2LineJoint,p.Dynamics.Joints.b2LineJointDef,p.Dynamics.Joints.b2MouseJoint,p.Dynamics.Joints.b2MouseJointDef,p.Dynamics.Joints.b2PrismaticJoint,p.Dynamics.Joints.b2PrismaticJointDef;var U=p.Dynamics.Joints.b2PulleyJoint;p.Dynamics.Joints.b2PulleyJointDef,p.Dynamics.Joints.b2RevoluteJoint,p.Dynamics.Joints.b2RevoluteJointDef,p.Dynamics.Joints.b2WeldJoint,p.Dynamics.Joints.b2WeldJointDef,h.b2Body=function(){this.m_xf=new e,this.m_sweep=new t,this.m_linearVelocity=new r,this.m_force=new r},h.prototype.connectEdges=function(u,g,V){V===void 0&&(V=0);var d=Math.atan2(g.GetDirectionVector().y,g.GetDirectionVector().x),w=Math.tan((d-V)*.5),m=i.MulFV(w,g.GetDirectionVector());m=i.SubtractVV(m,g.GetNormalVector()),m=i.MulFV(s.b2_toiSlop,m),m=i.AddVV(m,g.GetVertex1());var P=i.AddVV(u.GetDirectionVector(),g.GetDirectionVector());P.Normalize();var T=i.Dot(u.GetDirectionVector(),g.GetNormalVector())>0;return u.SetNextEdge(g,m,P,T),g.SetPrevEdge(u,m,P,T),d},h.prototype.CreateFixture=function(u){if(this.m_world.IsLocked()==!0)return null;var g=new j;if(g.Create(this,this.m_xf,u),this.m_flags&h.e_activeFlag){var V=this.m_world.m_contactManager.m_broadPhase;g.CreateProxy(V,this.m_xf)}return g.m_next=this.m_fixtureList,this.m_fixtureList=g,++this.m_fixtureCount,g.m_body=this,g.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=I.e_newFixture,g},h.prototype.CreateFixture2=function(u,g){g===void 0&&(g=0);var V=new K;return V.shape=u,V.density=g,this.CreateFixture(V)},h.prototype.DestroyFixture=function(u){if(this.m_world.IsLocked()!=!0){for(var g=this.m_fixtureList,V=null;g!=null;){if(g==u){V?V.m_next=u.m_next:this.m_fixtureList=u.m_next;break}V=g,g=g.m_next}for(var d=this.m_contactList;d;){var w=d.contact;d=d.next;var m=w.GetFixtureA(),P=w.GetFixtureB();(u==m||u==P)&&this.m_world.m_contactManager.Destroy(w)}if(this.m_flags&h.e_activeFlag){var T=this.m_world.m_contactManager.m_broadPhase;u.DestroyProxy(T)}u.Destroy(),u.m_body=null,u.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},h.prototype.SetPositionAndAngle=function(u,g){g===void 0&&(g=0);var V;if(this.m_world.IsLocked()!=!0){this.m_xf.R.Set(g),this.m_xf.position.SetV(u);var d=this.m_xf.R,w=this.m_sweep.localCenter;this.m_sweep.c.x=d.col1.x*w.x+d.col2.x*w.y,this.m_sweep.c.y=d.col1.y*w.x+d.col2.y*w.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=g;var m=this.m_world.m_contactManager.m_broadPhase;for(V=this.m_fixtureList;V;V=V.m_next)V.Synchronize(m,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},h.prototype.SetTransform=function(u){this.SetPositionAndAngle(u.position,u.GetAngle())},h.prototype.GetTransform=function(){return this.m_xf},h.prototype.GetPosition=function(){return this.m_xf.position},h.prototype.SetPosition=function(u){this.SetPositionAndAngle(u,this.GetAngle())},h.prototype.GetAngle=function(){return this.m_sweep.a},h.prototype.SetAngle=function(u){u===void 0&&(u=0),this.SetPositionAndAngle(this.GetPosition(),u)},h.prototype.GetWorldCenter=function(){return this.m_sweep.c},h.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},h.prototype.SetLinearVelocity=function(u){this.m_type!=h.b2_staticBody&&this.m_linearVelocity.SetV(u)},h.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},h.prototype.SetAngularVelocity=function(u){u===void 0&&(u=0),this.m_type!=h.b2_staticBody&&(this.m_angularVelocity=u)},h.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},h.prototype.GetDefinition=function(){var u=new v;return u.type=this.GetType(),u.allowSleep=(this.m_flags&h.e_allowSleepFlag)==h.e_allowSleepFlag,u.angle=this.GetAngle(),u.angularDamping=this.m_angularDamping,u.angularVelocity=this.m_angularVelocity,u.fixedRotation=(this.m_flags&h.e_fixedRotationFlag)==h.e_fixedRotationFlag,u.bullet=(this.m_flags&h.e_bulletFlag)==h.e_bulletFlag,u.awake=(this.m_flags&h.e_awakeFlag)==h.e_awakeFlag,u.linearDamping=this.m_linearDamping,u.linearVelocity.SetV(this.GetLinearVelocity()),u.position=this.GetPosition(),u.userData=this.GetUserData(),u},h.prototype.ApplyForce=function(u,g){this.m_type==h.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_force.x+=u.x,this.m_force.y+=u.y,this.m_torque+=(g.x-this.m_sweep.c.x)*u.y-(g.y-this.m_sweep.c.y)*u.x)},h.prototype.ApplyTorque=function(u){u===void 0&&(u=0),this.m_type==h.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_torque+=u)},h.prototype.ApplyImpulse=function(u,g){this.m_type==h.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*u.x,this.m_linearVelocity.y+=this.m_invMass*u.y,this.m_angularVelocity+=this.m_invI*((g.x-this.m_sweep.c.x)*u.y-(g.y-this.m_sweep.c.y)*u.x))},h.prototype.ApplyAngularImpulse=function(u){this.IsAwake()==!1&&this.SetAwake(!0),this.m_angularVelocity+=this.m_invI*u},h.prototype.Split=function(u){for(var g=this.GetLinearVelocity().Copy(),V=this.GetAngularVelocity(),d=this.GetWorldCenter(),w=this,m=this.m_world.CreateBody(this.GetDefinition()),P,T=w.m_fixtureList;T;)if(u(T)){var L=T.m_next;P?P.m_next=L:w.m_fixtureList=L,w.m_fixtureCount--,T.m_next=m.m_fixtureList,m.m_fixtureList=T,m.m_fixtureCount++,T.m_body=m,T=L}else P=T,T=T.m_next;w.ResetMassData(),m.ResetMassData();var O=w.GetWorldCenter(),R=m.GetWorldCenter(),z=i.AddVV(g,i.CrossFV(V,i.SubtractVV(O,d))),q=i.AddVV(g,i.CrossFV(V,i.SubtractVV(R,d)));return w.SetLinearVelocity(z),m.SetLinearVelocity(q),w.SetAngularVelocity(V),m.SetAngularVelocity(V),w.SynchronizeFixtures(),m.SynchronizeFixtures(),m},h.prototype.Merge=function(u){var g;for(g=u.m_fixtureList;g;){var V=g.m_next;u.m_fixtureCount--,g.m_next=this.m_fixtureList,this.m_fixtureList=g,this.m_fixtureCount++,g.m_body=w,g=V}d.m_fixtureCount=0;var d=this,w=u;d.GetWorldCenter(),w.GetWorldCenter(),d.GetLinearVelocity().Copy(),w.GetLinearVelocity().Copy(),d.GetAngularVelocity(),w.GetAngularVelocity(),d.ResetMassData(),this.SynchronizeFixtures()},h.prototype.GetMass=function(){return this.m_mass},h.prototype.GetInertia=function(){return this.m_I},h.prototype.GetMassData=function(u){u.mass=this.m_mass,u.I=this.m_I,u.center.SetV(this.m_sweep.localCenter)},h.prototype.SetMassData=function(u){if(s.b2Assert(this.m_world.IsLocked()==!1),this.m_world.IsLocked()!=!0&&this.m_type==h.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=u.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,u.I>0&&(this.m_flags&h.e_fixedRotationFlag)==0&&(this.m_I=u.I-this.m_mass*(u.center.x*u.center.x+u.center.y*u.center.y),this.m_invI=1/this.m_I);var g=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(u.center),this.m_sweep.c0.SetV(i.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-g.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-g.x)}},h.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),!(this.m_type==h.b2_staticBody||this.m_type==h.b2_kinematicBody)){for(var u=r.Make(0,0),g=this.m_fixtureList;g;g=g.m_next)if(g.m_density!=0){var V=g.GetMassData();this.m_mass+=V.mass,u.x+=V.center.x*V.mass,u.y+=V.center.y*V.mass,this.m_I+=V.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,u.x*=this.m_invMass,u.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&(this.m_flags&h.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(u.x*u.x+u.y*u.y),this.m_I*=this.m_inertiaScale,s.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var d=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(u),this.m_sweep.c0.SetV(i.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-d.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-d.x)}},h.prototype.GetWorldPoint=function(u){var g=this.m_xf.R,V=new r(g.col1.x*u.x+g.col2.x*u.y,g.col1.y*u.x+g.col2.y*u.y);return V.x+=this.m_xf.position.x,V.y+=this.m_xf.position.y,V},h.prototype.GetWorldVector=function(u){return i.MulMV(this.m_xf.R,u)},h.prototype.GetLocalPoint=function(u){return i.MulXT(this.m_xf,u)},h.prototype.GetLocalVector=function(u){return i.MulTMV(this.m_xf.R,u)},h.prototype.GetLinearVelocityFromWorldPoint=function(u){return new r(this.m_linearVelocity.x-this.m_angularVelocity*(u.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(u.x-this.m_sweep.c.x))},h.prototype.GetLinearVelocityFromLocalPoint=function(u){var g=this.m_xf.R,V=new r(g.col1.x*u.x+g.col2.x*u.y,g.col1.y*u.x+g.col2.y*u.y);return V.x+=this.m_xf.position.x,V.y+=this.m_xf.position.y,new r(this.m_linearVelocity.x-this.m_angularVelocity*(V.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(V.x-this.m_sweep.c.x))},h.prototype.GetLinearDamping=function(){return this.m_linearDamping},h.prototype.SetLinearDamping=function(u){u===void 0&&(u=0),this.m_linearDamping=u},h.prototype.GetAngularDamping=function(){return this.m_angularDamping},h.prototype.SetAngularDamping=function(u){u===void 0&&(u=0),this.m_angularDamping=u},h.prototype.SetType=function(u){if(u===void 0&&(u=0),this.m_type!=u){this.m_type=u,this.ResetMassData(),this.m_type==h.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var g=this.m_contactList;g;g=g.next)g.contact.FlagForFiltering()}},h.prototype.GetType=function(){return this.m_type},h.prototype.SetBullet=function(u){u?this.m_flags|=h.e_bulletFlag:this.m_flags&=~h.e_bulletFlag},h.prototype.IsBullet=function(){return(this.m_flags&h.e_bulletFlag)==h.e_bulletFlag},h.prototype.SetSleepingAllowed=function(u){u?this.m_flags|=h.e_allowSleepFlag:(this.m_flags&=~h.e_allowSleepFlag,this.SetAwake(!0))},h.prototype.SetAwake=function(u){u?(this.m_flags|=h.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~h.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},h.prototype.IsAwake=function(){return(this.m_flags&h.e_awakeFlag)==h.e_awakeFlag},h.prototype.SetFixedRotation=function(u){u?this.m_flags|=h.e_fixedRotationFlag:this.m_flags&=~h.e_fixedRotationFlag,this.ResetMassData()},h.prototype.IsFixedRotation=function(){return(this.m_flags&h.e_fixedRotationFlag)==h.e_fixedRotationFlag},h.prototype.SetActive=function(u){if(u!=this.IsActive()){var g,V;if(u)for(this.m_flags|=h.e_activeFlag,g=this.m_world.m_contactManager.m_broadPhase,V=this.m_fixtureList;V;V=V.m_next)V.CreateProxy(g,this.m_xf);else{for(this.m_flags&=~h.e_activeFlag,g=this.m_world.m_contactManager.m_broadPhase,V=this.m_fixtureList;V;V=V.m_next)V.DestroyProxy(g);for(var d=this.m_contactList;d;){var w=d;d=d.next,this.m_world.m_contactManager.Destroy(w.contact)}this.m_contactList=null}}},h.prototype.IsActive=function(){return(this.m_flags&h.e_activeFlag)==h.e_activeFlag},h.prototype.IsSleepingAllowed=function(){return(this.m_flags&h.e_allowSleepFlag)==h.e_allowSleepFlag},h.prototype.GetFixtureList=function(){return this.m_fixtureList},h.prototype.GetJointList=function(){return this.m_jointList},h.prototype.GetControllerList=function(){return this.m_controllerList},h.prototype.GetContactList=function(){return this.m_contactList},h.prototype.GetNext=function(){return this.m_next},h.prototype.GetUserData=function(){return this.m_userData},h.prototype.SetUserData=function(u){this.m_userData=u},h.prototype.GetWorld=function(){return this.m_world},h.prototype.b2Body=function(u,g){this.m_flags=0,u.bullet&&(this.m_flags|=h.e_bulletFlag),u.fixedRotation&&(this.m_flags|=h.e_fixedRotationFlag),u.allowSleep&&(this.m_flags|=h.e_allowSleepFlag),u.awake&&(this.m_flags|=h.e_awakeFlag),u.active&&(this.m_flags|=h.e_activeFlag),this.m_world=g,this.m_xf.position.SetV(u.position),this.m_xf.R.Set(u.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=u.angle;var V=this.m_xf.R,d=this.m_sweep.localCenter;this.m_sweep.c.x=V.col1.x*d.x+V.col2.x*d.y,this.m_sweep.c.y=V.col1.y*d.x+V.col2.y*d.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(u.linearVelocity),this.m_angularVelocity=u.angularVelocity,this.m_linearDamping=u.linearDamping,this.m_angularDamping=u.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=u.type,this.m_type==h.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=u.inertiaScale,this.m_userData=u.userData,this.m_fixtureList=null,this.m_fixtureCount=0},h.prototype.SynchronizeFixtures=function(){var u=h.s_xf1;u.R.Set(this.m_sweep.a0);var g=u.R,V=this.m_sweep.localCenter;u.position.x=this.m_sweep.c0.x-(g.col1.x*V.x+g.col2.x*V.y),u.position.y=this.m_sweep.c0.y-(g.col1.y*V.x+g.col2.y*V.y);var d,w=this.m_world.m_contactManager.m_broadPhase;for(d=this.m_fixtureList;d;d=d.m_next)d.Synchronize(w,u,this.m_xf)},h.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var u=this.m_xf.R,g=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(u.col1.x*g.x+u.col2.x*g.y),this.m_xf.position.y=this.m_sweep.c.y-(u.col1.y*g.x+u.col2.y*g.y)},h.prototype.ShouldCollide=function(u){if(this.m_type!=h.b2_dynamicBody&&u.m_type!=h.b2_dynamicBody)return!1;for(var g=this.m_jointList;g;g=g.next)if(g.other==u&&g.joint.m_collideConnected==!1)return!1;return!0},h.prototype.Advance=function(u){u===void 0&&(u=0),this.m_sweep.Advance(u),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},p.postDefs.push(function(){p.Dynamics.b2Body.s_xf1=new e,p.Dynamics.b2Body.e_islandFlag=1,p.Dynamics.b2Body.e_awakeFlag=2,p.Dynamics.b2Body.e_allowSleepFlag=4,p.Dynamics.b2Body.e_bulletFlag=8,p.Dynamics.b2Body.e_fixedRotationFlag=16,p.Dynamics.b2Body.e_activeFlag=32,p.Dynamics.b2Body.b2_staticBody=0,p.Dynamics.b2Body.b2_kinematicBody=1,p.Dynamics.b2Body.b2_dynamicBody=2}),v.b2BodyDef=function(){this.position=new r,this.linearVelocity=new r},v.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=h.b2_staticBody,this.active=!0,this.inertiaScale=1},C.b2ContactFilter=function(){},C.prototype.ShouldCollide=function(u,g){var V=u.GetFilterData(),d=g.GetFilterData();if(V.groupIndex==d.groupIndex&&V.groupIndex!=0)return V.groupIndex>0;var w=(V.maskBits&d.categoryBits)!=0&&(V.categoryBits&d.maskBits)!=0;return w},C.prototype.RayCollide=function(u,g){return u?this.ShouldCollide(u instanceof j?u:null,g):!0},p.postDefs.push(function(){p.Dynamics.b2ContactFilter.b2_defaultFilter=new C}),E.b2ContactImpulse=function(){this.normalImpulses=new we(s.b2_maxManifoldPoints),this.tangentImpulses=new we(s.b2_maxManifoldPoints)},k.b2ContactListener=function(){},k.prototype.BeginContact=function(u){},k.prototype.EndContact=function(u){},k.prototype.PreSolve=function(u,g){},k.prototype.PostSolve=function(u,g){},p.postDefs.push(function(){p.Dynamics.b2ContactListener.b2_defaultListener=new k}),J.b2ContactManager=function(){},J.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=C.b2_defaultFilter,this.m_contactListener=k.b2_defaultListener,this.m_contactFactory=new A(this.m_allocator),this.m_broadPhase=new l},J.prototype.AddPair=function(u,g){var V=u instanceof j?u:null,d=g instanceof j?g:null,w=V.GetBody(),m=d.GetBody();if(w!=m){for(var P=m.GetContactList();P;){if(P.other==w){var T=P.contact.GetFixtureA(),L=P.contact.GetFixtureB();if(T==V&&L==d||T==d&&L==V)return}P=P.next}if(m.ShouldCollide(w)!=!1&&this.m_contactFilter.ShouldCollide(V,d)!=!1){var O=this.m_contactFactory.Create(V,d);V=O.GetFixtureA(),d=O.GetFixtureB(),w=V.m_body,m=d.m_body,O.m_prev=null,O.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=O),this.m_world.m_contactList=O,O.m_nodeA.contact=O,O.m_nodeA.other=m,O.m_nodeA.prev=null,O.m_nodeA.next=w.m_contactList,w.m_contactList!=null&&(w.m_contactList.prev=O.m_nodeA),w.m_contactList=O.m_nodeA,O.m_nodeB.contact=O,O.m_nodeB.other=w,O.m_nodeB.prev=null,O.m_nodeB.next=m.m_contactList,m.m_contactList!=null&&(m.m_contactList.prev=O.m_nodeB),m.m_contactList=O.m_nodeB,++this.m_world.m_contactCount}}},J.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(p.generateCallback(this,this.AddPair))},J.prototype.Destroy=function(u){var g=u.GetFixtureA(),V=u.GetFixtureB(),d=g.GetBody(),w=V.GetBody();u.IsTouching()&&this.m_contactListener.EndContact(u),u.m_prev&&(u.m_prev.m_next=u.m_next),u.m_next&&(u.m_next.m_prev=u.m_prev),u==this.m_world.m_contactList&&(this.m_world.m_contactList=u.m_next),u.m_nodeA.prev&&(u.m_nodeA.prev.next=u.m_nodeA.next),u.m_nodeA.next&&(u.m_nodeA.next.prev=u.m_nodeA.prev),u.m_nodeA==d.m_contactList&&(d.m_contactList=u.m_nodeA.next),u.m_nodeB.prev&&(u.m_nodeB.prev.next=u.m_nodeB.next),u.m_nodeB.next&&(u.m_nodeB.next.prev=u.m_nodeB.prev),u.m_nodeB==w.m_contactList&&(w.m_contactList=u.m_nodeB.next),this.m_contactFactory.Destroy(u),--this.m_contactCount},J.prototype.Collide=function(){for(var u=this.m_world.m_contactList;u;){var g=u.GetFixtureA(),V=u.GetFixtureB(),d=g.GetBody(),w=V.GetBody();if(d.IsAwake()==!1&&w.IsAwake()==!1){u=u.GetNext();continue}if(u.m_flags&F.e_filterFlag){if(w.ShouldCollide(d)==!1){var m=u;u=m.GetNext(),this.Destroy(m);continue}if(this.m_contactFilter.ShouldCollide(g,V)==!1){m=u,u=m.GetNext(),this.Destroy(m);continue}u.m_flags&=~F.e_filterFlag}var P=g.m_proxy,T=V.m_proxy,L=this.m_broadPhase.TestOverlap(P,T);if(L==!1){m=u,u=m.GetNext(),this.Destroy(m);continue}u.Update(this.m_contactListener),u=u.GetNext()}},p.postDefs.push(function(){p.Dynamics.b2ContactManager.s_evalCP=new o}),N.b2DebugDraw=function(){},N.prototype.b2DebugDraw=function(){},N.prototype.SetFlags=function(u){},N.prototype.GetFlags=function(){},N.prototype.AppendFlags=function(u){},N.prototype.ClearFlags=function(u){},N.prototype.SetSprite=function(u){},N.prototype.GetSprite=function(){},N.prototype.SetDrawScale=function(u){},N.prototype.GetDrawScale=function(){},N.prototype.SetLineThickness=function(u){},N.prototype.GetLineThickness=function(){},N.prototype.SetAlpha=function(u){},N.prototype.GetAlpha=function(){},N.prototype.SetFillAlpha=function(u){},N.prototype.GetFillAlpha=function(){},N.prototype.SetXFormScale=function(u){},N.prototype.GetXFormScale=function(){},N.prototype.DrawPolygon=function(u,g,V){},N.prototype.DrawSolidPolygon=function(u,g,V){},N.prototype.DrawCircle=function(u,g,V){},N.prototype.DrawSolidCircle=function(u,g,V,d){},N.prototype.DrawSegment=function(u,g,V){},N.prototype.DrawTransform=function(u){},p.postDefs.push(function(){p.Dynamics.b2DebugDraw.e_shapeBit=1,p.Dynamics.b2DebugDraw.e_jointBit=2,p.Dynamics.b2DebugDraw.e_aabbBit=4,p.Dynamics.b2DebugDraw.e_pairBit=8,p.Dynamics.b2DebugDraw.e_centerOfMassBit=16,p.Dynamics.b2DebugDraw.e_controllerBit=32}),H.b2DestructionListener=function(){},H.prototype.SayGoodbyeJoint=function(u){},H.prototype.SayGoodbyeFixture=function(u){},$.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},$.prototype.Copy=function(){var u=new $;return u.categoryBits=this.categoryBits,u.maskBits=this.maskBits,u.groupIndex=this.groupIndex,u},j.b2Fixture=function(){this.m_filter=new $},j.prototype.GetType=function(){return this.m_shape.GetType()},j.prototype.GetShape=function(){return this.m_shape},j.prototype.SetSensor=function(u){if(this.m_isSensor!=u&&(this.m_isSensor=u,this.m_body!=null))for(var g=this.m_body.GetContactList();g;){var V=g.contact,d=V.GetFixtureA(),w=V.GetFixtureB();(d==this||w==this)&&V.SetSensor(d.IsSensor()||w.IsSensor()),g=g.next}},j.prototype.IsSensor=function(){return this.m_isSensor},j.prototype.SetFilterData=function(u){if(this.m_filter=u.Copy(),!this.m_body)for(var g=this.m_body.GetContactList();g;){var V=g.contact,d=V.GetFixtureA(),w=V.GetFixtureB();(d==this||w==this)&&V.FlagForFiltering(),g=g.next}},j.prototype.GetFilterData=function(){return this.m_filter.Copy()},j.prototype.GetBody=function(){return this.m_body},j.prototype.GetNext=function(){return this.m_next},j.prototype.GetUserData=function(){return this.m_userData},j.prototype.SetUserData=function(u){this.m_userData=u},j.prototype.TestPoint=function(u){return this.m_shape.TestPoint(this.m_body.GetTransform(),u)},j.prototype.RayCast=function(u,g){return this.m_shape.RayCast(u,g,this.m_body.GetTransform())},j.prototype.GetMassData=function(u){return u===void 0&&(u=null),u==null&&(u=new y),this.m_shape.ComputeMass(u,this.m_density),u},j.prototype.SetDensity=function(u){u===void 0&&(u=0),this.m_density=u},j.prototype.GetDensity=function(){return this.m_density},j.prototype.GetFriction=function(){return this.m_friction},j.prototype.SetFriction=function(u){u===void 0&&(u=0),this.m_friction=u},j.prototype.GetRestitution=function(){return this.m_restitution},j.prototype.SetRestitution=function(u){u===void 0&&(u=0),this.m_restitution=u},j.prototype.GetAABB=function(){return this.m_aabb},j.prototype.b2Fixture=function(){this.m_aabb=new a,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},j.prototype.Create=function(u,g,V){this.m_userData=V.userData,this.m_friction=V.friction,this.m_restitution=V.restitution,this.m_body=u,this.m_next=null,this.m_filter=V.filter.Copy(),this.m_isSensor=V.isSensor,this.m_shape=V.shape.Copy(),this.m_density=V.density},j.prototype.Destroy=function(){this.m_shape=null},j.prototype.CreateProxy=function(u,g){this.m_shape.ComputeAABB(this.m_aabb,g),this.m_proxy=u.CreateProxy(this.m_aabb,this)},j.prototype.DestroyProxy=function(u){this.m_proxy!=null&&(u.DestroyProxy(this.m_proxy),this.m_proxy=null)},j.prototype.Synchronize=function(u,g,V){if(this.m_proxy){var d=new a,w=new a;this.m_shape.ComputeAABB(d,g),this.m_shape.ComputeAABB(w,V),this.m_aabb.Combine(d,w);var m=i.SubtractVV(V.position,g.position);u.MoveProxy(this.m_proxy,this.m_aabb,m)}},K.b2FixtureDef=function(){this.filter=new $},K.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},rt.b2Island=function(){},rt.prototype.b2Island=function(){this.m_bodies=new Wt,this.m_contacts=new Wt,this.m_joints=new Wt},rt.prototype.Initialize=function(u,g,V,d,w,m){u===void 0&&(u=0),g===void 0&&(g=0),V===void 0&&(V=0);var P=0;for(this.m_bodyCapacity=u,this.m_contactCapacity=g,this.m_jointCapacity=V,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=d,this.m_listener=w,this.m_contactSolver=m,P=this.m_bodies.length;P<u;P++)this.m_bodies[P]=null;for(P=this.m_contacts.length;P<g;P++)this.m_contacts[P]=null;for(P=this.m_joints.length;P<V;P++)this.m_joints[P]=null},rt.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},rt.prototype.Solve=function(u,g,V){var d=0,w=0,m,P;for(d=0;d<this.m_bodyCount;++d)m=this.m_bodies[d],m.GetType()==h.b2_dynamicBody&&(m.m_linearVelocity.x+=u.dt*(g.x+m.m_invMass*m.m_force.x),m.m_linearVelocity.y+=u.dt*(g.y+m.m_invMass*m.m_force.y),m.m_angularVelocity+=u.dt*m.m_invI*m.m_torque,m.m_linearVelocity.Multiply(i.Clamp(1-u.dt*m.m_linearDamping,0,1)),m.m_angularVelocity*=i.Clamp(1-u.dt*m.m_angularDamping,0,1));this.m_contactSolver.Initialize(u,this.m_contacts,this.m_contactCount,this.m_allocator);var T=this.m_contactSolver;for(T.InitVelocityConstraints(u),d=0;d<this.m_jointCount;++d)P=this.m_joints[d],P.InitVelocityConstraints(u);for(d=0;d<u.velocityIterations;++d){for(w=0;w<this.m_jointCount;++w)P=this.m_joints[w],P.SolveVelocityConstraints(u);T.SolveVelocityConstraints()}for(d=0;d<this.m_jointCount;++d)P=this.m_joints[d],P.FinalizeVelocityConstraints();for(T.FinalizeVelocityConstraints(),d=0;d<this.m_bodyCount;++d)if(m=this.m_bodies[d],m.GetType()!=h.b2_staticBody){var L=u.dt*m.m_linearVelocity.x,O=u.dt*m.m_linearVelocity.y;L*L+O*O>s.b2_maxTranslationSquared&&(m.m_linearVelocity.Normalize(),m.m_linearVelocity.x*=s.b2_maxTranslation*u.inv_dt,m.m_linearVelocity.y*=s.b2_maxTranslation*u.inv_dt);var R=u.dt*m.m_angularVelocity;R*R>s.b2_maxRotationSquared&&(m.m_angularVelocity<0?m.m_angularVelocity=-s.b2_maxRotation*u.inv_dt:m.m_angularVelocity=s.b2_maxRotation*u.inv_dt),m.m_sweep.c0.SetV(m.m_sweep.c),m.m_sweep.a0=m.m_sweep.a,m.m_sweep.c.x+=u.dt*m.m_linearVelocity.x,m.m_sweep.c.y+=u.dt*m.m_linearVelocity.y,m.m_sweep.a+=u.dt*m.m_angularVelocity,m.SynchronizeTransform()}for(d=0;d<u.positionIterations;++d){var z=T.SolvePositionConstraints(s.b2_contactBaumgarte),q=!0;for(w=0;w<this.m_jointCount;++w){P=this.m_joints[w];var X=P.SolvePositionConstraints(s.b2_contactBaumgarte);q=q&&X}if(z&&q)break}if(this.Report(T.m_constraints),V){var Y=Number.MAX_VALUE,Q=s.b2_linearSleepTolerance*s.b2_linearSleepTolerance,tt=s.b2_angularSleepTolerance*s.b2_angularSleepTolerance;for(d=0;d<this.m_bodyCount;++d)m=this.m_bodies[d],m.GetType()!=h.b2_staticBody&&((m.m_flags&h.e_allowSleepFlag)==0&&(m.m_sleepTime=0,Y=0),(m.m_flags&h.e_allowSleepFlag)==0||m.m_angularVelocity*m.m_angularVelocity>tt||i.Dot(m.m_linearVelocity,m.m_linearVelocity)>Q?(m.m_sleepTime=0,Y=0):(m.m_sleepTime+=u.dt,Y=i.Min(Y,m.m_sleepTime)));if(Y>=s.b2_timeToSleep)for(d=0;d<this.m_bodyCount;++d)m=this.m_bodies[d],m.SetAwake(!1)}},rt.prototype.SolveTOI=function(u){var g=0,V=0;this.m_contactSolver.Initialize(u,this.m_contacts,this.m_contactCount,this.m_allocator);var d=this.m_contactSolver;for(g=0;g<this.m_jointCount;++g)this.m_joints[g].InitVelocityConstraints(u);for(g=0;g<u.velocityIterations;++g)for(d.SolveVelocityConstraints(),V=0;V<this.m_jointCount;++V)this.m_joints[V].SolveVelocityConstraints(u);for(g=0;g<this.m_bodyCount;++g){var w=this.m_bodies[g];if(w.GetType()!=h.b2_staticBody){var m=u.dt*w.m_linearVelocity.x,P=u.dt*w.m_linearVelocity.y;m*m+P*P>s.b2_maxTranslationSquared&&(w.m_linearVelocity.Normalize(),w.m_linearVelocity.x*=s.b2_maxTranslation*u.inv_dt,w.m_linearVelocity.y*=s.b2_maxTranslation*u.inv_dt);var T=u.dt*w.m_angularVelocity;T*T>s.b2_maxRotationSquared&&(w.m_angularVelocity<0?w.m_angularVelocity=-s.b2_maxRotation*u.inv_dt:w.m_angularVelocity=s.b2_maxRotation*u.inv_dt),w.m_sweep.c0.SetV(w.m_sweep.c),w.m_sweep.a0=w.m_sweep.a,w.m_sweep.c.x+=u.dt*w.m_linearVelocity.x,w.m_sweep.c.y+=u.dt*w.m_linearVelocity.y,w.m_sweep.a+=u.dt*w.m_angularVelocity,w.SynchronizeTransform()}}var L=.75;for(g=0;g<u.positionIterations;++g){var O=d.SolvePositionConstraints(L),R=!0;for(V=0;V<this.m_jointCount;++V){var z=this.m_joints[V].SolvePositionConstraints(s.b2_contactBaumgarte);R=R&&z}if(O&&R)break}this.Report(d.m_constraints)},rt.prototype.Report=function(u){if(this.m_listener!=null)for(var g=0;g<this.m_contactCount;++g){for(var V=this.m_contacts[g],d=u[g],w=0;w<d.pointCount;++w)rt.s_impulse.normalImpulses[w]=d.points[w].normalImpulse,rt.s_impulse.tangentImpulses[w]=d.points[w].tangentImpulse;this.m_listener.PostSolve(V,rt.s_impulse)}},rt.prototype.AddBody=function(u){u.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=u},rt.prototype.AddContact=function(u){this.m_contacts[this.m_contactCount++]=u},rt.prototype.AddJoint=function(u){this.m_joints[this.m_jointCount++]=u},p.postDefs.push(function(){p.Dynamics.b2Island.s_impulse=new E}),B.b2TimeStep=function(){},B.prototype.Set=function(u){this.dt=u.dt,this.inv_dt=u.inv_dt,this.positionIterations=u.positionIterations,this.velocityIterations=u.velocityIterations,this.warmStarting=u.warmStarting},I.b2World=function(){this.s_stack=new Wt,this.m_contactManager=new J,this.m_contactSolver=new D,this.m_island=new rt},I.prototype.b2World=function(u,g){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,I.m_warmStarting=!0,I.m_continuousPhysics=!0,this.m_allowSleep=g,this.m_gravity=u,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var V=new v;this.m_groundBody=this.CreateBody(V)},I.prototype.SetDestructionListener=function(u){this.m_destructionListener=u},I.prototype.SetContactFilter=function(u){this.m_contactManager.m_contactFilter=u},I.prototype.SetContactListener=function(u){this.m_contactManager.m_contactListener=u},I.prototype.SetDebugDraw=function(u){this.m_debugDraw=u},I.prototype.SetBroadPhase=function(u){var g=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=u;for(var V=this.m_bodyList;V;V=V.m_next)for(var d=V.m_fixtureList;d;d=d.m_next)d.m_proxy=u.CreateProxy(g.GetFatAABB(d.m_proxy),d)},I.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},I.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},I.prototype.CreateBody=function(u){if(this.IsLocked()==!0)return null;var g=new h(u,this);return g.m_prev=null,g.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=g),this.m_bodyList=g,++this.m_bodyCount,g},I.prototype.DestroyBody=function(u){if(this.IsLocked()!=!0){for(var g=u.m_jointList;g;){var V=g;g=g.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(V.joint),this.DestroyJoint(V.joint)}for(var d=u.m_controllerList;d;){var w=d;d=d.nextController,w.controller.RemoveBody(u)}for(var m=u.m_contactList;m;){var P=m;m=m.next,this.m_contactManager.Destroy(P.contact)}u.m_contactList=null;for(var T=u.m_fixtureList;T;){var L=T;T=T.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(L),L.DestroyProxy(this.m_contactManager.m_broadPhase),L.Destroy()}u.m_fixtureList=null,u.m_fixtureCount=0,u.m_prev&&(u.m_prev.m_next=u.m_next),u.m_next&&(u.m_next.m_prev=u.m_prev),u==this.m_bodyList&&(this.m_bodyList=u.m_next),--this.m_bodyCount}},I.prototype.CreateJoint=function(u){var g=W.Create(u,null);g.m_prev=null,g.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=g),this.m_jointList=g,++this.m_jointCount,g.m_edgeA.joint=g,g.m_edgeA.other=g.m_bodyB,g.m_edgeA.prev=null,g.m_edgeA.next=g.m_bodyA.m_jointList,g.m_bodyA.m_jointList&&(g.m_bodyA.m_jointList.prev=g.m_edgeA),g.m_bodyA.m_jointList=g.m_edgeA,g.m_edgeB.joint=g,g.m_edgeB.other=g.m_bodyA,g.m_edgeB.prev=null,g.m_edgeB.next=g.m_bodyB.m_jointList,g.m_bodyB.m_jointList&&(g.m_bodyB.m_jointList.prev=g.m_edgeB),g.m_bodyB.m_jointList=g.m_edgeB;var V=u.bodyA,d=u.bodyB;if(u.collideConnected==!1)for(var w=d.GetContactList();w;)w.other==V&&w.contact.FlagForFiltering(),w=w.next;return g},I.prototype.DestroyJoint=function(u){var g=u.m_collideConnected;u.m_prev&&(u.m_prev.m_next=u.m_next),u.m_next&&(u.m_next.m_prev=u.m_prev),u==this.m_jointList&&(this.m_jointList=u.m_next);var V=u.m_bodyA,d=u.m_bodyB;if(V.SetAwake(!0),d.SetAwake(!0),u.m_edgeA.prev&&(u.m_edgeA.prev.next=u.m_edgeA.next),u.m_edgeA.next&&(u.m_edgeA.next.prev=u.m_edgeA.prev),u.m_edgeA==V.m_jointList&&(V.m_jointList=u.m_edgeA.next),u.m_edgeA.prev=null,u.m_edgeA.next=null,u.m_edgeB.prev&&(u.m_edgeB.prev.next=u.m_edgeB.next),u.m_edgeB.next&&(u.m_edgeB.next.prev=u.m_edgeB.prev),u.m_edgeB==d.m_jointList&&(d.m_jointList=u.m_edgeB.next),u.m_edgeB.prev=null,u.m_edgeB.next=null,W.Destroy(u,null),--this.m_jointCount,g==!1)for(var w=d.GetContactList();w;)w.other==V&&w.contact.FlagForFiltering(),w=w.next},I.prototype.AddController=function(u){return u.m_next=this.m_controllerList,u.m_prev=null,this.m_controllerList=u,u.m_world=this,this.m_controllerCount++,u},I.prototype.RemoveController=function(u){u.m_prev&&(u.m_prev.m_next=u.m_next),u.m_next&&(u.m_next.m_prev=u.m_prev),this.m_controllerList==u&&(this.m_controllerList=u.m_next),this.m_controllerCount--},I.prototype.CreateController=function(u){if(u.m_world!=this)throw new Error("Controller can only be a member of one world");return u.m_next=this.m_controllerList,u.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=u),this.m_controllerList=u,++this.m_controllerCount,u.m_world=this,u},I.prototype.DestroyController=function(u){u.Clear(),u.m_next&&(u.m_next.m_prev=u.m_prev),u.m_prev&&(u.m_prev.m_next=u.m_next),u==this.m_controllerList&&(this.m_controllerList=u.m_next),--this.m_controllerCount},I.prototype.SetWarmStarting=function(u){I.m_warmStarting=u},I.prototype.SetContinuousPhysics=function(u){I.m_continuousPhysics=u},I.prototype.GetBodyCount=function(){return this.m_bodyCount},I.prototype.GetJointCount=function(){return this.m_jointCount},I.prototype.GetContactCount=function(){return this.m_contactCount},I.prototype.SetGravity=function(u){this.m_gravity=u},I.prototype.GetGravity=function(){return this.m_gravity},I.prototype.GetGroundBody=function(){return this.m_groundBody},I.prototype.Step=function(u,g,V){u===void 0&&(u=0),g===void 0&&(g=0),V===void 0&&(V=0),this.m_flags&I.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~I.e_newFixture),this.m_flags|=I.e_locked;var d=I.s_timestep2;d.dt=u,d.velocityIterations=g,d.positionIterations=V,u>0?d.inv_dt=1/u:d.inv_dt=0,d.dtRatio=this.m_inv_dt0*u,d.warmStarting=I.m_warmStarting,this.m_contactManager.Collide(),d.dt>0&&this.Solve(d),I.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d),d.dt>0&&(this.m_inv_dt0=d.inv_dt),this.m_flags&=~I.e_locked},I.prototype.ClearForces=function(){for(var u=this.m_bodyList;u;u=u.m_next)u.m_force.SetZero(),u.m_torque=0},I.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var u=this.m_debugDraw.GetFlags(),g,V,d,w,m;new r,new r,new r;var P;new a,new a;var T=[new r,new r,new r,new r],L=new n(0,0,0);if(u&N.e_shapeBit)for(g=this.m_bodyList;g;g=g.m_next)for(P=g.m_xf,V=g.GetFixtureList();V;V=V.m_next)d=V.GetShape(),g.IsActive()==!1?(L.Set(.5,.5,.3),this.DrawShape(d,P,L)):g.GetType()==h.b2_staticBody?(L.Set(.5,.9,.5),this.DrawShape(d,P,L)):g.GetType()==h.b2_kinematicBody?(L.Set(.5,.5,.9),this.DrawShape(d,P,L)):g.IsAwake()==!1?(L.Set(.6,.6,.6),this.DrawShape(d,P,L)):(L.Set(.9,.7,.7),this.DrawShape(d,P,L));if(u&N.e_jointBit)for(w=this.m_jointList;w;w=w.m_next)this.DrawJoint(w);if(u&N.e_controllerBit)for(var O=this.m_controllerList;O;O=O.m_next)O.Draw(this.m_debugDraw);if(u&N.e_pairBit){L.Set(.3,.9,.9);for(var R=this.m_contactManager.m_contactList;R;R=R.GetNext()){var z=R.GetFixtureA(),q=R.GetFixtureB(),X=z.GetAABB().GetCenter(),Y=q.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(X,Y,L)}}if(u&N.e_aabbBit){for(m=this.m_contactManager.m_broadPhase,T=[new r,new r,new r,new r],g=this.m_bodyList;g;g=g.GetNext())if(g.IsActive()!=!1)for(V=g.GetFixtureList();V;V=V.GetNext()){var Q=m.GetFatAABB(V.m_proxy);T[0].Set(Q.lowerBound.x,Q.lowerBound.y),T[1].Set(Q.upperBound.x,Q.lowerBound.y),T[2].Set(Q.upperBound.x,Q.upperBound.y),T[3].Set(Q.lowerBound.x,Q.upperBound.y),this.m_debugDraw.DrawPolygon(T,4,L)}}if(u&N.e_centerOfMassBit)for(g=this.m_bodyList;g;g=g.m_next)P=I.s_xf,P.R=g.m_xf.R,P.position=g.GetWorldCenter(),this.m_debugDraw.DrawTransform(P)}},I.prototype.QueryAABB=function(u,g){var V=this,d=V.m_contactManager.m_broadPhase;function w(m){return u(d.GetUserData(m))}d.Query(w,g)},I.prototype.QueryShape=function(u,g,V){var d=this;V===void 0&&(V=null),V==null&&(V=new e,V.SetIdentity());var w=d.m_contactManager.m_broadPhase;function m(T){var L=w.GetUserData(T)instanceof j?w.GetUserData(T):null;return G.TestOverlap(g,V,L.GetShape(),L.GetBody().GetTransform())?u(L):!0}var P=new a;g.ComputeAABB(P,V),w.Query(m,P)},I.prototype.QueryPoint=function(u,g){var V=this,d=V.m_contactManager.m_broadPhase;function w(P){var T=d.GetUserData(P)instanceof j?d.GetUserData(P):null;return T.TestPoint(g)?u(T):!0}var m=new a;m.lowerBound.Set(g.x-s.b2_linearSlop,g.y-s.b2_linearSlop),m.upperBound.Set(g.x+s.b2_linearSlop,g.y+s.b2_linearSlop),d.Query(w,m)},I.prototype.RayCast=function(u,g,V){var d=this,w=d.m_contactManager.m_broadPhase,m=new f;function P(L,O){var R=w.GetUserData(O),z=R instanceof j?R:null,q=z.RayCast(m,L);if(q){var X=m.fraction,Y=new r((1-X)*g.x+X*V.x,(1-X)*g.y+X*V.y);return u(z,Y,m.normal,X)}return L.maxFraction}var T=new c(g,V);w.RayCast(P,T)},I.prototype.RayCastOne=function(u,g){var V=this,d;function w(m,P,T,L){return L===void 0&&(L=0),d=m,L}return V.RayCast(w,u,g),d},I.prototype.RayCastAll=function(u,g){var V=this,d=new Wt;function w(m,P,T,L){return d[d.length]=m,1}return V.RayCast(w,u,g),d},I.prototype.GetBodyList=function(){return this.m_bodyList},I.prototype.GetJointList=function(){return this.m_jointList},I.prototype.GetContactList=function(){return this.m_contactList},I.prototype.IsLocked=function(){return(this.m_flags&I.e_locked)>0},I.prototype.Solve=function(u){for(var g,V=this.m_controllerList;V;V=V.m_next)V.Step(u);var d=this.m_island;for(d.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),g=this.m_bodyList;g;g=g.m_next)g.m_flags&=~h.e_islandFlag;for(var w=this.m_contactList;w;w=w.m_next)w.m_flags&=~F.e_islandFlag;for(var m=this.m_jointList;m;m=m.m_next)m.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var P=this.s_stack,T=this.m_bodyList;T;T=T.m_next)if(!(T.m_flags&h.e_islandFlag)&&!(T.IsAwake()==!1||T.IsActive()==!1)&&T.GetType()!=h.b2_staticBody){d.Clear();var L=0;for(P[L++]=T,T.m_flags|=h.e_islandFlag;L>0;)if(g=P[--L],d.AddBody(g),g.IsAwake()==!1&&g.SetAwake(!0),g.GetType()!=h.b2_staticBody){for(var O,R=g.m_contactList;R;R=R.next)R.contact.m_flags&F.e_islandFlag||R.contact.IsSensor()==!0||R.contact.IsEnabled()==!1||R.contact.IsTouching()==!1||(d.AddContact(R.contact),R.contact.m_flags|=F.e_islandFlag,O=R.other,!(O.m_flags&h.e_islandFlag)&&(P[L++]=O,O.m_flags|=h.e_islandFlag));for(var z=g.m_jointList;z;z=z.next)z.joint.m_islandFlag!=!0&&(O=z.other,O.IsActive()!=!1&&(d.AddJoint(z.joint),z.joint.m_islandFlag=!0,!(O.m_flags&h.e_islandFlag)&&(P[L++]=O,O.m_flags|=h.e_islandFlag)))}d.Solve(u,this.m_gravity,this.m_allowSleep);for(var q=0;q<d.m_bodyCount;++q)g=d.m_bodies[q],g.GetType()==h.b2_staticBody&&(g.m_flags&=~h.e_islandFlag)}for(q=0;q<P.length&&P[q];++q)P[q]=null;for(g=this.m_bodyList;g;g=g.m_next)g.IsAwake()==!1||g.IsActive()==!1||g.GetType()!=h.b2_staticBody&&g.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},I.prototype.SolveTOI=function(u){var g,V,d,w,m,P,T,L=this.m_island;L.Initialize(this.m_bodyCount,s.b2_maxTOIContactsPerIsland,s.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var O=I.s_queue;for(g=this.m_bodyList;g;g=g.m_next)g.m_flags&=~h.e_islandFlag,g.m_sweep.t0=0;var R;for(R=this.m_contactList;R;R=R.m_next)R.m_flags&=~(F.e_toiFlag|F.e_islandFlag);for(T=this.m_jointList;T;T=T.m_next)T.m_islandFlag=!1;for(;;){var z=null,q=1;for(R=this.m_contactList;R;R=R.m_next)if(!(R.IsSensor()==!0||R.IsEnabled()==!1||R.IsContinuous()==!1)){var X=1;if(R.m_flags&F.e_toiFlag)X=R.m_toi;else{if(V=R.m_fixtureA,d=R.m_fixtureB,w=V.m_body,m=d.m_body,(w.GetType()!=h.b2_dynamicBody||w.IsAwake()==!1)&&(m.GetType()!=h.b2_dynamicBody||m.IsAwake()==!1))continue;var Y=w.m_sweep.t0;w.m_sweep.t0<m.m_sweep.t0?(Y=m.m_sweep.t0,w.m_sweep.Advance(Y)):m.m_sweep.t0<w.m_sweep.t0&&(Y=w.m_sweep.t0,m.m_sweep.Advance(Y)),X=R.ComputeTOI(w.m_sweep,m.m_sweep),s.b2Assert(0<=X&&X<=1),X>0&&X<1&&(X=(1-X)*Y+X,X>1&&(X=1)),R.m_toi=X,R.m_flags|=F.e_toiFlag}Number.MIN_VALUE<X&&X<q&&(z=R,q=X)}if(z==null||1-100*Number.MIN_VALUE<q)break;if(V=z.m_fixtureA,d=z.m_fixtureB,w=V.m_body,m=d.m_body,I.s_backupA.Set(w.m_sweep),I.s_backupB.Set(m.m_sweep),w.Advance(q),m.Advance(q),z.Update(this.m_contactManager.m_contactListener),z.m_flags&=~F.e_toiFlag,z.IsSensor()==!0||z.IsEnabled()==!1){w.m_sweep.Set(I.s_backupA),m.m_sweep.Set(I.s_backupB),w.SynchronizeTransform(),m.SynchronizeTransform();continue}if(z.IsTouching()!=!1){var Q=w;Q.GetType()!=h.b2_dynamicBody&&(Q=m),L.Clear();var tt=0,at=0;for(O[tt+at++]=Q,Q.m_flags|=h.e_islandFlag;at>0;)if(g=O[tt++],--at,L.AddBody(g),g.IsAwake()==!1&&g.SetAwake(!0),g.GetType()==h.b2_dynamicBody){for(P=g.m_contactList;P&&L.m_contactCount!=L.m_contactCapacity;P=P.next)if(!(P.contact.m_flags&F.e_islandFlag)&&!(P.contact.IsSensor()==!0||P.contact.IsEnabled()==!1||P.contact.IsTouching()==!1)){L.AddContact(P.contact),P.contact.m_flags|=F.e_islandFlag;var et=P.other;et.m_flags&h.e_islandFlag||(et.GetType()!=h.b2_staticBody&&(et.Advance(q),et.SetAwake(!0)),O[tt+at]=et,++at,et.m_flags|=h.e_islandFlag)}for(var st=g.m_jointList;st;st=st.next)L.m_jointCount!=L.m_jointCapacity&&st.joint.m_islandFlag!=!0&&(et=st.other,et.IsActive()!=!1&&(L.AddJoint(st.joint),st.joint.m_islandFlag=!0,!(et.m_flags&h.e_islandFlag)&&(et.GetType()!=h.b2_staticBody&&(et.Advance(q),et.SetAwake(!0)),O[tt+at]=et,++at,et.m_flags|=h.e_islandFlag)))}var lt=I.s_timestep;lt.warmStarting=!1,lt.dt=(1-q)*u.dt,lt.inv_dt=1/lt.dt,lt.dtRatio=0,lt.velocityIterations=u.velocityIterations,lt.positionIterations=u.positionIterations,L.SolveTOI(lt);var Z=0;for(Z=0;Z<L.m_bodyCount;++Z)if(g=L.m_bodies[Z],g.m_flags&=~h.e_islandFlag,g.IsAwake()!=!1&&g.GetType()==h.b2_dynamicBody)for(g.SynchronizeFixtures(),P=g.m_contactList;P;P=P.next)P.contact.m_flags&=~F.e_toiFlag;for(Z=0;Z<L.m_contactCount;++Z)R=L.m_contacts[Z],R.m_flags&=~(F.e_toiFlag|F.e_islandFlag);for(Z=0;Z<L.m_jointCount;++Z)T=L.m_joints[Z],T.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},I.prototype.DrawJoint=function(u){var g=u.GetBodyA(),V=u.GetBodyB(),d=g.m_xf,w=V.m_xf,m=d.position,P=w.position,T=u.GetAnchorA(),L=u.GetAnchorB(),O=I.s_jointColor;switch(u.m_type){case W.e_distanceJoint:this.m_debugDraw.DrawSegment(T,L,O);break;case W.e_pulleyJoint:{var R=u instanceof U?u:null,z=R.GetGroundAnchorA(),q=R.GetGroundAnchorB();this.m_debugDraw.DrawSegment(z,T,O),this.m_debugDraw.DrawSegment(q,L,O),this.m_debugDraw.DrawSegment(z,q,O)}break;case W.e_mouseJoint:this.m_debugDraw.DrawSegment(T,L,O);break;default:g!=this.m_groundBody&&this.m_debugDraw.DrawSegment(m,T,O),this.m_debugDraw.DrawSegment(T,L,O),V!=this.m_groundBody&&this.m_debugDraw.DrawSegment(P,L,O)}},I.prototype.DrawShape=function(u,g,V){switch(u.m_type){case G.e_circleShape:{var d=u instanceof _?u:null,w=i.MulX(g,d.m_p),m=d.m_radius,P=g.R.col1;this.m_debugDraw.DrawSolidCircle(w,m,P,V)}break;case G.e_polygonShape:{var T=0,L=u instanceof M?u:null,O=parseInt(L.GetVertexCount()),R=L.GetVertices(),z=new Wt(O);for(T=0;T<O;++T)z[T]=i.MulX(g,R[T]);this.m_debugDraw.DrawSolidPolygon(z,O,V)}break;case G.e_edgeShape:{var q=u instanceof x?u:null;this.m_debugDraw.DrawSegment(i.MulX(g,q.GetVertex1()),i.MulX(g,q.GetVertex2()),V)}break}},p.postDefs.push(function(){p.Dynamics.b2World.s_timestep2=new B,p.Dynamics.b2World.s_xf=new e,p.Dynamics.b2World.s_backupA=new t,p.Dynamics.b2World.s_backupB=new t,p.Dynamics.b2World.s_timestep=new B,p.Dynamics.b2World.s_queue=new Wt,p.Dynamics.b2World.s_jointColor=new n(.5,.8,.8),p.Dynamics.b2World.e_newFixture=1,p.Dynamics.b2World.e_locked=2})})();(function(){var i=p.Collision.Shapes.b2CircleShape;p.Collision.Shapes.b2EdgeChainDef;var t=p.Collision.Shapes.b2EdgeShape;p.Collision.Shapes.b2MassData;var e=p.Collision.Shapes.b2PolygonShape,r=p.Collision.Shapes.b2Shape,n=p.Dynamics.Contacts.b2CircleContact,s=p.Dynamics.Contacts.b2Contact,a=p.Dynamics.Contacts.b2ContactConstraint,o=p.Dynamics.Contacts.b2ContactConstraintPoint,l=p.Dynamics.Contacts.b2ContactEdge,c=p.Dynamics.Contacts.b2ContactFactory,f=p.Dynamics.Contacts.b2ContactRegister,_=p.Dynamics.Contacts.b2ContactResult,x=p.Dynamics.Contacts.b2ContactSolver,y=p.Dynamics.Contacts.b2EdgeAndCircleContact,M=p.Dynamics.Contacts.b2NullContact,G=p.Dynamics.Contacts.b2PolyAndCircleContact,h=p.Dynamics.Contacts.b2PolyAndEdgeContact,v=p.Dynamics.Contacts.b2PolygonContact,C=p.Dynamics.Contacts.b2PositionSolverManifold,E=p.Dynamics.b2Body;p.Dynamics.b2BodyDef,p.Dynamics.b2ContactFilter,p.Dynamics.b2ContactImpulse,p.Dynamics.b2ContactListener,p.Dynamics.b2ContactManager,p.Dynamics.b2DebugDraw,p.Dynamics.b2DestructionListener,p.Dynamics.b2FilterData,p.Dynamics.b2Fixture,p.Dynamics.b2FixtureDef,p.Dynamics.b2Island;var k=p.Dynamics.b2TimeStep;p.Dynamics.b2World,p.Common.b2Color,p.Common.b2internal;var J=p.Common.b2Settings,N=p.Common.Math.b2Mat22;p.Common.Math.b2Mat33;var H=p.Common.Math.b2Math;p.Common.Math.b2Sweep,p.Common.Math.b2Transform;var $=p.Common.Math.b2Vec2;p.Common.Math.b2Vec3,p.Collision.b2AABB,p.Collision.b2Bound,p.Collision.b2BoundValues;var j=p.Collision.b2Collision,K=p.Collision.b2ContactID;p.Collision.b2ContactPoint,p.Collision.b2Distance,p.Collision.b2DistanceInput,p.Collision.b2DistanceOutput,p.Collision.b2DistanceProxy,p.Collision.b2DynamicTree,p.Collision.b2DynamicTreeBroadPhase,p.Collision.b2DynamicTreeNode,p.Collision.b2DynamicTreePair;var rt=p.Collision.b2Manifold;p.Collision.b2ManifoldPoint,p.Collision.b2Point,p.Collision.b2RayCastInput,p.Collision.b2RayCastOutput,p.Collision.b2Segment,p.Collision.b2SeparationFunction,p.Collision.b2Simplex,p.Collision.b2SimplexCache,p.Collision.b2SimplexVertex;var B=p.Collision.b2TimeOfImpact,I=p.Collision.b2TOIInput,F=p.Collision.b2WorldManifold;p.Collision.ClipVertex,p.Collision.Features,p.Collision.IBroadPhase,p.inherit(n,p.Dynamics.Contacts.b2Contact),n.prototype.__super=p.Dynamics.Contacts.b2Contact.prototype,n.b2CircleContact=function(){p.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},n.Create=function(A){return new n},n.Destroy=function(A,D){},n.prototype.Reset=function(A,D){this.__super.Reset.call(this,A,D)},n.prototype.Evaluate=function(){var A=this.m_fixtureA.GetBody(),D=this.m_fixtureB.GetBody();j.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,A.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,D.m_xf)},s.b2Contact=function(){this.m_nodeA=new l,this.m_nodeB=new l,this.m_manifold=new rt,this.m_oldManifold=new rt},s.prototype.GetManifold=function(){return this.m_manifold},s.prototype.GetWorldManifold=function(A){var D=this.m_fixtureA.GetBody(),W=this.m_fixtureB.GetBody(),U=this.m_fixtureA.GetShape(),u=this.m_fixtureB.GetShape();A.Initialize(this.m_manifold,D.GetTransform(),U.m_radius,W.GetTransform(),u.m_radius)},s.prototype.IsTouching=function(){return(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag},s.prototype.IsContinuous=function(){return(this.m_flags&s.e_continuousFlag)==s.e_continuousFlag},s.prototype.SetSensor=function(A){A?this.m_flags|=s.e_sensorFlag:this.m_flags&=~s.e_sensorFlag},s.prototype.IsSensor=function(){return(this.m_flags&s.e_sensorFlag)==s.e_sensorFlag},s.prototype.SetEnabled=function(A){A?this.m_flags|=s.e_enabledFlag:this.m_flags&=~s.e_enabledFlag},s.prototype.IsEnabled=function(){return(this.m_flags&s.e_enabledFlag)==s.e_enabledFlag},s.prototype.GetNext=function(){return this.m_next},s.prototype.GetFixtureA=function(){return this.m_fixtureA},s.prototype.GetFixtureB=function(){return this.m_fixtureB},s.prototype.FlagForFiltering=function(){this.m_flags|=s.e_filterFlag},s.prototype.b2Contact=function(){},s.prototype.Reset=function(A,D){if(A===void 0&&(A=null),D===void 0&&(D=null),this.m_flags=s.e_enabledFlag,!A||!D){this.m_fixtureA=null,this.m_fixtureB=null;return}(A.IsSensor()||D.IsSensor())&&(this.m_flags|=s.e_sensorFlag);var W=A.GetBody(),U=D.GetBody();(W.GetType()!=E.b2_dynamicBody||W.IsBullet()||U.GetType()!=E.b2_dynamicBody||U.IsBullet())&&(this.m_flags|=s.e_continuousFlag),this.m_fixtureA=A,this.m_fixtureB=D,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},s.prototype.Update=function(A){var D=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=D,this.m_flags|=s.e_enabledFlag;var W=!1,U=(this.m_flags&s.e_touchingFlag)==s.e_touchingFlag,u=this.m_fixtureA.m_body,g=this.m_fixtureB.m_body,V=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&s.e_sensorFlag){if(V){var d=this.m_fixtureA.GetShape(),w=this.m_fixtureB.GetShape(),m=u.GetTransform(),P=g.GetTransform();W=r.TestOverlap(d,m,w,P)}this.m_manifold.m_pointCount=0}else{if(u.GetType()!=E.b2_dynamicBody||u.IsBullet()||g.GetType()!=E.b2_dynamicBody||g.IsBullet()?this.m_flags|=s.e_continuousFlag:this.m_flags&=~s.e_continuousFlag,V){this.Evaluate(),W=this.m_manifold.m_pointCount>0;for(var T=0;T<this.m_manifold.m_pointCount;++T){var L=this.m_manifold.m_points[T];L.m_normalImpulse=0,L.m_tangentImpulse=0;for(var O=L.m_id,R=0;R<this.m_oldManifold.m_pointCount;++R){var z=this.m_oldManifold.m_points[R];if(z.m_id.key==O.key){L.m_normalImpulse=z.m_normalImpulse,L.m_tangentImpulse=z.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;W!=U&&(u.SetAwake(!0),g.SetAwake(!0))}W?this.m_flags|=s.e_touchingFlag:this.m_flags&=~s.e_touchingFlag,U==!1&&W==!0&&A.BeginContact(this),U==!0&&W==!1&&A.EndContact(this),(this.m_flags&s.e_sensorFlag)==0&&A.PreSolve(this,this.m_oldManifold)},s.prototype.Evaluate=function(){},s.prototype.ComputeTOI=function(A,D){return s.s_input.proxyA.Set(this.m_fixtureA.GetShape()),s.s_input.proxyB.Set(this.m_fixtureB.GetShape()),s.s_input.sweepA=A,s.s_input.sweepB=D,s.s_input.tolerance=J.b2_linearSlop,B.TimeOfImpact(s.s_input)},p.postDefs.push(function(){p.Dynamics.Contacts.b2Contact.e_sensorFlag=1,p.Dynamics.Contacts.b2Contact.e_continuousFlag=2,p.Dynamics.Contacts.b2Contact.e_islandFlag=4,p.Dynamics.Contacts.b2Contact.e_toiFlag=8,p.Dynamics.Contacts.b2Contact.e_touchingFlag=16,p.Dynamics.Contacts.b2Contact.e_enabledFlag=32,p.Dynamics.Contacts.b2Contact.e_filterFlag=64,p.Dynamics.Contacts.b2Contact.s_input=new I}),a.b2ContactConstraint=function(){this.localPlaneNormal=new $,this.localPoint=new $,this.normal=new $,this.normalMass=new N,this.K=new N},a.prototype.b2ContactConstraint=function(){this.points=new Wt(J.b2_maxManifoldPoints);for(var A=0;A<J.b2_maxManifoldPoints;A++)this.points[A]=new o},o.b2ContactConstraintPoint=function(){this.localPoint=new $,this.rA=new $,this.rB=new $},l.b2ContactEdge=function(){},c.b2ContactFactory=function(){},c.prototype.b2ContactFactory=function(A){this.m_allocator=A,this.InitializeRegisters()},c.prototype.AddType=function(A,D,W,U){W===void 0&&(W=0),U===void 0&&(U=0),this.m_registers[W][U].createFcn=A,this.m_registers[W][U].destroyFcn=D,this.m_registers[W][U].primary=!0,W!=U&&(this.m_registers[U][W].createFcn=A,this.m_registers[U][W].destroyFcn=D,this.m_registers[U][W].primary=!1)},c.prototype.InitializeRegisters=function(){this.m_registers=new Wt(r.e_shapeTypeCount);for(var A=0;A<r.e_shapeTypeCount;A++){this.m_registers[A]=new Wt(r.e_shapeTypeCount);for(var D=0;D<r.e_shapeTypeCount;D++)this.m_registers[A][D]=new f}this.AddType(n.Create,n.Destroy,r.e_circleShape,r.e_circleShape),this.AddType(G.Create,G.Destroy,r.e_polygonShape,r.e_circleShape),this.AddType(v.Create,v.Destroy,r.e_polygonShape,r.e_polygonShape),this.AddType(y.Create,y.Destroy,r.e_edgeShape,r.e_circleShape),this.AddType(h.Create,h.Destroy,r.e_polygonShape,r.e_edgeShape)},c.prototype.Create=function(A,D){var W=parseInt(A.GetType()),U=parseInt(D.GetType()),u=this.m_registers[W][U],g;if(u.pool)return g=u.pool,u.pool=g.m_next,u.poolCount--,g.Reset(A,D),g;var V=u.createFcn;return V!=null?u.primary?(g=V(this.m_allocator),g.Reset(A,D),g):(g=V(this.m_allocator),g.Reset(D,A),g):null},c.prototype.Destroy=function(A){A.m_manifold.m_pointCount>0&&(A.m_fixtureA.m_body.SetAwake(!0),A.m_fixtureB.m_body.SetAwake(!0));var D=parseInt(A.m_fixtureA.GetType()),W=parseInt(A.m_fixtureB.GetType()),U=this.m_registers[D][W];U.poolCount++,A.m_next=U.pool,U.pool=A;var u=U.destroyFcn;u(A,this.m_allocator)},f.b2ContactRegister=function(){},_.b2ContactResult=function(){this.position=new $,this.normal=new $,this.id=new K},x.b2ContactSolver=function(){this.m_step=new k,this.m_constraints=new Wt},x.prototype.b2ContactSolver=function(){},x.prototype.Initialize=function(A,D,W,U){W===void 0&&(W=0);var u;this.m_step.Set(A),this.m_allocator=U;var g=0;for(this.m_constraintCount=W;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new a;for(g=0;g<W;++g){u=D[g];var V=u.m_fixtureA,d=u.m_fixtureB,w=V.m_shape,m=d.m_shape,P=w.m_radius,T=m.m_radius,L=V.m_body,O=d.m_body,R=u.GetManifold(),z=J.b2MixFriction(V.GetFriction(),d.GetFriction()),q=J.b2MixRestitution(V.GetRestitution(),d.GetRestitution()),X=L.m_linearVelocity.x,Y=L.m_linearVelocity.y,Q=O.m_linearVelocity.x,tt=O.m_linearVelocity.y,at=L.m_angularVelocity,et=O.m_angularVelocity;J.b2Assert(R.m_pointCount>0),x.s_worldManifold.Initialize(R,L.m_xf,P,O.m_xf,T);var st=x.s_worldManifold.m_normal.x,lt=x.s_worldManifold.m_normal.y,Z=this.m_constraints[g];Z.bodyA=L,Z.bodyB=O,Z.manifold=R,Z.normal.x=st,Z.normal.y=lt,Z.pointCount=R.m_pointCount,Z.friction=z,Z.restitution=q,Z.localPlaneNormal.x=R.m_localPlaneNormal.x,Z.localPlaneNormal.y=R.m_localPlaneNormal.y,Z.localPoint.x=R.m_localPoint.x,Z.localPoint.y=R.m_localPoint.y,Z.radius=P+T,Z.type=R.m_type;for(var it=0;it<Z.pointCount;++it){var ft=R.m_points[it],ut=Z.points[it];ut.normalImpulse=ft.m_normalImpulse,ut.tangentImpulse=ft.m_tangentImpulse,ut.localPoint.SetV(ft.m_localPoint);var dt=ut.rA.x=x.s_worldManifold.m_points[it].x-L.m_sweep.c.x,pt=ut.rA.y=x.s_worldManifold.m_points[it].y-L.m_sweep.c.y,mt=ut.rB.x=x.s_worldManifold.m_points[it].x-O.m_sweep.c.x,Ct=ut.rB.y=x.s_worldManifold.m_points[it].y-O.m_sweep.c.y,kt=dt*lt-pt*st,Mt=mt*lt-Ct*st;kt*=kt,Mt*=Mt;var yt=L.m_invMass+O.m_invMass+L.m_invI*kt+O.m_invI*Mt;ut.normalMass=1/yt;var St=L.m_mass*L.m_invMass+O.m_mass*O.m_invMass;St+=L.m_mass*L.m_invI*kt+O.m_mass*O.m_invI*Mt,ut.equalizedMass=1/St;var Et=lt,Nt=-st,Vt=dt*Nt-pt*Et,Ft=mt*Nt-Ct*Et;Vt*=Vt,Ft*=Ft;var b=L.m_invMass+O.m_invMass+L.m_invI*Vt+O.m_invI*Ft;ut.tangentMass=1/b,ut.velocityBias=0;var S=Q+-et*Ct-X- -at*pt,ot=tt+et*mt-Y-at*dt,ct=Z.normal.x*S+Z.normal.y*ot;ct<-J.b2_velocityThreshold&&(ut.velocityBias+=-Z.restitution*ct)}if(Z.pointCount==2){var ht=Z.points[0],nt=Z.points[1],gt=L.m_invMass,vt=L.m_invI,_t=O.m_invMass,At=O.m_invI,zt=ht.rA.x*lt-ht.rA.y*st,Tt=ht.rB.x*lt-ht.rB.y*st,bt=nt.rA.x*lt-nt.rA.y*st,jt=nt.rB.x*lt-nt.rB.y*st,te=gt+_t+vt*zt*zt+At*Tt*Tt,ce=gt+_t+vt*bt*bt+At*jt*jt,It=gt+_t+vt*zt*bt+At*Tt*jt,Qt=100;te*te<Qt*(te*ce-It*It)?(Z.K.col1.Set(te,It),Z.K.col2.Set(It,ce),Z.K.GetInverse(Z.normalMass)):Z.pointCount=1}}},x.prototype.InitVelocityConstraints=function(A){for(var D=0;D<this.m_constraintCount;++D){var W=this.m_constraints[D],U=W.bodyA,u=W.bodyB,g=U.m_invMass,V=U.m_invI,d=u.m_invMass,w=u.m_invI,m=W.normal.x,P=W.normal.y,T=P,L=-m,O=0,R=0;if(A.warmStarting)for(R=W.pointCount,O=0;O<R;++O){var z=W.points[O];z.normalImpulse*=A.dtRatio,z.tangentImpulse*=A.dtRatio;var q=z.normalImpulse*m+z.tangentImpulse*T,X=z.normalImpulse*P+z.tangentImpulse*L;U.m_angularVelocity-=V*(z.rA.x*X-z.rA.y*q),U.m_linearVelocity.x-=g*q,U.m_linearVelocity.y-=g*X,u.m_angularVelocity+=w*(z.rB.x*X-z.rB.y*q),u.m_linearVelocity.x+=d*q,u.m_linearVelocity.y+=d*X}else for(R=W.pointCount,O=0;O<R;++O){var Y=W.points[O];Y.normalImpulse=0,Y.tangentImpulse=0}}},x.prototype.SolveVelocityConstraints=function(){for(var A=0,D,W=0,U=0,u=0,g=0,V=0,d=0,w=0,m=0,P=0,T=0,L=0,O=0,R=0,z=0,q=0,X,Y=0;Y<this.m_constraintCount;++Y){var Q=this.m_constraints[Y],tt=Q.bodyA,at=Q.bodyB,et=tt.m_angularVelocity,st=at.m_angularVelocity,lt=tt.m_linearVelocity,Z=at.m_linearVelocity,it=tt.m_invMass,ft=tt.m_invI,ut=at.m_invMass,dt=at.m_invI,pt=Q.normal.x,mt=Q.normal.y,Ct=mt,kt=-pt,Mt=Q.friction;for(A=0;A<Q.pointCount;A++)D=Q.points[A],W=Z.x-st*D.rB.y-lt.x+et*D.rA.y,U=Z.y+st*D.rB.x-lt.y-et*D.rA.x,g=W*Ct+U*kt,V=D.tangentMass*-g,d=Mt*D.normalImpulse,w=H.Clamp(D.tangentImpulse+V,-d,d),V=w-D.tangentImpulse,m=V*Ct,P=V*kt,lt.x-=it*m,lt.y-=it*P,et-=ft*(D.rA.x*P-D.rA.y*m),Z.x+=ut*m,Z.y+=ut*P,st+=dt*(D.rB.x*P-D.rB.y*m),D.tangentImpulse=w;if(parseInt(Q.pointCount),Q.pointCount==1)D=Q.points[0],W=Z.x+-st*D.rB.y-lt.x- -et*D.rA.y,U=Z.y+st*D.rB.x-lt.y-et*D.rA.x,u=W*pt+U*mt,V=-D.normalMass*(u-D.velocityBias),w=D.normalImpulse+V,w=w>0?w:0,V=w-D.normalImpulse,m=V*pt,P=V*mt,lt.x-=it*m,lt.y-=it*P,et-=ft*(D.rA.x*P-D.rA.y*m),Z.x+=ut*m,Z.y+=ut*P,st+=dt*(D.rB.x*P-D.rB.y*m),D.normalImpulse=w;else{var yt=Q.points[0],St=Q.points[1],Et=yt.normalImpulse,Nt=St.normalImpulse,Vt=Z.x-st*yt.rB.y-lt.x+et*yt.rA.y,Ft=Z.y+st*yt.rB.x-lt.y-et*yt.rA.x,b=Z.x-st*St.rB.y-lt.x+et*St.rA.y,S=Z.y+st*St.rB.x-lt.y-et*St.rA.x,ot=Vt*pt+Ft*mt,ct=b*pt+S*mt,ht=ot-yt.velocityBias,nt=ct-St.velocityBias;for(X=Q.K,ht-=X.col1.x*Et+X.col2.x*Nt,nt-=X.col1.y*Et+X.col2.y*Nt;;){X=Q.normalMass;var gt=-(X.col1.x*ht+X.col2.x*nt),vt=-(X.col1.y*ht+X.col2.y*nt);if(gt>=0&&vt>=0){T=gt-Et,L=vt-Nt,O=T*pt,R=T*mt,z=L*pt,q=L*mt,lt.x-=it*(O+z),lt.y-=it*(R+q),et-=ft*(yt.rA.x*R-yt.rA.y*O+St.rA.x*q-St.rA.y*z),Z.x+=ut*(O+z),Z.y+=ut*(R+q),st+=dt*(yt.rB.x*R-yt.rB.y*O+St.rB.x*q-St.rB.y*z),yt.normalImpulse=gt,St.normalImpulse=vt;break}if(gt=-yt.normalMass*ht,vt=0,ot=0,ct=Q.K.col1.y*gt+nt,gt>=0&&ct>=0){T=gt-Et,L=vt-Nt,O=T*pt,R=T*mt,z=L*pt,q=L*mt,lt.x-=it*(O+z),lt.y-=it*(R+q),et-=ft*(yt.rA.x*R-yt.rA.y*O+St.rA.x*q-St.rA.y*z),Z.x+=ut*(O+z),Z.y+=ut*(R+q),st+=dt*(yt.rB.x*R-yt.rB.y*O+St.rB.x*q-St.rB.y*z),yt.normalImpulse=gt,St.normalImpulse=vt;break}if(gt=0,vt=-St.normalMass*nt,ot=Q.K.col2.x*vt+ht,ct=0,vt>=0&&ot>=0){T=gt-Et,L=vt-Nt,O=T*pt,R=T*mt,z=L*pt,q=L*mt,lt.x-=it*(O+z),lt.y-=it*(R+q),et-=ft*(yt.rA.x*R-yt.rA.y*O+St.rA.x*q-St.rA.y*z),Z.x+=ut*(O+z),Z.y+=ut*(R+q),st+=dt*(yt.rB.x*R-yt.rB.y*O+St.rB.x*q-St.rB.y*z),yt.normalImpulse=gt,St.normalImpulse=vt;break}if(gt=0,vt=0,ot=ht,ct=nt,ot>=0&&ct>=0){T=gt-Et,L=vt-Nt,O=T*pt,R=T*mt,z=L*pt,q=L*mt,lt.x-=it*(O+z),lt.y-=it*(R+q),et-=ft*(yt.rA.x*R-yt.rA.y*O+St.rA.x*q-St.rA.y*z),Z.x+=ut*(O+z),Z.y+=ut*(R+q),st+=dt*(yt.rB.x*R-yt.rB.y*O+St.rB.x*q-St.rB.y*z),yt.normalImpulse=gt,St.normalImpulse=vt;break}break}}tt.m_angularVelocity=et,at.m_angularVelocity=st}},x.prototype.FinalizeVelocityConstraints=function(){for(var A=0;A<this.m_constraintCount;++A)for(var D=this.m_constraints[A],W=D.manifold,U=0;U<D.pointCount;++U){var u=W.m_points[U],g=D.points[U];u.m_normalImpulse=g.normalImpulse,u.m_tangentImpulse=g.tangentImpulse}},x.prototype.SolvePositionConstraints=function(A){A===void 0&&(A=0);for(var D=0,W=0;W<this.m_constraintCount;W++){var U=this.m_constraints[W],u=U.bodyA,g=U.bodyB,V=u.m_mass*u.m_invMass,d=u.m_mass*u.m_invI,w=g.m_mass*g.m_invMass,m=g.m_mass*g.m_invI;x.s_psm.Initialize(U);for(var P=x.s_psm.m_normal,T=0;T<U.pointCount;T++){var L=U.points[T],O=x.s_psm.m_points[T],R=x.s_psm.m_separations[T],z=O.x-u.m_sweep.c.x,q=O.y-u.m_sweep.c.y,X=O.x-g.m_sweep.c.x,Y=O.y-g.m_sweep.c.y;D=D<R?D:R;var Q=H.Clamp(A*(R+J.b2_linearSlop),-J.b2_maxLinearCorrection,0),tt=-L.equalizedMass*Q,at=tt*P.x,et=tt*P.y;u.m_sweep.c.x-=V*at,u.m_sweep.c.y-=V*et,u.m_sweep.a-=d*(z*et-q*at),u.SynchronizeTransform(),g.m_sweep.c.x+=w*at,g.m_sweep.c.y+=w*et,g.m_sweep.a+=m*(X*et-Y*at),g.SynchronizeTransform()}}return D>-1.5*J.b2_linearSlop},p.postDefs.push(function(){p.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new F,p.Dynamics.Contacts.b2ContactSolver.s_psm=new C}),p.inherit(y,p.Dynamics.Contacts.b2Contact),y.prototype.__super=p.Dynamics.Contacts.b2Contact.prototype,y.b2EdgeAndCircleContact=function(){p.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},y.Create=function(A){return new y},y.Destroy=function(A,D){},y.prototype.Reset=function(A,D){this.__super.Reset.call(this,A,D)},y.prototype.Evaluate=function(){var A=this.m_fixtureA.GetBody(),D=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,A.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,D.m_xf)},y.prototype.b2CollideEdgeAndCircle=function(A,D,W,U,u){},p.inherit(M,p.Dynamics.Contacts.b2Contact),M.prototype.__super=p.Dynamics.Contacts.b2Contact.prototype,M.b2NullContact=function(){p.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},M.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},M.prototype.Evaluate=function(){},p.inherit(G,p.Dynamics.Contacts.b2Contact),G.prototype.__super=p.Dynamics.Contacts.b2Contact.prototype,G.b2PolyAndCircleContact=function(){p.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},G.Create=function(A){return new G},G.Destroy=function(A,D){},G.prototype.Reset=function(A,D){this.__super.Reset.call(this,A,D),J.b2Assert(A.GetType()==r.e_polygonShape),J.b2Assert(D.GetType()==r.e_circleShape)},G.prototype.Evaluate=function(){var A=this.m_fixtureA.m_body,D=this.m_fixtureB.m_body;j.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,A.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,D.m_xf)},p.inherit(h,p.Dynamics.Contacts.b2Contact),h.prototype.__super=p.Dynamics.Contacts.b2Contact.prototype,h.b2PolyAndEdgeContact=function(){p.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},h.Create=function(A){return new h},h.Destroy=function(A,D){},h.prototype.Reset=function(A,D){this.__super.Reset.call(this,A,D),J.b2Assert(A.GetType()==r.e_polygonShape),J.b2Assert(D.GetType()==r.e_edgeShape)},h.prototype.Evaluate=function(){var A=this.m_fixtureA.GetBody(),D=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,A.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,D.m_xf)},h.prototype.b2CollidePolyAndEdge=function(A,D,W,U,u){},p.inherit(v,p.Dynamics.Contacts.b2Contact),v.prototype.__super=p.Dynamics.Contacts.b2Contact.prototype,v.b2PolygonContact=function(){p.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},v.Create=function(A){return new v},v.Destroy=function(A,D){},v.prototype.Reset=function(A,D){this.__super.Reset.call(this,A,D)},v.prototype.Evaluate=function(){var A=this.m_fixtureA.GetBody(),D=this.m_fixtureB.GetBody();j.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,A.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,D.m_xf)},C.b2PositionSolverManifold=function(){},C.prototype.b2PositionSolverManifold=function(){this.m_normal=new $,this.m_separations=new we(J.b2_maxManifoldPoints),this.m_points=new Wt(J.b2_maxManifoldPoints);for(var A=0;A<J.b2_maxManifoldPoints;A++)this.m_points[A]=new $},C.prototype.Initialize=function(A){J.b2Assert(A.pointCount>0);var D=0,W=0,U=0,u,g,V=0,d=0;switch(A.type){case rt.e_circles:{u=A.bodyA.m_xf.R,g=A.localPoint;var w=A.bodyA.m_xf.position.x+(u.col1.x*g.x+u.col2.x*g.y),m=A.bodyA.m_xf.position.y+(u.col1.y*g.x+u.col2.y*g.y);u=A.bodyB.m_xf.R,g=A.points[0].localPoint;var P=A.bodyB.m_xf.position.x+(u.col1.x*g.x+u.col2.x*g.y),T=A.bodyB.m_xf.position.y+(u.col1.y*g.x+u.col2.y*g.y),L=P-w,O=T-m,R=L*L+O*O;if(R>Number.MIN_VALUE*Number.MIN_VALUE){var z=Math.sqrt(R);this.m_normal.x=L/z,this.m_normal.y=O/z}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(w+P),this.m_points[0].y=.5*(m+T),this.m_separations[0]=L*this.m_normal.x+O*this.m_normal.y-A.radius}break;case rt.e_faceA:for(u=A.bodyA.m_xf.R,g=A.localPlaneNormal,this.m_normal.x=u.col1.x*g.x+u.col2.x*g.y,this.m_normal.y=u.col1.y*g.x+u.col2.y*g.y,u=A.bodyA.m_xf.R,g=A.localPoint,V=A.bodyA.m_xf.position.x+(u.col1.x*g.x+u.col2.x*g.y),d=A.bodyA.m_xf.position.y+(u.col1.y*g.x+u.col2.y*g.y),u=A.bodyB.m_xf.R,D=0;D<A.pointCount;++D)g=A.points[D].localPoint,W=A.bodyB.m_xf.position.x+(u.col1.x*g.x+u.col2.x*g.y),U=A.bodyB.m_xf.position.y+(u.col1.y*g.x+u.col2.y*g.y),this.m_separations[D]=(W-V)*this.m_normal.x+(U-d)*this.m_normal.y-A.radius,this.m_points[D].x=W,this.m_points[D].y=U;break;case rt.e_faceB:{for(u=A.bodyB.m_xf.R,g=A.localPlaneNormal,this.m_normal.x=u.col1.x*g.x+u.col2.x*g.y,this.m_normal.y=u.col1.y*g.x+u.col2.y*g.y,u=A.bodyB.m_xf.R,g=A.localPoint,V=A.bodyB.m_xf.position.x+(u.col1.x*g.x+u.col2.x*g.y),d=A.bodyB.m_xf.position.y+(u.col1.y*g.x+u.col2.y*g.y),u=A.bodyA.m_xf.R,D=0;D<A.pointCount;++D)g=A.points[D].localPoint,W=A.bodyA.m_xf.position.x+(u.col1.x*g.x+u.col2.x*g.y),U=A.bodyA.m_xf.position.y+(u.col1.y*g.x+u.col2.y*g.y),this.m_separations[D]=(W-V)*this.m_normal.x+(U-d)*this.m_normal.y-A.radius,this.m_points[D].Set(W,U);this.m_normal.x*=-1,this.m_normal.y*=-1}break}},p.postDefs.push(function(){p.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new $,p.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new $})})();(function(){p.Dynamics.b2Body,p.Dynamics.b2BodyDef,p.Dynamics.b2ContactFilter,p.Dynamics.b2ContactImpulse,p.Dynamics.b2ContactListener,p.Dynamics.b2ContactManager,p.Dynamics.b2DebugDraw,p.Dynamics.b2DestructionListener,p.Dynamics.b2FilterData,p.Dynamics.b2Fixture,p.Dynamics.b2FixtureDef,p.Dynamics.b2Island,p.Dynamics.b2TimeStep,p.Dynamics.b2World;var i=p.Common.Math.b2Mat22;p.Common.Math.b2Mat33;var t=p.Common.Math.b2Math;p.Common.Math.b2Sweep,p.Common.Math.b2Transform;var e=p.Common.Math.b2Vec2;p.Common.Math.b2Vec3;var r=p.Common.b2Color;p.Common.b2internal,p.Common.b2Settings,p.Collision.Shapes.b2CircleShape,p.Collision.Shapes.b2EdgeChainDef,p.Collision.Shapes.b2EdgeShape,p.Collision.Shapes.b2MassData,p.Collision.Shapes.b2PolygonShape,p.Collision.Shapes.b2Shape;var n=p.Dynamics.Controllers.b2BuoyancyController,s=p.Dynamics.Controllers.b2ConstantAccelController,a=p.Dynamics.Controllers.b2ConstantForceController,o=p.Dynamics.Controllers.b2Controller,l=p.Dynamics.Controllers.b2ControllerEdge,c=p.Dynamics.Controllers.b2GravityController,f=p.Dynamics.Controllers.b2TensorDampingController;p.inherit(n,p.Dynamics.Controllers.b2Controller),n.prototype.__super=p.Dynamics.Controllers.b2Controller.prototype,n.b2BuoyancyController=function(){p.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new e(0,-1),this.offset=0,this.density=0,this.velocity=new e(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},n.prototype.Step=function(_){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var x=this.m_bodyList;x;x=x.nextBody){var y=x.body;if(y.IsAwake()!=!1){for(var M=new e,G=new e,h=0,v=0,C=y.GetFixtureList();C;C=C.GetNext()){var E=new e,k=C.GetShape().ComputeSubmergedArea(this.normal,this.offset,y.GetTransform(),E);h+=k,M.x+=k*E.x,M.y+=k*E.y;var J=0;this.useDensity,J=1,v+=k*J,G.x+=k*E.x*J,G.y+=k*E.y*J}if(M.x/=h,M.y/=h,G.x/=v,G.y/=v,!(h<Number.MIN_VALUE)){var N=this.gravity.GetNegative();N.Multiply(this.density*h),y.ApplyForce(N,G);var H=y.GetLinearVelocityFromWorldPoint(M);H.Subtract(this.velocity),H.Multiply(-this.linearDrag*h),y.ApplyForce(H,M),y.ApplyTorque(-y.GetInertia()/y.GetMass()*h*y.GetAngularVelocity()*this.angularDrag)}}}}},n.prototype.Draw=function(_){var x=1e3,y=new e,M=new e;y.x=this.normal.x*this.offset+this.normal.y*x,y.y=this.normal.y*this.offset-this.normal.x*x,M.x=this.normal.x*this.offset-this.normal.y*x,M.y=this.normal.y*this.offset+this.normal.x*x;var G=new r(0,0,1);_.DrawSegment(y,M,G)},p.inherit(s,p.Dynamics.Controllers.b2Controller),s.prototype.__super=p.Dynamics.Controllers.b2Controller.prototype,s.b2ConstantAccelController=function(){p.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new e(0,0)},s.prototype.Step=function(_){for(var x=new e(this.A.x*_.dt,this.A.y*_.dt),y=this.m_bodyList;y;y=y.nextBody){var M=y.body;M.IsAwake()&&M.SetLinearVelocity(new e(M.GetLinearVelocity().x+x.x,M.GetLinearVelocity().y+x.y))}},p.inherit(a,p.Dynamics.Controllers.b2Controller),a.prototype.__super=p.Dynamics.Controllers.b2Controller.prototype,a.b2ConstantForceController=function(){p.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new e(0,0)},a.prototype.Step=function(_){for(var x=this.m_bodyList;x;x=x.nextBody){var y=x.body;y.IsAwake()&&y.ApplyForce(this.F,y.GetWorldCenter())}},o.b2Controller=function(){},o.prototype.Step=function(_){},o.prototype.Draw=function(_){},o.prototype.AddBody=function(_){var x=new l;x.controller=this,x.body=_,x.nextBody=this.m_bodyList,x.prevBody=null,this.m_bodyList=x,x.nextBody&&(x.nextBody.prevBody=x),this.m_bodyCount++,x.nextController=_.m_controllerList,x.prevController=null,_.m_controllerList=x,x.nextController&&(x.nextController.prevController=x),_.m_controllerCount++},o.prototype.RemoveBody=function(_){for(var x=_.m_controllerList;x&&x.controller!=this;)x=x.nextController;x.prevBody&&(x.prevBody.nextBody=x.nextBody),x.nextBody&&(x.nextBody.prevBody=x.prevBody),x.nextController&&(x.nextController.prevController=x.prevController),x.prevController&&(x.prevController.nextController=x.nextController),this.m_bodyList==x&&(this.m_bodyList=x.nextBody),_.m_controllerList==x&&(_.m_controllerList=x.nextController),_.m_controllerCount--,this.m_bodyCount--},o.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},o.prototype.GetNext=function(){return this.m_next},o.prototype.GetWorld=function(){return this.m_world},o.prototype.GetBodyList=function(){return this.m_bodyList},l.b2ControllerEdge=function(){},p.inherit(c,p.Dynamics.Controllers.b2Controller),c.prototype.__super=p.Dynamics.Controllers.b2Controller.prototype,c.b2GravityController=function(){p.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},c.prototype.Step=function(_){var x=null,y=null,M=null,G=0,h=null,v=null,C=null,E=0,k=0,J=0,N=null;if(this.invSqr)for(x=this.m_bodyList;x;x=x.nextBody)for(y=x.body,M=y.GetWorldCenter(),G=y.GetMass(),h=this.m_bodyList;h!=x;h=h.nextBody)v=h.body,C=v.GetWorldCenter(),E=C.x-M.x,k=C.y-M.y,J=E*E+k*k,!(J<Number.MIN_VALUE)&&(N=new e(E,k),N.Multiply(this.G/J/Math.sqrt(J)*G*v.GetMass()),y.IsAwake()&&y.ApplyForce(N,M),N.Multiply(-1),v.IsAwake()&&v.ApplyForce(N,C));else for(x=this.m_bodyList;x;x=x.nextBody)for(y=x.body,M=y.GetWorldCenter(),G=y.GetMass(),h=this.m_bodyList;h!=x;h=h.nextBody)v=h.body,C=v.GetWorldCenter(),E=C.x-M.x,k=C.y-M.y,J=E*E+k*k,!(J<Number.MIN_VALUE)&&(N=new e(E,k),N.Multiply(this.G/J*G*v.GetMass()),y.IsAwake()&&y.ApplyForce(N,M),N.Multiply(-1),v.IsAwake()&&v.ApplyForce(N,C))},p.inherit(f,p.Dynamics.Controllers.b2Controller),f.prototype.__super=p.Dynamics.Controllers.b2Controller.prototype,f.b2TensorDampingController=function(){p.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new i,this.maxTimestep=0},f.prototype.SetAxisAligned=function(_,x){_===void 0&&(_=0),x===void 0&&(x=0),this.T.col1.x=-_,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-x,_>0||x>0?this.maxTimestep=1/Math.max(_,x):this.maxTimestep=0},f.prototype.Step=function(_){var x=_.dt;if(!(x<=Number.MIN_VALUE)){x>this.maxTimestep&&this.maxTimestep>0&&(x=this.maxTimestep);for(var y=this.m_bodyList;y;y=y.nextBody){var M=y.body;if(M.IsAwake()){var G=M.GetWorldVector(t.MulMV(this.T,M.GetLocalVector(M.GetLinearVelocity())));M.SetLinearVelocity(new e(M.GetLinearVelocity().x+G.x*x,M.GetLinearVelocity().y+G.y*x))}}}}})();(function(){p.Common.b2Color,p.Common.b2internal;var i=p.Common.b2Settings,t=p.Common.Math.b2Mat22,e=p.Common.Math.b2Mat33,r=p.Common.Math.b2Math;p.Common.Math.b2Sweep,p.Common.Math.b2Transform;var n=p.Common.Math.b2Vec2,s=p.Common.Math.b2Vec3,a=p.Dynamics.Joints.b2DistanceJoint,o=p.Dynamics.Joints.b2DistanceJointDef,l=p.Dynamics.Joints.b2FrictionJoint,c=p.Dynamics.Joints.b2FrictionJointDef,f=p.Dynamics.Joints.b2GearJoint,_=p.Dynamics.Joints.b2GearJointDef,x=p.Dynamics.Joints.b2Jacobian,y=p.Dynamics.Joints.b2Joint,M=p.Dynamics.Joints.b2JointDef,G=p.Dynamics.Joints.b2JointEdge,h=p.Dynamics.Joints.b2LineJoint,v=p.Dynamics.Joints.b2LineJointDef,C=p.Dynamics.Joints.b2MouseJoint,E=p.Dynamics.Joints.b2MouseJointDef,k=p.Dynamics.Joints.b2PrismaticJoint,J=p.Dynamics.Joints.b2PrismaticJointDef,N=p.Dynamics.Joints.b2PulleyJoint,H=p.Dynamics.Joints.b2PulleyJointDef,$=p.Dynamics.Joints.b2RevoluteJoint,j=p.Dynamics.Joints.b2RevoluteJointDef,K=p.Dynamics.Joints.b2WeldJoint,rt=p.Dynamics.Joints.b2WeldJointDef;p.Dynamics.b2Body,p.Dynamics.b2BodyDef,p.Dynamics.b2ContactFilter,p.Dynamics.b2ContactImpulse,p.Dynamics.b2ContactListener,p.Dynamics.b2ContactManager,p.Dynamics.b2DebugDraw,p.Dynamics.b2DestructionListener,p.Dynamics.b2FilterData,p.Dynamics.b2Fixture,p.Dynamics.b2FixtureDef,p.Dynamics.b2Island,p.Dynamics.b2TimeStep,p.Dynamics.b2World,p.inherit(a,p.Dynamics.Joints.b2Joint),a.prototype.__super=p.Dynamics.Joints.b2Joint.prototype,a.b2DistanceJoint=function(){p.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u=new n},a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},a.prototype.GetReactionForce=function(B){return B===void 0&&(B=0),new n(B*this.m_impulse*this.m_u.x,B*this.m_impulse*this.m_u.y)},a.prototype.GetReactionTorque=function(B){return 0},a.prototype.GetLength=function(){return this.m_length},a.prototype.SetLength=function(B){B===void 0&&(B=0),this.m_length=B},a.prototype.GetFrequency=function(){return this.m_frequencyHz},a.prototype.SetFrequency=function(B){B===void 0&&(B=0),this.m_frequencyHz=B},a.prototype.GetDampingRatio=function(){return this.m_dampingRatio},a.prototype.SetDampingRatio=function(B){B===void 0&&(B=0),this.m_dampingRatio=B},a.prototype.b2DistanceJoint=function(B){this.__super.b2Joint.call(this,B),this.m_localAnchor1.SetV(B.localAnchorA),this.m_localAnchor2.SetV(B.localAnchorB),this.m_length=B.length,this.m_frequencyHz=B.frequencyHz,this.m_dampingRatio=B.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},a.prototype.InitVelocityConstraints=function(B){var I,F=0,A=this.m_bodyA,D=this.m_bodyB;I=A.m_xf.R;var W=this.m_localAnchor1.x-A.m_sweep.localCenter.x,U=this.m_localAnchor1.y-A.m_sweep.localCenter.y;F=I.col1.x*W+I.col2.x*U,U=I.col1.y*W+I.col2.y*U,W=F,I=D.m_xf.R;var u=this.m_localAnchor2.x-D.m_sweep.localCenter.x,g=this.m_localAnchor2.y-D.m_sweep.localCenter.y;F=I.col1.x*u+I.col2.x*g,g=I.col1.y*u+I.col2.y*g,u=F,this.m_u.x=D.m_sweep.c.x+u-A.m_sweep.c.x-W,this.m_u.y=D.m_sweep.c.y+g-A.m_sweep.c.y-U;var V=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);V>i.b2_linearSlop?this.m_u.Multiply(1/V):this.m_u.SetZero();var d=W*this.m_u.y-U*this.m_u.x,w=u*this.m_u.y-g*this.m_u.x,m=A.m_invMass+A.m_invI*d*d+D.m_invMass+D.m_invI*w*w;if(this.m_mass=m!=0?1/m:0,this.m_frequencyHz>0){var P=V-this.m_length,T=2*Math.PI*this.m_frequencyHz,L=2*this.m_mass*this.m_dampingRatio*T,O=this.m_mass*T*T;this.m_gamma=B.dt*(L+B.dt*O),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=P*B.dt*O*this.m_gamma,this.m_mass=m+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(B.warmStarting){this.m_impulse*=B.dtRatio;var R=this.m_impulse*this.m_u.x,z=this.m_impulse*this.m_u.y;A.m_linearVelocity.x-=A.m_invMass*R,A.m_linearVelocity.y-=A.m_invMass*z,A.m_angularVelocity-=A.m_invI*(W*z-U*R),D.m_linearVelocity.x+=D.m_invMass*R,D.m_linearVelocity.y+=D.m_invMass*z,D.m_angularVelocity+=D.m_invI*(u*z-g*R)}else this.m_impulse=0},a.prototype.SolveVelocityConstraints=function(B){var I,F=this.m_bodyA,A=this.m_bodyB;I=F.m_xf.R;var D=this.m_localAnchor1.x-F.m_sweep.localCenter.x,W=this.m_localAnchor1.y-F.m_sweep.localCenter.y,U=I.col1.x*D+I.col2.x*W;W=I.col1.y*D+I.col2.y*W,D=U,I=A.m_xf.R;var u=this.m_localAnchor2.x-A.m_sweep.localCenter.x,g=this.m_localAnchor2.y-A.m_sweep.localCenter.y;U=I.col1.x*u+I.col2.x*g,g=I.col1.y*u+I.col2.y*g,u=U;var V=F.m_linearVelocity.x+-F.m_angularVelocity*W,d=F.m_linearVelocity.y+F.m_angularVelocity*D,w=A.m_linearVelocity.x+-A.m_angularVelocity*g,m=A.m_linearVelocity.y+A.m_angularVelocity*u,P=this.m_u.x*(w-V)+this.m_u.y*(m-d),T=-this.m_mass*(P+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=T;var L=T*this.m_u.x,O=T*this.m_u.y;F.m_linearVelocity.x-=F.m_invMass*L,F.m_linearVelocity.y-=F.m_invMass*O,F.m_angularVelocity-=F.m_invI*(D*O-W*L),A.m_linearVelocity.x+=A.m_invMass*L,A.m_linearVelocity.y+=A.m_invMass*O,A.m_angularVelocity+=A.m_invI*(u*O-g*L)},a.prototype.SolvePositionConstraints=function(B){var I;if(this.m_frequencyHz>0)return!0;var F=this.m_bodyA,A=this.m_bodyB;I=F.m_xf.R;var D=this.m_localAnchor1.x-F.m_sweep.localCenter.x,W=this.m_localAnchor1.y-F.m_sweep.localCenter.y,U=I.col1.x*D+I.col2.x*W;W=I.col1.y*D+I.col2.y*W,D=U,I=A.m_xf.R;var u=this.m_localAnchor2.x-A.m_sweep.localCenter.x,g=this.m_localAnchor2.y-A.m_sweep.localCenter.y;U=I.col1.x*u+I.col2.x*g,g=I.col1.y*u+I.col2.y*g,u=U;var V=A.m_sweep.c.x+u-F.m_sweep.c.x-D,d=A.m_sweep.c.y+g-F.m_sweep.c.y-W,w=Math.sqrt(V*V+d*d);V/=w,d/=w;var m=w-this.m_length;m=r.Clamp(m,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection);var P=-this.m_mass*m;this.m_u.Set(V,d);var T=P*this.m_u.x,L=P*this.m_u.y;return F.m_sweep.c.x-=F.m_invMass*T,F.m_sweep.c.y-=F.m_invMass*L,F.m_sweep.a-=F.m_invI*(D*L-W*T),A.m_sweep.c.x+=A.m_invMass*T,A.m_sweep.c.y+=A.m_invMass*L,A.m_sweep.a+=A.m_invI*(u*L-g*T),F.SynchronizeTransform(),A.SynchronizeTransform(),r.Abs(m)<i.b2_linearSlop},p.inherit(o,p.Dynamics.Joints.b2JointDef),o.prototype.__super=p.Dynamics.Joints.b2JointDef.prototype,o.b2DistanceJointDef=function(){p.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},o.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},o.prototype.Initialize=function(B,I,F,A){this.bodyA=B,this.bodyB=I,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(F)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(A));var D=A.x-F.x,W=A.y-F.y;this.length=Math.sqrt(D*D+W*W),this.frequencyHz=0,this.dampingRatio=0},p.inherit(l,p.Dynamics.Joints.b2Joint),l.prototype.__super=p.Dynamics.Joints.b2Joint.prototype,l.b2FrictionJoint=function(){p.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_linearMass=new t,this.m_linearImpulse=new n},l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},l.prototype.GetReactionForce=function(B){return B===void 0&&(B=0),new n(B*this.m_linearImpulse.x,B*this.m_linearImpulse.y)},l.prototype.GetReactionTorque=function(B){return B===void 0&&(B=0),B*this.m_angularImpulse},l.prototype.SetMaxForce=function(B){B===void 0&&(B=0),this.m_maxForce=B},l.prototype.GetMaxForce=function(){return this.m_maxForce},l.prototype.SetMaxTorque=function(B){B===void 0&&(B=0),this.m_maxTorque=B},l.prototype.GetMaxTorque=function(){return this.m_maxTorque},l.prototype.b2FrictionJoint=function(B){this.__super.b2Joint.call(this,B),this.m_localAnchorA.SetV(B.localAnchorA),this.m_localAnchorB.SetV(B.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=B.maxForce,this.m_maxTorque=B.maxTorque},l.prototype.InitVelocityConstraints=function(B){var I,F=0,A=this.m_bodyA,D=this.m_bodyB;I=A.m_xf.R;var W=this.m_localAnchorA.x-A.m_sweep.localCenter.x,U=this.m_localAnchorA.y-A.m_sweep.localCenter.y;F=I.col1.x*W+I.col2.x*U,U=I.col1.y*W+I.col2.y*U,W=F,I=D.m_xf.R;var u=this.m_localAnchorB.x-D.m_sweep.localCenter.x,g=this.m_localAnchorB.y-D.m_sweep.localCenter.y;F=I.col1.x*u+I.col2.x*g,g=I.col1.y*u+I.col2.y*g,u=F;var V=A.m_invMass,d=D.m_invMass,w=A.m_invI,m=D.m_invI,P=new t;if(P.col1.x=V+d,P.col2.x=0,P.col1.y=0,P.col2.y=V+d,P.col1.x+=w*U*U,P.col2.x+=-w*W*U,P.col1.y+=-w*W*U,P.col2.y+=w*W*W,P.col1.x+=m*g*g,P.col2.x+=-m*u*g,P.col1.y+=-m*u*g,P.col2.y+=m*u*u,P.GetInverse(this.m_linearMass),this.m_angularMass=w+m,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),B.warmStarting){this.m_linearImpulse.x*=B.dtRatio,this.m_linearImpulse.y*=B.dtRatio,this.m_angularImpulse*=B.dtRatio;var T=this.m_linearImpulse;A.m_linearVelocity.x-=V*T.x,A.m_linearVelocity.y-=V*T.y,A.m_angularVelocity-=w*(W*T.y-U*T.x+this.m_angularImpulse),D.m_linearVelocity.x+=d*T.x,D.m_linearVelocity.y+=d*T.y,D.m_angularVelocity+=m*(u*T.y-g*T.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},l.prototype.SolveVelocityConstraints=function(B){var I,F=0,A=this.m_bodyA,D=this.m_bodyB,W=A.m_linearVelocity,U=A.m_angularVelocity,u=D.m_linearVelocity,g=D.m_angularVelocity,V=A.m_invMass,d=D.m_invMass,w=A.m_invI,m=D.m_invI;I=A.m_xf.R;var P=this.m_localAnchorA.x-A.m_sweep.localCenter.x,T=this.m_localAnchorA.y-A.m_sweep.localCenter.y;F=I.col1.x*P+I.col2.x*T,T=I.col1.y*P+I.col2.y*T,P=F,I=D.m_xf.R;var L=this.m_localAnchorB.x-D.m_sweep.localCenter.x,O=this.m_localAnchorB.y-D.m_sweep.localCenter.y;F=I.col1.x*L+I.col2.x*O,O=I.col1.y*L+I.col2.y*O,L=F;var R=0;{var z=g-U,q=-this.m_angularMass*z,X=this.m_angularImpulse;R=B.dt*this.m_maxTorque,this.m_angularImpulse=r.Clamp(this.m_angularImpulse+q,-R,R),q=this.m_angularImpulse-X,U-=w*q,g+=m*q}{var Y=u.x-g*O-W.x+U*T,Q=u.y+g*L-W.y-U*P,tt=r.MulMV(this.m_linearMass,new n(-Y,-Q)),at=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(tt),R=B.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>R*R&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(R)),tt=r.SubtractVV(this.m_linearImpulse,at),W.x-=V*tt.x,W.y-=V*tt.y,U-=w*(P*tt.y-T*tt.x),u.x+=d*tt.x,u.y+=d*tt.y,g+=m*(L*tt.y-O*tt.x)}A.m_angularVelocity=U,D.m_angularVelocity=g},l.prototype.SolvePositionConstraints=function(B){return!0},p.inherit(c,p.Dynamics.Joints.b2JointDef),c.prototype.__super=p.Dynamics.Joints.b2JointDef.prototype,c.b2FrictionJointDef=function(){p.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},c.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_frictionJoint,this.maxForce=0,this.maxTorque=0},c.prototype.Initialize=function(B,I,F){this.bodyA=B,this.bodyB=I,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(F)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(F))},p.inherit(f,p.Dynamics.Joints.b2Joint),f.prototype.__super=p.Dynamics.Joints.b2Joint.prototype,f.b2GearJoint=function(){p.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_J=new x},f.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},f.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},f.prototype.GetReactionForce=function(B){return B===void 0&&(B=0),new n(B*this.m_impulse*this.m_J.linearB.x,B*this.m_impulse*this.m_J.linearB.y)},f.prototype.GetReactionTorque=function(B){B===void 0&&(B=0);var I=this.m_bodyB.m_xf.R,F=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,A=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,D=I.col1.x*F+I.col2.x*A;A=I.col1.y*F+I.col2.y*A,F=D;var W=this.m_impulse*this.m_J.linearB.x,U=this.m_impulse*this.m_J.linearB.y;return B*(this.m_impulse*this.m_J.angularB-F*U+A*W)},f.prototype.GetRatio=function(){return this.m_ratio},f.prototype.SetRatio=function(B){B===void 0&&(B=0),this.m_ratio=B},f.prototype.b2GearJoint=function(B){this.__super.b2Joint.call(this,B);var I=parseInt(B.joint1.m_type),F=parseInt(B.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var A=0,D=0;this.m_ground1=B.joint1.GetBodyA(),this.m_bodyA=B.joint1.GetBodyB(),I==y.e_revoluteJoint?(this.m_revolute1=B.joint1 instanceof $?B.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),A=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=B.joint1 instanceof k?B.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),A=this.m_prismatic1.GetJointTranslation()),this.m_ground2=B.joint2.GetBodyA(),this.m_bodyB=B.joint2.GetBodyB(),F==y.e_revoluteJoint?(this.m_revolute2=B.joint2 instanceof $?B.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),D=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=B.joint2 instanceof k?B.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),D=this.m_prismatic2.GetJointTranslation()),this.m_ratio=B.ratio,this.m_constant=A+this.m_ratio*D,this.m_impulse=0},f.prototype.InitVelocityConstraints=function(B){var I=this.m_ground1,F=this.m_ground2,A=this.m_bodyA,D=this.m_bodyB,W=0,U=0,u=0,g=0,V,d,w=0,m=0,P=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,P+=A.m_invI):(V=I.m_xf.R,d=this.m_prismatic1.m_localXAxis1,W=V.col1.x*d.x+V.col2.x*d.y,U=V.col1.y*d.x+V.col2.y*d.y,V=A.m_xf.R,u=this.m_localAnchor1.x-A.m_sweep.localCenter.x,g=this.m_localAnchor1.y-A.m_sweep.localCenter.y,m=V.col1.x*u+V.col2.x*g,g=V.col1.y*u+V.col2.y*g,u=m,w=u*U-g*W,this.m_J.linearA.Set(-W,-U),this.m_J.angularA=-w,P+=A.m_invMass+A.m_invI*w*w),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,P+=this.m_ratio*this.m_ratio*D.m_invI):(V=F.m_xf.R,d=this.m_prismatic2.m_localXAxis1,W=V.col1.x*d.x+V.col2.x*d.y,U=V.col1.y*d.x+V.col2.y*d.y,V=D.m_xf.R,u=this.m_localAnchor2.x-D.m_sweep.localCenter.x,g=this.m_localAnchor2.y-D.m_sweep.localCenter.y,m=V.col1.x*u+V.col2.x*g,g=V.col1.y*u+V.col2.y*g,u=m,w=u*U-g*W,this.m_J.linearB.Set(-this.m_ratio*W,-this.m_ratio*U),this.m_J.angularB=-this.m_ratio*w,P+=this.m_ratio*this.m_ratio*(D.m_invMass+D.m_invI*w*w)),this.m_mass=P>0?1/P:0,B.warmStarting?(A.m_linearVelocity.x+=A.m_invMass*this.m_impulse*this.m_J.linearA.x,A.m_linearVelocity.y+=A.m_invMass*this.m_impulse*this.m_J.linearA.y,A.m_angularVelocity+=A.m_invI*this.m_impulse*this.m_J.angularA,D.m_linearVelocity.x+=D.m_invMass*this.m_impulse*this.m_J.linearB.x,D.m_linearVelocity.y+=D.m_invMass*this.m_impulse*this.m_J.linearB.y,D.m_angularVelocity+=D.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},f.prototype.SolveVelocityConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A=this.m_J.Compute(I.m_linearVelocity,I.m_angularVelocity,F.m_linearVelocity,F.m_angularVelocity),D=-this.m_mass*A;this.m_impulse+=D,I.m_linearVelocity.x+=I.m_invMass*D*this.m_J.linearA.x,I.m_linearVelocity.y+=I.m_invMass*D*this.m_J.linearA.y,I.m_angularVelocity+=I.m_invI*D*this.m_J.angularA,F.m_linearVelocity.x+=F.m_invMass*D*this.m_J.linearB.x,F.m_linearVelocity.y+=F.m_invMass*D*this.m_J.linearB.y,F.m_angularVelocity+=F.m_invI*D*this.m_J.angularB},f.prototype.SolvePositionConstraints=function(B){var I=0,F=this.m_bodyA,A=this.m_bodyB,D=0,W=0;this.m_revolute1?D=this.m_revolute1.GetJointAngle():D=this.m_prismatic1.GetJointTranslation(),this.m_revolute2?W=this.m_revolute2.GetJointAngle():W=this.m_prismatic2.GetJointTranslation();var U=this.m_constant-(D+this.m_ratio*W),u=-this.m_mass*U;return F.m_sweep.c.x+=F.m_invMass*u*this.m_J.linearA.x,F.m_sweep.c.y+=F.m_invMass*u*this.m_J.linearA.y,F.m_sweep.a+=F.m_invI*u*this.m_J.angularA,A.m_sweep.c.x+=A.m_invMass*u*this.m_J.linearB.x,A.m_sweep.c.y+=A.m_invMass*u*this.m_J.linearB.y,A.m_sweep.a+=A.m_invI*u*this.m_J.angularB,F.SynchronizeTransform(),A.SynchronizeTransform(),I<i.b2_linearSlop},p.inherit(_,p.Dynamics.Joints.b2JointDef),_.prototype.__super=p.Dynamics.Joints.b2JointDef.prototype,_.b2GearJointDef=function(){p.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},_.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},x.b2Jacobian=function(){this.linearA=new n,this.linearB=new n},x.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},x.prototype.Set=function(B,I,F,A){I===void 0&&(I=0),A===void 0&&(A=0),this.linearA.SetV(B),this.angularA=I,this.linearB.SetV(F),this.angularB=A},x.prototype.Compute=function(B,I,F,A){return I===void 0&&(I=0),A===void 0&&(A=0),this.linearA.x*B.x+this.linearA.y*B.y+this.angularA*I+(this.linearB.x*F.x+this.linearB.y*F.y)+this.angularB*A},y.b2Joint=function(){this.m_edgeA=new G,this.m_edgeB=new G,this.m_localCenterA=new n,this.m_localCenterB=new n},y.prototype.GetType=function(){return this.m_type},y.prototype.GetAnchorA=function(){return null},y.prototype.GetAnchorB=function(){return null},y.prototype.GetReactionForce=function(B){return null},y.prototype.GetReactionTorque=function(B){return 0},y.prototype.GetBodyA=function(){return this.m_bodyA},y.prototype.GetBodyB=function(){return this.m_bodyB},y.prototype.GetNext=function(){return this.m_next},y.prototype.GetUserData=function(){return this.m_userData},y.prototype.SetUserData=function(B){this.m_userData=B},y.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},y.Create=function(B,I){var F=null;switch(B.type){case y.e_distanceJoint:F=new a(B instanceof o?B:null);break;case y.e_mouseJoint:F=new C(B instanceof E?B:null);break;case y.e_prismaticJoint:F=new k(B instanceof J?B:null);break;case y.e_revoluteJoint:F=new $(B instanceof j?B:null);break;case y.e_pulleyJoint:F=new N(B instanceof H?B:null);break;case y.e_gearJoint:F=new f(B instanceof _?B:null);break;case y.e_lineJoint:F=new h(B instanceof v?B:null);break;case y.e_weldJoint:F=new K(B instanceof rt?B:null);break;case y.e_frictionJoint:F=new l(B instanceof c?B:null);break}return F},y.Destroy=function(B,I){},y.prototype.b2Joint=function(B){i.b2Assert(B.bodyA!=B.bodyB),this.m_type=B.type,this.m_prev=null,this.m_next=null,this.m_bodyA=B.bodyA,this.m_bodyB=B.bodyB,this.m_collideConnected=B.collideConnected,this.m_islandFlag=!1,this.m_userData=B.userData},y.prototype.InitVelocityConstraints=function(B){},y.prototype.SolveVelocityConstraints=function(B){},y.prototype.FinalizeVelocityConstraints=function(){},y.prototype.SolvePositionConstraints=function(B){return!1},p.postDefs.push(function(){p.Dynamics.Joints.b2Joint.e_unknownJoint=0,p.Dynamics.Joints.b2Joint.e_revoluteJoint=1,p.Dynamics.Joints.b2Joint.e_prismaticJoint=2,p.Dynamics.Joints.b2Joint.e_distanceJoint=3,p.Dynamics.Joints.b2Joint.e_pulleyJoint=4,p.Dynamics.Joints.b2Joint.e_mouseJoint=5,p.Dynamics.Joints.b2Joint.e_gearJoint=6,p.Dynamics.Joints.b2Joint.e_lineJoint=7,p.Dynamics.Joints.b2Joint.e_weldJoint=8,p.Dynamics.Joints.b2Joint.e_frictionJoint=9,p.Dynamics.Joints.b2Joint.e_inactiveLimit=0,p.Dynamics.Joints.b2Joint.e_atLowerLimit=1,p.Dynamics.Joints.b2Joint.e_atUpperLimit=2,p.Dynamics.Joints.b2Joint.e_equalLimits=3}),M.b2JointDef=function(){},M.prototype.b2JointDef=function(){this.type=y.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},G.b2JointEdge=function(){},p.inherit(h,p.Dynamics.Joints.b2Joint),h.prototype.__super=p.Dynamics.Joints.b2Joint.prototype,h.b2LineJoint=function(){p.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new t,this.m_impulse=new n},h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},h.prototype.GetReactionForce=function(B){return B===void 0&&(B=0),new n(B*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),B*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},h.prototype.GetReactionTorque=function(B){return B===void 0&&(B=0),B*this.m_impulse.y},h.prototype.GetJointTranslation=function(){var B=this.m_bodyA,I=this.m_bodyB,F=B.GetWorldPoint(this.m_localAnchor1),A=I.GetWorldPoint(this.m_localAnchor2),D=A.x-F.x,W=A.y-F.y,U=B.GetWorldVector(this.m_localXAxis1),u=U.x*D+U.y*W;return u},h.prototype.GetJointSpeed=function(){var B=this.m_bodyA,I=this.m_bodyB,F;F=B.m_xf.R;var A=this.m_localAnchor1.x-B.m_sweep.localCenter.x,D=this.m_localAnchor1.y-B.m_sweep.localCenter.y,W=F.col1.x*A+F.col2.x*D;D=F.col1.y*A+F.col2.y*D,A=W,F=I.m_xf.R;var U=this.m_localAnchor2.x-I.m_sweep.localCenter.x,u=this.m_localAnchor2.y-I.m_sweep.localCenter.y;W=F.col1.x*U+F.col2.x*u,u=F.col1.y*U+F.col2.y*u,U=W;var g=B.m_sweep.c.x+A,V=B.m_sweep.c.y+D,d=I.m_sweep.c.x+U,w=I.m_sweep.c.y+u,m=d-g,P=w-V,T=B.GetWorldVector(this.m_localXAxis1),L=B.m_linearVelocity,O=I.m_linearVelocity,R=B.m_angularVelocity,z=I.m_angularVelocity,q=m*(-R*T.y)+P*(R*T.x)+(T.x*(O.x+-z*u-L.x- -R*D)+T.y*(O.y+z*U-L.y-R*A));return q},h.prototype.IsLimitEnabled=function(){return this.m_enableLimit},h.prototype.EnableLimit=function(B){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=B},h.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},h.prototype.GetUpperLimit=function(){return this.m_upperTranslation},h.prototype.SetLimits=function(B,I){B===void 0&&(B=0),I===void 0&&(I=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=B,this.m_upperTranslation=I},h.prototype.IsMotorEnabled=function(){return this.m_enableMotor},h.prototype.EnableMotor=function(B){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=B},h.prototype.SetMotorSpeed=function(B){B===void 0&&(B=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=B},h.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},h.prototype.SetMaxMotorForce=function(B){B===void 0&&(B=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=B},h.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},h.prototype.GetMotorForce=function(){return this.m_motorImpulse},h.prototype.b2LineJoint=function(B){this.__super.b2Joint.call(this,B),this.m_localAnchor1.SetV(B.localAnchorA),this.m_localAnchor2.SetV(B.localAnchorB),this.m_localXAxis1.SetV(B.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=B.lowerTranslation,this.m_upperTranslation=B.upperTranslation,this.m_maxMotorForce=B.maxMotorForce,this.m_motorSpeed=B.motorSpeed,this.m_enableLimit=B.enableLimit,this.m_enableMotor=B.enableMotor,this.m_limitState=y.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},h.prototype.InitVelocityConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A,D=0;this.m_localCenterA.SetV(I.GetLocalCenter()),this.m_localCenterB.SetV(F.GetLocalCenter());var W=I.GetTransform();F.GetTransform(),A=I.m_xf.R;var U=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;D=A.col1.x*U+A.col2.x*u,u=A.col1.y*U+A.col2.y*u,U=D,A=F.m_xf.R;var g=this.m_localAnchor2.x-this.m_localCenterB.x,V=this.m_localAnchor2.y-this.m_localCenterB.y;D=A.col1.x*g+A.col2.x*V,V=A.col1.y*g+A.col2.y*V,g=D;var d=F.m_sweep.c.x+g-I.m_sweep.c.x-U,w=F.m_sweep.c.y+V-I.m_sweep.c.y-u;this.m_invMassA=I.m_invMass,this.m_invMassB=F.m_invMass,this.m_invIA=I.m_invI,this.m_invIB=F.m_invI,this.m_axis.SetV(r.MulMV(W.R,this.m_localXAxis1)),this.m_a1=(d+U)*this.m_axis.y-(w+u)*this.m_axis.x,this.m_a2=g*this.m_axis.y-V*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;{this.m_perp.SetV(r.MulMV(W.R,this.m_localYAxis1)),this.m_s1=(d+U)*this.m_perp.y-(w+u)*this.m_perp.x,this.m_s2=g*this.m_perp.y-V*this.m_perp.x;var m=this.m_invMassA,P=this.m_invMassB,T=this.m_invIA,L=this.m_invIB;this.m_K.col1.x=m+P+T*this.m_s1*this.m_s1+L*this.m_s2*this.m_s2,this.m_K.col1.y=T*this.m_s1*this.m_a1+L*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=m+P+T*this.m_a1*this.m_a1+L*this.m_a2*this.m_a2}if(this.m_enableLimit){var O=this.m_axis.x*d+this.m_axis.y*w;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop?this.m_limitState=y.e_equalLimits:O<=this.m_lowerTranslation?this.m_limitState!=y.e_atLowerLimit&&(this.m_limitState=y.e_atLowerLimit,this.m_impulse.y=0):O>=this.m_upperTranslation?this.m_limitState!=y.e_atUpperLimit&&(this.m_limitState=y.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=y.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=y.e_inactiveLimit;if(this.m_enableMotor==!1&&(this.m_motorImpulse=0),B.warmStarting){this.m_impulse.x*=B.dtRatio,this.m_impulse.y*=B.dtRatio,this.m_motorImpulse*=B.dtRatio;var R=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,z=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,q=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,X=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;I.m_linearVelocity.x-=this.m_invMassA*R,I.m_linearVelocity.y-=this.m_invMassA*z,I.m_angularVelocity-=this.m_invIA*q,F.m_linearVelocity.x+=this.m_invMassB*R,F.m_linearVelocity.y+=this.m_invMassB*z,F.m_angularVelocity+=this.m_invIB*X}else this.m_impulse.SetZero(),this.m_motorImpulse=0},h.prototype.SolveVelocityConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A=I.m_linearVelocity,D=I.m_angularVelocity,W=F.m_linearVelocity,U=F.m_angularVelocity,u=0,g=0,V=0,d=0;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var w=this.m_axis.x*(W.x-A.x)+this.m_axis.y*(W.y-A.y)+this.m_a2*U-this.m_a1*D,m=this.m_motorMass*(this.m_motorSpeed-w),P=this.m_motorImpulse,T=B.dt*this.m_maxMotorForce;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+m,-T,T),m=this.m_motorImpulse-P,u=m*this.m_axis.x,g=m*this.m_axis.y,V=m*this.m_a1,d=m*this.m_a2,A.x-=this.m_invMassA*u,A.y-=this.m_invMassA*g,D-=this.m_invIA*V,W.x+=this.m_invMassB*u,W.y+=this.m_invMassB*g,U+=this.m_invIB*d}var L=this.m_perp.x*(W.x-A.x)+this.m_perp.y*(W.y-A.y)+this.m_s2*U-this.m_s1*D;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var O=this.m_axis.x*(W.x-A.x)+this.m_axis.y*(W.y-A.y)+this.m_a2*U-this.m_a1*D,R=this.m_impulse.Copy(),z=this.m_K.Solve(new n,-L,-O);this.m_impulse.Add(z),this.m_limitState==y.e_atLowerLimit?this.m_impulse.y=r.Max(this.m_impulse.y,0):this.m_limitState==y.e_atUpperLimit&&(this.m_impulse.y=r.Min(this.m_impulse.y,0));var q=-L-(this.m_impulse.y-R.y)*this.m_K.col2.x,X=0;this.m_K.col1.x!=0?X=q/this.m_K.col1.x+R.x:X=R.x,this.m_impulse.x=X,z.x=this.m_impulse.x-R.x,z.y=this.m_impulse.y-R.y,u=z.x*this.m_perp.x+z.y*this.m_axis.x,g=z.x*this.m_perp.y+z.y*this.m_axis.y,V=z.x*this.m_s1+z.y*this.m_a1,d=z.x*this.m_s2+z.y*this.m_a2,A.x-=this.m_invMassA*u,A.y-=this.m_invMassA*g,D-=this.m_invIA*V,W.x+=this.m_invMassB*u,W.y+=this.m_invMassB*g,U+=this.m_invIB*d}else{var Y=0;this.m_K.col1.x!=0?Y=-L/this.m_K.col1.x:Y=0,this.m_impulse.x+=Y,u=Y*this.m_perp.x,g=Y*this.m_perp.y,V=Y*this.m_s1,d=Y*this.m_s2,A.x-=this.m_invMassA*u,A.y-=this.m_invMassA*g,D-=this.m_invIA*V,W.x+=this.m_invMassB*u,W.y+=this.m_invMassB*g,U+=this.m_invIB*d}I.m_linearVelocity.SetV(A),I.m_angularVelocity=D,F.m_linearVelocity.SetV(W),F.m_angularVelocity=U},h.prototype.SolvePositionConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A=I.m_sweep.c,D=I.m_sweep.a,W=F.m_sweep.c,U=F.m_sweep.a,u,g=0,V=0,d=0,w=0,m=0,P=0,T=0,L=!1,O=0,R=t.FromAngle(D),z=t.FromAngle(U);u=R;var q=this.m_localAnchor1.x-this.m_localCenterA.x,X=this.m_localAnchor1.y-this.m_localCenterA.y;g=u.col1.x*q+u.col2.x*X,X=u.col1.y*q+u.col2.y*X,q=g,u=z;var Y=this.m_localAnchor2.x-this.m_localCenterB.x,Q=this.m_localAnchor2.y-this.m_localCenterB.y;g=u.col1.x*Y+u.col2.x*Q,Q=u.col1.y*Y+u.col2.y*Q,Y=g;var tt=W.x+Y-A.x-q,at=W.y+Q-A.y-X;if(this.m_enableLimit){this.m_axis=r.MulMV(R,this.m_localXAxis1),this.m_a1=(tt+q)*this.m_axis.y-(at+X)*this.m_axis.x,this.m_a2=Y*this.m_axis.y-Q*this.m_axis.x;var et=this.m_axis.x*tt+this.m_axis.y*at;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop?(O=r.Clamp(et,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection),P=r.Abs(et),L=!0):et<=this.m_lowerTranslation?(O=r.Clamp(et-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0),P=this.m_lowerTranslation-et,L=!0):et>=this.m_upperTranslation&&(O=r.Clamp(et-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection),P=et-this.m_upperTranslation,L=!0)}this.m_perp=r.MulMV(R,this.m_localYAxis1),this.m_s1=(tt+q)*this.m_perp.y-(at+X)*this.m_perp.x,this.m_s2=Y*this.m_perp.y-Q*this.m_perp.x;var st=new n,lt=this.m_perp.x*tt+this.m_perp.y*at;if(P=r.Max(P,r.Abs(lt)),T=0,L)V=this.m_invMassA,d=this.m_invMassB,w=this.m_invIA,m=this.m_invIB,this.m_K.col1.x=V+d+w*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,this.m_K.col1.y=w*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=V+d+w*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2,this.m_K.Solve(st,-lt,-O);else{V=this.m_invMassA,d=this.m_invMassB,w=this.m_invIA,m=this.m_invIB;var Z=V+d+w*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,it=0;Z!=0?it=-lt/Z:it=0,st.x=it,st.y=0}var ft=st.x*this.m_perp.x+st.y*this.m_axis.x,ut=st.x*this.m_perp.y+st.y*this.m_axis.y,dt=st.x*this.m_s1+st.y*this.m_a1,pt=st.x*this.m_s2+st.y*this.m_a2;return A.x-=this.m_invMassA*ft,A.y-=this.m_invMassA*ut,D-=this.m_invIA*dt,W.x+=this.m_invMassB*ft,W.y+=this.m_invMassB*ut,U+=this.m_invIB*pt,I.m_sweep.a=D,F.m_sweep.a=U,I.SynchronizeTransform(),F.SynchronizeTransform(),P<=i.b2_linearSlop&&T<=i.b2_angularSlop},p.inherit(v,p.Dynamics.Joints.b2JointDef),v.prototype.__super=p.Dynamics.Joints.b2JointDef.prototype,v.b2LineJointDef=function(){p.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},v.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},v.prototype.Initialize=function(B,I,F,A){this.bodyA=B,this.bodyB=I,this.localAnchorA=this.bodyA.GetLocalPoint(F),this.localAnchorB=this.bodyB.GetLocalPoint(F),this.localAxisA=this.bodyA.GetLocalVector(A)},p.inherit(C,p.Dynamics.Joints.b2Joint),C.prototype.__super=p.Dynamics.Joints.b2Joint.prototype,C.b2MouseJoint=function(){p.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new t,this.K1=new t,this.K2=new t,this.m_localAnchor=new n,this.m_target=new n,this.m_impulse=new n,this.m_mass=new t,this.m_C=new n},C.prototype.GetAnchorA=function(){return this.m_target},C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},C.prototype.GetReactionForce=function(B){return B===void 0&&(B=0),new n(B*this.m_impulse.x,B*this.m_impulse.y)},C.prototype.GetReactionTorque=function(B){return 0},C.prototype.GetTarget=function(){return this.m_target},C.prototype.SetTarget=function(B){this.m_bodyB.IsAwake()==!1&&this.m_bodyB.SetAwake(!0),this.m_target=B},C.prototype.GetMaxForce=function(){return this.m_maxForce},C.prototype.SetMaxForce=function(B){B===void 0&&(B=0),this.m_maxForce=B},C.prototype.GetFrequency=function(){return this.m_frequencyHz},C.prototype.SetFrequency=function(B){B===void 0&&(B=0),this.m_frequencyHz=B},C.prototype.GetDampingRatio=function(){return this.m_dampingRatio},C.prototype.SetDampingRatio=function(B){B===void 0&&(B=0),this.m_dampingRatio=B},C.prototype.b2MouseJoint=function(B){this.__super.b2Joint.call(this,B),this.m_target.SetV(B.target);var I=this.m_target.x-this.m_bodyB.m_xf.position.x,F=this.m_target.y-this.m_bodyB.m_xf.position.y,A=this.m_bodyB.m_xf.R;this.m_localAnchor.x=I*A.col1.x+F*A.col1.y,this.m_localAnchor.y=I*A.col2.x+F*A.col2.y,this.m_maxForce=B.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=B.frequencyHz,this.m_dampingRatio=B.dampingRatio,this.m_beta=0,this.m_gamma=0},C.prototype.InitVelocityConstraints=function(B){var I=this.m_bodyB,F=I.GetMass(),A=2*Math.PI*this.m_frequencyHz,D=2*F*this.m_dampingRatio*A,W=F*A*A;this.m_gamma=B.dt*(D+B.dt*W),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=B.dt*W*this.m_gamma;var U;U=I.m_xf.R;var u=this.m_localAnchor.x-I.m_sweep.localCenter.x,g=this.m_localAnchor.y-I.m_sweep.localCenter.y,V=U.col1.x*u+U.col2.x*g;g=U.col1.y*u+U.col2.y*g,u=V;var d=I.m_invMass,w=I.m_invI;this.K1.col1.x=d,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=d,this.K2.col1.x=w*g*g,this.K2.col2.x=-w*u*g,this.K2.col1.y=-w*u*g,this.K2.col2.y=w*u*u,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=I.m_sweep.c.x+u-this.m_target.x,this.m_C.y=I.m_sweep.c.y+g-this.m_target.y,I.m_angularVelocity*=.98,this.m_impulse.x*=B.dtRatio,this.m_impulse.y*=B.dtRatio,I.m_linearVelocity.x+=d*this.m_impulse.x,I.m_linearVelocity.y+=d*this.m_impulse.y,I.m_angularVelocity+=w*(u*this.m_impulse.y-g*this.m_impulse.x)},C.prototype.SolveVelocityConstraints=function(B){var I=this.m_bodyB,F,A=0,D=0;F=I.m_xf.R;var W=this.m_localAnchor.x-I.m_sweep.localCenter.x,U=this.m_localAnchor.y-I.m_sweep.localCenter.y;A=F.col1.x*W+F.col2.x*U,U=F.col1.y*W+F.col2.y*U,W=A;var u=I.m_linearVelocity.x+-I.m_angularVelocity*U,g=I.m_linearVelocity.y+I.m_angularVelocity*W;F=this.m_mass,A=u+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,D=g+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var V=-(F.col1.x*A+F.col2.x*D),d=-(F.col1.y*A+F.col2.y*D),w=this.m_impulse.x,m=this.m_impulse.y;this.m_impulse.x+=V,this.m_impulse.y+=d;var P=B.dt*this.m_maxForce;this.m_impulse.LengthSquared()>P*P&&this.m_impulse.Multiply(P/this.m_impulse.Length()),V=this.m_impulse.x-w,d=this.m_impulse.y-m,I.m_linearVelocity.x+=I.m_invMass*V,I.m_linearVelocity.y+=I.m_invMass*d,I.m_angularVelocity+=I.m_invI*(W*d-U*V)},C.prototype.SolvePositionConstraints=function(B){return!0},p.inherit(E,p.Dynamics.Joints.b2JointDef),E.prototype.__super=p.Dynamics.Joints.b2JointDef.prototype,E.b2MouseJointDef=function(){p.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new n},E.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},p.inherit(k,p.Dynamics.Joints.b2Joint),k.prototype.__super=p.Dynamics.Joints.b2Joint.prototype,k.b2PrismaticJoint=function(){p.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new e,this.m_impulse=new s},k.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},k.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},k.prototype.GetReactionForce=function(B){return B===void 0&&(B=0),new n(B*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),B*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},k.prototype.GetReactionTorque=function(B){return B===void 0&&(B=0),B*this.m_impulse.y},k.prototype.GetJointTranslation=function(){var B=this.m_bodyA,I=this.m_bodyB,F=B.GetWorldPoint(this.m_localAnchor1),A=I.GetWorldPoint(this.m_localAnchor2),D=A.x-F.x,W=A.y-F.y,U=B.GetWorldVector(this.m_localXAxis1),u=U.x*D+U.y*W;return u},k.prototype.GetJointSpeed=function(){var B=this.m_bodyA,I=this.m_bodyB,F;F=B.m_xf.R;var A=this.m_localAnchor1.x-B.m_sweep.localCenter.x,D=this.m_localAnchor1.y-B.m_sweep.localCenter.y,W=F.col1.x*A+F.col2.x*D;D=F.col1.y*A+F.col2.y*D,A=W,F=I.m_xf.R;var U=this.m_localAnchor2.x-I.m_sweep.localCenter.x,u=this.m_localAnchor2.y-I.m_sweep.localCenter.y;W=F.col1.x*U+F.col2.x*u,u=F.col1.y*U+F.col2.y*u,U=W;var g=B.m_sweep.c.x+A,V=B.m_sweep.c.y+D,d=I.m_sweep.c.x+U,w=I.m_sweep.c.y+u,m=d-g,P=w-V,T=B.GetWorldVector(this.m_localXAxis1),L=B.m_linearVelocity,O=I.m_linearVelocity,R=B.m_angularVelocity,z=I.m_angularVelocity,q=m*(-R*T.y)+P*(R*T.x)+(T.x*(O.x+-z*u-L.x- -R*D)+T.y*(O.y+z*U-L.y-R*A));return q},k.prototype.IsLimitEnabled=function(){return this.m_enableLimit},k.prototype.EnableLimit=function(B){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=B},k.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},k.prototype.GetUpperLimit=function(){return this.m_upperTranslation},k.prototype.SetLimits=function(B,I){B===void 0&&(B=0),I===void 0&&(I=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=B,this.m_upperTranslation=I},k.prototype.IsMotorEnabled=function(){return this.m_enableMotor},k.prototype.EnableMotor=function(B){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=B},k.prototype.SetMotorSpeed=function(B){B===void 0&&(B=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=B},k.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},k.prototype.SetMaxMotorForce=function(B){B===void 0&&(B=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=B},k.prototype.GetMotorForce=function(){return this.m_motorImpulse},k.prototype.b2PrismaticJoint=function(B){this.__super.b2Joint.call(this,B),this.m_localAnchor1.SetV(B.localAnchorA),this.m_localAnchor2.SetV(B.localAnchorB),this.m_localXAxis1.SetV(B.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=B.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=B.lowerTranslation,this.m_upperTranslation=B.upperTranslation,this.m_maxMotorForce=B.maxMotorForce,this.m_motorSpeed=B.motorSpeed,this.m_enableLimit=B.enableLimit,this.m_enableMotor=B.enableMotor,this.m_limitState=y.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},k.prototype.InitVelocityConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A,D=0;this.m_localCenterA.SetV(I.GetLocalCenter()),this.m_localCenterB.SetV(F.GetLocalCenter());var W=I.GetTransform();F.GetTransform(),A=I.m_xf.R;var U=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;D=A.col1.x*U+A.col2.x*u,u=A.col1.y*U+A.col2.y*u,U=D,A=F.m_xf.R;var g=this.m_localAnchor2.x-this.m_localCenterB.x,V=this.m_localAnchor2.y-this.m_localCenterB.y;D=A.col1.x*g+A.col2.x*V,V=A.col1.y*g+A.col2.y*V,g=D;var d=F.m_sweep.c.x+g-I.m_sweep.c.x-U,w=F.m_sweep.c.y+V-I.m_sweep.c.y-u;this.m_invMassA=I.m_invMass,this.m_invMassB=F.m_invMass,this.m_invIA=I.m_invI,this.m_invIB=F.m_invI,this.m_axis.SetV(r.MulMV(W.R,this.m_localXAxis1)),this.m_a1=(d+U)*this.m_axis.y-(w+u)*this.m_axis.x,this.m_a2=g*this.m_axis.y-V*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass);{this.m_perp.SetV(r.MulMV(W.R,this.m_localYAxis1)),this.m_s1=(d+U)*this.m_perp.y-(w+u)*this.m_perp.x,this.m_s2=g*this.m_perp.y-V*this.m_perp.x;var m=this.m_invMassA,P=this.m_invMassB,T=this.m_invIA,L=this.m_invIB;this.m_K.col1.x=m+P+T*this.m_s1*this.m_s1+L*this.m_s2*this.m_s2,this.m_K.col1.y=T*this.m_s1+L*this.m_s2,this.m_K.col1.z=T*this.m_s1*this.m_a1+L*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=T+L,this.m_K.col2.z=T*this.m_a1+L*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m+P+T*this.m_a1*this.m_a1+L*this.m_a2*this.m_a2}if(this.m_enableLimit){var O=this.m_axis.x*d+this.m_axis.y*w;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop?this.m_limitState=y.e_equalLimits:O<=this.m_lowerTranslation?this.m_limitState!=y.e_atLowerLimit&&(this.m_limitState=y.e_atLowerLimit,this.m_impulse.z=0):O>=this.m_upperTranslation?this.m_limitState!=y.e_atUpperLimit&&(this.m_limitState=y.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=y.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=y.e_inactiveLimit;if(this.m_enableMotor==!1&&(this.m_motorImpulse=0),B.warmStarting){this.m_impulse.x*=B.dtRatio,this.m_impulse.y*=B.dtRatio,this.m_motorImpulse*=B.dtRatio;var R=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,z=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,q=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,X=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;I.m_linearVelocity.x-=this.m_invMassA*R,I.m_linearVelocity.y-=this.m_invMassA*z,I.m_angularVelocity-=this.m_invIA*q,F.m_linearVelocity.x+=this.m_invMassB*R,F.m_linearVelocity.y+=this.m_invMassB*z,F.m_angularVelocity+=this.m_invIB*X}else this.m_impulse.SetZero(),this.m_motorImpulse=0},k.prototype.SolveVelocityConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A=I.m_linearVelocity,D=I.m_angularVelocity,W=F.m_linearVelocity,U=F.m_angularVelocity,u=0,g=0,V=0,d=0;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var w=this.m_axis.x*(W.x-A.x)+this.m_axis.y*(W.y-A.y)+this.m_a2*U-this.m_a1*D,m=this.m_motorMass*(this.m_motorSpeed-w),P=this.m_motorImpulse,T=B.dt*this.m_maxMotorForce;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+m,-T,T),m=this.m_motorImpulse-P,u=m*this.m_axis.x,g=m*this.m_axis.y,V=m*this.m_a1,d=m*this.m_a2,A.x-=this.m_invMassA*u,A.y-=this.m_invMassA*g,D-=this.m_invIA*V,W.x+=this.m_invMassB*u,W.y+=this.m_invMassB*g,U+=this.m_invIB*d}var L=this.m_perp.x*(W.x-A.x)+this.m_perp.y*(W.y-A.y)+this.m_s2*U-this.m_s1*D,O=U-D;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var R=this.m_axis.x*(W.x-A.x)+this.m_axis.y*(W.y-A.y)+this.m_a2*U-this.m_a1*D,z=this.m_impulse.Copy(),q=this.m_K.Solve33(new s,-L,-O,-R);this.m_impulse.Add(q),this.m_limitState==y.e_atLowerLimit?this.m_impulse.z=r.Max(this.m_impulse.z,0):this.m_limitState==y.e_atUpperLimit&&(this.m_impulse.z=r.Min(this.m_impulse.z,0));var X=-L-(this.m_impulse.z-z.z)*this.m_K.col3.x,Y=-O-(this.m_impulse.z-z.z)*this.m_K.col3.y,Q=this.m_K.Solve22(new n,X,Y);Q.x+=z.x,Q.y+=z.y,this.m_impulse.x=Q.x,this.m_impulse.y=Q.y,q.x=this.m_impulse.x-z.x,q.y=this.m_impulse.y-z.y,q.z=this.m_impulse.z-z.z,u=q.x*this.m_perp.x+q.z*this.m_axis.x,g=q.x*this.m_perp.y+q.z*this.m_axis.y,V=q.x*this.m_s1+q.y+q.z*this.m_a1,d=q.x*this.m_s2+q.y+q.z*this.m_a2,A.x-=this.m_invMassA*u,A.y-=this.m_invMassA*g,D-=this.m_invIA*V,W.x+=this.m_invMassB*u,W.y+=this.m_invMassB*g,U+=this.m_invIB*d}else{var tt=this.m_K.Solve22(new n,-L,-O);this.m_impulse.x+=tt.x,this.m_impulse.y+=tt.y,u=tt.x*this.m_perp.x,g=tt.x*this.m_perp.y,V=tt.x*this.m_s1+tt.y,d=tt.x*this.m_s2+tt.y,A.x-=this.m_invMassA*u,A.y-=this.m_invMassA*g,D-=this.m_invIA*V,W.x+=this.m_invMassB*u,W.y+=this.m_invMassB*g,U+=this.m_invIB*d}I.m_linearVelocity.SetV(A),I.m_angularVelocity=D,F.m_linearVelocity.SetV(W),F.m_angularVelocity=U},k.prototype.SolvePositionConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A=I.m_sweep.c,D=I.m_sweep.a,W=F.m_sweep.c,U=F.m_sweep.a,u,g=0,V=0,d=0,w=0,m=0,P=0,T=0,L=!1,O=0,R=t.FromAngle(D),z=t.FromAngle(U);u=R;var q=this.m_localAnchor1.x-this.m_localCenterA.x,X=this.m_localAnchor1.y-this.m_localCenterA.y;g=u.col1.x*q+u.col2.x*X,X=u.col1.y*q+u.col2.y*X,q=g,u=z;var Y=this.m_localAnchor2.x-this.m_localCenterB.x,Q=this.m_localAnchor2.y-this.m_localCenterB.y;g=u.col1.x*Y+u.col2.x*Q,Q=u.col1.y*Y+u.col2.y*Q,Y=g;var tt=W.x+Y-A.x-q,at=W.y+Q-A.y-X;if(this.m_enableLimit){this.m_axis=r.MulMV(R,this.m_localXAxis1),this.m_a1=(tt+q)*this.m_axis.y-(at+X)*this.m_axis.x,this.m_a2=Y*this.m_axis.y-Q*this.m_axis.x;var et=this.m_axis.x*tt+this.m_axis.y*at;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*i.b2_linearSlop?(O=r.Clamp(et,-i.b2_maxLinearCorrection,i.b2_maxLinearCorrection),P=r.Abs(et),L=!0):et<=this.m_lowerTranslation?(O=r.Clamp(et-this.m_lowerTranslation+i.b2_linearSlop,-i.b2_maxLinearCorrection,0),P=this.m_lowerTranslation-et,L=!0):et>=this.m_upperTranslation&&(O=r.Clamp(et-this.m_upperTranslation+i.b2_linearSlop,0,i.b2_maxLinearCorrection),P=et-this.m_upperTranslation,L=!0)}this.m_perp=r.MulMV(R,this.m_localYAxis1),this.m_s1=(tt+q)*this.m_perp.y-(at+X)*this.m_perp.x,this.m_s2=Y*this.m_perp.y-Q*this.m_perp.x;var st=new s,lt=this.m_perp.x*tt+this.m_perp.y*at,Z=U-D-this.m_refAngle;if(P=r.Max(P,r.Abs(lt)),T=r.Abs(Z),L)V=this.m_invMassA,d=this.m_invMassB,w=this.m_invIA,m=this.m_invIB,this.m_K.col1.x=V+d+w*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,this.m_K.col1.y=w*this.m_s1+m*this.m_s2,this.m_K.col1.z=w*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=w+m,this.m_K.col2.z=w*this.m_a1+m*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=V+d+w*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2,this.m_K.Solve33(st,-lt,-Z,-O);else{V=this.m_invMassA,d=this.m_invMassB,w=this.m_invIA,m=this.m_invIB;var it=V+d+w*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2,ft=w*this.m_s1+m*this.m_s2,ut=w+m;this.m_K.col1.Set(it,ft,0),this.m_K.col2.Set(ft,ut,0);var dt=this.m_K.Solve22(new n,-lt,-Z);st.x=dt.x,st.y=dt.y,st.z=0}var pt=st.x*this.m_perp.x+st.z*this.m_axis.x,mt=st.x*this.m_perp.y+st.z*this.m_axis.y,Ct=st.x*this.m_s1+st.y+st.z*this.m_a1,kt=st.x*this.m_s2+st.y+st.z*this.m_a2;return A.x-=this.m_invMassA*pt,A.y-=this.m_invMassA*mt,D-=this.m_invIA*Ct,W.x+=this.m_invMassB*pt,W.y+=this.m_invMassB*mt,U+=this.m_invIB*kt,I.m_sweep.a=D,F.m_sweep.a=U,I.SynchronizeTransform(),F.SynchronizeTransform(),P<=i.b2_linearSlop&&T<=i.b2_angularSlop},p.inherit(J,p.Dynamics.Joints.b2JointDef),J.prototype.__super=p.Dynamics.Joints.b2JointDef.prototype,J.b2PrismaticJointDef=function(){p.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},J.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},J.prototype.Initialize=function(B,I,F,A){this.bodyA=B,this.bodyB=I,this.localAnchorA=this.bodyA.GetLocalPoint(F),this.localAnchorB=this.bodyB.GetLocalPoint(F),this.localAxisA=this.bodyA.GetLocalVector(A),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},p.inherit(N,p.Dynamics.Joints.b2Joint),N.prototype.__super=p.Dynamics.Joints.b2Joint.prototype,N.b2PulleyJoint=function(){p.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u1=new n,this.m_u2=new n},N.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},N.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},N.prototype.GetReactionForce=function(B){return B===void 0&&(B=0),new n(B*this.m_impulse*this.m_u2.x,B*this.m_impulse*this.m_u2.y)},N.prototype.GetReactionTorque=function(B){return 0},N.prototype.GetGroundAnchorA=function(){var B=this.m_ground.m_xf.position.Copy();return B.Add(this.m_groundAnchor1),B},N.prototype.GetGroundAnchorB=function(){var B=this.m_ground.m_xf.position.Copy();return B.Add(this.m_groundAnchor2),B},N.prototype.GetLength1=function(){var B=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),I=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,F=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,A=B.x-I,D=B.y-F;return Math.sqrt(A*A+D*D)},N.prototype.GetLength2=function(){var B=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),I=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,F=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,A=B.x-I,D=B.y-F;return Math.sqrt(A*A+D*D)},N.prototype.GetRatio=function(){return this.m_ratio},N.prototype.b2PulleyJoint=function(B){this.__super.b2Joint.call(this,B),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=B.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=B.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=B.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=B.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(B.localAnchorA),this.m_localAnchor2.SetV(B.localAnchorB),this.m_ratio=B.ratio,this.m_constant=B.lengthA+this.m_ratio*B.lengthB,this.m_maxLength1=r.Min(B.maxLengthA,this.m_constant-this.m_ratio*N.b2_minPulleyLength),this.m_maxLength2=r.Min(B.maxLengthB,(this.m_constant-N.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},N.prototype.InitVelocityConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A;A=I.m_xf.R;var D=this.m_localAnchor1.x-I.m_sweep.localCenter.x,W=this.m_localAnchor1.y-I.m_sweep.localCenter.y,U=A.col1.x*D+A.col2.x*W;W=A.col1.y*D+A.col2.y*W,D=U,A=F.m_xf.R;var u=this.m_localAnchor2.x-F.m_sweep.localCenter.x,g=this.m_localAnchor2.y-F.m_sweep.localCenter.y;U=A.col1.x*u+A.col2.x*g,g=A.col1.y*u+A.col2.y*g,u=U;var V=I.m_sweep.c.x+D,d=I.m_sweep.c.y+W,w=F.m_sweep.c.x+u,m=F.m_sweep.c.y+g,P=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,T=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,L=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,O=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(V-P,d-T),this.m_u2.Set(w-L,m-O);var R=this.m_u1.Length(),z=this.m_u2.Length();R>i.b2_linearSlop?this.m_u1.Multiply(1/R):this.m_u1.SetZero(),z>i.b2_linearSlop?this.m_u2.Multiply(1/z):this.m_u2.SetZero();var q=this.m_constant-R-this.m_ratio*z;q>0?(this.m_state=y.e_inactiveLimit,this.m_impulse=0):this.m_state=y.e_atUpperLimit,R<this.m_maxLength1?(this.m_limitState1=y.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=y.e_atUpperLimit,z<this.m_maxLength2?(this.m_limitState2=y.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=y.e_atUpperLimit;var X=D*this.m_u1.y-W*this.m_u1.x,Y=u*this.m_u2.y-g*this.m_u2.x;if(this.m_limitMass1=I.m_invMass+I.m_invI*X*X,this.m_limitMass2=F.m_invMass+F.m_invI*Y*Y,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,B.warmStarting){this.m_impulse*=B.dtRatio,this.m_limitImpulse1*=B.dtRatio,this.m_limitImpulse2*=B.dtRatio;var Q=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,tt=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,at=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,et=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;I.m_linearVelocity.x+=I.m_invMass*Q,I.m_linearVelocity.y+=I.m_invMass*tt,I.m_angularVelocity+=I.m_invI*(D*tt-W*Q),F.m_linearVelocity.x+=F.m_invMass*at,F.m_linearVelocity.y+=F.m_invMass*et,F.m_angularVelocity+=F.m_invI*(u*et-g*at)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},N.prototype.SolveVelocityConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A;A=I.m_xf.R;var D=this.m_localAnchor1.x-I.m_sweep.localCenter.x,W=this.m_localAnchor1.y-I.m_sweep.localCenter.y,U=A.col1.x*D+A.col2.x*W;W=A.col1.y*D+A.col2.y*W,D=U,A=F.m_xf.R;var u=this.m_localAnchor2.x-F.m_sweep.localCenter.x,g=this.m_localAnchor2.y-F.m_sweep.localCenter.y;U=A.col1.x*u+A.col2.x*g,g=A.col1.y*u+A.col2.y*g,u=U;var V=0,d=0,w=0,m=0,P=0,T=0,L=0,O=0,R=0,z=0,q=0;this.m_state==y.e_atUpperLimit&&(V=I.m_linearVelocity.x+-I.m_angularVelocity*W,d=I.m_linearVelocity.y+I.m_angularVelocity*D,w=F.m_linearVelocity.x+-F.m_angularVelocity*g,m=F.m_linearVelocity.y+F.m_angularVelocity*u,R=-(this.m_u1.x*V+this.m_u1.y*d)-this.m_ratio*(this.m_u2.x*w+this.m_u2.y*m),z=this.m_pulleyMass*-R,q=this.m_impulse,this.m_impulse=r.Max(0,this.m_impulse+z),z=this.m_impulse-q,P=-z*this.m_u1.x,T=-z*this.m_u1.y,L=-this.m_ratio*z*this.m_u2.x,O=-this.m_ratio*z*this.m_u2.y,I.m_linearVelocity.x+=I.m_invMass*P,I.m_linearVelocity.y+=I.m_invMass*T,I.m_angularVelocity+=I.m_invI*(D*T-W*P),F.m_linearVelocity.x+=F.m_invMass*L,F.m_linearVelocity.y+=F.m_invMass*O,F.m_angularVelocity+=F.m_invI*(u*O-g*L)),this.m_limitState1==y.e_atUpperLimit&&(V=I.m_linearVelocity.x+-I.m_angularVelocity*W,d=I.m_linearVelocity.y+I.m_angularVelocity*D,R=-(this.m_u1.x*V+this.m_u1.y*d),z=-this.m_limitMass1*R,q=this.m_limitImpulse1,this.m_limitImpulse1=r.Max(0,this.m_limitImpulse1+z),z=this.m_limitImpulse1-q,P=-z*this.m_u1.x,T=-z*this.m_u1.y,I.m_linearVelocity.x+=I.m_invMass*P,I.m_linearVelocity.y+=I.m_invMass*T,I.m_angularVelocity+=I.m_invI*(D*T-W*P)),this.m_limitState2==y.e_atUpperLimit&&(w=F.m_linearVelocity.x+-F.m_angularVelocity*g,m=F.m_linearVelocity.y+F.m_angularVelocity*u,R=-(this.m_u2.x*w+this.m_u2.y*m),z=-this.m_limitMass2*R,q=this.m_limitImpulse2,this.m_limitImpulse2=r.Max(0,this.m_limitImpulse2+z),z=this.m_limitImpulse2-q,L=-z*this.m_u2.x,O=-z*this.m_u2.y,F.m_linearVelocity.x+=F.m_invMass*L,F.m_linearVelocity.y+=F.m_invMass*O,F.m_angularVelocity+=F.m_invI*(u*O-g*L))},N.prototype.SolvePositionConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A,D=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,W=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,U=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,g=0,V=0,d=0,w=0,m=0,P=0,T=0,L=0,O=0,R=0,z=0,q=0,X=0,Y=0;return this.m_state==y.e_atUpperLimit&&(A=I.m_xf.R,g=this.m_localAnchor1.x-I.m_sweep.localCenter.x,V=this.m_localAnchor1.y-I.m_sweep.localCenter.y,X=A.col1.x*g+A.col2.x*V,V=A.col1.y*g+A.col2.y*V,g=X,A=F.m_xf.R,d=this.m_localAnchor2.x-F.m_sweep.localCenter.x,w=this.m_localAnchor2.y-F.m_sweep.localCenter.y,X=A.col1.x*d+A.col2.x*w,w=A.col1.y*d+A.col2.y*w,d=X,m=I.m_sweep.c.x+g,P=I.m_sweep.c.y+V,T=F.m_sweep.c.x+d,L=F.m_sweep.c.y+w,this.m_u1.Set(m-D,P-W),this.m_u2.Set(T-U,L-u),O=this.m_u1.Length(),R=this.m_u2.Length(),O>i.b2_linearSlop?this.m_u1.Multiply(1/O):this.m_u1.SetZero(),R>i.b2_linearSlop?this.m_u2.Multiply(1/R):this.m_u2.SetZero(),z=this.m_constant-O-this.m_ratio*R,Y=r.Max(Y,-z),z=r.Clamp(z+i.b2_linearSlop,-i.b2_maxLinearCorrection,0),q=-this.m_pulleyMass*z,m=-q*this.m_u1.x,P=-q*this.m_u1.y,T=-this.m_ratio*q*this.m_u2.x,L=-this.m_ratio*q*this.m_u2.y,I.m_sweep.c.x+=I.m_invMass*m,I.m_sweep.c.y+=I.m_invMass*P,I.m_sweep.a+=I.m_invI*(g*P-V*m),F.m_sweep.c.x+=F.m_invMass*T,F.m_sweep.c.y+=F.m_invMass*L,F.m_sweep.a+=F.m_invI*(d*L-w*T),I.SynchronizeTransform(),F.SynchronizeTransform()),this.m_limitState1==y.e_atUpperLimit&&(A=I.m_xf.R,g=this.m_localAnchor1.x-I.m_sweep.localCenter.x,V=this.m_localAnchor1.y-I.m_sweep.localCenter.y,X=A.col1.x*g+A.col2.x*V,V=A.col1.y*g+A.col2.y*V,g=X,m=I.m_sweep.c.x+g,P=I.m_sweep.c.y+V,this.m_u1.Set(m-D,P-W),O=this.m_u1.Length(),O>i.b2_linearSlop?(this.m_u1.x*=1/O,this.m_u1.y*=1/O):this.m_u1.SetZero(),z=this.m_maxLength1-O,Y=r.Max(Y,-z),z=r.Clamp(z+i.b2_linearSlop,-i.b2_maxLinearCorrection,0),q=-this.m_limitMass1*z,m=-q*this.m_u1.x,P=-q*this.m_u1.y,I.m_sweep.c.x+=I.m_invMass*m,I.m_sweep.c.y+=I.m_invMass*P,I.m_sweep.a+=I.m_invI*(g*P-V*m),I.SynchronizeTransform()),this.m_limitState2==y.e_atUpperLimit&&(A=F.m_xf.R,d=this.m_localAnchor2.x-F.m_sweep.localCenter.x,w=this.m_localAnchor2.y-F.m_sweep.localCenter.y,X=A.col1.x*d+A.col2.x*w,w=A.col1.y*d+A.col2.y*w,d=X,T=F.m_sweep.c.x+d,L=F.m_sweep.c.y+w,this.m_u2.Set(T-U,L-u),R=this.m_u2.Length(),R>i.b2_linearSlop?(this.m_u2.x*=1/R,this.m_u2.y*=1/R):this.m_u2.SetZero(),z=this.m_maxLength2-R,Y=r.Max(Y,-z),z=r.Clamp(z+i.b2_linearSlop,-i.b2_maxLinearCorrection,0),q=-this.m_limitMass2*z,T=-q*this.m_u2.x,L=-q*this.m_u2.y,F.m_sweep.c.x+=F.m_invMass*T,F.m_sweep.c.y+=F.m_invMass*L,F.m_sweep.a+=F.m_invI*(d*L-w*T),F.SynchronizeTransform()),Y<i.b2_linearSlop},p.postDefs.push(function(){p.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),p.inherit(H,p.Dynamics.Joints.b2JointDef),H.prototype.__super=p.Dynamics.Joints.b2JointDef.prototype,H.b2PulleyJointDef=function(){p.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new n,this.groundAnchorB=new n,this.localAnchorA=new n,this.localAnchorB=new n},H.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},H.prototype.Initialize=function(B,I,F,A,D,W,U){U===void 0&&(U=0),this.bodyA=B,this.bodyB=I,this.groundAnchorA.SetV(F),this.groundAnchorB.SetV(A),this.localAnchorA=this.bodyA.GetLocalPoint(D),this.localAnchorB=this.bodyB.GetLocalPoint(W);var u=D.x-F.x,g=D.y-F.y;this.lengthA=Math.sqrt(u*u+g*g);var V=W.x-A.x,d=W.y-A.y;this.lengthB=Math.sqrt(V*V+d*d),this.ratio=U;var w=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=w-this.ratio*N.b2_minPulleyLength,this.maxLengthB=(w-N.b2_minPulleyLength)/this.ratio},p.inherit($,p.Dynamics.Joints.b2Joint),$.prototype.__super=p.Dynamics.Joints.b2Joint.prototype,$.b2RevoluteJoint=function(){p.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new t,this.K1=new t,this.K2=new t,this.K3=new t,this.impulse3=new s,this.impulse2=new n,this.reduced=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_impulse=new s,this.m_mass=new e},$.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},$.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},$.prototype.GetReactionForce=function(B){return B===void 0&&(B=0),new n(B*this.m_impulse.x,B*this.m_impulse.y)},$.prototype.GetReactionTorque=function(B){return B===void 0&&(B=0),B*this.m_impulse.z},$.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},$.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},$.prototype.IsLimitEnabled=function(){return this.m_enableLimit},$.prototype.EnableLimit=function(B){this.m_enableLimit=B},$.prototype.GetLowerLimit=function(){return this.m_lowerAngle},$.prototype.GetUpperLimit=function(){return this.m_upperAngle},$.prototype.SetLimits=function(B,I){B===void 0&&(B=0),I===void 0&&(I=0),this.m_lowerAngle=B,this.m_upperAngle=I},$.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},$.prototype.EnableMotor=function(B){this.m_enableMotor=B},$.prototype.SetMotorSpeed=function(B){B===void 0&&(B=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=B},$.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},$.prototype.SetMaxMotorTorque=function(B){B===void 0&&(B=0),this.m_maxMotorTorque=B},$.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},$.prototype.b2RevoluteJoint=function(B){this.__super.b2Joint.call(this,B),this.m_localAnchor1.SetV(B.localAnchorA),this.m_localAnchor2.SetV(B.localAnchorB),this.m_referenceAngle=B.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=B.lowerAngle,this.m_upperAngle=B.upperAngle,this.m_maxMotorTorque=B.maxMotorTorque,this.m_motorSpeed=B.motorSpeed,this.m_enableLimit=B.enableLimit,this.m_enableMotor=B.enableMotor,this.m_limitState=y.e_inactiveLimit},$.prototype.InitVelocityConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A,D=0;this.m_enableMotor||this.m_enableLimit,A=I.m_xf.R;var W=this.m_localAnchor1.x-I.m_sweep.localCenter.x,U=this.m_localAnchor1.y-I.m_sweep.localCenter.y;D=A.col1.x*W+A.col2.x*U,U=A.col1.y*W+A.col2.y*U,W=D,A=F.m_xf.R;var u=this.m_localAnchor2.x-F.m_sweep.localCenter.x,g=this.m_localAnchor2.y-F.m_sweep.localCenter.y;D=A.col1.x*u+A.col2.x*g,g=A.col1.y*u+A.col2.y*g,u=D;var V=I.m_invMass,d=F.m_invMass,w=I.m_invI,m=F.m_invI;if(this.m_mass.col1.x=V+d+U*U*w+g*g*m,this.m_mass.col2.x=-U*W*w-g*u*m,this.m_mass.col3.x=-U*w-g*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=V+d+W*W*w+u*u*m,this.m_mass.col3.y=W*w+u*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=w+m,this.m_motorMass=1/(w+m),this.m_enableMotor==!1&&(this.m_motorImpulse=0),this.m_enableLimit){var P=F.m_sweep.a-I.m_sweep.a-this.m_referenceAngle;r.Abs(this.m_upperAngle-this.m_lowerAngle)<2*i.b2_angularSlop?this.m_limitState=y.e_equalLimits:P<=this.m_lowerAngle?(this.m_limitState!=y.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=y.e_atLowerLimit):P>=this.m_upperAngle?(this.m_limitState!=y.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=y.e_atUpperLimit):(this.m_limitState=y.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=y.e_inactiveLimit;if(B.warmStarting){this.m_impulse.x*=B.dtRatio,this.m_impulse.y*=B.dtRatio,this.m_motorImpulse*=B.dtRatio;var T=this.m_impulse.x,L=this.m_impulse.y;I.m_linearVelocity.x-=V*T,I.m_linearVelocity.y-=V*L,I.m_angularVelocity-=w*(W*L-U*T+this.m_motorImpulse+this.m_impulse.z),F.m_linearVelocity.x+=d*T,F.m_linearVelocity.y+=d*L,F.m_angularVelocity+=m*(u*L-g*T+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},$.prototype.SolveVelocityConstraints=function(B){var I=this.m_bodyA,F=this.m_bodyB,A,D=0,W=0,U=0,u=0,g=0,V=0,d=I.m_linearVelocity,w=I.m_angularVelocity,m=F.m_linearVelocity,P=F.m_angularVelocity,T=I.m_invMass,L=F.m_invMass,O=I.m_invI,R=F.m_invI;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var z=P-w-this.m_motorSpeed,q=this.m_motorMass*-z,X=this.m_motorImpulse,Y=B.dt*this.m_maxMotorTorque;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+q,-Y,Y),q=this.m_motorImpulse-X,w-=O*q,P+=R*q}if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){A=I.m_xf.R,U=this.m_localAnchor1.x-I.m_sweep.localCenter.x,u=this.m_localAnchor1.y-I.m_sweep.localCenter.y,D=A.col1.x*U+A.col2.x*u,u=A.col1.y*U+A.col2.y*u,U=D,A=F.m_xf.R,g=this.m_localAnchor2.x-F.m_sweep.localCenter.x,V=this.m_localAnchor2.y-F.m_sweep.localCenter.y,D=A.col1.x*g+A.col2.x*V,V=A.col1.y*g+A.col2.y*V,g=D;var Q=m.x+-P*V-d.x- -w*u,tt=m.y+P*g-d.y-w*U,at=P-w;this.m_mass.Solve33(this.impulse3,-Q,-tt,-at),this.m_limitState==y.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==y.e_atLowerLimit?(W=this.m_impulse.z+this.impulse3.z,W<0&&(this.m_mass.Solve22(this.reduced,-Q,-tt),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==y.e_atUpperLimit&&(W=this.m_impulse.z+this.impulse3.z,W>0&&(this.m_mass.Solve22(this.reduced,-Q,-tt),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),d.x-=T*this.impulse3.x,d.y-=T*this.impulse3.y,w-=O*(U*this.impulse3.y-u*this.impulse3.x+this.impulse3.z),m.x+=L*this.impulse3.x,m.y+=L*this.impulse3.y,P+=R*(g*this.impulse3.y-V*this.impulse3.x+this.impulse3.z)}else{A=I.m_xf.R,U=this.m_localAnchor1.x-I.m_sweep.localCenter.x,u=this.m_localAnchor1.y-I.m_sweep.localCenter.y,D=A.col1.x*U+A.col2.x*u,u=A.col1.y*U+A.col2.y*u,U=D,A=F.m_xf.R,g=this.m_localAnchor2.x-F.m_sweep.localCenter.x,V=this.m_localAnchor2.y-F.m_sweep.localCenter.y,D=A.col1.x*g+A.col2.x*V,V=A.col1.y*g+A.col2.y*V,g=D;var et=m.x+-P*V-d.x- -w*u,st=m.y+P*g-d.y-w*U;this.m_mass.Solve22(this.impulse2,-et,-st),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,d.x-=T*this.impulse2.x,d.y-=T*this.impulse2.y,w-=O*(U*this.impulse2.y-u*this.impulse2.x),m.x+=L*this.impulse2.x,m.y+=L*this.impulse2.y,P+=R*(g*this.impulse2.y-V*this.impulse2.x)}I.m_linearVelocity.SetV(d),I.m_angularVelocity=w,F.m_linearVelocity.SetV(m),F.m_angularVelocity=P},$.prototype.SolvePositionConstraints=function(B){var I=0,F,A=this.m_bodyA,D=this.m_bodyB,W=0,U=0,u=0,g=0,V=0;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var d=D.m_sweep.a-A.m_sweep.a-this.m_referenceAngle,w=0;this.m_limitState==y.e_equalLimits?(I=r.Clamp(d-this.m_lowerAngle,-i.b2_maxAngularCorrection,i.b2_maxAngularCorrection),w=-this.m_motorMass*I,W=r.Abs(I)):this.m_limitState==y.e_atLowerLimit?(I=d-this.m_lowerAngle,W=-I,I=r.Clamp(I+i.b2_angularSlop,-i.b2_maxAngularCorrection,0),w=-this.m_motorMass*I):this.m_limitState==y.e_atUpperLimit&&(I=d-this.m_upperAngle,W=I,I=r.Clamp(I-i.b2_angularSlop,0,i.b2_maxAngularCorrection),w=-this.m_motorMass*I),A.m_sweep.a-=A.m_invI*w,D.m_sweep.a+=D.m_invI*w,A.SynchronizeTransform(),D.SynchronizeTransform()}{F=A.m_xf.R;var m=this.m_localAnchor1.x-A.m_sweep.localCenter.x,P=this.m_localAnchor1.y-A.m_sweep.localCenter.y;u=F.col1.x*m+F.col2.x*P,P=F.col1.y*m+F.col2.y*P,m=u,F=D.m_xf.R;var T=this.m_localAnchor2.x-D.m_sweep.localCenter.x,L=this.m_localAnchor2.y-D.m_sweep.localCenter.y;u=F.col1.x*T+F.col2.x*L,L=F.col1.y*T+F.col2.y*L,T=u;var O=D.m_sweep.c.x+T-A.m_sweep.c.x-m,R=D.m_sweep.c.y+L-A.m_sweep.c.y-P,z=O*O+R*R,q=Math.sqrt(z);U=q;var X=A.m_invMass,Y=D.m_invMass,Q=A.m_invI,tt=D.m_invI,at=10*i.b2_linearSlop;if(z>at*at){var et=X+Y,st=1/et;g=st*-O,V=st*-R;var lt=.5;A.m_sweep.c.x-=lt*X*g,A.m_sweep.c.y-=lt*X*V,D.m_sweep.c.x+=lt*Y*g,D.m_sweep.c.y+=lt*Y*V,O=D.m_sweep.c.x+T-A.m_sweep.c.x-m,R=D.m_sweep.c.y+L-A.m_sweep.c.y-P}this.K1.col1.x=X+Y,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=X+Y,this.K2.col1.x=Q*P*P,this.K2.col2.x=-Q*m*P,this.K2.col1.y=-Q*m*P,this.K2.col2.y=Q*m*m,this.K3.col1.x=tt*L*L,this.K3.col2.x=-tt*T*L,this.K3.col1.y=-tt*T*L,this.K3.col2.y=tt*T*T,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve($.tImpulse,-O,-R),g=$.tImpulse.x,V=$.tImpulse.y,A.m_sweep.c.x-=A.m_invMass*g,A.m_sweep.c.y-=A.m_invMass*V,A.m_sweep.a-=A.m_invI*(m*V-P*g),D.m_sweep.c.x+=D.m_invMass*g,D.m_sweep.c.y+=D.m_invMass*V,D.m_sweep.a+=D.m_invI*(T*V-L*g),A.SynchronizeTransform(),D.SynchronizeTransform()}return U<=i.b2_linearSlop&&W<=i.b2_angularSlop},p.postDefs.push(function(){p.Dynamics.Joints.b2RevoluteJoint.tImpulse=new n}),p.inherit(j,p.Dynamics.Joints.b2JointDef),j.prototype.__super=p.Dynamics.Joints.b2JointDef.prototype,j.b2RevoluteJointDef=function(){p.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},j.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},j.prototype.Initialize=function(B,I,F){this.bodyA=B,this.bodyB=I,this.localAnchorA=this.bodyA.GetLocalPoint(F),this.localAnchorB=this.bodyB.GetLocalPoint(F),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},p.inherit(K,p.Dynamics.Joints.b2Joint),K.prototype.__super=p.Dynamics.Joints.b2Joint.prototype,K.b2WeldJoint=function(){p.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_impulse=new s,this.m_mass=new e},K.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},K.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},K.prototype.GetReactionForce=function(B){return B===void 0&&(B=0),new n(B*this.m_impulse.x,B*this.m_impulse.y)},K.prototype.GetReactionTorque=function(B){return B===void 0&&(B=0),B*this.m_impulse.z},K.prototype.b2WeldJoint=function(B){this.__super.b2Joint.call(this,B),this.m_localAnchorA.SetV(B.localAnchorA),this.m_localAnchorB.SetV(B.localAnchorB),this.m_referenceAngle=B.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new e},K.prototype.InitVelocityConstraints=function(B){var I,F=0,A=this.m_bodyA,D=this.m_bodyB;I=A.m_xf.R;var W=this.m_localAnchorA.x-A.m_sweep.localCenter.x,U=this.m_localAnchorA.y-A.m_sweep.localCenter.y;F=I.col1.x*W+I.col2.x*U,U=I.col1.y*W+I.col2.y*U,W=F,I=D.m_xf.R;var u=this.m_localAnchorB.x-D.m_sweep.localCenter.x,g=this.m_localAnchorB.y-D.m_sweep.localCenter.y;F=I.col1.x*u+I.col2.x*g,g=I.col1.y*u+I.col2.y*g,u=F;var V=A.m_invMass,d=D.m_invMass,w=A.m_invI,m=D.m_invI;this.m_mass.col1.x=V+d+U*U*w+g*g*m,this.m_mass.col2.x=-U*W*w-g*u*m,this.m_mass.col3.x=-U*w-g*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=V+d+W*W*w+u*u*m,this.m_mass.col3.y=W*w+u*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=w+m,B.warmStarting?(this.m_impulse.x*=B.dtRatio,this.m_impulse.y*=B.dtRatio,this.m_impulse.z*=B.dtRatio,A.m_linearVelocity.x-=V*this.m_impulse.x,A.m_linearVelocity.y-=V*this.m_impulse.y,A.m_angularVelocity-=w*(W*this.m_impulse.y-U*this.m_impulse.x+this.m_impulse.z),D.m_linearVelocity.x+=d*this.m_impulse.x,D.m_linearVelocity.y+=d*this.m_impulse.y,D.m_angularVelocity+=m*(u*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},K.prototype.SolveVelocityConstraints=function(B){var I,F=0,A=this.m_bodyA,D=this.m_bodyB,W=A.m_linearVelocity,U=A.m_angularVelocity,u=D.m_linearVelocity,g=D.m_angularVelocity,V=A.m_invMass,d=D.m_invMass,w=A.m_invI,m=D.m_invI;I=A.m_xf.R;var P=this.m_localAnchorA.x-A.m_sweep.localCenter.x,T=this.m_localAnchorA.y-A.m_sweep.localCenter.y;F=I.col1.x*P+I.col2.x*T,T=I.col1.y*P+I.col2.y*T,P=F,I=D.m_xf.R;var L=this.m_localAnchorB.x-D.m_sweep.localCenter.x,O=this.m_localAnchorB.y-D.m_sweep.localCenter.y;F=I.col1.x*L+I.col2.x*O,O=I.col1.y*L+I.col2.y*O,L=F;var R=u.x-g*O-W.x+U*T,z=u.y+g*L-W.y-U*P,q=g-U,X=new s;this.m_mass.Solve33(X,-R,-z,-q),this.m_impulse.Add(X),W.x-=V*X.x,W.y-=V*X.y,U-=w*(P*X.y-T*X.x+X.z),u.x+=d*X.x,u.y+=d*X.y,g+=m*(L*X.y-O*X.x+X.z),A.m_angularVelocity=U,D.m_angularVelocity=g},K.prototype.SolvePositionConstraints=function(B){var I,F=0,A=this.m_bodyA,D=this.m_bodyB;I=A.m_xf.R;var W=this.m_localAnchorA.x-A.m_sweep.localCenter.x,U=this.m_localAnchorA.y-A.m_sweep.localCenter.y;F=I.col1.x*W+I.col2.x*U,U=I.col1.y*W+I.col2.y*U,W=F,I=D.m_xf.R;var u=this.m_localAnchorB.x-D.m_sweep.localCenter.x,g=this.m_localAnchorB.y-D.m_sweep.localCenter.y;F=I.col1.x*u+I.col2.x*g,g=I.col1.y*u+I.col2.y*g,u=F;var V=A.m_invMass,d=D.m_invMass,w=A.m_invI,m=D.m_invI,P=D.m_sweep.c.x+u-A.m_sweep.c.x-W,T=D.m_sweep.c.y+g-A.m_sweep.c.y-U,L=D.m_sweep.a-A.m_sweep.a-this.m_referenceAngle,O=10*i.b2_linearSlop,R=Math.sqrt(P*P+T*T),z=r.Abs(L);R>O&&(w*=1,m*=1),this.m_mass.col1.x=V+d+U*U*w+g*g*m,this.m_mass.col2.x=-U*W*w-g*u*m,this.m_mass.col3.x=-U*w-g*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=V+d+W*W*w+u*u*m,this.m_mass.col3.y=W*w+u*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=w+m;var q=new s;return this.m_mass.Solve33(q,-P,-T,-L),A.m_sweep.c.x-=V*q.x,A.m_sweep.c.y-=V*q.y,A.m_sweep.a-=w*(W*q.y-U*q.x+q.z),D.m_sweep.c.x+=d*q.x,D.m_sweep.c.y+=d*q.y,D.m_sweep.a+=m*(u*q.y-g*q.x+q.z),A.SynchronizeTransform(),D.SynchronizeTransform(),R<=i.b2_linearSlop&&z<=i.b2_angularSlop},p.inherit(rt,p.Dynamics.Joints.b2JointDef),rt.prototype.__super=p.Dynamics.Joints.b2JointDef.prototype,rt.b2WeldJointDef=function(){p.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},rt.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_weldJoint,this.referenceAngle=0},rt.prototype.Initialize=function(B,I,F){this.bodyA=B,this.bodyB=I,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(F)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(F)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var i=p.Dynamics.b2DebugDraw;i.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}},i.prototype._color=function(t,e){return"rgba("+((t&16711680)>>16)+","+((t&65280)>>8)+","+(t&255)+","+e+")"},i.prototype.b2DebugDraw=function(){this.m_drawFlags=0},i.prototype.SetFlags=function(t){t===void 0&&(t=0),this.m_drawFlags=t},i.prototype.GetFlags=function(){return this.m_drawFlags},i.prototype.AppendFlags=function(t){t===void 0&&(t=0),this.m_drawFlags|=t},i.prototype.ClearFlags=function(t){t===void 0&&(t=0),this.m_drawFlags&=~t},i.prototype.SetSprite=function(t){this.m_ctx=t},i.prototype.GetSprite=function(){return this.m_ctx},i.prototype.SetDrawScale=function(t){t===void 0&&(t=0),this.m_drawScale=t},i.prototype.GetDrawScale=function(){return this.m_drawScale},i.prototype.SetLineThickness=function(t){t===void 0&&(t=0),this.m_lineThickness=t,this.m_ctx.strokeWidth=t},i.prototype.GetLineThickness=function(){return this.m_lineThickness},i.prototype.SetAlpha=function(t){t===void 0&&(t=0),this.m_alpha=t},i.prototype.GetAlpha=function(){return this.m_alpha},i.prototype.SetFillAlpha=function(t){t===void 0&&(t=0),this.m_fillAlpha=t},i.prototype.GetFillAlpha=function(){return this.m_fillAlpha},i.prototype.SetXFormScale=function(t){t===void 0&&(t=0),this.m_xformScale=t},i.prototype.GetXFormScale=function(){return this.m_xformScale},i.prototype.DrawPolygon=function(t,e,r){if(e){var n=this.m_ctx,s=this.m_drawScale;n.beginPath(),n.strokeStyle=this._color(r.color,this.m_alpha),n.moveTo(t[0].x*s,t[0].y*s);for(var a=1;a<e;a++)n.lineTo(t[a].x*s,t[a].y*s);n.lineTo(t[0].x*s,t[0].y*s),n.closePath(),n.stroke()}},i.prototype.DrawSolidPolygon=function(t,e,r){if(e){var n=this.m_ctx,s=this.m_drawScale;n.beginPath(),n.strokeStyle=this._color(r.color,this.m_alpha),n.fillStyle=this._color(r.color,this.m_fillAlpha),n.moveTo(t[0].x*s,t[0].y*s);for(var a=1;a<e;a++)n.lineTo(t[a].x*s,t[a].y*s);n.lineTo(t[0].x*s,t[0].y*s),n.closePath(),n.fill(),n.stroke()}},i.prototype.DrawCircle=function(t,e,r){if(e){var n=this.m_ctx,s=this.m_drawScale;n.beginPath(),n.strokeStyle=this._color(r.color,this.m_alpha),n.arc(t.x*s,t.y*s,e*s,0,Math.PI*2,!0),n.closePath(),n.stroke()}},i.prototype.DrawSolidCircle=function(t,e,r,n){if(e){var s=this.m_ctx,a=this.m_drawScale,o=t.x*a,l=t.y*a;s.moveTo(0,0),s.beginPath(),s.strokeStyle=this._color(n.color,this.m_alpha),s.fillStyle=this._color(n.color,this.m_fillAlpha),s.arc(o,l,e*a,0,Math.PI*2,!0),s.moveTo(o,l),s.lineTo((t.x+r.x*e)*a,(t.y+r.y*e)*a),s.closePath(),s.fill(),s.stroke()}},i.prototype.DrawSegment=function(t,e,r){var n=this.m_ctx,s=this.m_drawScale;n.strokeStyle=this._color(r.color,this.m_alpha),n.beginPath(),n.moveTo(t.x*s,t.y*s),n.lineTo(e.x*s,e.y*s),n.closePath(),n.stroke()},i.prototype.DrawTransform=function(t){var e=this.m_ctx,r=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(16711680,this.m_alpha),e.moveTo(t.position.x*r,t.position.y*r),e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*r,(t.position.y+this.m_xformScale*t.R.col1.y)*r),e.strokeStyle=this._color(65280,this.m_alpha),e.moveTo(t.position.x*r,t.position.y*r),e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*r,(t.position.y+this.m_xformScale*t.R.col2.y)*r),e.closePath(),e.stroke()}})();var or;for(or=0;or<p.postDefs.length;++or)p.postDefs[or]();delete p.postDefs;const Se=p;function Mr(){this.dyn=Se.Dynamics,this.shapes=Se.Collision.Shapes,this.math=Se.Common.Math.b2Math,this.cMath=Se.Common.Math,this.joints=Se.Dynamics.Joints,this.STAGE_WIDTH_B2=Ot.consts.STAGE_WIDTH_PIXEL/Ot.consts.METER,this.STAGE_HEIGHT_B2=Ot.consts.STAGE_HEIGHT_PIXEL/Ot.consts.METER,this.ScreenCenterVector=new this.cMath.b2Vec2(this.STAGE_WIDTH_B2/2,this.STAGE_HEIGHT_B2/2)}Mr.prototype.findCustomPropertyValue=function(i,t,e){var r,n,s,a;if(i.customProperties!=null){for(a=i.customProperties,r=0,n=a.length;r<n;r++)if(s=a[r],s.name===t)return s[e]}};Mr.prototype.initDebugDraw=function(i){var t,e=document.getElementById("canvas");return e||(e=document.createElement("canvas"),e.id="canvas",e.style.position="absolute",e.style.left="50%",e.style.top="50%",e.style.transform="translate(-50%, -50%)",e.style.zIndex="100",e.style.pointerEvents="none",document.getElementById("gameContainer").appendChild(e)),e.width=Ot.consts.STAGE_WIDTH_PIXEL,e.height=Ot.consts.STAGE_HEIGHT_PIXEL,e.style.display="block",t=new this.dyn.b2DebugDraw,t.SetSprite(e.getContext("2d")),t.SetDrawScale(100),t.SetFillAlpha(.3),t.SetLineThickness(2),t.SetFlags(this.dyn.b2DebugDraw.e_shapeBit|this.dyn.b2DebugDraw.e_jointBit|this.dyn.b2DebugDraw.e_controllerBit|this.dyn.b2DebugDraw.e_pairBit),i.SetDebugDraw(t)};Mr.prototype.applyForceToCenter=function(i,t){return i.ApplyForce(i.GetWorldVector(t),i.GetWorldCenter())};Se.Dynamics.b2Body.prototype.LogPosition=function(){this.GetPosition()};const Dt=new Mr;var Pr=function(){this.firstNode=null,this.lastNode=null,this.size=0};Pr.prototype.add=function(i,t,e){var r={id:i,data:t,next:null,dataType:e};return this.firstNode===null?(this.firstNode=r,this.lastNode=r):(this.lastNode.next=r,this.lastNode=r),this.size+=1,this.size};Pr.prototype.removeFirst=function(){this.firstNode!==null&&(this.firstNode.next!==null?(this.firstNode=this.firstNode.next,this.size-=1):(this.firstNode=null,this.lastNode=null,this.size=0))};Pr.prototype.getLength=function(){return this.size};var Ii={exports:{}},sn,ma;function nd(){if(ma)return sn;ma=1;var i=(function(){function t(e,r,n,s){if(typeof e!="number")throw new TypeError("statusCode must be a number but was "+typeof e);if(r===null)throw new TypeError("headers cannot be null");if(typeof r!="object")throw new TypeError("headers must be an object but was "+typeof r);this.statusCode=e;var a={};for(var o in r)a[o.toLowerCase()]=r[o];this.headers=a,this.body=n,this.url=s}return t.prototype.isError=function(){return this.statusCode===0||this.statusCode>=400},t.prototype.getBody=function(e){if(this.statusCode===0){var r=new Error("This request to "+this.url+` resulted in a status code of 0. This usually indicates some kind of network error in a browser (e.g. CORS not being set up or the DNS failing to resolve):
`+this.body.toString());throw r.statusCode=this.statusCode,r.headers=this.headers,r.body=this.body,r.url=this.url,r}if(this.statusCode>=300){var r=new Error("Server responded to "+this.url+" with status code "+this.statusCode+`:
`+this.body.toString());throw r.statusCode=this.statusCode,r.headers=this.headers,r.body=this.body,r.url=this.url,r}return!e||typeof this.body=="string"?this.body:this.body.toString(e)},t})();return sn=i,sn}var on,da;function Qc(){if(da)return on;da=1,on=i;function i(f){t.length||e(),t[t.length]=f}var t=[],e,r=0,n=1024;function s(){for(;r<t.length;){var f=r;if(r=r+1,t[f].call(),r>n){for(var _=0,x=t.length-r;_<x;_++)t[_]=t[_+r];t.length-=r,r=0}}t.length=0,r=0}var a=typeof Oe<"u"?Oe:self,o=a.MutationObserver||a.WebKitMutationObserver;typeof o=="function"?e=l(s):e=c(s),i.requestFlush=e;function l(f){var _=1,x=new o(f),y=document.createTextNode("");return x.observe(y,{characterData:!0}),function(){_=-_,y.data=_}}function c(f){return function(){var x=setTimeout(M,0),y=setInterval(M,50);function M(){clearTimeout(x),clearInterval(y),f()}}}return i.makeRequestCallFromTimer=c,on}var an,ya;function yi(){if(ya)return an;ya=1;var i=Qc();function t(){}var e=null,r={};function n(h){try{return h.then}catch(v){return e=v,r}}function s(h,v){try{return h(v)}catch(C){return e=C,r}}function a(h,v,C){try{h(v,C)}catch(E){return e=E,r}}an=o;function o(h){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof h!="function")throw new TypeError("Promise constructor's argument is not a function");this._x=0,this._y=0,this._z=null,this._A=null,h!==t&&G(h,this)}o._B=null,o._C=null,o._D=t,o.prototype.then=function(h,v){if(this.constructor!==o)return l(this,h,v);var C=new o(t);return c(this,new M(h,v,C)),C};function l(h,v,C){return new h.constructor(function(E,k){var J=new o(t);J.then(E,k),c(h,new M(v,C,J))})}function c(h,v){for(;h._y===3;)h=h._z;if(o._B&&o._B(h),h._y===0){if(h._x===0){h._x=1,h._A=v;return}if(h._x===1){h._x=2,h._A=[h._A,v];return}h._A.push(v);return}f(h,v)}function f(h,v){i(function(){var C=h._y===1?v.onFulfilled:v.onRejected;if(C===null){h._y===1?_(v.promise,h._z):x(v.promise,h._z);return}var E=s(C,h._z);E===r?x(v.promise,e):_(v.promise,E)})}function _(h,v){if(v===h)return x(h,new TypeError("A promise cannot be resolved with itself."));if(v&&(typeof v=="object"||typeof v=="function")){var C=n(v);if(C===r)return x(h,e);if(C===h.then&&v instanceof o){h._y=3,h._z=v,y(h);return}else if(typeof C=="function"){G(C.bind(v),h);return}}h._y=1,h._z=v,y(h)}function x(h,v){h._y=2,h._z=v,o._C&&o._C(h,v),y(h)}function y(h){if(h._x===1&&(c(h,h._A),h._A=null),h._x===2){for(var v=0;v<h._A.length;v++)c(h,h._A[v]);h._A=null}}function M(h,v,C){this.onFulfilled=typeof h=="function"?h:null,this.onRejected=typeof v=="function"?v:null,this.promise=C}function G(h,v){var C=!1,E=a(h,function(k){C||(C=!0,_(v,k))},function(k){C||(C=!0,x(v,k))});!C&&E===r&&(C=!0,x(v,e))}return an}var ln,_a;function sd(){if(_a)return ln;_a=1;var i=yi();return ln=i,i.prototype.done=function(t,e){var r=arguments.length?this.then.apply(this,arguments):this;r.then(null,function(n){setTimeout(function(){throw n},0)})},ln}var cn,ga;function od(){if(ga)return cn;ga=1;var i=yi();return cn=i,i.prototype.finally=function(t){return this.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})})},cn}var hn,xa;function ad(){if(xa)return hn;xa=1;var i=yi();hn=i;var t=o(!0),e=o(!1),r=o(null),n=o(void 0),s=o(0),a=o("");function o(y){var M=new i(i._D);return M._y=1,M._z=y,M}i.resolve=function(y){if(y instanceof i)return y;if(y===null)return r;if(y===void 0)return n;if(y===!0)return t;if(y===!1)return e;if(y===0)return s;if(y==="")return a;if(typeof y=="object"||typeof y=="function")try{var M=y.then;if(typeof M=="function")return new i(M.bind(y))}catch(G){return new i(function(h,v){v(G)})}return o(y)};var l=function(y){return typeof Array.from=="function"?(l=Array.from,Array.from(y)):(l=function(M){return Array.prototype.slice.call(M)},Array.prototype.slice.call(y))};i.all=function(y){var M=l(y);return new i(function(G,h){if(M.length===0)return G([]);var v=M.length;function C(k,J){if(J&&(typeof J=="object"||typeof J=="function"))if(J instanceof i&&J.then===i.prototype.then){for(;J._y===3;)J=J._z;if(J._y===1)return C(k,J._z);J._y===2&&h(J._z),J.then(function($){C(k,$)},h);return}else{var N=J.then;if(typeof N=="function"){var H=new i(N.bind(J));H.then(function($){C(k,$)},h);return}}M[k]=J,--v===0&&G(M)}for(var E=0;E<M.length;E++)C(E,M[E])})};function c(y){return{status:"fulfilled",value:y}}function f(y){return{status:"rejected",reason:y}}function _(y){if(y&&(typeof y=="object"||typeof y=="function")){if(y instanceof i&&y.then===i.prototype.then)return y.then(c,f);var M=y.then;if(typeof M=="function")return new i(M.bind(y)).then(c,f)}return c(y)}i.allSettled=function(y){return i.all(l(y).map(_))},i.reject=function(y){return new i(function(M,G){G(y)})},i.race=function(y){return new i(function(M,G){l(y).forEach(function(h){i.resolve(h).then(M,G)})})},i.prototype.catch=function(y){return this.then(null,y)};function x(y){if(typeof AggregateError=="function")return new AggregateError(y,"All promises were rejected");var M=new Error("All promises were rejected");return M.name="AggregateError",M.errors=y,M}return i.any=function(M){return new i(function(G,h){var v=l(M),C=!1,E=[];function k(N){C||(C=!0,G(N))}function J(N){E.push(N),E.length===v.length&&h(x(E))}v.length===0?h(x(E)):v.forEach(function(N){i.resolve(N).then(k,J)})})},hn}var un,va;function ld(){if(va)return un;va=1;var i=Qc(),t=[],e=[],r=i.makeRequestCallFromTimer(n);function n(){if(e.length)throw e.shift()}un=s;function s(o){var l;t.length?l=t.pop():l=new a,l.task=o,i(l)}function a(){this.task=null}return a.prototype.call=function(){try{this.task.call()}catch(o){s.onerror?s.onerror(o):(e.push(o),r())}finally{this.task=null,t[t.length]=this}},un}var fn,ba;function cd(){if(ba)return fn;ba=1;var i=yi(),t=ld();fn=i,i.denodeify=function(s,a){return typeof a=="number"&&a!==1/0?r(s,a):n(s)};var e="function (err, res) {if (err) { rj(err); } else { rs(res); }}";function r(s,a){for(var o=[],l=0;l<a;l++)o.push("a"+l);var c=["return function ("+o.join(",")+") {","var self = this;","return new Promise(function (rs, rj) {","var res = fn.call(",["self"].concat(o).concat([e]).join(","),");","if (res &&",'(typeof res === "object" || typeof res === "function") &&','typeof res.then === "function"',") {rs(res);}","});","};"].join("");return Function(["Promise","fn"],c)(i,s)}function n(s){for(var a=Math.max(s.length-1,3),o=[],l=0;l<a;l++)o.push("a"+l);var c=["return function ("+o.join(",")+") {","var self = this;","var args;","var argLength = arguments.length;","if (arguments.length > "+a+") {","args = new Array(arguments.length + 1);","for (var i = 0; i < arguments.length; i++) {","args[i] = arguments[i];","}","}","return new Promise(function (rs, rj) {","var cb = "+e+";","var res;","switch (argLength) {",o.concat(["extra"]).map(function(f,_){return"case "+_+":res = fn.call("+["self"].concat(o.slice(0,_)).concat("cb").join(",")+");break;"}).join(""),"default:","args[argLength] = cb;","res = fn.apply(self, args);","}","if (res &&",'(typeof res === "object" || typeof res === "function") &&','typeof res.then === "function"',") {rs(res);}","});","};"].join("");return Function(["Promise","fn"],c)(i,s)}return i.nodeify=function(s){return function(){var a=Array.prototype.slice.call(arguments),o=typeof a[a.length-1]=="function"?a.pop():null,l=this;try{return s.apply(this,arguments).nodeify(o,l)}catch(c){if(o===null||typeof o>"u")return new i(function(f,_){_(c)});t(function(){o.call(l,c)})}}},i.prototype.nodeify=function(s,a){if(typeof s!="function")return this;this.then(function(o){t(function(){s.call(a,null,o)})},function(o){t(function(){s.call(a,o)})})},fn}var pn,wa;function hd(){if(wa)return pn;wa=1;var i=yi();return pn=i,i.enableSynchronous=function(){i.prototype.isPending=function(){return this.getState()==0},i.prototype.isFulfilled=function(){return this.getState()==1},i.prototype.isRejected=function(){return this.getState()==2},i.prototype.getValue=function(){if(this._y===3)return this._z.getValue();if(!this.isFulfilled())throw new Error("Cannot get a value of an unfulfilled promise.");return this._z},i.prototype.getReason=function(){if(this._y===3)return this._z.getReason();if(!this.isRejected())throw new Error("Cannot get a rejection reason of a non-rejected promise.");return this._z},i.prototype.getState=function(){return this._y===3?this._z.getState():this._y===-1||this._y===-2?0:this._y}},i.disableSynchronous=function(){i.prototype.isPending=void 0,i.prototype.isFulfilled=void 0,i.prototype.isRejected=void 0,i.prototype.getValue=void 0,i.prototype.getReason=void 0,i.prototype.getState=void 0},pn}var mn,Sa;function ud(){return Sa||(Sa=1,mn=yi(),sd(),od(),ad(),cd(),hd()),mn}var dn,Ca;function jc(){return Ca||(Ca=1,dn=ud()),dn}var yn={},Aa;function fd(){return Aa||(Aa=1,(function(i){i.__esModule=!0,jc();function t(a){return a?a==="utf8"?this.then(n):this.then(e(a)):this.then(r)}function e(a){return function(o){return o.getBody(a)}}function r(a){return a.getBody()}function n(a){return a.getBody("utf8")}function s(a){return a.getBody=t,a}i.default=s,i.ResponsePromise=void 0})(yn)),yn}var _n={},gn,Ma;function _i(){return Ma||(Ma=1,gn=TypeError),gn}const pd={},md=Object.freeze(Object.defineProperty({__proto__:null,default:pd},Symbol.toStringTag,{value:"Module"})),Br=mh(md);var xn,Pa;function dd(){if(Pa)return xn;Pa=1;var i=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=i&&t&&typeof t.get=="function"?t.get:null,r=i&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=n&&s&&typeof s.get=="function"?s.get:null,o=n&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,c=l?WeakMap.prototype.has:null,f=typeof WeakSet=="function"&&WeakSet.prototype,_=f?WeakSet.prototype.has:null,x=typeof WeakRef=="function"&&WeakRef.prototype,y=x?WeakRef.prototype.deref:null,M=Boolean.prototype.valueOf,G=Object.prototype.toString,h=Function.prototype.toString,v=String.prototype.match,C=String.prototype.slice,E=String.prototype.replace,k=String.prototype.toUpperCase,J=String.prototype.toLowerCase,N=RegExp.prototype.test,H=Array.prototype.concat,$=Array.prototype.join,j=Array.prototype.slice,K=Math.floor,rt=typeof BigInt=="function"?BigInt.prototype.valueOf:null,B=Object.getOwnPropertySymbols,I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,F=typeof Symbol=="function"&&typeof Symbol.iterator=="object",A=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===F||!0)?Symbol.toStringTag:null,D=Object.prototype.propertyIsEnumerable,W=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(b){return b.__proto__}:null);function U(b,S){if(b===1/0||b===-1/0||b!==b||b&&b>-1e3&&b<1e3||N.call(/e/,S))return S;var ot=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof b=="number"){var ct=b<0?-K(-b):K(b);if(ct!==b){var ht=String(ct),nt=C.call(S,ht.length+1);return E.call(ht,ot,"$&_")+"."+E.call(E.call(nt,/([0-9]{3})/g,"$&_"),/_$/,"")}}return E.call(S,ot,"$&_")}var u=Br,g=u.custom,V=Q(g)?g:null,d={__proto__:null,double:'"',single:"'"},w={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};xn=function b(S,ot,ct,ht){var nt=ot||{};if(et(nt,"quoteStyle")&&!et(d,nt.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(et(nt,"maxStringLength")&&(typeof nt.maxStringLength=="number"?nt.maxStringLength<0&&nt.maxStringLength!==1/0:nt.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var gt=et(nt,"customInspect")?nt.customInspect:!0;if(typeof gt!="boolean"&&gt!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(et(nt,"indent")&&nt.indent!==null&&nt.indent!=="	"&&!(parseInt(nt.indent,10)===nt.indent&&nt.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(et(nt,"numericSeparator")&&typeof nt.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var vt=nt.numericSeparator;if(typeof S>"u")return"undefined";if(S===null)return"null";if(typeof S=="boolean")return S?"true":"false";if(typeof S=="string")return Ct(S,nt);if(typeof S=="number"){if(S===0)return 1/0/S>0?"0":"-0";var _t=String(S);return vt?U(S,_t):_t}if(typeof S=="bigint"){var At=String(S)+"n";return vt?U(S,At):At}var zt=typeof nt.depth>"u"?5:nt.depth;if(typeof ct>"u"&&(ct=0),ct>=zt&&zt>0&&typeof S=="object")return L(S)?"[Array]":"[Object]";var Tt=Nt(nt,ct);if(typeof ht>"u")ht=[];else if(Z(ht,S)>=0)return"[Circular]";function bt(Rt,oe,Ye){if(oe&&(ht=j.call(ht),ht.push(oe)),Ye){var Be={depth:nt.depth};return et(nt,"quoteStyle")&&(Be.quoteStyle=nt.quoteStyle),b(Rt,Be,ct+1,ht)}return b(Rt,nt,ct+1,ht)}if(typeof S=="function"&&!R(S)){var jt=lt(S),te=Ft(S,bt);return"[Function"+(jt?": "+jt:" (anonymous)")+"]"+(te.length>0?" { "+$.call(te,", ")+" }":"")}if(Q(S)){var ce=F?E.call(String(S),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(S);return typeof S=="object"&&!F?Mt(ce):ce}if(mt(S)){for(var It="<"+J.call(String(S.nodeName)),Qt=S.attributes||[],Ht=0;Ht<Qt.length;Ht++)It+=" "+Qt[Ht].name+"="+m(P(Qt[Ht].value),"double",nt);return It+=">",S.childNodes&&S.childNodes.length&&(It+="..."),It+="</"+J.call(String(S.nodeName))+">",It}if(L(S)){if(S.length===0)return"[]";var ee=Ft(S,bt);return Tt&&!Et(ee)?"["+Vt(ee,Tt)+"]":"[ "+$.call(ee,", ")+" ]"}if(z(S)){var ie=Ft(S,bt);return!("cause"in Error.prototype)&&"cause"in S&&!D.call(S,"cause")?"{ ["+String(S)+"] "+$.call(H.call("[cause]: "+bt(S.cause),ie),", ")+" }":ie.length===0?"["+String(S)+"]":"{ ["+String(S)+"] "+$.call(ie,", ")+" }"}if(typeof S=="object"&&gt){if(V&&typeof S[V]=="function"&&u)return u(S,{depth:zt-ct});if(gt!=="symbol"&&typeof S.inspect=="function")return S.inspect()}if(it(S)){var me=[];return r&&r.call(S,function(Rt,oe){me.push(bt(oe,S,!0)+" => "+bt(Rt,S))}),St("Map",e.call(S),me,Tt)}if(dt(S)){var de=[];return o&&o.call(S,function(Rt){de.push(bt(Rt,S))}),St("Set",a.call(S),de,Tt)}if(ft(S))return yt("WeakMap");if(pt(S))return yt("WeakSet");if(ut(S))return yt("WeakRef");if(X(S))return Mt(bt(Number(S)));if(tt(S))return Mt(bt(rt.call(S)));if(Y(S))return Mt(M.call(S));if(q(S))return Mt(bt(String(S)));if(typeof window<"u"&&S===window)return"{ [object Window] }";if(typeof globalThis<"u"&&S===globalThis||typeof Oe<"u"&&S===Oe)return"{ [object globalThis] }";if(!O(S)&&!R(S)){var re=Ft(S,bt),ye=W?W(S)===Object.prototype:S instanceof Object||S.constructor===Object,ne=S instanceof Object?"":"null prototype",_e=!ye&&A&&Object(S)===S&&A in S?C.call(st(S),8,-1):ne?"Object":"",Pe=ye||typeof S.constructor!="function"?"":S.constructor.name?S.constructor.name+" ":"",se=Pe+(_e||ne?"["+$.call(H.call([],_e||[],ne||[]),": ")+"] ":"");return re.length===0?se+"{}":Tt?se+"{"+Vt(re,Tt)+"}":se+"{ "+$.call(re,", ")+" }"}return String(S)};function m(b,S,ot){var ct=ot.quoteStyle||S,ht=d[ct];return ht+b+ht}function P(b){return E.call(String(b),/"/g,"&quot;")}function T(b){return!A||!(typeof b=="object"&&(A in b||typeof b[A]<"u"))}function L(b){return st(b)==="[object Array]"&&T(b)}function O(b){return st(b)==="[object Date]"&&T(b)}function R(b){return st(b)==="[object RegExp]"&&T(b)}function z(b){return st(b)==="[object Error]"&&T(b)}function q(b){return st(b)==="[object String]"&&T(b)}function X(b){return st(b)==="[object Number]"&&T(b)}function Y(b){return st(b)==="[object Boolean]"&&T(b)}function Q(b){if(F)return b&&typeof b=="object"&&b instanceof Symbol;if(typeof b=="symbol")return!0;if(!b||typeof b!="object"||!I)return!1;try{return I.call(b),!0}catch{}return!1}function tt(b){if(!b||typeof b!="object"||!rt)return!1;try{return rt.call(b),!0}catch{}return!1}var at=Object.prototype.hasOwnProperty||function(b){return b in this};function et(b,S){return at.call(b,S)}function st(b){return G.call(b)}function lt(b){if(b.name)return b.name;var S=v.call(h.call(b),/^function\s*([\w$]+)/);return S?S[1]:null}function Z(b,S){if(b.indexOf)return b.indexOf(S);for(var ot=0,ct=b.length;ot<ct;ot++)if(b[ot]===S)return ot;return-1}function it(b){if(!e||!b||typeof b!="object")return!1;try{e.call(b);try{a.call(b)}catch{return!0}return b instanceof Map}catch{}return!1}function ft(b){if(!c||!b||typeof b!="object")return!1;try{c.call(b,c);try{_.call(b,_)}catch{return!0}return b instanceof WeakMap}catch{}return!1}function ut(b){if(!y||!b||typeof b!="object")return!1;try{return y.call(b),!0}catch{}return!1}function dt(b){if(!a||!b||typeof b!="object")return!1;try{a.call(b);try{e.call(b)}catch{return!0}return b instanceof Set}catch{}return!1}function pt(b){if(!_||!b||typeof b!="object")return!1;try{_.call(b,_);try{c.call(b,c)}catch{return!0}return b instanceof WeakSet}catch{}return!1}function mt(b){return!b||typeof b!="object"?!1:typeof HTMLElement<"u"&&b instanceof HTMLElement?!0:typeof b.nodeName=="string"&&typeof b.getAttribute=="function"}function Ct(b,S){if(b.length>S.maxStringLength){var ot=b.length-S.maxStringLength,ct="... "+ot+" more character"+(ot>1?"s":"");return Ct(C.call(b,0,S.maxStringLength),S)+ct}var ht=w[S.quoteStyle||"single"];ht.lastIndex=0;var nt=E.call(E.call(b,ht,"\\$1"),/[\x00-\x1f]/g,kt);return m(nt,"single",S)}function kt(b){var S=b.charCodeAt(0),ot={8:"b",9:"t",10:"n",12:"f",13:"r"}[S];return ot?"\\"+ot:"\\x"+(S<16?"0":"")+k.call(S.toString(16))}function Mt(b){return"Object("+b+")"}function yt(b){return b+" { ? }"}function St(b,S,ot,ct){var ht=ct?Vt(ot,ct):$.call(ot,", ");return b+" ("+S+") {"+ht+"}"}function Et(b){for(var S=0;S<b.length;S++)if(Z(b[S],`
`)>=0)return!1;return!0}function Nt(b,S){var ot;if(b.indent==="	")ot="	";else if(typeof b.indent=="number"&&b.indent>0)ot=$.call(Array(b.indent+1)," ");else return null;return{base:ot,prev:$.call(Array(S+1),ot)}}function Vt(b,S){if(b.length===0)return"";var ot=`
`+S.prev+S.base;return ot+$.call(b,","+ot)+`
`+S.prev}function Ft(b,S){var ot=L(b),ct=[];if(ot){ct.length=b.length;for(var ht=0;ht<b.length;ht++)ct[ht]=et(b,ht)?S(b[ht],b):""}var nt=typeof B=="function"?B(b):[],gt;if(F){gt={};for(var vt=0;vt<nt.length;vt++)gt["$"+nt[vt]]=nt[vt]}for(var _t in b)et(b,_t)&&(ot&&String(Number(_t))===_t&&_t<b.length||F&&gt["$"+_t]instanceof Symbol||(N.call(/[^\w$]/,_t)?ct.push(S(_t,b)+": "+S(b[_t],b)):ct.push(_t+": "+S(b[_t],b))));if(typeof B=="function")for(var At=0;At<nt.length;At++)D.call(b,nt[At])&&ct.push("["+S(nt[At])+"]: "+S(b[nt[At]],b));return ct}return xn}var vn,Ba;function yd(){if(Ba)return vn;Ba=1;var i=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=i&&t&&typeof t.get=="function"?t.get:null,r=i&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=n&&s&&typeof s.get=="function"?s.get:null,o=n&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,c=l?WeakMap.prototype.has:null,f=typeof WeakSet=="function"&&WeakSet.prototype,_=f?WeakSet.prototype.has:null,x=typeof WeakRef=="function"&&WeakRef.prototype,y=x?WeakRef.prototype.deref:null,M=Boolean.prototype.valueOf,G=Object.prototype.toString,h=Function.prototype.toString,v=String.prototype.match,C=String.prototype.slice,E=String.prototype.replace,k=String.prototype.toUpperCase,J=String.prototype.toLowerCase,N=RegExp.prototype.test,H=Array.prototype.concat,$=Array.prototype.join,j=Array.prototype.slice,K=Math.floor,rt=typeof BigInt=="function"?BigInt.prototype.valueOf:null,B=Object.getOwnPropertySymbols,I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,F=typeof Symbol=="function"&&typeof Symbol.iterator=="object",A=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===F||!0)?Symbol.toStringTag:null,D=Object.prototype.propertyIsEnumerable,W=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(b){return b.__proto__}:null);function U(b,S){if(b===1/0||b===-1/0||b!==b||b&&b>-1e3&&b<1e3||N.call(/e/,S))return S;var ot=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof b=="number"){var ct=b<0?-K(-b):K(b);if(ct!==b){var ht=String(ct),nt=C.call(S,ht.length+1);return E.call(ht,ot,"$&_")+"."+E.call(E.call(nt,/([0-9]{3})/g,"$&_"),/_$/,"")}}return E.call(S,ot,"$&_")}var u=Br,g=u.custom,V=Q(g)?g:null,d={__proto__:null,double:'"',single:"'"},w={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};vn=function b(S,ot,ct,ht){var nt=ot||{};if(et(nt,"quoteStyle")&&!et(d,nt.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(et(nt,"maxStringLength")&&(typeof nt.maxStringLength=="number"?nt.maxStringLength<0&&nt.maxStringLength!==1/0:nt.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var gt=et(nt,"customInspect")?nt.customInspect:!0;if(typeof gt!="boolean"&&gt!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(et(nt,"indent")&&nt.indent!==null&&nt.indent!=="	"&&!(parseInt(nt.indent,10)===nt.indent&&nt.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(et(nt,"numericSeparator")&&typeof nt.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var vt=nt.numericSeparator;if(typeof S>"u")return"undefined";if(S===null)return"null";if(typeof S=="boolean")return S?"true":"false";if(typeof S=="string")return Ct(S,nt);if(typeof S=="number"){if(S===0)return 1/0/S>0?"0":"-0";var _t=String(S);return vt?U(S,_t):_t}if(typeof S=="bigint"){var At=String(S)+"n";return vt?U(S,At):At}var zt=typeof nt.depth>"u"?5:nt.depth;if(typeof ct>"u"&&(ct=0),ct>=zt&&zt>0&&typeof S=="object")return L(S)?"[Array]":"[Object]";var Tt=Nt(nt,ct);if(typeof ht>"u")ht=[];else if(Z(ht,S)>=0)return"[Circular]";function bt(Rt,oe,Ye){if(oe&&(ht=j.call(ht),ht.push(oe)),Ye){var Be={depth:nt.depth};return et(nt,"quoteStyle")&&(Be.quoteStyle=nt.quoteStyle),b(Rt,Be,ct+1,ht)}return b(Rt,nt,ct+1,ht)}if(typeof S=="function"&&!R(S)){var jt=lt(S),te=Ft(S,bt);return"[Function"+(jt?": "+jt:" (anonymous)")+"]"+(te.length>0?" { "+$.call(te,", ")+" }":"")}if(Q(S)){var ce=F?E.call(String(S),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(S);return typeof S=="object"&&!F?Mt(ce):ce}if(mt(S)){for(var It="<"+J.call(String(S.nodeName)),Qt=S.attributes||[],Ht=0;Ht<Qt.length;Ht++)It+=" "+Qt[Ht].name+"="+m(P(Qt[Ht].value),"double",nt);return It+=">",S.childNodes&&S.childNodes.length&&(It+="..."),It+="</"+J.call(String(S.nodeName))+">",It}if(L(S)){if(S.length===0)return"[]";var ee=Ft(S,bt);return Tt&&!Et(ee)?"["+Vt(ee,Tt)+"]":"[ "+$.call(ee,", ")+" ]"}if(z(S)){var ie=Ft(S,bt);return!("cause"in Error.prototype)&&"cause"in S&&!D.call(S,"cause")?"{ ["+String(S)+"] "+$.call(H.call("[cause]: "+bt(S.cause),ie),", ")+" }":ie.length===0?"["+String(S)+"]":"{ ["+String(S)+"] "+$.call(ie,", ")+" }"}if(typeof S=="object"&&gt){if(V&&typeof S[V]=="function"&&u)return u(S,{depth:zt-ct});if(gt!=="symbol"&&typeof S.inspect=="function")return S.inspect()}if(it(S)){var me=[];return r&&r.call(S,function(Rt,oe){me.push(bt(oe,S,!0)+" => "+bt(Rt,S))}),St("Map",e.call(S),me,Tt)}if(dt(S)){var de=[];return o&&o.call(S,function(Rt){de.push(bt(Rt,S))}),St("Set",a.call(S),de,Tt)}if(ft(S))return yt("WeakMap");if(pt(S))return yt("WeakSet");if(ut(S))return yt("WeakRef");if(X(S))return Mt(bt(Number(S)));if(tt(S))return Mt(bt(rt.call(S)));if(Y(S))return Mt(M.call(S));if(q(S))return Mt(bt(String(S)));if(typeof window<"u"&&S===window)return"{ [object Window] }";if(typeof globalThis<"u"&&S===globalThis||typeof Oe<"u"&&S===Oe)return"{ [object globalThis] }";if(!O(S)&&!R(S)){var re=Ft(S,bt),ye=W?W(S)===Object.prototype:S instanceof Object||S.constructor===Object,ne=S instanceof Object?"":"null prototype",_e=!ye&&A&&Object(S)===S&&A in S?C.call(st(S),8,-1):ne?"Object":"",Pe=ye||typeof S.constructor!="function"?"":S.constructor.name?S.constructor.name+" ":"",se=Pe+(_e||ne?"["+$.call(H.call([],_e||[],ne||[]),": ")+"] ":"");return re.length===0?se+"{}":Tt?se+"{"+Vt(re,Tt)+"}":se+"{ "+$.call(re,", ")+" }"}return String(S)};function m(b,S,ot){var ct=ot.quoteStyle||S,ht=d[ct];return ht+b+ht}function P(b){return E.call(String(b),/"/g,"&quot;")}function T(b){return!A||!(typeof b=="object"&&(A in b||typeof b[A]<"u"))}function L(b){return st(b)==="[object Array]"&&T(b)}function O(b){return st(b)==="[object Date]"&&T(b)}function R(b){return st(b)==="[object RegExp]"&&T(b)}function z(b){return st(b)==="[object Error]"&&T(b)}function q(b){return st(b)==="[object String]"&&T(b)}function X(b){return st(b)==="[object Number]"&&T(b)}function Y(b){return st(b)==="[object Boolean]"&&T(b)}function Q(b){if(F)return b&&typeof b=="object"&&b instanceof Symbol;if(typeof b=="symbol")return!0;if(!b||typeof b!="object"||!I)return!1;try{return I.call(b),!0}catch{}return!1}function tt(b){if(!b||typeof b!="object"||!rt)return!1;try{return rt.call(b),!0}catch{}return!1}var at=Object.prototype.hasOwnProperty||function(b){return b in this};function et(b,S){return at.call(b,S)}function st(b){return G.call(b)}function lt(b){if(b.name)return b.name;var S=v.call(h.call(b),/^function\s*([\w$]+)/);return S?S[1]:null}function Z(b,S){if(b.indexOf)return b.indexOf(S);for(var ot=0,ct=b.length;ot<ct;ot++)if(b[ot]===S)return ot;return-1}function it(b){if(!e||!b||typeof b!="object")return!1;try{e.call(b);try{a.call(b)}catch{return!0}return b instanceof Map}catch{}return!1}function ft(b){if(!c||!b||typeof b!="object")return!1;try{c.call(b,c);try{_.call(b,_)}catch{return!0}return b instanceof WeakMap}catch{}return!1}function ut(b){if(!y||!b||typeof b!="object")return!1;try{return y.call(b),!0}catch{}return!1}function dt(b){if(!a||!b||typeof b!="object")return!1;try{a.call(b);try{e.call(b)}catch{return!0}return b instanceof Set}catch{}return!1}function pt(b){if(!_||!b||typeof b!="object")return!1;try{_.call(b,_);try{c.call(b,c)}catch{return!0}return b instanceof WeakSet}catch{}return!1}function mt(b){return!b||typeof b!="object"?!1:typeof HTMLElement<"u"&&b instanceof HTMLElement?!0:typeof b.nodeName=="string"&&typeof b.getAttribute=="function"}function Ct(b,S){if(b.length>S.maxStringLength){var ot=b.length-S.maxStringLength,ct="... "+ot+" more character"+(ot>1?"s":"");return Ct(C.call(b,0,S.maxStringLength),S)+ct}var ht=w[S.quoteStyle||"single"];ht.lastIndex=0;var nt=E.call(E.call(b,ht,"\\$1"),/[\x00-\x1f]/g,kt);return m(nt,"single",S)}function kt(b){var S=b.charCodeAt(0),ot={8:"b",9:"t",10:"n",12:"f",13:"r"}[S];return ot?"\\"+ot:"\\x"+(S<16?"0":"")+k.call(S.toString(16))}function Mt(b){return"Object("+b+")"}function yt(b){return b+" { ? }"}function St(b,S,ot,ct){var ht=ct?Vt(ot,ct):$.call(ot,", ");return b+" ("+S+") {"+ht+"}"}function Et(b){for(var S=0;S<b.length;S++)if(Z(b[S],`
`)>=0)return!1;return!0}function Nt(b,S){var ot;if(b.indent==="	")ot="	";else if(typeof b.indent=="number"&&b.indent>0)ot=$.call(Array(b.indent+1)," ");else return null;return{base:ot,prev:$.call(Array(S+1),ot)}}function Vt(b,S){if(b.length===0)return"";var ot=`
`+S.prev+S.base;return ot+$.call(b,","+ot)+`
`+S.prev}function Ft(b,S){var ot=L(b),ct=[];if(ot){ct.length=b.length;for(var ht=0;ht<b.length;ht++)ct[ht]=et(b,ht)?S(b[ht],b):""}var nt=typeof B=="function"?B(b):[],gt;if(F){gt={};for(var vt=0;vt<nt.length;vt++)gt["$"+nt[vt]]=nt[vt]}for(var _t in b)et(b,_t)&&(ot&&String(Number(_t))===_t&&_t<b.length||F&&gt["$"+_t]instanceof Symbol||(N.call(/[^\w$]/,_t)?ct.push(S(_t,b)+": "+S(b[_t],b)):ct.push(_t+": "+S(b[_t],b))));if(typeof B=="function")for(var At=0;At<nt.length;At++)D.call(b,nt[At])&&ct.push("["+S(nt[At])+"]: "+S(b[nt[At]],b));return ct}return vn}var bn,Ta;function _d(){if(Ta)return bn;Ta=1;var i=yd(),t=_i(),e=function(o,l,c){for(var f=o,_;(_=f.next)!=null;f=_)if(_.key===l)return f.next=_.next,c||(_.next=o.next,o.next=_),_},r=function(o,l){if(o){var c=e(o,l);return c&&c.value}},n=function(o,l,c){var f=e(o,l);f?f.value=c:o.next={key:l,next:o.next,value:c}},s=function(o,l){return o?!!e(o,l):!1},a=function(o,l){if(o)return e(o,l,!0)};return bn=function(){var l,c={assert:function(f){if(!c.has(f))throw new t("Side channel does not contain "+i(f))},delete:function(f){var _=l&&l.next,x=a(l,f);return x&&_&&_===x&&(l=void 0),!!x},get:function(f){return r(l,f)},has:function(f){return s(l,f)},set:function(f,_){l||(l={next:void 0}),n(l,f,_)}};return c},bn}var wn,Ia;function th(){return Ia||(Ia=1,wn=Object),wn}var Sn,Da;function gd(){return Da||(Da=1,Sn=Error),Sn}var Cn,Ea;function xd(){return Ea||(Ea=1,Cn=EvalError),Cn}var An,Ra;function vd(){return Ra||(Ra=1,An=RangeError),An}var Mn,Fa;function bd(){return Fa||(Fa=1,Mn=ReferenceError),Mn}var Pn,ka;function wd(){return ka||(ka=1,Pn=SyntaxError),Pn}var Bn,Va;function Sd(){return Va||(Va=1,Bn=URIError),Bn}var Tn,La;function Cd(){return La||(La=1,Tn=Math.abs),Tn}var In,Ga;function Ad(){return Ga||(Ga=1,In=Math.floor),In}var Dn,Oa;function Md(){return Oa||(Oa=1,Dn=Math.max),Dn}var En,Na;function Pd(){return Na||(Na=1,En=Math.min),En}var Rn,za;function Bd(){return za||(za=1,Rn=Math.pow),Rn}var Fn,Wa;function Td(){return Wa||(Wa=1,Fn=Math.round),Fn}var kn,Ua;function Id(){return Ua||(Ua=1,kn=Number.isNaN||function(t){return t!==t}),kn}var Vn,Ja;function Dd(){if(Ja)return Vn;Ja=1;var i=Id();return Vn=function(e){return i(e)||e===0?e:e<0?-1:1},Vn}var Ln,qa;function Ed(){return qa||(qa=1,Ln=Object.getOwnPropertyDescriptor),Ln}var Gn,Ha;function eh(){if(Ha)return Gn;Ha=1;var i=Ed();if(i)try{i([],"length")}catch{i=null}return Gn=i,Gn}var On,$a;function Rd(){if($a)return On;$a=1;var i=Object.defineProperty||!1;if(i)try{i({},"a",{value:1})}catch{i=!1}return On=i,On}var Nn,Xa;function Fd(){return Xa||(Xa=1,Nn=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var a=Object.getOwnPropertySymbols(t);if(a.length!==1||a[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==n||o.enumerable!==!0)return!1}return!0}),Nn}var zn,Ya;function kd(){if(Ya)return zn;Ya=1;var i=typeof Symbol<"u"&&Symbol,t=Fd();return zn=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},zn}var Wn,Ka;function ih(){return Ka||(Ka=1,Wn=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Wn}var Un,Za;function rh(){if(Za)return Un;Za=1;var i=th();return Un=i.getPrototypeOf||null,Un}var Jn,Qa;function Vd(){if(Qa)return Jn;Qa=1;var i="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,e=Math.max,r="[object Function]",n=function(l,c){for(var f=[],_=0;_<l.length;_+=1)f[_]=l[_];for(var x=0;x<c.length;x+=1)f[x+l.length]=c[x];return f},s=function(l,c){for(var f=[],_=c,x=0;_<l.length;_+=1,x+=1)f[x]=l[_];return f},a=function(o,l){for(var c="",f=0;f<o.length;f+=1)c+=o[f],f+1<o.length&&(c+=l);return c};return Jn=function(l){var c=this;if(typeof c!="function"||t.apply(c)!==r)throw new TypeError(i+c);for(var f=s(arguments,1),_,x=function(){if(this instanceof _){var v=c.apply(this,n(f,arguments));return Object(v)===v?v:this}return c.apply(l,n(f,arguments))},y=e(0,c.length-f.length),M=[],G=0;G<y;G++)M[G]="$"+G;if(_=Function("binder","return function ("+a(M,",")+"){ return binder.apply(this,arguments); }")(x),c.prototype){var h=function(){};h.prototype=c.prototype,_.prototype=new h,h.prototype=null}return _},Jn}var qn,ja;function Tr(){if(ja)return qn;ja=1;var i=Vd();return qn=Function.prototype.bind||i,qn}var Hn,tl;function Xs(){return tl||(tl=1,Hn=Function.prototype.call),Hn}var $n,el;function nh(){return el||(el=1,$n=Function.prototype.apply),$n}var Xn,il;function Ld(){return il||(il=1,Xn=typeof Reflect<"u"&&Reflect&&Reflect.apply),Xn}var Yn,rl;function Gd(){if(rl)return Yn;rl=1;var i=Tr(),t=nh(),e=Xs(),r=Ld();return Yn=r||i.call(e,t),Yn}var Kn,nl;function sh(){if(nl)return Kn;nl=1;var i=Tr(),t=_i(),e=Xs(),r=Gd();return Kn=function(s){if(s.length<1||typeof s[0]!="function")throw new t("a function is required");return r(i,e,s)},Kn}var Zn,sl;function Od(){if(sl)return Zn;sl=1;var i=sh(),t=eh(),e;try{e=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!="object"||!("code"in a)||a.code!=="ERR_PROTO_ACCESS")throw a}var r=!!e&&t&&t(Object.prototype,"__proto__"),n=Object,s=n.getPrototypeOf;return Zn=r&&typeof r.get=="function"?i([r.get]):typeof s=="function"?function(o){return s(o==null?o:n(o))}:!1,Zn}var Qn,ol;function Nd(){if(ol)return Qn;ol=1;var i=ih(),t=rh(),e=Od();return Qn=i?function(n){return i(n)}:t?function(n){if(!n||typeof n!="object"&&typeof n!="function")throw new TypeError("getProto: not an object");return t(n)}:e?function(n){return e(n)}:null,Qn}var jn,al;function zd(){if(al)return jn;al=1;var i=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=Tr();return jn=e.call(i,t),jn}var ts,ll;function Ys(){if(ll)return ts;ll=1;var i,t=th(),e=gd(),r=xd(),n=vd(),s=bd(),a=wd(),o=_i(),l=Sd(),c=Cd(),f=Ad(),_=Md(),x=Pd(),y=Bd(),M=Td(),G=Dd(),h=Function,v=function(R){try{return h('"use strict"; return ('+R+").constructor;")()}catch{}},C=eh(),E=Rd(),k=function(){throw new o},J=C?(function(){try{return arguments.callee,k}catch{try{return C(arguments,"callee").get}catch{return k}}})():k,N=kd()(),H=Nd(),$=rh(),j=ih(),K=nh(),rt=Xs(),B={},I=typeof Uint8Array>"u"||!H?i:H(Uint8Array),F={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":N&&H?H([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":B,"%AsyncGenerator%":B,"%AsyncGeneratorFunction%":B,"%AsyncIteratorPrototype%":B,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?i:Float16Array,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":h,"%GeneratorFunction%":B,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":N&&H?H(H([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!N||!H?i:H(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":C,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":n,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!N||!H?i:H(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":N&&H?H(""[Symbol.iterator]()):i,"%Symbol%":N?Symbol:i,"%SyntaxError%":a,"%ThrowTypeError%":J,"%TypedArray%":I,"%TypeError%":o,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":l,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet,"%Function.prototype.call%":rt,"%Function.prototype.apply%":K,"%Object.defineProperty%":E,"%Object.getPrototypeOf%":$,"%Math.abs%":c,"%Math.floor%":f,"%Math.max%":_,"%Math.min%":x,"%Math.pow%":y,"%Math.round%":M,"%Math.sign%":G,"%Reflect.getPrototypeOf%":j};if(H)try{null.error}catch(R){var A=H(H(R));F["%Error.prototype%"]=A}var D=function R(z){var q;if(z==="%AsyncFunction%")q=v("async function () {}");else if(z==="%GeneratorFunction%")q=v("function* () {}");else if(z==="%AsyncGeneratorFunction%")q=v("async function* () {}");else if(z==="%AsyncGenerator%"){var X=R("%AsyncGeneratorFunction%");X&&(q=X.prototype)}else if(z==="%AsyncIteratorPrototype%"){var Y=R("%AsyncGenerator%");Y&&H&&(q=H(Y.prototype))}return F[z]=q,q},W={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},U=Tr(),u=zd(),g=U.call(rt,Array.prototype.concat),V=U.call(K,Array.prototype.splice),d=U.call(rt,String.prototype.replace),w=U.call(rt,String.prototype.slice),m=U.call(rt,RegExp.prototype.exec),P=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,T=/\\(\\)?/g,L=function(z){var q=w(z,0,1),X=w(z,-1);if(q==="%"&&X!=="%")throw new a("invalid intrinsic syntax, expected closing `%`");if(X==="%"&&q!=="%")throw new a("invalid intrinsic syntax, expected opening `%`");var Y=[];return d(z,P,function(Q,tt,at,et){Y[Y.length]=at?d(et,T,"$1"):tt||Q}),Y},O=function(z,q){var X=z,Y;if(u(W,X)&&(Y=W[X],X="%"+Y[0]+"%"),u(F,X)){var Q=F[X];if(Q===B&&(Q=D(X)),typeof Q>"u"&&!q)throw new o("intrinsic "+z+" exists, but is not available. Please file an issue!");return{alias:Y,name:X,value:Q}}throw new a("intrinsic "+z+" does not exist!")};return ts=function(z,q){if(typeof z!="string"||z.length===0)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof q!="boolean")throw new o('"allowMissing" argument must be a boolean');if(m(/^%?[^%]*%?$/,z)===null)throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var X=L(z),Y=X.length>0?X[0]:"",Q=O("%"+Y+"%",q),tt=Q.name,at=Q.value,et=!1,st=Q.alias;st&&(Y=st[0],V(X,g([0,1],st)));for(var lt=1,Z=!0;lt<X.length;lt+=1){var it=X[lt],ft=w(it,0,1),ut=w(it,-1);if((ft==='"'||ft==="'"||ft==="`"||ut==='"'||ut==="'"||ut==="`")&&ft!==ut)throw new a("property names with quotes must have matching quotes");if((it==="constructor"||!Z)&&(et=!0),Y+="."+it,tt="%"+Y+"%",u(F,tt))at=F[tt];else if(at!=null){if(!(it in at)){if(!q)throw new o("base intrinsic for "+z+" exists, but the property is not available.");return}if(C&&lt+1>=X.length){var dt=C(at,it);Z=!!dt,Z&&"get"in dt&&!("originalValue"in dt.get)?at=dt.get:at=at[it]}else Z=u(at,it),at=at[it];Z&&!et&&(F[tt]=at)}}return at},ts}var es,cl;function oh(){if(cl)return es;cl=1;var i=Ys(),t=sh(),e=t([i("%String.prototype.indexOf%")]);return es=function(n,s){var a=i(n,!!s);return typeof a=="function"&&e(n,".prototype.")>-1?t([a]):a},es}var is,hl;function Wd(){if(hl)return is;hl=1;var i=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=i&&t&&typeof t.get=="function"?t.get:null,r=i&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=n&&s&&typeof s.get=="function"?s.get:null,o=n&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,c=l?WeakMap.prototype.has:null,f=typeof WeakSet=="function"&&WeakSet.prototype,_=f?WeakSet.prototype.has:null,x=typeof WeakRef=="function"&&WeakRef.prototype,y=x?WeakRef.prototype.deref:null,M=Boolean.prototype.valueOf,G=Object.prototype.toString,h=Function.prototype.toString,v=String.prototype.match,C=String.prototype.slice,E=String.prototype.replace,k=String.prototype.toUpperCase,J=String.prototype.toLowerCase,N=RegExp.prototype.test,H=Array.prototype.concat,$=Array.prototype.join,j=Array.prototype.slice,K=Math.floor,rt=typeof BigInt=="function"?BigInt.prototype.valueOf:null,B=Object.getOwnPropertySymbols,I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,F=typeof Symbol=="function"&&typeof Symbol.iterator=="object",A=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===F||!0)?Symbol.toStringTag:null,D=Object.prototype.propertyIsEnumerable,W=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(b){return b.__proto__}:null);function U(b,S){if(b===1/0||b===-1/0||b!==b||b&&b>-1e3&&b<1e3||N.call(/e/,S))return S;var ot=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof b=="number"){var ct=b<0?-K(-b):K(b);if(ct!==b){var ht=String(ct),nt=C.call(S,ht.length+1);return E.call(ht,ot,"$&_")+"."+E.call(E.call(nt,/([0-9]{3})/g,"$&_"),/_$/,"")}}return E.call(S,ot,"$&_")}var u=Br,g=u.custom,V=Q(g)?g:null,d={__proto__:null,double:'"',single:"'"},w={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};is=function b(S,ot,ct,ht){var nt=ot||{};if(et(nt,"quoteStyle")&&!et(d,nt.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(et(nt,"maxStringLength")&&(typeof nt.maxStringLength=="number"?nt.maxStringLength<0&&nt.maxStringLength!==1/0:nt.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var gt=et(nt,"customInspect")?nt.customInspect:!0;if(typeof gt!="boolean"&&gt!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(et(nt,"indent")&&nt.indent!==null&&nt.indent!=="	"&&!(parseInt(nt.indent,10)===nt.indent&&nt.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(et(nt,"numericSeparator")&&typeof nt.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var vt=nt.numericSeparator;if(typeof S>"u")return"undefined";if(S===null)return"null";if(typeof S=="boolean")return S?"true":"false";if(typeof S=="string")return Ct(S,nt);if(typeof S=="number"){if(S===0)return 1/0/S>0?"0":"-0";var _t=String(S);return vt?U(S,_t):_t}if(typeof S=="bigint"){var At=String(S)+"n";return vt?U(S,At):At}var zt=typeof nt.depth>"u"?5:nt.depth;if(typeof ct>"u"&&(ct=0),ct>=zt&&zt>0&&typeof S=="object")return L(S)?"[Array]":"[Object]";var Tt=Nt(nt,ct);if(typeof ht>"u")ht=[];else if(Z(ht,S)>=0)return"[Circular]";function bt(Rt,oe,Ye){if(oe&&(ht=j.call(ht),ht.push(oe)),Ye){var Be={depth:nt.depth};return et(nt,"quoteStyle")&&(Be.quoteStyle=nt.quoteStyle),b(Rt,Be,ct+1,ht)}return b(Rt,nt,ct+1,ht)}if(typeof S=="function"&&!R(S)){var jt=lt(S),te=Ft(S,bt);return"[Function"+(jt?": "+jt:" (anonymous)")+"]"+(te.length>0?" { "+$.call(te,", ")+" }":"")}if(Q(S)){var ce=F?E.call(String(S),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(S);return typeof S=="object"&&!F?Mt(ce):ce}if(mt(S)){for(var It="<"+J.call(String(S.nodeName)),Qt=S.attributes||[],Ht=0;Ht<Qt.length;Ht++)It+=" "+Qt[Ht].name+"="+m(P(Qt[Ht].value),"double",nt);return It+=">",S.childNodes&&S.childNodes.length&&(It+="..."),It+="</"+J.call(String(S.nodeName))+">",It}if(L(S)){if(S.length===0)return"[]";var ee=Ft(S,bt);return Tt&&!Et(ee)?"["+Vt(ee,Tt)+"]":"[ "+$.call(ee,", ")+" ]"}if(z(S)){var ie=Ft(S,bt);return!("cause"in Error.prototype)&&"cause"in S&&!D.call(S,"cause")?"{ ["+String(S)+"] "+$.call(H.call("[cause]: "+bt(S.cause),ie),", ")+" }":ie.length===0?"["+String(S)+"]":"{ ["+String(S)+"] "+$.call(ie,", ")+" }"}if(typeof S=="object"&&gt){if(V&&typeof S[V]=="function"&&u)return u(S,{depth:zt-ct});if(gt!=="symbol"&&typeof S.inspect=="function")return S.inspect()}if(it(S)){var me=[];return r&&r.call(S,function(Rt,oe){me.push(bt(oe,S,!0)+" => "+bt(Rt,S))}),St("Map",e.call(S),me,Tt)}if(dt(S)){var de=[];return o&&o.call(S,function(Rt){de.push(bt(Rt,S))}),St("Set",a.call(S),de,Tt)}if(ft(S))return yt("WeakMap");if(pt(S))return yt("WeakSet");if(ut(S))return yt("WeakRef");if(X(S))return Mt(bt(Number(S)));if(tt(S))return Mt(bt(rt.call(S)));if(Y(S))return Mt(M.call(S));if(q(S))return Mt(bt(String(S)));if(typeof window<"u"&&S===window)return"{ [object Window] }";if(typeof globalThis<"u"&&S===globalThis||typeof Oe<"u"&&S===Oe)return"{ [object globalThis] }";if(!O(S)&&!R(S)){var re=Ft(S,bt),ye=W?W(S)===Object.prototype:S instanceof Object||S.constructor===Object,ne=S instanceof Object?"":"null prototype",_e=!ye&&A&&Object(S)===S&&A in S?C.call(st(S),8,-1):ne?"Object":"",Pe=ye||typeof S.constructor!="function"?"":S.constructor.name?S.constructor.name+" ":"",se=Pe+(_e||ne?"["+$.call(H.call([],_e||[],ne||[]),": ")+"] ":"");return re.length===0?se+"{}":Tt?se+"{"+Vt(re,Tt)+"}":se+"{ "+$.call(re,", ")+" }"}return String(S)};function m(b,S,ot){var ct=ot.quoteStyle||S,ht=d[ct];return ht+b+ht}function P(b){return E.call(String(b),/"/g,"&quot;")}function T(b){return!A||!(typeof b=="object"&&(A in b||typeof b[A]<"u"))}function L(b){return st(b)==="[object Array]"&&T(b)}function O(b){return st(b)==="[object Date]"&&T(b)}function R(b){return st(b)==="[object RegExp]"&&T(b)}function z(b){return st(b)==="[object Error]"&&T(b)}function q(b){return st(b)==="[object String]"&&T(b)}function X(b){return st(b)==="[object Number]"&&T(b)}function Y(b){return st(b)==="[object Boolean]"&&T(b)}function Q(b){if(F)return b&&typeof b=="object"&&b instanceof Symbol;if(typeof b=="symbol")return!0;if(!b||typeof b!="object"||!I)return!1;try{return I.call(b),!0}catch{}return!1}function tt(b){if(!b||typeof b!="object"||!rt)return!1;try{return rt.call(b),!0}catch{}return!1}var at=Object.prototype.hasOwnProperty||function(b){return b in this};function et(b,S){return at.call(b,S)}function st(b){return G.call(b)}function lt(b){if(b.name)return b.name;var S=v.call(h.call(b),/^function\s*([\w$]+)/);return S?S[1]:null}function Z(b,S){if(b.indexOf)return b.indexOf(S);for(var ot=0,ct=b.length;ot<ct;ot++)if(b[ot]===S)return ot;return-1}function it(b){if(!e||!b||typeof b!="object")return!1;try{e.call(b);try{a.call(b)}catch{return!0}return b instanceof Map}catch{}return!1}function ft(b){if(!c||!b||typeof b!="object")return!1;try{c.call(b,c);try{_.call(b,_)}catch{return!0}return b instanceof WeakMap}catch{}return!1}function ut(b){if(!y||!b||typeof b!="object")return!1;try{return y.call(b),!0}catch{}return!1}function dt(b){if(!a||!b||typeof b!="object")return!1;try{a.call(b);try{e.call(b)}catch{return!0}return b instanceof Set}catch{}return!1}function pt(b){if(!_||!b||typeof b!="object")return!1;try{_.call(b,_);try{c.call(b,c)}catch{return!0}return b instanceof WeakSet}catch{}return!1}function mt(b){return!b||typeof b!="object"?!1:typeof HTMLElement<"u"&&b instanceof HTMLElement?!0:typeof b.nodeName=="string"&&typeof b.getAttribute=="function"}function Ct(b,S){if(b.length>S.maxStringLength){var ot=b.length-S.maxStringLength,ct="... "+ot+" more character"+(ot>1?"s":"");return Ct(C.call(b,0,S.maxStringLength),S)+ct}var ht=w[S.quoteStyle||"single"];ht.lastIndex=0;var nt=E.call(E.call(b,ht,"\\$1"),/[\x00-\x1f]/g,kt);return m(nt,"single",S)}function kt(b){var S=b.charCodeAt(0),ot={8:"b",9:"t",10:"n",12:"f",13:"r"}[S];return ot?"\\"+ot:"\\x"+(S<16?"0":"")+k.call(S.toString(16))}function Mt(b){return"Object("+b+")"}function yt(b){return b+" { ? }"}function St(b,S,ot,ct){var ht=ct?Vt(ot,ct):$.call(ot,", ");return b+" ("+S+") {"+ht+"}"}function Et(b){for(var S=0;S<b.length;S++)if(Z(b[S],`
`)>=0)return!1;return!0}function Nt(b,S){var ot;if(b.indent==="	")ot="	";else if(typeof b.indent=="number"&&b.indent>0)ot=$.call(Array(b.indent+1)," ");else return null;return{base:ot,prev:$.call(Array(S+1),ot)}}function Vt(b,S){if(b.length===0)return"";var ot=`
`+S.prev+S.base;return ot+$.call(b,","+ot)+`
`+S.prev}function Ft(b,S){var ot=L(b),ct=[];if(ot){ct.length=b.length;for(var ht=0;ht<b.length;ht++)ct[ht]=et(b,ht)?S(b[ht],b):""}var nt=typeof B=="function"?B(b):[],gt;if(F){gt={};for(var vt=0;vt<nt.length;vt++)gt["$"+nt[vt]]=nt[vt]}for(var _t in b)et(b,_t)&&(ot&&String(Number(_t))===_t&&_t<b.length||F&&gt["$"+_t]instanceof Symbol||(N.call(/[^\w$]/,_t)?ct.push(S(_t,b)+": "+S(b[_t],b)):ct.push(_t+": "+S(b[_t],b))));if(typeof B=="function")for(var At=0;At<nt.length;At++)D.call(b,nt[At])&&ct.push("["+S(nt[At])+"]: "+S(b[nt[At]],b));return ct}return is}var rs,ul;function ah(){if(ul)return rs;ul=1;var i=Ys(),t=oh(),e=Wd(),r=_i(),n=i("%Map%",!0),s=t("Map.prototype.get",!0),a=t("Map.prototype.set",!0),o=t("Map.prototype.has",!0),l=t("Map.prototype.delete",!0),c=t("Map.prototype.size",!0);return rs=!!n&&function(){var _,x={assert:function(y){if(!x.has(y))throw new r("Side channel does not contain "+e(y))},delete:function(y){if(_){var M=l(_,y);return c(_)===0&&(_=void 0),M}return!1},get:function(y){if(_)return s(_,y)},has:function(y){return _?o(_,y):!1},set:function(y,M){_||(_=new n),a(_,y,M)}};return x},rs}var ns,fl;function Ud(){if(fl)return ns;fl=1;var i=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=i&&t&&typeof t.get=="function"?t.get:null,r=i&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=n&&s&&typeof s.get=="function"?s.get:null,o=n&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,c=l?WeakMap.prototype.has:null,f=typeof WeakSet=="function"&&WeakSet.prototype,_=f?WeakSet.prototype.has:null,x=typeof WeakRef=="function"&&WeakRef.prototype,y=x?WeakRef.prototype.deref:null,M=Boolean.prototype.valueOf,G=Object.prototype.toString,h=Function.prototype.toString,v=String.prototype.match,C=String.prototype.slice,E=String.prototype.replace,k=String.prototype.toUpperCase,J=String.prototype.toLowerCase,N=RegExp.prototype.test,H=Array.prototype.concat,$=Array.prototype.join,j=Array.prototype.slice,K=Math.floor,rt=typeof BigInt=="function"?BigInt.prototype.valueOf:null,B=Object.getOwnPropertySymbols,I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,F=typeof Symbol=="function"&&typeof Symbol.iterator=="object",A=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===F||!0)?Symbol.toStringTag:null,D=Object.prototype.propertyIsEnumerable,W=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(b){return b.__proto__}:null);function U(b,S){if(b===1/0||b===-1/0||b!==b||b&&b>-1e3&&b<1e3||N.call(/e/,S))return S;var ot=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof b=="number"){var ct=b<0?-K(-b):K(b);if(ct!==b){var ht=String(ct),nt=C.call(S,ht.length+1);return E.call(ht,ot,"$&_")+"."+E.call(E.call(nt,/([0-9]{3})/g,"$&_"),/_$/,"")}}return E.call(S,ot,"$&_")}var u=Br,g=u.custom,V=Q(g)?g:null,d={__proto__:null,double:'"',single:"'"},w={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};ns=function b(S,ot,ct,ht){var nt=ot||{};if(et(nt,"quoteStyle")&&!et(d,nt.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(et(nt,"maxStringLength")&&(typeof nt.maxStringLength=="number"?nt.maxStringLength<0&&nt.maxStringLength!==1/0:nt.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var gt=et(nt,"customInspect")?nt.customInspect:!0;if(typeof gt!="boolean"&&gt!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(et(nt,"indent")&&nt.indent!==null&&nt.indent!=="	"&&!(parseInt(nt.indent,10)===nt.indent&&nt.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(et(nt,"numericSeparator")&&typeof nt.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var vt=nt.numericSeparator;if(typeof S>"u")return"undefined";if(S===null)return"null";if(typeof S=="boolean")return S?"true":"false";if(typeof S=="string")return Ct(S,nt);if(typeof S=="number"){if(S===0)return 1/0/S>0?"0":"-0";var _t=String(S);return vt?U(S,_t):_t}if(typeof S=="bigint"){var At=String(S)+"n";return vt?U(S,At):At}var zt=typeof nt.depth>"u"?5:nt.depth;if(typeof ct>"u"&&(ct=0),ct>=zt&&zt>0&&typeof S=="object")return L(S)?"[Array]":"[Object]";var Tt=Nt(nt,ct);if(typeof ht>"u")ht=[];else if(Z(ht,S)>=0)return"[Circular]";function bt(Rt,oe,Ye){if(oe&&(ht=j.call(ht),ht.push(oe)),Ye){var Be={depth:nt.depth};return et(nt,"quoteStyle")&&(Be.quoteStyle=nt.quoteStyle),b(Rt,Be,ct+1,ht)}return b(Rt,nt,ct+1,ht)}if(typeof S=="function"&&!R(S)){var jt=lt(S),te=Ft(S,bt);return"[Function"+(jt?": "+jt:" (anonymous)")+"]"+(te.length>0?" { "+$.call(te,", ")+" }":"")}if(Q(S)){var ce=F?E.call(String(S),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(S);return typeof S=="object"&&!F?Mt(ce):ce}if(mt(S)){for(var It="<"+J.call(String(S.nodeName)),Qt=S.attributes||[],Ht=0;Ht<Qt.length;Ht++)It+=" "+Qt[Ht].name+"="+m(P(Qt[Ht].value),"double",nt);return It+=">",S.childNodes&&S.childNodes.length&&(It+="..."),It+="</"+J.call(String(S.nodeName))+">",It}if(L(S)){if(S.length===0)return"[]";var ee=Ft(S,bt);return Tt&&!Et(ee)?"["+Vt(ee,Tt)+"]":"[ "+$.call(ee,", ")+" ]"}if(z(S)){var ie=Ft(S,bt);return!("cause"in Error.prototype)&&"cause"in S&&!D.call(S,"cause")?"{ ["+String(S)+"] "+$.call(H.call("[cause]: "+bt(S.cause),ie),", ")+" }":ie.length===0?"["+String(S)+"]":"{ ["+String(S)+"] "+$.call(ie,", ")+" }"}if(typeof S=="object"&&gt){if(V&&typeof S[V]=="function"&&u)return u(S,{depth:zt-ct});if(gt!=="symbol"&&typeof S.inspect=="function")return S.inspect()}if(it(S)){var me=[];return r&&r.call(S,function(Rt,oe){me.push(bt(oe,S,!0)+" => "+bt(Rt,S))}),St("Map",e.call(S),me,Tt)}if(dt(S)){var de=[];return o&&o.call(S,function(Rt){de.push(bt(Rt,S))}),St("Set",a.call(S),de,Tt)}if(ft(S))return yt("WeakMap");if(pt(S))return yt("WeakSet");if(ut(S))return yt("WeakRef");if(X(S))return Mt(bt(Number(S)));if(tt(S))return Mt(bt(rt.call(S)));if(Y(S))return Mt(M.call(S));if(q(S))return Mt(bt(String(S)));if(typeof window<"u"&&S===window)return"{ [object Window] }";if(typeof globalThis<"u"&&S===globalThis||typeof Oe<"u"&&S===Oe)return"{ [object globalThis] }";if(!O(S)&&!R(S)){var re=Ft(S,bt),ye=W?W(S)===Object.prototype:S instanceof Object||S.constructor===Object,ne=S instanceof Object?"":"null prototype",_e=!ye&&A&&Object(S)===S&&A in S?C.call(st(S),8,-1):ne?"Object":"",Pe=ye||typeof S.constructor!="function"?"":S.constructor.name?S.constructor.name+" ":"",se=Pe+(_e||ne?"["+$.call(H.call([],_e||[],ne||[]),": ")+"] ":"");return re.length===0?se+"{}":Tt?se+"{"+Vt(re,Tt)+"}":se+"{ "+$.call(re,", ")+" }"}return String(S)};function m(b,S,ot){var ct=ot.quoteStyle||S,ht=d[ct];return ht+b+ht}function P(b){return E.call(String(b),/"/g,"&quot;")}function T(b){return!A||!(typeof b=="object"&&(A in b||typeof b[A]<"u"))}function L(b){return st(b)==="[object Array]"&&T(b)}function O(b){return st(b)==="[object Date]"&&T(b)}function R(b){return st(b)==="[object RegExp]"&&T(b)}function z(b){return st(b)==="[object Error]"&&T(b)}function q(b){return st(b)==="[object String]"&&T(b)}function X(b){return st(b)==="[object Number]"&&T(b)}function Y(b){return st(b)==="[object Boolean]"&&T(b)}function Q(b){if(F)return b&&typeof b=="object"&&b instanceof Symbol;if(typeof b=="symbol")return!0;if(!b||typeof b!="object"||!I)return!1;try{return I.call(b),!0}catch{}return!1}function tt(b){if(!b||typeof b!="object"||!rt)return!1;try{return rt.call(b),!0}catch{}return!1}var at=Object.prototype.hasOwnProperty||function(b){return b in this};function et(b,S){return at.call(b,S)}function st(b){return G.call(b)}function lt(b){if(b.name)return b.name;var S=v.call(h.call(b),/^function\s*([\w$]+)/);return S?S[1]:null}function Z(b,S){if(b.indexOf)return b.indexOf(S);for(var ot=0,ct=b.length;ot<ct;ot++)if(b[ot]===S)return ot;return-1}function it(b){if(!e||!b||typeof b!="object")return!1;try{e.call(b);try{a.call(b)}catch{return!0}return b instanceof Map}catch{}return!1}function ft(b){if(!c||!b||typeof b!="object")return!1;try{c.call(b,c);try{_.call(b,_)}catch{return!0}return b instanceof WeakMap}catch{}return!1}function ut(b){if(!y||!b||typeof b!="object")return!1;try{return y.call(b),!0}catch{}return!1}function dt(b){if(!a||!b||typeof b!="object")return!1;try{a.call(b);try{e.call(b)}catch{return!0}return b instanceof Set}catch{}return!1}function pt(b){if(!_||!b||typeof b!="object")return!1;try{_.call(b,_);try{c.call(b,c)}catch{return!0}return b instanceof WeakSet}catch{}return!1}function mt(b){return!b||typeof b!="object"?!1:typeof HTMLElement<"u"&&b instanceof HTMLElement?!0:typeof b.nodeName=="string"&&typeof b.getAttribute=="function"}function Ct(b,S){if(b.length>S.maxStringLength){var ot=b.length-S.maxStringLength,ct="... "+ot+" more character"+(ot>1?"s":"");return Ct(C.call(b,0,S.maxStringLength),S)+ct}var ht=w[S.quoteStyle||"single"];ht.lastIndex=0;var nt=E.call(E.call(b,ht,"\\$1"),/[\x00-\x1f]/g,kt);return m(nt,"single",S)}function kt(b){var S=b.charCodeAt(0),ot={8:"b",9:"t",10:"n",12:"f",13:"r"}[S];return ot?"\\"+ot:"\\x"+(S<16?"0":"")+k.call(S.toString(16))}function Mt(b){return"Object("+b+")"}function yt(b){return b+" { ? }"}function St(b,S,ot,ct){var ht=ct?Vt(ot,ct):$.call(ot,", ");return b+" ("+S+") {"+ht+"}"}function Et(b){for(var S=0;S<b.length;S++)if(Z(b[S],`
`)>=0)return!1;return!0}function Nt(b,S){var ot;if(b.indent==="	")ot="	";else if(typeof b.indent=="number"&&b.indent>0)ot=$.call(Array(b.indent+1)," ");else return null;return{base:ot,prev:$.call(Array(S+1),ot)}}function Vt(b,S){if(b.length===0)return"";var ot=`
`+S.prev+S.base;return ot+$.call(b,","+ot)+`
`+S.prev}function Ft(b,S){var ot=L(b),ct=[];if(ot){ct.length=b.length;for(var ht=0;ht<b.length;ht++)ct[ht]=et(b,ht)?S(b[ht],b):""}var nt=typeof B=="function"?B(b):[],gt;if(F){gt={};for(var vt=0;vt<nt.length;vt++)gt["$"+nt[vt]]=nt[vt]}for(var _t in b)et(b,_t)&&(ot&&String(Number(_t))===_t&&_t<b.length||F&&gt["$"+_t]instanceof Symbol||(N.call(/[^\w$]/,_t)?ct.push(S(_t,b)+": "+S(b[_t],b)):ct.push(_t+": "+S(b[_t],b))));if(typeof B=="function")for(var At=0;At<nt.length;At++)D.call(b,nt[At])&&ct.push("["+S(nt[At])+"]: "+S(b[nt[At]],b));return ct}return ns}var ss,pl;function Jd(){if(pl)return ss;pl=1;var i=Ys(),t=oh(),e=Ud(),r=ah(),n=_i(),s=i("%WeakMap%",!0),a=t("WeakMap.prototype.get",!0),o=t("WeakMap.prototype.set",!0),l=t("WeakMap.prototype.has",!0),c=t("WeakMap.prototype.delete",!0);return ss=s?function(){var _,x,y={assert:function(M){if(!y.has(M))throw new n("Side channel does not contain "+e(M))},delete:function(M){if(s&&M&&(typeof M=="object"||typeof M=="function")){if(_)return c(_,M)}else if(r&&x)return x.delete(M);return!1},get:function(M){return s&&M&&(typeof M=="object"||typeof M=="function")&&_?a(_,M):x&&x.get(M)},has:function(M){return s&&M&&(typeof M=="object"||typeof M=="function")&&_?l(_,M):!!x&&x.has(M)},set:function(M,G){s&&M&&(typeof M=="object"||typeof M=="function")?(_||(_=new s),o(_,M,G)):r&&(x||(x=r()),x.set(M,G))}};return y}:r,ss}var os,ml;function qd(){if(ml)return os;ml=1;var i=_i(),t=dd(),e=_d(),r=ah(),n=Jd(),s=n||r||e;return os=function(){var o,l={assert:function(c){if(!l.has(c))throw new i("Side channel does not contain "+t(c))},delete:function(c){return!!o&&o.delete(c)},get:function(c){return o&&o.get(c)},has:function(c){return!!o&&o.has(c)},set:function(c,f){o||(o=s()),o.set(c,f)}};return l},os}var as,dl;function Ks(){if(dl)return as;dl=1;var i=String.prototype.replace,t=/%20/g,e={RFC1738:"RFC1738",RFC3986:"RFC3986"};return as={default:e.RFC3986,formatters:{RFC1738:function(r){return i.call(r,t,"+")},RFC3986:function(r){return String(r)}},RFC1738:e.RFC1738,RFC3986:e.RFC3986},as}var ls,yl;function lh(){if(yl)return ls;yl=1;var i=Ks(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r=(function(){for(var h=[],v=0;v<256;++v)h.push("%"+((v<16?"0":"")+v.toString(16)).toUpperCase());return h})(),n=function(v){for(;v.length>1;){var C=v.pop(),E=C.obj[C.prop];if(e(E)){for(var k=[],J=0;J<E.length;++J)typeof E[J]<"u"&&k.push(E[J]);C.obj[C.prop]=k}}},s=function(v,C){for(var E=C&&C.plainObjects?{__proto__:null}:{},k=0;k<v.length;++k)typeof v[k]<"u"&&(E[k]=v[k]);return E},a=function h(v,C,E){if(!C)return v;if(typeof C!="object"&&typeof C!="function"){if(e(v))v.push(C);else if(v&&typeof v=="object")(E&&(E.plainObjects||E.allowPrototypes)||!t.call(Object.prototype,C))&&(v[C]=!0);else return[v,C];return v}if(!v||typeof v!="object")return[v].concat(C);var k=v;return e(v)&&!e(C)&&(k=s(v,E)),e(v)&&e(C)?(C.forEach(function(J,N){if(t.call(v,N)){var H=v[N];H&&typeof H=="object"&&J&&typeof J=="object"?v[N]=h(H,J,E):v.push(J)}else v[N]=J}),v):Object.keys(C).reduce(function(J,N){var H=C[N];return t.call(J,N)?J[N]=h(J[N],H,E):J[N]=H,J},k)},o=function(v,C){return Object.keys(C).reduce(function(E,k){return E[k]=C[k],E},v)},l=function(h,v,C){var E=h.replace(/\+/g," ");if(C==="iso-8859-1")return E.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(E)}catch{return E}},c=1024,f=function(v,C,E,k,J){if(v.length===0)return v;var N=v;if(typeof v=="symbol"?N=Symbol.prototype.toString.call(v):typeof v!="string"&&(N=String(v)),E==="iso-8859-1")return escape(N).replace(/%u[0-9a-f]{4}/gi,function(I){return"%26%23"+parseInt(I.slice(2),16)+"%3B"});for(var H="",$=0;$<N.length;$+=c){for(var j=N.length>=c?N.slice($,$+c):N,K=[],rt=0;rt<j.length;++rt){var B=j.charCodeAt(rt);if(B===45||B===46||B===95||B===126||B>=48&&B<=57||B>=65&&B<=90||B>=97&&B<=122||J===i.RFC1738&&(B===40||B===41)){K[K.length]=j.charAt(rt);continue}if(B<128){K[K.length]=r[B];continue}if(B<2048){K[K.length]=r[192|B>>6]+r[128|B&63];continue}if(B<55296||B>=57344){K[K.length]=r[224|B>>12]+r[128|B>>6&63]+r[128|B&63];continue}rt+=1,B=65536+((B&1023)<<10|j.charCodeAt(rt)&1023),K[K.length]=r[240|B>>18]+r[128|B>>12&63]+r[128|B>>6&63]+r[128|B&63]}H+=K.join("")}return H},_=function(v){for(var C=[{obj:{o:v},prop:"o"}],E=[],k=0;k<C.length;++k)for(var J=C[k],N=J.obj[J.prop],H=Object.keys(N),$=0;$<H.length;++$){var j=H[$],K=N[j];typeof K=="object"&&K!==null&&E.indexOf(K)===-1&&(C.push({obj:N,prop:j}),E.push(K))}return n(C),v},x=function(v){return Object.prototype.toString.call(v)==="[object RegExp]"},y=function(v){return!v||typeof v!="object"?!1:!!(v.constructor&&v.constructor.isBuffer&&v.constructor.isBuffer(v))},M=function(v,C){return[].concat(v,C)},G=function(v,C){if(e(v)){for(var E=[],k=0;k<v.length;k+=1)E.push(C(v[k]));return E}return C(v)};return ls={arrayToObject:s,assign:o,combine:M,compact:_,decode:l,encode:f,isBuffer:y,isRegExp:x,maybeMap:G,merge:a},ls}var cs,_l;function Hd(){if(_l)return cs;_l=1;var i=qd(),t=lh(),e=Ks(),r=Object.prototype.hasOwnProperty,n={brackets:function(h){return h+"[]"},comma:"comma",indices:function(h,v){return h+"["+v+"]"},repeat:function(h){return h}},s=Array.isArray,a=Array.prototype.push,o=function(G,h){a.apply(G,s(h)?h:[h])},l=Date.prototype.toISOString,c=e.default,f={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:c,formatter:e.formatters[c],indices:!1,serializeDate:function(h){return l.call(h)},skipNulls:!1,strictNullHandling:!1},_=function(h){return typeof h=="string"||typeof h=="number"||typeof h=="boolean"||typeof h=="symbol"||typeof h=="bigint"},x={},y=function G(h,v,C,E,k,J,N,H,$,j,K,rt,B,I,F,A,D,W){for(var U=h,u=W,g=0,V=!1;(u=u.get(x))!==void 0&&!V;){var d=u.get(h);if(g+=1,typeof d<"u"){if(d===g)throw new RangeError("Cyclic object value");V=!0}typeof u.get(x)>"u"&&(g=0)}if(typeof j=="function"?U=j(v,U):U instanceof Date?U=B(U):C==="comma"&&s(U)&&(U=t.maybeMap(U,function(tt){return tt instanceof Date?B(tt):tt})),U===null){if(J)return $&&!A?$(v,f.encoder,D,"key",I):v;U=""}if(_(U)||t.isBuffer(U)){if($){var w=A?v:$(v,f.encoder,D,"key",I);return[F(w)+"="+F($(U,f.encoder,D,"value",I))]}return[F(v)+"="+F(String(U))]}var m=[];if(typeof U>"u")return m;var P;if(C==="comma"&&s(U))A&&$&&(U=t.maybeMap(U,$)),P=[{value:U.length>0?U.join(",")||null:void 0}];else if(s(j))P=j;else{var T=Object.keys(U);P=K?T.sort(K):T}var L=H?String(v).replace(/\./g,"%2E"):String(v),O=E&&s(U)&&U.length===1?L+"[]":L;if(k&&s(U)&&U.length===0)return O+"[]";for(var R=0;R<P.length;++R){var z=P[R],q=typeof z=="object"&&z&&typeof z.value<"u"?z.value:U[z];if(!(N&&q===null)){var X=rt&&H?String(z).replace(/\./g,"%2E"):String(z),Y=s(U)?typeof C=="function"?C(O,X):O:O+(rt?"."+X:"["+X+"]");W.set(h,g);var Q=i();Q.set(x,W),o(m,G(q,Y,C,E,k,J,N,H,C==="comma"&&A&&s(U)?null:$,j,K,rt,B,I,F,A,D,Q))}}return m},M=function(h){if(!h)return f;if(typeof h.allowEmptyArrays<"u"&&typeof h.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof h.encodeDotInKeys<"u"&&typeof h.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(h.encoder!==null&&typeof h.encoder<"u"&&typeof h.encoder!="function")throw new TypeError("Encoder has to be a function.");var v=h.charset||f.charset;if(typeof h.charset<"u"&&h.charset!=="utf-8"&&h.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var C=e.default;if(typeof h.format<"u"){if(!r.call(e.formatters,h.format))throw new TypeError("Unknown format option provided.");C=h.format}var E=e.formatters[C],k=f.filter;(typeof h.filter=="function"||s(h.filter))&&(k=h.filter);var J;if(h.arrayFormat in n?J=h.arrayFormat:"indices"in h?J=h.indices?"indices":"repeat":J=f.arrayFormat,"commaRoundTrip"in h&&typeof h.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var N=typeof h.allowDots>"u"?h.encodeDotInKeys===!0?!0:f.allowDots:!!h.allowDots;return{addQueryPrefix:typeof h.addQueryPrefix=="boolean"?h.addQueryPrefix:f.addQueryPrefix,allowDots:N,allowEmptyArrays:typeof h.allowEmptyArrays=="boolean"?!!h.allowEmptyArrays:f.allowEmptyArrays,arrayFormat:J,charset:v,charsetSentinel:typeof h.charsetSentinel=="boolean"?h.charsetSentinel:f.charsetSentinel,commaRoundTrip:!!h.commaRoundTrip,delimiter:typeof h.delimiter>"u"?f.delimiter:h.delimiter,encode:typeof h.encode=="boolean"?h.encode:f.encode,encodeDotInKeys:typeof h.encodeDotInKeys=="boolean"?h.encodeDotInKeys:f.encodeDotInKeys,encoder:typeof h.encoder=="function"?h.encoder:f.encoder,encodeValuesOnly:typeof h.encodeValuesOnly=="boolean"?h.encodeValuesOnly:f.encodeValuesOnly,filter:k,format:C,formatter:E,serializeDate:typeof h.serializeDate=="function"?h.serializeDate:f.serializeDate,skipNulls:typeof h.skipNulls=="boolean"?h.skipNulls:f.skipNulls,sort:typeof h.sort=="function"?h.sort:null,strictNullHandling:typeof h.strictNullHandling=="boolean"?h.strictNullHandling:f.strictNullHandling}};return cs=function(G,h){var v=G,C=M(h),E,k;typeof C.filter=="function"?(k=C.filter,v=k("",v)):s(C.filter)&&(k=C.filter,E=k);var J=[];if(typeof v!="object"||v===null)return"";var N=n[C.arrayFormat],H=N==="comma"&&C.commaRoundTrip;E||(E=Object.keys(v)),C.sort&&E.sort(C.sort);for(var $=i(),j=0;j<E.length;++j){var K=E[j],rt=v[K];C.skipNulls&&rt===null||o(J,y(rt,K,N,H,C.allowEmptyArrays,C.strictNullHandling,C.skipNulls,C.encodeDotInKeys,C.encode?C.encoder:null,C.filter,C.sort,C.allowDots,C.serializeDate,C.format,C.formatter,C.encodeValuesOnly,C.charset,$))}var B=J.join(C.delimiter),I=C.addQueryPrefix===!0?"?":"";return C.charsetSentinel&&(C.charset==="iso-8859-1"?I+="utf8=%26%2310003%3B&":I+="utf8=%E2%9C%93&"),B.length>0?I+B:""},cs}var hs,gl;function $d(){if(gl)return hs;gl=1;var i=lh(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},n=function(x){return x.replace(/&#(\d+);/g,function(y,M){return String.fromCharCode(parseInt(M,10))})},s=function(x,y,M){if(x&&typeof x=="string"&&y.comma&&x.indexOf(",")>-1)return x.split(",");if(y.throwOnLimitExceeded&&M>=y.arrayLimit)throw new RangeError("Array limit exceeded. Only "+y.arrayLimit+" element"+(y.arrayLimit===1?"":"s")+" allowed in an array.");return x},a="utf8=%26%2310003%3B",o="utf8=%E2%9C%93",l=function(y,M){var G={__proto__:null},h=M.ignoreQueryPrefix?y.replace(/^\?/,""):y;h=h.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var v=M.parameterLimit===1/0?void 0:M.parameterLimit,C=h.split(M.delimiter,M.throwOnLimitExceeded?v+1:v);if(M.throwOnLimitExceeded&&C.length>v)throw new RangeError("Parameter limit exceeded. Only "+v+" parameter"+(v===1?"":"s")+" allowed.");var E=-1,k,J=M.charset;if(M.charsetSentinel)for(k=0;k<C.length;++k)C[k].indexOf("utf8=")===0&&(C[k]===o?J="utf-8":C[k]===a&&(J="iso-8859-1"),E=k,k=C.length);for(k=0;k<C.length;++k)if(k!==E){var N=C[k],H=N.indexOf("]="),$=H===-1?N.indexOf("="):H+1,j,K;$===-1?(j=M.decoder(N,r.decoder,J,"key"),K=M.strictNullHandling?null:""):(j=M.decoder(N.slice(0,$),r.decoder,J,"key"),K=i.maybeMap(s(N.slice($+1),M,e(G[j])?G[j].length:0),function(B){return M.decoder(B,r.decoder,J,"value")})),K&&M.interpretNumericEntities&&J==="iso-8859-1"&&(K=n(String(K))),N.indexOf("[]=")>-1&&(K=e(K)?[K]:K);var rt=t.call(G,j);rt&&M.duplicates==="combine"?G[j]=i.combine(G[j],K):(!rt||M.duplicates==="last")&&(G[j]=K)}return G},c=function(x,y,M,G){var h=0;if(x.length>0&&x[x.length-1]==="[]"){var v=x.slice(0,-1).join("");h=Array.isArray(y)&&y[v]?y[v].length:0}for(var C=G?y:s(y,M,h),E=x.length-1;E>=0;--E){var k,J=x[E];if(J==="[]"&&M.parseArrays)k=M.allowEmptyArrays&&(C===""||M.strictNullHandling&&C===null)?[]:i.combine([],C);else{k=M.plainObjects?{__proto__:null}:{};var N=J.charAt(0)==="["&&J.charAt(J.length-1)==="]"?J.slice(1,-1):J,H=M.decodeDotInKeys?N.replace(/%2E/g,"."):N,$=parseInt(H,10);!M.parseArrays&&H===""?k={0:C}:!isNaN($)&&J!==H&&String($)===H&&$>=0&&M.parseArrays&&$<=M.arrayLimit?(k=[],k[$]=C):H!=="__proto__"&&(k[H]=C)}C=k}return C},f=function(y,M,G,h){if(y){var v=G.allowDots?y.replace(/\.([^.[]+)/g,"[$1]"):y,C=/(\[[^[\]]*])/,E=/(\[[^[\]]*])/g,k=G.depth>0&&C.exec(v),J=k?v.slice(0,k.index):v,N=[];if(J){if(!G.plainObjects&&t.call(Object.prototype,J)&&!G.allowPrototypes)return;N.push(J)}for(var H=0;G.depth>0&&(k=E.exec(v))!==null&&H<G.depth;){if(H+=1,!G.plainObjects&&t.call(Object.prototype,k[1].slice(1,-1))&&!G.allowPrototypes)return;N.push(k[1])}if(k){if(G.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+G.depth+" and strictDepth is true");N.push("["+v.slice(k.index)+"]")}return c(N,M,G,h)}},_=function(y){if(!y)return r;if(typeof y.allowEmptyArrays<"u"&&typeof y.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof y.decodeDotInKeys<"u"&&typeof y.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(y.decoder!==null&&typeof y.decoder<"u"&&typeof y.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof y.charset<"u"&&y.charset!=="utf-8"&&y.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof y.throwOnLimitExceeded<"u"&&typeof y.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var M=typeof y.charset>"u"?r.charset:y.charset,G=typeof y.duplicates>"u"?r.duplicates:y.duplicates;if(G!=="combine"&&G!=="first"&&G!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var h=typeof y.allowDots>"u"?y.decodeDotInKeys===!0?!0:r.allowDots:!!y.allowDots;return{allowDots:h,allowEmptyArrays:typeof y.allowEmptyArrays=="boolean"?!!y.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof y.allowPrototypes=="boolean"?y.allowPrototypes:r.allowPrototypes,allowSparse:typeof y.allowSparse=="boolean"?y.allowSparse:r.allowSparse,arrayLimit:typeof y.arrayLimit=="number"?y.arrayLimit:r.arrayLimit,charset:M,charsetSentinel:typeof y.charsetSentinel=="boolean"?y.charsetSentinel:r.charsetSentinel,comma:typeof y.comma=="boolean"?y.comma:r.comma,decodeDotInKeys:typeof y.decodeDotInKeys=="boolean"?y.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof y.decoder=="function"?y.decoder:r.decoder,delimiter:typeof y.delimiter=="string"||i.isRegExp(y.delimiter)?y.delimiter:r.delimiter,depth:typeof y.depth=="number"||y.depth===!1?+y.depth:r.depth,duplicates:G,ignoreQueryPrefix:y.ignoreQueryPrefix===!0,interpretNumericEntities:typeof y.interpretNumericEntities=="boolean"?y.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof y.parameterLimit=="number"?y.parameterLimit:r.parameterLimit,parseArrays:y.parseArrays!==!1,plainObjects:typeof y.plainObjects=="boolean"?y.plainObjects:r.plainObjects,strictDepth:typeof y.strictDepth=="boolean"?!!y.strictDepth:r.strictDepth,strictNullHandling:typeof y.strictNullHandling=="boolean"?y.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof y.throwOnLimitExceeded=="boolean"?y.throwOnLimitExceeded:!1}};return hs=function(x,y){var M=_(y);if(x===""||x===null||typeof x>"u")return M.plainObjects?{__proto__:null}:{};for(var G=typeof x=="string"?l(x,M):x,h=M.plainObjects?{__proto__:null}:{},v=Object.keys(G),C=0;C<v.length;++C){var E=v[C],k=f(E,G[E],M,typeof x=="string");h=i.merge(h,k,M)}return M.allowSparse===!0?h:i.compact(h)},hs}var us,xl;function Xd(){if(xl)return us;xl=1;var i=Hd(),t=$d(),e=Ks();return us={formats:e,parse:t,stringify:i},us}var vl;function Yd(){return vl||(vl=1,(function(i){i.__esModule=!0;var t=Xd();function e(r,n){var s=r.split("?"),a=s[0],o=s[1],l=(o||"").split("#")[0],c=o&&o.split("#").length>1?"#"+o.split("#")[1]:"",f=t.parse(l);for(var _ in n)f[_]=n[_];return l=t.stringify(f),l!==""&&(l="?"+l),a+l+c}i.default=e})(_n)),_n}var bl=Ii.exports,wl;function Kd(){return wl||(wl=1,(function(i,t){var e=bl&&bl.__assign||Object.assign||function(c){for(var f,_=1,x=arguments.length;_<x;_++){f=arguments[_];for(var y in f)Object.prototype.hasOwnProperty.call(f,y)&&(c[y]=f[y])}return c};t.__esModule=!0;var r=nd(),n=jc(),s=fd();t.ResponsePromise=s.ResponsePromise;var a=Yd();function o(c,f,_){return s.default(new n(function(x,y){var M=new XMLHttpRequest;if(typeof c!="string")throw new TypeError("The method must be a string.");if(typeof f!="string")throw new TypeError("The URL/path must be a string.");if(_==null&&(_={}),typeof _!="object")throw new TypeError("Options must be an object (or null).");c=c.toUpperCase();function G(J,N){o(c,f,{qs:N.qs,headers:N.headers,timeout:N.timeout}).nodeify(function(H,$){var j=!!(H||$.statusCode>=400);if(typeof N.retry=="function"&&(j=N.retry(H,$,J+1)),J>=(N.maxRetries||5)&&(j=!1),j){var K=N.retryDelay;typeof N.retryDelay=="function"&&(K=N.retryDelay(H,$,J+1)),K=K||200,setTimeout(function(){G(J+1,N)},K)}else H?y(H):x($)})}if(_.retry&&c==="GET")return G(0,_);var h=_.headers||{},v,C=!!((v=/^([\w-]+:)?\/\/([^\/]+)/.exec(f))&&v[2]!=location.host);if(C||(h=e({},h,{"X-Requested-With":"XMLHttpRequest"})),_.qs&&(f=a.default(f,_.qs)),_.json&&(_.body=JSON.stringify(_.json),h=e({},h,{"Content-Type":"application/json"})),_.form&&(_.body=_.form),_.timeout){M.timeout=_.timeout;var E=Date.now();M.ontimeout=function(){var J=Date.now()-E,N=new Error("Request timed out after "+J+"ms");N.timeout=!0,N.duration=J,y(N)}}M.onreadystatechange=function(){if(M.readyState===4){var J={};M.getAllResponseHeaders().split(`\r
`).forEach(function(H){var $=H.split(":");$.length>1&&(J[$[0].toLowerCase()]=$.slice(1).join(":").trim())});var N=new r(M.status,J,M.responseText,f);x(N)}},M.open(c,f,!0);for(var k in h)M.setRequestHeader(k,h[k]);M.send(_.body?_.body:null)}))}var l=FormData;t.FormData=l,t.default=o,i.exports=o,i.exports.default=o,i.exports.FormData=l})(Ii,Ii.exports)),Ii.exports}var Zd=Kd();const Qd=Fs(Zd);var jd=Se.Collision.Shapes.b2CircleShape,Sl=Se.Collision.Shapes.b2PolygonShape,Li=Se.Common.Math.b2Vec2,ty=Se.Dynamics.b2BodyDef,ey=Se.Dynamics.b2FixtureDef,iy=Se.Dynamics.b2World,Xt=function(){};Xt.prototype.loadBodyFromRUBE=function(i,t,e){if(!i.hasOwnProperty("type"))return console.log("Body does not have a 'type' property"),null;var r=new ty;i.type==2?r.type=Dt.dyn.b2Body.b2_dynamicBody:i.type==1&&(r.type=Dt.dyn.b2Body.b2_kinematicBody),i.hasOwnProperty("angle")&&(r.angle=i.angle),i.hasOwnProperty("angularVelocity")&&(r.angularVelocity=i.angularVelocity),i.hasOwnProperty("active")&&(r.awake=i.active),i.hasOwnProperty("fixedRotation")&&(r.fixedRotation=i.fixedRotation),i.hasOwnProperty("linearVelocity")&&i.linearVelocity instanceof Object&&r.linearVelocity.SetV(i.linearVelocity),i.hasOwnProperty("position")&&i.position instanceof Object&&r.position.SetV(i.position),i.hasOwnProperty("awake")?r.awake=i.awake:r.awake=!1;var n=t.CreateBody(r);if(i.hasOwnProperty("fixture"))for(var s=0;s<i.fixture.length;s++){var a=i.fixture[s];this.loadFixtureFromRUBE(n,a)}return i.hasOwnProperty("name")&&(n.name=i.name),i.hasOwnProperty("customProperties")&&(this.setCustomProperty(i,"int","loadingIndex",e),n.customProperties=i.customProperties),n};Xt.prototype.loadFixtureFromRUBE=function(i,t){var e=new ey;t.hasOwnProperty("friction")&&(e.friction=t.friction),t.hasOwnProperty("density")&&(e.density=t.density),t.hasOwnProperty("restitution")&&(e.restitution=t.restitution),t.hasOwnProperty("sensor")&&(e.isSensor=t.sensor),t.hasOwnProperty("filter-categoryBits")&&(e.filter.categoryBits=t["filter-categoryBits"]),t.hasOwnProperty("filter-maskBits")&&(e.filter.maskBits=t["filter-maskBits"]),t.hasOwnProperty("filter-groupIndex")&&(e.filter.groupIndex=t["filter-groupIndex"]);var r;if(t.hasOwnProperty("circle"))e.shape=new jd,e.shape.m_radius=t.circle.radius,t.circle.center&&e.shape.m_p.SetV(t.circle.center),r=i.CreateFixture(e),t.name&&(r.name=t.name);else if(t.hasOwnProperty("polygon")){e.shape=new Sl;for(var n=[],s=0;s<t.polygon.vertices.x.length;s++)n.push(new Li(t.polygon.vertices.x[s],t.polygon.vertices.y[s]));e.shape.SetAsArray(n,n.length),r=i.CreateFixture(e),r&&t.name&&(r.name=t.name)}else if(t.hasOwnProperty("chain")){e.shape=new Sl;for(var a=new Li,s=0;s<t.chain.vertices.x.length;s++){var o=new Li(t.chain.vertices.x[s],t.chain.vertices.y[s]);s>0&&(e.shape.SetAsEdge(a,o),r=i.CreateFixture(e),t.name&&(r.name=t.name)),a=o}}else console.log("Could not find shape type for fixture");t.hasOwnProperty("customProperties")&&(r.customProperties=t.customProperties)};Xt.prototype.getVectorValue=function(i){return i instanceof Object?i:{x:0,y:0}};Xt.prototype.loadJointCommonProperties=function(i,t,e,r){i.bodyA=e[t.bodyA],i.bodyB=e[t.bodyB],i.localAnchorA.SetV(this.getVectorValue(t.anchorA)),i.localAnchorB.SetV(this.getVectorValue(t.anchorB)),t.collideConnected&&(i.collideConnected=t.collideConnected)};Xt.prototype.loadJointFromRUBE=function(i,t,e,r){if(!i.hasOwnProperty("type"))return console.log("Joint does not have a 'type' property"),null;if(i.bodyA>=e.length)return console.log("Index for bodyA is invalid: "+i.bodyA),null;if(i.bodyB>=e.length)return console.log("Index for bodyB is invalid: "+i.bodyB),null;var n=null,s;return i.type=="revolute"?(s=new Dt.joints.b2RevoluteJointDef,this.loadJointCommonProperties(s,i,e,r),i.hasOwnProperty("refAngle")&&(s.referenceAngle=i.refAngle),i.hasOwnProperty("lowerLimit")&&(s.lowerAngle=i.lowerLimit),i.hasOwnProperty("upperLimit")&&(s.upperAngle=i.upperLimit),i.hasOwnProperty("maxMotorTorque")&&(s.maxMotorTorque=i.maxMotorTorque),i.hasOwnProperty("motorSpeed")&&(s.motorSpeed=i.motorSpeed),i.hasOwnProperty("enableLimit")&&(s.enableLimit=i.enableLimit),i.hasOwnProperty("enableMotor")&&(s.enableMotor=i.enableMotor),s.lowerAngle=0,s.upperAngle=0,s.referenceAngle=0,n=t.CreateJoint(s)):i.type=="distance"||i.type=="rope"?(i.type=="rope"&&console.log("Replacing unsupported rope joint with distance joint!"),s=new b2DistanceJointDef,this.loadJointCommonProperties(s,i,e,r),i.hasOwnProperty("length")&&(s.length=i.length),i.hasOwnProperty("dampingRatio")&&(s.dampingRatio=i.dampingRatio),i.hasOwnProperty("frequency")&&(s.frequencyHz=i.frequency),n=t.CreateJoint(s)):i.type=="prismatic"?(s=new b2PrismaticJointDef,this.loadJointCommonProperties(s,i,e,r),i.hasOwnProperty("localAxisA")&&s.localAxisA.SetV(this.getVectorValue(i.localAxisA)),i.hasOwnProperty("refAngle")&&(s.referenceAngle=i.refAngle),i.hasOwnProperty("enableLimit")&&(s.enableLimit=i.enableLimit),i.hasOwnProperty("lowerLimit")&&(s.lowerTranslation=i.lowerLimit),i.hasOwnProperty("upperLimit")&&(s.upperTranslation=i.upperLimit),i.hasOwnProperty("enableMotor")&&(s.enableMotor=i.enableMotor),i.hasOwnProperty("maxMotorForce")&&(s.maxMotorForce=i.maxMotorForce),i.hasOwnProperty("motorSpeed")&&(s.motorSpeed=i.motorSpeed),n=t.CreateJoint(s)):i.type=="wheel"?(s=new b2DistanceJointDef,this.loadJointCommonProperties(s,i,e,r),s.length=0,i.hasOwnProperty("springDampingRatio")&&(s.dampingRatio=i.springDampingRatio),i.hasOwnProperty("springFrequency")&&(s.frequencyHz=i.springFrequency),t.CreateJoint(s),s=new b2LineJointDef,this.loadJointCommonProperties(s,i,e,r),i.hasOwnProperty("localAxisA")&&s.localAxisA.SetV(this.getVectorValue(i.localAxisA)),n=t.CreateJoint(s)):i.type=="friction"?(s=new b2FrictionJointDef,this.loadJointCommonProperties(s,i,e,r),i.hasOwnProperty("maxForce")&&(s.maxForce=i.maxForce),i.hasOwnProperty("maxTorque")&&(s.maxTorque=i.maxTorque),n=t.CreateJoint(s)):i.type=="weld"?(s=new Dt.joints.b2WeldJointDef,this.loadJointCommonProperties(s,i,e,r),i.hasOwnProperty("referenceAngle")&&(s.referenceAngle=i.referenceAngle),n=t.CreateJoint(s)):console.log("Unsupported joint type: "+i.type),n&&i.name&&(n.name=i.name),i.hasOwnProperty("customProperties")&&(this.setCustomProperty(i,"int","loadingIndex",r),n.customProperties=i.customProperties),n};Xt.prototype.makeClone=function(i){var t=i instanceof Array?[]:{};for(var e in i)i[e]&&typeof i[e]=="object"?t[e]=this.makeClone(i[e]):t[e]=i[e];return t};Xt.prototype.loadImageFromRUBE=function(i,t,e){var r=this.makeClone(i);return r.hasOwnProperty("body")&&r.body>=0?r.body=e[r.body]:r.body=null,r.center=new Li,r.center.SetV(this.getVectorValue(i.center)),r};Xt.prototype.loadSceneFromRUBE=function(i){return this.loadSceneIntoWorld(i,world)};Xt.prototype.loadSceneIntoWorld=function(i,t,e){var r=!0,n=[];if(i.hasOwnProperty("body"))for(var s=0;s<i.body.length;s++){var a=i.body[s],o=this.loadBodyFromRUBE(a,t,e);o?n.push(o):r=!1}if(i.hasOwnProperty("joint"))for(var l=0;l<i.joint.length;l++){var c=i.joint[l];this.loadJointFromRUBE(c,t,n,e)}var f=[];if(i.hasOwnProperty("image")){for(var _=0;_<i.image.length;_++){var x=i.image[_],y=this.loadImageFromRUBE(x,t,n);y?f.push(y):r=!1}t.images=f}return r};Xt.prototype.loadWorldFromRUBE=function(i,t,e){var r=new Li(0,0);i.hasOwnProperty("gravity")&&i.gravity instanceof Object&&r.SetV(i.gravity);var n;if(typeof t<"u"&&t!==null?n=t:n=new iy(r),!this.loadSceneIntoWorld(i,n,e))throw{ErrorCode:"RUBE_LOADING_ERROR",ErrorMessage:"Could not load subworld"};return n};Xt.prototype.getNamedBodies=function(i,t){for(var e=[],r=i.m_bodyList;r;r=r.m_next)r.name==t&&e.push(r);return e};Xt.prototype.getBodiesWithNamesStartingWith=function(i,t){for(var e=[],r=i.m_bodyList;r;r=r.m_next)typeof r.name<"u"&&r.name.indexOf(t)===0&&e.push(r);return e.sort(function(n,s){return n.name>s.name?1:n.name<s.name?-1:0}),e};Xt.prototype.getBodies=function(i){for(var t=[],e=i.m_bodyList;e;e=e.m_next)t.push(e);return t};Xt.prototype.getNamedFixtures=function(i,t){for(var e=[],r=i.m_bodyList;r;r=r.m_next)for(var n=r.m_fixtureList;n;n=n.m_next)n.name==t&&e.push(n);return e};Xt.prototype.getNamedJoints=function(i,t){for(var e=[],r=i.m_jointList;r;r=r.m_next)r.name==t&&e.push(r);return e};Xt.prototype.getNamedImages=function(i,t){for(var e=[],r=0;r<i.images.length;r++)i.images[r].name==t&&e.push(i.images[r].name);return e};Xt.prototype.getBodiesByCustomProperty=function(i,t,e,r){for(var n=[],s=i.m_bodyList;s;s=s.m_next)if(s.hasOwnProperty("customProperties"))for(var a=0;a<s.customProperties.length;a++)s.customProperties[a].hasOwnProperty("name")&&s.customProperties[a].hasOwnProperty(t)&&s.customProperties[a].name==e&&s.customProperties[a][t]==r&&n.push(s);return n};Xt.prototype.filterElementsByCustomProperty=function(i,t,e,r){var n=[];for(var s in i){var a=i[s];if(a.hasOwnProperty("customProperties"))for(var s=0;s<a.customProperties.length;s++)a.customProperties[s].hasOwnProperty("name")&&a.customProperties[s].hasOwnProperty(t)&&a.customProperties[s].name==e&&a.customProperties[s][t]==r&&n.push(a)}return n};Xt.prototype.hasCustomProperty=function(i,t,e){if(!i.hasOwnProperty("customProperties"))return!1;for(var r=0;r<i.customProperties.length;r++)if(i.customProperties[r].hasOwnProperty("name")&&i.customProperties[r].hasOwnProperty(t))return!0;return!1};Xt.prototype.getCustomProperty=function(i,t,e,r){if(!i.hasOwnProperty("customProperties"))return r;for(var n=0;n<i.customProperties.length;n++)if(i.customProperties[n].hasOwnProperty("name")&&i.customProperties[n].hasOwnProperty(t)&&i.customProperties[n].name==e)return i.customProperties[n][t];return r};Xt.prototype.setCustomProperty=function(i,t,e,r){if(!i.hasOwnProperty("customProperties"))return r;for(var n=0;n<i.customProperties.length;n++)i.customProperties[n].hasOwnProperty("name")&&i.customProperties[n].hasOwnProperty(t)&&i.customProperties[n].name==e&&(i.customProperties[n][t]=r);return r};Xt.prototype.preprocessRube=function(i){var t,e,r,n,s,a,o,l,c,f,_,x,y;for(_=i.body,e=0,l=_.length;e<l;e++)if(a=_[e],a.position!==0&&(a.position.y=a.position.y*-1),typeof a.fixture<"u")for(x=a.fixture,n=0,c=x.length;n<c;n++){if(t=x[n],t.hasOwnProperty("polygon")){for(r in t.polygon.vertices.y)t.polygon.vertices.y[r]=-t.polygon.vertices.y[r];t.polygon.vertices.x.reverse(),t.polygon.vertices.y.reverse()}if(t.hasOwnProperty("chain")){for(r in t.chain.vertices.y)t.chain.vertices.y[r]=-t.chain.vertices.y[r];t.chain.vertices.x.reverse(),t.chain.vertices.y.reverse()}}if(i.hasOwnProperty("joint"))for(y=i.joint,o=0,f=y.length;o<f;o++)s=y[o],s.anchorA!==0&&(s.anchorA.y=s.anchorA.y*-1),s.anchorB!==0&&(s.anchorB.y=s.anchorB.y*-1),s.upperLimit=0,s.lowerLimit=0;return i};var Ve=function(){this.frontTires=[],this.rearTires=[],this.tires=[],this.tiresCount=0,this.localNormalVector=new Dt.cMath.b2Vec2(1,0),this.vCurrentRightNormals=[],this.linearVelocities=[],this.currentRightForwards=[],this.adherenceFactor=1,this.adherence=!0,this.drifting=!1,this.puddleEffect=!1,this.checkPointManager=null,this.directionJoints=[]};Ve.prototype.setBox2dData=function(i){return this.rearTires=i.rearTires,this.frontTires=i.frontTires,this.tires=this.rearTires.concat(this.frontTires),this.tiresCount=this.tires.length,this.directionJoints=i.directionJoints,this.b2Body=i.carBody,this.b2Body};Ve.prototype.setPosition=function(i){this.b2Body.SetPosition(i),this.foreachTire(function(t,e){t.SetPosition(i)})};Ve.prototype.updateData=function(){this.localAccelerationVector=new Dt.cMath.b2Vec2(0,-this.accelerationFactor),this.foreachTire((i,t)=>{this.linearVelocities[t]=this.getLinearVelocity(t),this.currentRightForwards[t]=i.GetWorldVector(new Dt.cMath.b2Vec2(0,1)),this.vCurrentRightNormals[t]=this.getLateralVelocity(t)})};Ve.prototype.negateTorque=function(i){return Dt.math.Dot(this.currentRightForwards[i],this.linearVelocities[i])<-.01?-1:1};Ve.prototype.getLateralVelocity=function(i){var t=this.tires[i].GetWorldVector(this.localNormalVector),e=Dt.math.MulFV(Dt.math.Dot(t,this.linearVelocities[i]),t);return e};Ve.prototype.getLinearVelocity=function(i){return this.tires[i].GetLinearVelocity()};Ve.prototype.getForwardVelocity=function(i){var t=Dt.math.MulFV(Dt.math.Dot(this.currentRightForwards[i],this.linearVelocities[i]),this.currentRightForwards[i]);return t};Ve.prototype.applyImpulse=function(i){this.foreachTire(function(t,e){Dt.applyForceToCenter(t,i)})};Ve.prototype.updateFriction=function(){this.foreachTire((i,t)=>{if(this.adherence){var e=Dt.findCustomPropertyValue(i,"category","string");e=="wheel_rear"&&this.drifting?this.adherenceFactor=this.carConfig.driftAdherenceFactor:this.adherenceFactor=this.carConfig.normalAdherenceFactor;var r=Dt.math.MulFV(-this.adherenceFactor*i.GetMass(),this.vCurrentRightNormals[t]);r.Length()>this.driftTrigger&&(r=Dt.math.MulFV(this.driftTrigger/r.Length(),r)),i.ApplyImpulse(r,i.GetWorldCenter())}var n=i.GetInertia(),s=i.GetAngularVelocity();i.ApplyAngularImpulse(10*n*-s);var a=this.getForwardVelocity([t]),o=a.Normalize(),l=-this.carConfig.natural_deceleration*o;i.ApplyForce(Dt.math.MulFV(l,a),i.GetWorldCenter()),this.puddleEffect&&i.ApplyTorque((this.puddleEffect?1:0)*this.carConfig.puddleFactor)})};Ve.prototype.foreachTire=function(i){for(var t=0;t<this.tires.length;t++)i.call(this,this.tires[t],t)};class ry extends vr{constructor(t,e,r){let n;if(r==null)for(let a in t){n=a;break}else n=r;const s=Array.isArray(t[n])?t[n]:[t[n]];super(s),this.sequences=t,this.currentSequence=n,this.anchor.set(.5,.5),this.animationSpeed=(e||60)/60,this.onComplete=null}gotoAndPlay(t){if(typeof t=="string"){if(this.currentSequence===t&&this.playing)return;this.currentSequence=t;const e=Array.isArray(this.sequences[t])?this.sequences[t]:[this.sequences[t]];this.textures=e,this.currentFrame=0}else this.currentFrame=t;this.play()}gotoAndStop(t){if(typeof t=="string"){if(this.currentSequence===t&&!this.playing)return;this.currentSequence=t;const e=Array.isArray(this.sequences[t])?this.sequences[t]:[this.sequences[t]];this.textures=e,this.currentFrame=0}else this.currentFrame=t;this.stop()}}var Zs=function(i){this.spriteType=i.spriteType,this.texturesMapping=null,this.sprite=null,this.sequences={},this.pixiContainer=i.pixiContainer,this.spriteType==="ship"&&(this.texturesMapping=Ot.spritesMapping.ships[i.index],this.buildMovingObjectSequences(),this.sprite=new ry(this.sequences),this.sprite.zIndex=10,this.pixiContainer.addChild(this.sprite),this.sprite.gotoAndStop("still"),this.sprite.visible=!0,console.log("Car sprite created"))};Zs.prototype.setState=function(i){this.sprite.gotoAndPlay(i)};Zs.prototype.buildMovingObjectSequences=function(){var i,t;this.sequences.still=[Pt.from(this.texturesMapping.still)];var e=[];for(i=1;i<=this.texturesMapping.turnRight.frames;i++)t=i+this.texturesMapping.turnRight.offset,t=t<10?"0"+t:t,e.push(Pt.from("right.0"+t+".png"));this.sequences.turnRight=e;var r=[];for(i=0;i<this.texturesMapping.turnLeft.frames;i++)t=i+this.texturesMapping.turnLeft.offset,t=t<10?"0"+t:t,r.push(Pt.from("left.0"+t+".png"));this.sequences.turnLeft=r};var Ee=function(i,t){this.carConfig=Ot.cars[i],this.accelerationFactor=this.carConfig.accelerationFactor,this.localAccelerationVector=new Dt.cMath.b2Vec2(0,-this.accelerationFactor),this.localBrakeVector=Dt.math.MulFV(-.5,this.localAccelerationVector),this.localHandBrakeVector=Dt.math.MulFV(-.5,this.localAccelerationVector),this.desiredAngle=0,this.lockAngleDeg=this.carConfig.wheelMaxAngle,this.driftTrigger=this.carConfig.driftTrigger,this.turnSpeedPerSec=Ot.cars[i].steeringWheelSpeed*Ot.consts.DEGTORAD,this.turnPerTimeStep=this.turnSpeedPerSec/60,this.spriteManager=new Zs({spriteType:"ship",index:i,pixiContainer:t})};Ee.prototype=new Ve;Ee.prototype.constructor=Ee;Ee.prototype.handleKeyboard=function(i){i.accelerate&&this.accelerate(),i.handbrake?this.handBrake():this.handBrakeRelease(),i.brake&&this.brake(),this.updateSteering(i)};Ee.prototype.updateSteering=function(i){var t,e,r;i.right&&!this.puddleEffect?(this.spriteManager.setState("turnRight"),this.desiredAngle=this.lockAngleDeg*Ot.consts.DEGTORAD):i.left&&!this.puddleEffect?(this.spriteManager.setState("turnLeft"),this.desiredAngle=-this.lockAngleDeg*Ot.consts.DEGTORAD):(this.desiredAngle=0,this.spriteManager.setState("still")),t=this.directionJoints[0].GetJointAngle(),e=this.desiredAngle-t,Math.abs(t)>this.lockAngleDeg?e=-t:e=Dt.math.Clamp(e,-this.turnPerTimeStep,this.turnPerTimeStep),r=t+e,this.directionJoints[0].SetLimits(r,r),this.directionJoints[1].SetLimits(r,r),this.updateFriction()};Ee.prototype.updateSpritePosition=function(){var i=this.b2Body.GetPosition();this.spriteManager.sprite.position.x=i.x*Ot.consts.METER,this.spriteManager.sprite.position.y=i.y*Ot.consts.METER,this.spriteManager.sprite.rotation=this.b2Body.GetAngle()};Ee.prototype.accelerate=function(){var i;for(i in this.tires)Dt.applyForceToCenter(this.tires[i],this.localAccelerationVector)};Ee.prototype.brake=function(){var i;for(i in this.tires)Dt.applyForceToCenter(this.tires[i],this.localBrakeVector)};Ee.prototype.handBrake=function(){var i;for(i in this.tires)Dt.applyForceToCenter(this.tires[i],this.localHandBrakeVector),this.drifting=!0};Ee.prototype.handBrakeRelease=function(){this.drifting=!1};var Ir=function(i){this.nbCheckPoints=i,this.currentCheckPointIndex=-1,this.startLap=null,this.lastLapTime=null,this.bestLapTime=0,this.nbLaps=0,this.updateLapTime(),this.updateBestLapTime()};Ir.prototype.step=function(i){var t,e;if(this.currentCheckPointIndex%this.nbCheckPoints!==i&&(i===0&&(this.currentCheckPointIndex===-1?(this.startLap=Date.now(),this.currentCheckPointIndex=0,this.updateLapTime(0)):(e=Date.now(),t=e-this.startLap,this.lastLapTime=t,this.startLap=e,this.bestLapTime===0?this.bestLapTime=this.lastLapTime:this.lastLapTime<this.bestLapTime&&(this.bestLapTime=this.lastLapTime),this.updateLapTime(this.lastLapTime),this.updateBestLapTime(this.bestLapTime))),i===(this.currentCheckPointIndex+1)%this.nbCheckPoints))return this.currentCheckPointIndex++};Ir.prototype.updateLapTime=function(i){var t=typeof i<"u"?(i/1e3).toFixed(2)+"s":"---";document.getElementById("lapTime").innerHTML="<span style='color: #AAA;'>Lap:</span> "+t};Ir.prototype.updateBestLapTime=function(i){var t=typeof i<"u"?(i/1e3).toFixed(2)+"s":"---";document.getElementById("bestLapTime").innerHTML="<span style='color: #AAA;'>Best:</span> "+t};var qe=function(i){this.elementsList=new Pr,this.resourceLoadingIndex=0,this.nextCarPositionAvailable=0,this.worldFacade=i,this.rubeFileLoader=new Xt,this.loaded={}};qe.prototype.addElement=function(i){this.elementsList.add(i.id,i.data,i.type),this.continueLoadingList(i.onAddedAndPlaced)};qe.prototype.continueLoadingList=function(i){if(this.elementsList.size>0){var t=this.elementsList.firstNode;this.elementsList.removeFirst(),console.log("Loading B2 element:",t.dataType,"from",t.data.jsonPath),Qd("GET",t.data.jsonPath).done(e=>{console.log("B2 element loaded:",t.dataType);var r=e.getBody();this.loadRawJson(r,t,i),this.continueLoadingList()})}};qe.prototype.loadRawJson=function(i,t,e){var r=this.rubeFileLoader.preprocessRube(JSON.parse(i));this.worldFacade.b2World=this.rubeFileLoader.loadWorldFromRUBE(r,this.worldFacade.b2World,this.resourceLoadingIndex),t.dataType==="track"?this.loaded[t.id]=this.extractAndPlaceTrack():t.dataType==="car"&&(this.loaded[t.id]=this.extractAndPlaceLastCarAdded(),this.nextCarPositionAvailable+=1),this.resourceLoadingIndex+=1,console.log("Calling onAddedAndPlaced for",t.dataType),e.call(this,this.loaded[t.id]),console.log("onAddedAndPlaced finished for",t.dataType)};qe.prototype.extractAndPlaceTrack=function(){var i,t,e,r,n={allBodies:this.rubeFileLoader.getBodies(this.worldFacade.b2World),startPositions:this.rubeFileLoader.getBodiesWithNamesStartingWith(this.worldFacade.b2World,"start"),iaLine:this.rubeFileLoader.getBodiesByCustomProperty(this.worldFacade.b2World,"string","category","iaLine")[0]};for(i=0,t=n.allBodies.length;i<t;i++)r=n.allBodies[i],e=r.GetPosition(),r.SetPosition(Dt.math.AddVV(Dt.ScreenCenterVector,e));return this.worldFacade.trackBodySet=n,n};qe.prototype.extractAndPlaceLastCarAdded=function(){var i={carBody:this.findElementInWorldByNameAndResourceIndex("car_body")[0],rearTires:this.findElementInWorldByNameAndResourceIndex("wheel_rear"),frontTires:this.findElementInWorldByNameAndResourceIndex("wheel_front"),directionJoints:this.findJointInWorld("direction")},t,e=-Math.PI/2;t=this.worldFacade.trackBodySet.startPositions[this.nextCarPositionAvailable].GetPosition(),i.carBody.SetPosition(t),i.carBody.SetAngle(e);for(var r=0;r<i.rearTires.length;r++)i.rearTires[r].SetPosition(t),i.rearTires[r].SetAngle(e);for(r=0;r<i.frontTires.length;r++)i.frontTires[r].SetPosition(t),i.frontTires[r].SetAngle(e);return i};qe.prototype.findElementInWorldByNameAndResourceIndex=function(i){var t=this.findInWorld(i);return this.rubeFileLoader.filterElementsByCustomProperty(t,"int","loadingIndex",this.resourceLoadingIndex)};qe.prototype.findInWorld=function(i){return this.rubeFileLoader.getBodiesWithNamesStartingWith(this.worldFacade.b2World,i)};qe.prototype.findJointInWorld=function(i){var t=this.rubeFileLoader.getNamedJoints(this.worldFacade.b2World,i);return this.rubeFileLoader.filterElementsByCustomProperty(t,"int","loadingIndex",this.resourceLoadingIndex)};var Qs=function(){this.keyArray=[],this.keys={accelerate:!1,brake:!1,left:!1,right:!1,handbrake:!1},this.handledKeys=[37,38,39,40,32]};Qs.prototype.handleKeyDown=function(i){var t,e;if(t=i.which,this.handledKeys.indexOf(t)>-1&&i.preventDefault(),!(this.keyArray.indexOf(t)>-1)){switch(e=!0,t){case 37:this.keys.left=!0;break;case 38:this.keys.accelerate=!0;break;case 39:this.keys.right=!0;break;case 40:this.keys.brake=!0;break;case 32:this.keys.handbrake=!0;break;default:e=!1}e&&this.keyArray.push(t)}};Qs.prototype.handleKeyUp=function(i){var t,e;switch(e=i.which,t=this.keyArray.indexOf(e),t>-1&&this.keyArray.splice(t,1),e){case 37:this.keys.left=!1;break;case 38:this.keys.accelerate=!1;break;case 39:this.keys.right=!1;break;case 40:this.keys.brake=!1;break;case 32:this.keys.handbrake=!1;break}};const Di=new Qs;var ar={exports:{}},fs={exports:{}},Cl;function ny(){if(Cl)return fs.exports;Cl=1;var i=fs.exports=i||{};return i.gui=i.gui||{},i.utils=i.utils||{},i.controllers=i.controllers||{},i.dom=i.dom||{},i.color=i.color||{},i.utils.css=(function(){return{load:function(t,e){e=e||document;var r=e.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=t,e.getElementsByTagName("head")[0].appendChild(r)},inject:function(t,e){e=e||document;var r=document.createElement("style");r.type="text/css",r.innerHTML=t,e.getElementsByTagName("head")[0].appendChild(r)}}})(),i.utils.common=(function(){var t=Array.prototype.forEach,e=Array.prototype.slice;return{BREAK:{},extend:function(r){return this.each(e.call(arguments,1),function(n){for(var s in n)this.isUndefined(n[s])||(r[s]=n[s])},this),r},defaults:function(r){return this.each(e.call(arguments,1),function(n){for(var s in n)this.isUndefined(r[s])&&(r[s]=n[s])},this),r},compose:function(){var r=e.call(arguments);return function(){for(var n=e.call(arguments),s=r.length-1;s>=0;s--)n=[r[s].apply(this,n)];return n[0]}},each:function(r,n,s){if(t&&r.forEach===t)r.forEach(n,s);else if(r.length===r.length+0){for(var a=0,o=r.length;a<o;a++)if(a in r&&n.call(s,r[a],a)===this.BREAK)return}else for(var a in r)if(n.call(s,r[a],a)===this.BREAK)return},defer:function(r){setTimeout(r,0)},toArray:function(r){return r.toArray?r.toArray():e.call(r)},isUndefined:function(r){return r===void 0},isNull:function(r){return r===null},isNaN:function(r){return r!==r},isArray:Array.isArray||function(r){return r.constructor===Array},isObject:function(r){return r===Object(r)},isNumber:function(r){return r===r+0},isString:function(r){return r===r+""},isBoolean:function(r){return r===!1||r===!0},isFunction:function(r){return Object.prototype.toString.call(r)==="[object Function]"}}})(),i.controllers.Controller=(function(t){var e=function(r,n){this.initialValue=r[n],this.domElement=document.createElement("div"),this.object=r,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0};return t.extend(e.prototype,{onChange:function(r){return this.__onChange=r,this},onFinishChange:function(r){return this.__onFinishChange=r,this},setValue:function(r){return this.object[this.property]=r,this.__onChange&&this.__onChange.call(this,r),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),e})(i.utils.common),i.dom.dom=(function(t){var e={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},r={};t.each(e,function(o,l){t.each(o,function(c){r[c]=l})});var n=/(\d+(\.\d+)?)px/;function s(o){if(o==="0"||t.isUndefined(o))return 0;var l=o.match(n);return t.isNull(l)?0:parseFloat(l[1])}var a={makeSelectable:function(o,l){o===void 0||o.style===void 0||(o.onselectstart=l?function(){return!1}:function(){},o.style.MozUserSelect=l?"auto":"none",o.style.KhtmlUserSelect=l?"auto":"none",o.unselectable=l?"on":"off")},makeFullscreen:function(o,l,c){t.isUndefined(l)&&(l=!0),t.isUndefined(c)&&(c=!0),o.style.position="absolute",l&&(o.style.left=0,o.style.right=0),c&&(o.style.top=0,o.style.bottom=0)},fakeEvent:function(o,l,c,f){c=c||{};var _=r[l];if(!_)throw new Error("Event type "+l+" not supported.");var x=document.createEvent(_);switch(_){case"MouseEvents":var y=c.x||c.clientX||0,M=c.y||c.clientY||0;x.initMouseEvent(l,c.bubbles||!1,c.cancelable||!0,window,c.clickCount||1,0,0,y,M,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var G=x.initKeyboardEvent||x.initKeyEvent;t.defaults(c,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),G(l,c.bubbles||!1,c.cancelable,window,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,c.keyCode,c.charCode);break;default:x.initEvent(l,c.bubbles||!1,c.cancelable||!0);break}t.defaults(x,f),o.dispatchEvent(x)},bind:function(o,l,c,f){return f=f||!1,o.addEventListener?o.addEventListener(l,c,f):o.attachEvent&&o.attachEvent("on"+l,c),a},unbind:function(o,l,c,f){return f=f||!1,o.removeEventListener?o.removeEventListener(l,c,f):o.detachEvent&&o.detachEvent("on"+l,c),a},addClass:function(o,l){if(o.className===void 0)o.className=l;else if(o.className!==l){var c=o.className.split(/ +/);c.indexOf(l)==-1&&(c.push(l),o.className=c.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return a},removeClass:function(o,l){if(l){if(o.className!==void 0)if(o.className===l)o.removeAttribute("class");else{var c=o.className.split(/ +/),f=c.indexOf(l);f!=-1&&(c.splice(f,1),o.className=c.join(" "))}}else o.className=void 0;return a},hasClass:function(o,l){return new RegExp("(?:^|\\s+)"+l+"(?:\\s+|$)").test(o.className)||!1},getWidth:function(o){var l=getComputedStyle(o);return s(l["border-left-width"])+s(l["border-right-width"])+s(l["padding-left"])+s(l["padding-right"])+s(l.width)},getHeight:function(o){var l=getComputedStyle(o);return s(l["border-top-width"])+s(l["border-bottom-width"])+s(l["padding-top"])+s(l["padding-bottom"])+s(l.height)},getOffset:function(o){var l={left:0,top:0};if(o.offsetParent)do l.left+=o.offsetLeft,l.top+=o.offsetTop;while(o=o.offsetParent);return l},isActive:function(o){return o===document.activeElement&&(o.type||o.href)}};return a})(i.utils.common),i.controllers.OptionController=(function(t,e,r){var n=function(s,a,o){n.superclass.call(this,s,a);var l=this;if(this.__select=document.createElement("select"),r.isArray(o)){var c={};r.each(o,function(f){c[f]=f}),o=c}r.each(o,function(f,_){var x=document.createElement("option");x.innerHTML=_,x.setAttribute("value",f),l.__select.appendChild(x)}),this.updateDisplay(),e.bind(this.__select,"change",function(){var f=this.options[this.selectedIndex].value;l.setValue(f)}),this.domElement.appendChild(this.__select)};return n.superclass=t,r.extend(n.prototype,t.prototype,{setValue:function(s){var a=n.superclass.prototype.setValue.call(this,s);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),a},updateDisplay:function(){return this.__select.value=this.getValue(),n.superclass.prototype.updateDisplay.call(this)}}),n})(i.controllers.Controller,i.dom.dom,i.utils.common),i.controllers.NumberController=(function(t,e){var r=function(s,a,o){r.superclass.call(this,s,a),o=o||{},this.__min=o.min,this.__max=o.max,this.__step=o.step,e.isUndefined(this.__step)?this.initialValue==0?this.__impliedStep=1:this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step,this.__precision=n(this.__impliedStep)};r.superclass=t,e.extend(r.prototype,t.prototype,{setValue:function(s){return this.__min!==void 0&&s<this.__min?s=this.__min:this.__max!==void 0&&s>this.__max&&(s=this.__max),this.__step!==void 0&&s%this.__step!=0&&(s=Math.round(s/this.__step)*this.__step),r.superclass.prototype.setValue.call(this,s)},min:function(s){return this.__min=s,this},max:function(s){return this.__max=s,this},step:function(s){return this.__step=s,this}});function n(s){return s=s.toString(),s.indexOf(".")>-1?s.length-s.indexOf(".")-1:0}return r})(i.controllers.Controller,i.utils.common),i.controllers.NumberControllerBox=(function(t,e,r){var n=function(a,o,l){this.__truncationSuspended=!1,n.superclass.call(this,a,o,l);var c=this,f;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),e.bind(this.__input,"change",_),e.bind(this.__input,"blur",x),e.bind(this.__input,"mousedown",y),e.bind(this.__input,"keydown",function(h){h.keyCode===13&&(c.__truncationSuspended=!0,this.blur(),c.__truncationSuspended=!1)});function _(){var h=parseFloat(c.__input.value);r.isNaN(h)||c.setValue(h)}function x(){_(),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function y(h){e.bind(window,"mousemove",M),e.bind(window,"mouseup",G),f=h.clientY}function M(h){var v=f-h.clientY;c.setValue(c.getValue()+v*c.__impliedStep),f=h.clientY}function G(){e.unbind(window,"mousemove",M),e.unbind(window,"mouseup",G)}this.updateDisplay(),this.domElement.appendChild(this.__input)};n.superclass=t,r.extend(n.prototype,t.prototype,{updateDisplay:function(){return this.__input.value=this.__truncationSuspended?this.getValue():s(this.getValue(),this.__precision),n.superclass.prototype.updateDisplay.call(this)}});function s(a,o){var l=Math.pow(10,o);return Math.round(a*l)/l}return n})(i.controllers.NumberController,i.dom.dom,i.utils.common),i.controllers.NumberControllerSlider=(function(t,e,r,n,s){var a=function(l,c,f,_,x){a.superclass.call(this,l,c,{min:f,max:_,step:x});var y=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),e.bind(this.__background,"mousedown",M),e.addClass(this.__background,"slider"),e.addClass(this.__foreground,"slider-fg");function M(v){e.bind(window,"mousemove",G),e.bind(window,"mouseup",h),G(v)}function G(v){v.preventDefault();var C=e.getOffset(y.__background),E=e.getWidth(y.__background);return y.setValue(o(v.clientX,C.left,C.left+E,y.__min,y.__max)),!1}function h(){e.unbind(window,"mousemove",G),e.unbind(window,"mouseup",h),y.__onFinishChange&&y.__onFinishChange.call(y,y.getValue())}this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};a.superclass=t,a.useDefaultStyles=function(){r.inject(s)},n.extend(a.prototype,t.prototype,{updateDisplay:function(){var l=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=l*100+"%",a.superclass.prototype.updateDisplay.call(this)}});function o(l,c,f,_,x){return _+(x-_)*((l-c)/(f-c))}return a})(i.controllers.NumberController,i.dom.dom,i.utils.css,i.utils.common,`.slider {
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);
  height: 1em;
  border-radius: 1em;
  background-color: #eee;
  padding: 0 0.5em;
  overflow: hidden;
}

.slider-fg {
  padding: 1px 0 2px 0;
  background-color: #aaa;
  height: 1em;
  margin-left: -0.5em;
  padding-right: 0.5em;
  border-radius: 1em 0 0 1em;
}

.slider-fg:after {
  display: inline-block;
  border-radius: 1em;
  background-color: #fff;
  border:  1px solid #aaa;
  content: '';
  float: right;
  margin-right: -1em;
  margin-top: -1px;
  height: 0.9em;
  width: 0.9em;
}`),i.controllers.FunctionController=(function(t,e,r){var n=function(s,a,o){n.superclass.call(this,s,a);var l=this;this.__button=document.createElement("div"),this.__button.innerHTML=o===void 0?"Fire":o,e.bind(this.__button,"click",function(c){return c.preventDefault(),l.fire(),!1}),e.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return n.superclass=t,r.extend(n.prototype,t.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),n})(i.controllers.Controller,i.dom.dom,i.utils.common),i.controllers.BooleanController=(function(t,e,r){var n=function(s,a){n.superclass.call(this,s,a);var o=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),e.bind(this.__checkbox,"change",l,!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay();function l(){o.setValue(!o.__prev)}};return n.superclass=t,r.extend(n.prototype,t.prototype,{setValue:function(s){var a=n.superclass.prototype.setValue.call(this,s);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),a},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,n.superclass.prototype.updateDisplay.call(this)}}),n})(i.controllers.Controller,i.dom.dom,i.utils.common),i.color.toString=(function(t){return function(e){if(e.a==1||t.isUndefined(e.a)){for(var r=e.hex.toString(16);r.length<6;)r="0"+r;return"#"+r}else return"rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+e.a+")"}})(i.utils.common),i.color.interpret=(function(t,e){var r,n,s=function(){n=!1;var o=arguments.length>1?e.toArray(arguments):arguments[0];return e.each(a,function(l){if(l.litmus(o))return e.each(l.conversions,function(c,f){if(r=c.read(o),n===!1&&r!==!1)return n=r,r.conversionName=f,r.conversion=c,e.BREAK}),e.BREAK}),n},a=[{litmus:e.isString,conversions:{THREE_CHAR_HEX:{read:function(o){var l=o.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return l===null?!1:{space:"HEX",hex:parseInt("0x"+l[1].toString()+l[1].toString()+l[2].toString()+l[2].toString()+l[3].toString()+l[3].toString())}},write:t},SIX_CHAR_HEX:{read:function(o){var l=o.match(/^#([A-F0-9]{6})$/i);return l===null?!1:{space:"HEX",hex:parseInt("0x"+l[1].toString())}},write:t},CSS_RGB:{read:function(o){var l=o.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return l===null?!1:{space:"RGB",r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3])}},write:t},CSS_RGBA:{read:function(o){var l=o.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return l===null?!1:{space:"RGB",r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3]),a:parseFloat(l[4])}},write:t}}},{litmus:e.isNumber,conversions:{HEX:{read:function(o){return{space:"HEX",hex:o,conversionName:"HEX"}},write:function(o){return o.hex}}}},{litmus:e.isArray,conversions:{RGB_ARRAY:{read:function(o){return o.length!=3?!1:{space:"RGB",r:o[0],g:o[1],b:o[2]}},write:function(o){return[o.r,o.g,o.b]}},RGBA_ARRAY:{read:function(o){return o.length!=4?!1:{space:"RGB",r:o[0],g:o[1],b:o[2],a:o[3]}},write:function(o){return[o.r,o.g,o.b,o.a]}}}},{litmus:e.isObject,conversions:{RGBA_OBJ:{read:function(o){return e.isNumber(o.r)&&e.isNumber(o.g)&&e.isNumber(o.b)&&e.isNumber(o.a)?{space:"RGB",r:o.r,g:o.g,b:o.b,a:o.a}:!1},write:function(o){return{r:o.r,g:o.g,b:o.b,a:o.a}}},RGB_OBJ:{read:function(o){return e.isNumber(o.r)&&e.isNumber(o.g)&&e.isNumber(o.b)?{space:"RGB",r:o.r,g:o.g,b:o.b}:!1},write:function(o){return{r:o.r,g:o.g,b:o.b}}},HSVA_OBJ:{read:function(o){return e.isNumber(o.h)&&e.isNumber(o.s)&&e.isNumber(o.v)&&e.isNumber(o.a)?{space:"HSV",h:o.h,s:o.s,v:o.v,a:o.a}:!1},write:function(o){return{h:o.h,s:o.s,v:o.v,a:o.a}}},HSV_OBJ:{read:function(o){return e.isNumber(o.h)&&e.isNumber(o.s)&&e.isNumber(o.v)?{space:"HSV",h:o.h,s:o.s,v:o.v}:!1},write:function(o){return{h:o.h,s:o.s,v:o.v}}}}}];return s})(i.color.toString,i.utils.common),i.GUI=i.gui.GUI=(function(t,e,r,n,s,a,o,l,c,f,_,x,y,M,G){t.inject(r);var h="dg",v=72,C=20,E="Default",k=(function(){try{return"localStorage"in window&&window.localStorage!==null}catch{return!1}})(),J,N=!0,H,$=!1,j=[],K=function(m){var P=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),M.addClass(this.domElement,h),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],m=m||{},m=G.defaults(m,{autoPlace:!0,width:K.DEFAULT_WIDTH}),m=G.defaults(m,{resizable:m.autoPlace,hideable:m.autoPlace}),G.isUndefined(m.load)?m.load={preset:E}:m.preset&&(m.load.preset=m.preset),G.isUndefined(m.parent)&&m.hideable&&j.push(this),m.resizable=G.isUndefined(m.parent)&&m.resizable,m.autoPlace&&G.isUndefined(m.scrollable)&&(m.scrollable=!0);var T=k&&localStorage.getItem(A(this,"isLocal"))==="true";if(Object.defineProperties(this,{parent:{get:function(){return m.parent}},scrollable:{get:function(){return m.scrollable}},autoPlace:{get:function(){return m.autoPlace}},preset:{get:function(){return P.parent?P.getRoot().preset:m.load.preset},set:function(Y){P.parent?P.getRoot().preset=Y:m.load.preset=Y,V(this),P.revert()}},width:{get:function(){return m.width},set:function(Y){m.width=Y,U(P,Y)}},name:{get:function(){return m.name},set:function(Y){m.name=Y,O&&(O.innerHTML=m.name)}},closed:{get:function(){return m.closed},set:function(Y){m.closed=Y,m.closed?M.addClass(P.__ul,K.CLASS_CLOSED):M.removeClass(P.__ul,K.CLASS_CLOSED),this.onResize(),P.__closeButton&&(P.__closeButton.innerHTML=Y?K.TEXT_OPEN:K.TEXT_CLOSED)}},load:{get:function(){return m.load}},useLocalStorage:{get:function(){return T},set:function(Y){k&&(T=Y,Y?M.bind(window,"unload",q):M.unbind(window,"unload",q),localStorage.setItem(A(P,"isLocal"),Y))}}}),G.isUndefined(m.parent)){if(m.closed=!1,M.addClass(this.domElement,K.CLASS_MAIN),M.makeSelectable(this.domElement,!1),k&&T){P.useLocalStorage=!0;var L=localStorage.getItem(A(this,"gui"));L&&(m.load=JSON.parse(L))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=K.TEXT_CLOSED,M.addClass(this.__closeButton,K.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),M.bind(this.__closeButton,"click",function(){P.closed=!P.closed})}else{m.closed===void 0&&(m.closed=!0);var O=document.createTextNode(m.name);M.addClass(O,"controller-name");var R=B(P,O),z=function(Y){return Y.preventDefault(),P.closed=!P.closed,!1};M.addClass(this.__ul,K.CLASS_CLOSED),M.addClass(R,"title"),M.bind(R,"click",z),m.closed||(this.closed=!1)}m.autoPlace&&(G.isUndefined(m.parent)&&(N&&(H=document.createElement("div"),M.addClass(H,h),M.addClass(H,K.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(H),N=!1),H.appendChild(this.domElement),M.addClass(this.domElement,K.CLASS_AUTO_PLACE)),this.parent||U(P,m.width)),M.bind(window,"resize",function(){P.onResize()}),M.bind(this.__ul,"webkitTransitionEnd",function(){P.onResize()}),M.bind(this.__ul,"transitionend",function(){P.onResize()}),M.bind(this.__ul,"oTransitionEnd",function(){P.onResize()}),this.onResize(),m.resizable&&W(this);function q(){localStorage.setItem(A(P,"gui"),JSON.stringify(P.getSaveObject()))}P.getRoot();function X(){var Y=P.getRoot();Y.width+=1,G.defer(function(){Y.width-=1})}m.parent||X()};K.toggleHide=function(){$=!$,G.each(j,function(m){m.domElement.style.zIndex=$?-999:999,m.domElement.style.opacity=$?0:1})},K.CLASS_AUTO_PLACE="a",K.CLASS_AUTO_PLACE_CONTAINER="ac",K.CLASS_MAIN="main",K.CLASS_CONTROLLER_ROW="cr",K.CLASS_TOO_TALL="taller-than-window",K.CLASS_CLOSED="closed",K.CLASS_CLOSE_BUTTON="close-button",K.CLASS_DRAG="drag",K.DEFAULT_WIDTH=245,K.TEXT_CLOSED="Close Controls",K.TEXT_OPEN="Open Controls",M.bind(window,"keydown",function(m){document.activeElement.type!=="text"&&(m.which===v||m.keyCode==v)&&K.toggleHide()},!1),G.extend(K.prototype,{add:function(m,P){return rt(this,m,P,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(m,P){return rt(this,m,P,{color:!0})},remove:function(m){this.__ul.removeChild(m.__li),this.__controllers.slice(this.__controllers.indexOf(m),1);var P=this;G.defer(function(){P.onResize()})},destroy:function(){this.autoPlace&&H.removeChild(this.domElement)},addFolder:function(m){if(this.__folders[m]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+m+'"');var P={name:m,parent:this};P.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[m]&&(P.closed=this.load.folders[m].closed,P.load=this.load.folders[m]);var T=new K(P);this.__folders[m]=T;var L=B(this,T.domElement);return M.addClass(L,"folder"),T},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var m=this.getRoot();if(m.scrollable){var P=M.getOffset(m.__ul).top,T=0;G.each(m.__ul.childNodes,function(L){m.autoPlace&&L===m.__save_row||(T+=M.getHeight(L))}),window.innerHeight-P-C<T?(M.addClass(m.domElement,K.CLASS_TOO_TALL),m.__ul.style.height=window.innerHeight-P-C+"px"):(M.removeClass(m.domElement,K.CLASS_TOO_TALL),m.__ul.style.height="auto")}m.__resize_handle&&G.defer(function(){m.__resize_handle.style.height=m.__ul.offsetHeight+"px"}),m.__closeButton&&(m.__closeButton.style.width=m.width+"px")},remember:function(){if(G.isUndefined(J)&&(J=new y,J.domElement.innerHTML=e),this.parent)throw new Error("You can only call remember on a top level GUI.");var m=this;G.each(Array.prototype.slice.call(arguments),function(P){m.__rememberedObjects.length==0&&D(m),m.__rememberedObjects.indexOf(P)==-1&&m.__rememberedObjects.push(P)}),this.autoPlace&&U(this,this.width)},getRoot:function(){for(var m=this;m.parent;)m=m.parent;return m},getSaveObject:function(){var m=this.load;return m.closed=this.closed,this.__rememberedObjects.length>0&&(m.preset=this.preset,m.remembered||(m.remembered={}),m.remembered[this.preset]=u(this)),m.folders={},G.each(this.__folders,function(P,T){m.folders[T]=P.getSaveObject()}),m},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=u(this),d(this,!1)},saveAs:function(m){this.load.remembered||(this.load.remembered={},this.load.remembered[E]=u(this,!0)),this.load.remembered[m]=u(this),this.preset=m,g(this,m,!0)},revert:function(m){G.each(this.__controllers,function(P){this.getRoot().load.remembered?F(m||this.getRoot(),P):P.setValue(P.initialValue)},this),G.each(this.__folders,function(P){P.revert(P)}),m||d(this.getRoot(),!1)},listen:function(m){var P=this.__listening.length==0;this.__listening.push(m),P&&w(this.__listening)}});function rt(m,P,T,L){if(P[T]===void 0)throw new Error("Object "+P+' has no property "'+T+'"');var O;if(L.color)O=new _(P,T);else{var R=[P,T].concat(L.factoryArgs);O=n.apply(m,R)}L.before instanceof s&&(L.before=L.before.__li),F(m,O),M.addClass(O.domElement,"c");var z=document.createElement("span");M.addClass(z,"property-name"),z.innerHTML=O.property;var q=document.createElement("div");q.appendChild(z),q.appendChild(O.domElement);var X=B(m,q,L.before);return M.addClass(X,K.CLASS_CONTROLLER_ROW),M.addClass(X,typeof O.getValue()),I(m,X,O),m.__controllers.push(O),O}function B(m,P,T){var L=document.createElement("li");return P&&L.appendChild(P),T?m.__ul.insertBefore(L,params.before):m.__ul.appendChild(L),m.onResize(),L}function I(m,P,T){if(T.__li=P,T.__gui=m,G.extend(T,{options:function(R){if(arguments.length>1)return T.remove(),rt(m,T.object,T.property,{before:T.__li.nextElementSibling,factoryArgs:[G.toArray(arguments)]});if(G.isArray(R)||G.isObject(R))return T.remove(),rt(m,T.object,T.property,{before:T.__li.nextElementSibling,factoryArgs:[R]})},name:function(R){return T.__li.firstElementChild.firstElementChild.innerHTML=R,T},listen:function(){return T.__gui.listen(T),T},remove:function(){return T.__gui.remove(T),T}}),T instanceof c){var L=new l(T.object,T.property,{min:T.__min,max:T.__max,step:T.__step});G.each(["updateDisplay","onChange","onFinishChange"],function(R){var z=T[R],q=L[R];T[R]=L[R]=function(){var X=Array.prototype.slice.call(arguments);return z.apply(T,X),q.apply(L,X)}}),M.addClass(P,"has-slider"),T.domElement.insertBefore(L.domElement,T.domElement.firstElementChild)}else if(T instanceof l){var O=function(R){return G.isNumber(T.__min)&&G.isNumber(T.__max)?(T.remove(),rt(m,T.object,T.property,{before:T.__li.nextElementSibling,factoryArgs:[T.__min,T.__max,T.__step]})):R};T.min=G.compose(O,T.min),T.max=G.compose(O,T.max)}else T instanceof a?(M.bind(P,"click",function(){M.fakeEvent(T.__checkbox,"click")}),M.bind(T.__checkbox,"click",function(R){R.stopPropagation()})):T instanceof o?(M.bind(P,"click",function(){M.fakeEvent(T.__button,"click")}),M.bind(P,"mouseover",function(){M.addClass(T.__button,"hover")}),M.bind(P,"mouseout",function(){M.removeClass(T.__button,"hover")})):T instanceof _&&(M.addClass(P,"color"),T.updateDisplay=G.compose(function(R){return P.style.borderLeftColor=T.__color.toString(),R},T.updateDisplay),T.updateDisplay());T.setValue=G.compose(function(R){return m.getRoot().__preset_select&&T.isModified()&&d(m.getRoot(),!0),R},T.setValue)}function F(m,P){var T=m.getRoot(),L=T.__rememberedObjects.indexOf(P.object);if(L!=-1){var O=T.__rememberedObjectIndecesToControllers[L];if(O===void 0&&(O={},T.__rememberedObjectIndecesToControllers[L]=O),O[P.property]=P,T.load&&T.load.remembered){var R=T.load.remembered,z;if(R[m.preset])z=R[m.preset];else if(R[E])z=R[E];else return;if(z[L]&&z[L][P.property]!==void 0){var q=z[L][P.property];P.initialValue=q,P.setValue(q)}}}}function A(m,P){return document.location.href+"."+P}function D(m){var P=m.__save_row=document.createElement("li");M.addClass(m.domElement,"has-save"),m.__ul.insertBefore(P,m.__ul.firstChild),M.addClass(P,"save-row");var T=document.createElement("span");T.innerHTML="&nbsp;",M.addClass(T,"button gears");var L=document.createElement("span");L.innerHTML="Save",M.addClass(L,"button"),M.addClass(L,"save");var O=document.createElement("span");O.innerHTML="New",M.addClass(O,"button"),M.addClass(O,"save-as");var R=document.createElement("span");R.innerHTML="Revert",M.addClass(R,"button"),M.addClass(R,"revert");var z=m.__preset_select=document.createElement("select");if(m.load&&m.load.remembered?G.each(m.load.remembered,function(tt,at){g(m,at,at==m.preset)}):g(m,E,!1),M.bind(z,"change",function(){for(var tt=0;tt<m.__preset_select.length;tt++)m.__preset_select[tt].innerHTML=m.__preset_select[tt].value;m.preset=this.value}),P.appendChild(z),P.appendChild(T),P.appendChild(L),P.appendChild(O),P.appendChild(R),k){let tt=function(){X.style.display=m.useLocalStorage?"block":"none"};var q=document.getElementById("dg-save-locally"),X=document.getElementById("dg-local-explain");q.style.display="block";var Y=document.getElementById("dg-local-storage");localStorage.getItem(A(m,"isLocal"))==="true"&&Y.setAttribute("checked","checked"),tt(),M.bind(Y,"change",function(){m.useLocalStorage=!m.useLocalStorage,tt()})}var Q=document.getElementById("dg-new-constructor");M.bind(Q,"keydown",function(tt){tt.metaKey&&(tt.which===67||tt.keyCode==67)&&J.hide()}),M.bind(T,"click",function(){Q.innerHTML=JSON.stringify(m.getSaveObject(),void 0,2),J.show(),Q.focus(),Q.select()}),M.bind(L,"click",function(){m.save()}),M.bind(O,"click",function(){var tt=prompt("Enter a new preset name.");tt&&m.saveAs(tt)}),M.bind(R,"click",function(){m.revert()})}function W(m){m.__resize_handle=document.createElement("div"),G.extend(m.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var P;M.bind(m.__resize_handle,"mousedown",T),M.bind(m.__closeButton,"mousedown",T),m.domElement.insertBefore(m.__resize_handle,m.domElement.firstElementChild);function T(R){return R.preventDefault(),P=R.clientX,M.addClass(m.__closeButton,K.CLASS_DRAG),M.bind(window,"mousemove",L),M.bind(window,"mouseup",O),!1}function L(R){return R.preventDefault(),m.width+=P-R.clientX,m.onResize(),P=R.clientX,!1}function O(){M.removeClass(m.__closeButton,K.CLASS_DRAG),M.unbind(window,"mousemove",L),M.unbind(window,"mouseup",O)}}function U(m,P){m.domElement.style.width=P+"px",m.__save_row&&m.autoPlace&&(m.__save_row.style.width=P+"px"),m.__closeButton&&(m.__closeButton.style.width=P+"px")}function u(m,P){var T={};return G.each(m.__rememberedObjects,function(L,O){var R={},z=m.__rememberedObjectIndecesToControllers[O];G.each(z,function(q,X){R[X]=P?q.initialValue:q.getValue()}),T[O]=R}),T}function g(m,P,T){var L=document.createElement("option");L.innerHTML=P,L.value=P,m.__preset_select.appendChild(L),T&&(m.__preset_select.selectedIndex=m.__preset_select.length-1)}function V(m){for(var P=0;P<m.__preset_select.length;P++)m.__preset_select[P].value==m.preset&&(m.__preset_select.selectedIndex=P)}function d(m,P){var T=m.__preset_select[m.__preset_select.selectedIndex];P?T.innerHTML=T.value+"*":T.innerHTML=T.value}function w(m){m.length!=0&&x(function(){w(m)}),G.each(m,function(P){P.updateDisplay()})}return K})(i.utils.css,`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.
      
    </div>
    
  </div>

</div>`,`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`,i.controllers.factory=(function(t,e,r,n,s,a,o){return function(l,c){var f=l[c];if(o.isArray(arguments[2])||o.isObject(arguments[2]))return new t(l,c,arguments[2]);if(o.isNumber(f))return o.isNumber(arguments[2])&&o.isNumber(arguments[3])?new r(l,c,arguments[2],arguments[3]):new e(l,c,{min:arguments[2],max:arguments[3]});if(o.isString(f))return new n(l,c);if(o.isFunction(f))return new s(l,c,"");if(o.isBoolean(f))return new a(l,c)}})(i.controllers.OptionController,i.controllers.NumberControllerBox,i.controllers.NumberControllerSlider,i.controllers.StringController=(function(t,e,r){var n=function(s,a){n.superclass.call(this,s,a);var o=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),e.bind(this.__input,"keyup",l),e.bind(this.__input,"change",l),e.bind(this.__input,"blur",c),e.bind(this.__input,"keydown",function(f){f.keyCode===13&&this.blur()});function l(){o.setValue(o.__input.value)}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}this.updateDisplay(),this.domElement.appendChild(this.__input)};return n.superclass=t,r.extend(n.prototype,t.prototype,{updateDisplay:function(){return e.isActive(this.__input)||(this.__input.value=this.getValue()),n.superclass.prototype.updateDisplay.call(this)}}),n})(i.controllers.Controller,i.dom.dom,i.utils.common),i.controllers.FunctionController,i.controllers.BooleanController,i.utils.common),i.controllers.Controller,i.controllers.BooleanController,i.controllers.FunctionController,i.controllers.NumberControllerBox,i.controllers.NumberControllerSlider,i.controllers.OptionController,i.controllers.ColorController=(function(t,e,r,n,s){var a=function(f,_){a.superclass.call(this,f,_),this.__color=new r(this.getValue()),this.__temp=new r(0);var x=this;this.domElement=document.createElement("div"),e.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",e.bind(this.__input,"keydown",function(k){k.keyCode===13&&h.call(this)}),e.bind(this.__input,"blur",h),e.bind(this.__selector,"mousedown",function(k){e.addClass(this,"drag").bind(window,"mouseup",function(J){e.removeClass(x.__selector,"drag")})});var y=document.createElement("div");s.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),s.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),s.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),s.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),s.extend(y.style,{width:"100%",height:"100%",background:"none"}),l(y,"top","rgba(0,0,0,0)","#000"),s.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),c(this.__hue_field),s.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),e.bind(this.__saturation_field,"mousedown",M),e.bind(this.__field_knob,"mousedown",M),e.bind(this.__hue_field,"mousedown",function(k){E(k),e.bind(window,"mousemove",E),e.bind(window,"mouseup",v)});function M(k){C(k),e.bind(window,"mousemove",C),e.bind(window,"mouseup",G)}function G(){e.unbind(window,"mousemove",C),e.unbind(window,"mouseup",G)}function h(){var k=n(this.value);k!==!1?(x.__color.__state=k,x.setValue(x.__color.toOriginal())):this.value=x.__color.toString()}function v(){e.unbind(window,"mousemove",E),e.unbind(window,"mouseup",v)}this.__saturation_field.appendChild(y),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay();function C(k){k.preventDefault();var J=e.getWidth(x.__saturation_field),N=e.getOffset(x.__saturation_field),H=(k.clientX-N.left+document.body.scrollLeft)/J,$=1-(k.clientY-N.top+document.body.scrollTop)/J;return $>1?$=1:$<0&&($=0),H>1?H=1:H<0&&(H=0),x.__color.v=$,x.__color.s=H,x.setValue(x.__color.toOriginal()),!1}function E(k){k.preventDefault();var J=e.getHeight(x.__hue_field),N=e.getOffset(x.__hue_field),H=1-(k.clientY-N.top+document.body.scrollTop)/J;return H>1?H=1:H<0&&(H=0),x.__color.h=H*360,x.setValue(x.__color.toOriginal()),!1}};a.superclass=t,s.extend(a.prototype,t.prototype,{updateDisplay:function(){var f=n(this.getValue());if(f!==!1){var _=!1;s.each(r.COMPONENTS,function(M){if(!s.isUndefined(f[M])&&!s.isUndefined(this.__color.__state[M])&&f[M]!==this.__color.__state[M])return _=!0,{}},this),_&&s.extend(this.__color.__state,f)}s.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var x=this.__color.v<.5||this.__color.s>.5?255:0,y=255-x;s.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+x+","+x+","+x+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,l(this.__saturation_field,"left","#fff",this.__temp.toString()),s.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+x+","+x+","+x+")",textShadow:this.__input_textShadow+"rgba("+y+","+y+","+y+",.7)"})}});var o=["-moz-","-o-","-webkit-","-ms-",""];function l(f,_,x,y){f.style.background="",s.each(o,function(M){f.style.cssText+="background: "+M+"linear-gradient("+_+", "+x+" 0%, "+y+" 100%); "})}function c(f){f.style.background="",f.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",f.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",f.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",f.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",f.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}return a})(i.controllers.Controller,i.dom.dom,i.color.Color=(function(t,e,r,n){var s=function(){if(this.__state=t.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};s.COMPONENTS=["r","g","b","h","s","v","hex","a"],n.extend(s.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),a(s.prototype,"r",2),a(s.prototype,"g",1),a(s.prototype,"b",0),o(s.prototype,"h"),o(s.prototype,"s"),o(s.prototype,"v"),Object.defineProperty(s.prototype,"a",{get:function(){return this.__state.a},set:function(f){this.__state.a=f}}),Object.defineProperty(s.prototype,"hex",{get:function(){return!this.__state.space!=="HEX"&&(this.__state.hex=e.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(f){this.__state.space="HEX",this.__state.hex=f}});function a(f,_,x){Object.defineProperty(f,_,{get:function(){return this.__state.space==="RGB"?this.__state[_]:(l(this,_,x),this.__state[_])},set:function(y){this.__state.space!=="RGB"&&(l(this,_,x),this.__state.space="RGB"),this.__state[_]=y}})}function o(f,_){Object.defineProperty(f,_,{get:function(){return this.__state.space==="HSV"?this.__state[_]:(c(this),this.__state[_])},set:function(x){this.__state.space!=="HSV"&&(c(this),this.__state.space="HSV"),this.__state[_]=x}})}function l(f,_,x){if(f.__state.space==="HEX")f.__state[_]=e.component_from_hex(f.__state.hex,x);else if(f.__state.space==="HSV")n.extend(f.__state,e.hsv_to_rgb(f.__state.h,f.__state.s,f.__state.v));else throw"Corrupted color state"}function c(f){var _=e.rgb_to_hsv(f.r,f.g,f.b);n.extend(f.__state,{s:_.s,v:_.v}),n.isNaN(_.h)?n.isUndefined(f.__state.h)&&(f.__state.h=0):f.__state.h=_.h}return s})(i.color.interpret,i.color.math=(function(){var t;return{hsv_to_rgb:function(e,r,n){var s=Math.floor(e/60)%6,a=e/60-Math.floor(e/60),o=n*(1-r),l=n*(1-a*r),c=n*(1-(1-a)*r),f=[[n,c,o],[l,n,o],[o,n,c],[o,l,n],[c,o,n],[n,o,l]][s];return{r:f[0]*255,g:f[1]*255,b:f[2]*255}},rgb_to_hsv:function(e,r,n){var s=Math.min(e,r,n),a=Math.max(e,r,n),o=a-s,l,c;if(a!=0)c=o/a;else return{h:NaN,s:0,v:0};return e==a?l=(r-n)/o:r==a?l=2+(n-e)/o:l=4+(e-r)/o,l/=6,l<0&&(l+=1),{h:l*360,s:c,v:a/255}},rgb_to_hex:function(e,r,n){var s=this.hex_with_component(0,2,e);return s=this.hex_with_component(s,1,r),s=this.hex_with_component(s,0,n),s},component_from_hex:function(e,r){return e>>r*8&255},hex_with_component:function(e,r,n){return n<<(t=r*8)|e&~(255<<t)}}})(),i.color.toString,i.utils.common),i.color.interpret,i.utils.common),i.utils.requestAnimationFrame=(function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}})(),i.dom.CenteredDiv=(function(t,e){var r=function(){this.backgroundElement=document.createElement("div"),e.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),t.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),e.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var n=this;t.bind(this.backgroundElement,"click",function(){n.hide()})};return r.prototype.show=function(){var n=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),e.defer(function(){n.backgroundElement.style.opacity=1,n.domElement.style.opacity=1,n.domElement.style.webkitTransform="scale(1)"})},r.prototype.hide=function(){var n=this,s=function(){n.domElement.style.display="none",n.backgroundElement.style.display="none",t.unbind(n.domElement,"webkitTransitionEnd",s),t.unbind(n.domElement,"transitionend",s),t.unbind(n.domElement,"oTransitionEnd",s)};t.bind(this.domElement,"webkitTransitionEnd",s),t.bind(this.domElement,"transitionend",s),t.bind(this.domElement,"oTransitionEnd",s),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},r.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-t.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-t.getHeight(this.domElement)/2+"px"},r})(i.dom.dom,i.utils.common),i.dom.dom,i.utils.common),fs.exports}var ps={exports:{}},Al;function sy(){if(Al)return ps.exports;Al=1;var i=ps.exports=i||{};return i.color=i.color||{},i.utils=i.utils||{},i.utils.common=(function(){var t=Array.prototype.forEach,e=Array.prototype.slice;return{BREAK:{},extend:function(r){return this.each(e.call(arguments,1),function(n){for(var s in n)this.isUndefined(n[s])||(r[s]=n[s])},this),r},defaults:function(r){return this.each(e.call(arguments,1),function(n){for(var s in n)this.isUndefined(r[s])&&(r[s]=n[s])},this),r},compose:function(){var r=e.call(arguments);return function(){for(var n=e.call(arguments),s=r.length-1;s>=0;s--)n=[r[s].apply(this,n)];return n[0]}},each:function(r,n,s){if(t&&r.forEach===t)r.forEach(n,s);else if(r.length===r.length+0){for(var a=0,o=r.length;a<o;a++)if(a in r&&n.call(s,r[a],a)===this.BREAK)return}else for(var a in r)if(n.call(s,r[a],a)===this.BREAK)return},defer:function(r){setTimeout(r,0)},toArray:function(r){return r.toArray?r.toArray():e.call(r)},isUndefined:function(r){return r===void 0},isNull:function(r){return r===null},isNaN:function(r){return r!==r},isArray:Array.isArray||function(r){return r.constructor===Array},isObject:function(r){return r===Object(r)},isNumber:function(r){return r===r+0},isString:function(r){return r===r+""},isBoolean:function(r){return r===!1||r===!0},isFunction:function(r){return Object.prototype.toString.call(r)==="[object Function]"}}})(),i.color.toString=(function(t){return function(e){if(e.a==1||t.isUndefined(e.a)){for(var r=e.hex.toString(16);r.length<6;)r="0"+r;return"#"+r}else return"rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+e.a+")"}})(i.utils.common),i.Color=i.color.Color=(function(t,e,r,n){var s=function(){if(this.__state=t.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};s.COMPONENTS=["r","g","b","h","s","v","hex","a"],n.extend(s.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),a(s.prototype,"r",2),a(s.prototype,"g",1),a(s.prototype,"b",0),o(s.prototype,"h"),o(s.prototype,"s"),o(s.prototype,"v"),Object.defineProperty(s.prototype,"a",{get:function(){return this.__state.a},set:function(f){this.__state.a=f}}),Object.defineProperty(s.prototype,"hex",{get:function(){return!this.__state.space!=="HEX"&&(this.__state.hex=e.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(f){this.__state.space="HEX",this.__state.hex=f}});function a(f,_,x){Object.defineProperty(f,_,{get:function(){return this.__state.space==="RGB"?this.__state[_]:(l(this,_,x),this.__state[_])},set:function(y){this.__state.space!=="RGB"&&(l(this,_,x),this.__state.space="RGB"),this.__state[_]=y}})}function o(f,_){Object.defineProperty(f,_,{get:function(){return this.__state.space==="HSV"?this.__state[_]:(c(this),this.__state[_])},set:function(x){this.__state.space!=="HSV"&&(c(this),this.__state.space="HSV"),this.__state[_]=x}})}function l(f,_,x){if(f.__state.space==="HEX")f.__state[_]=e.component_from_hex(f.__state.hex,x);else if(f.__state.space==="HSV")n.extend(f.__state,e.hsv_to_rgb(f.__state.h,f.__state.s,f.__state.v));else throw"Corrupted color state"}function c(f){var _=e.rgb_to_hsv(f.r,f.g,f.b);n.extend(f.__state,{s:_.s,v:_.v}),n.isNaN(_.h)?n.isUndefined(f.__state.h)&&(f.__state.h=0):f.__state.h=_.h}return s})(i.color.interpret=(function(t,e){var r,n,s=function(){n=!1;var o=arguments.length>1?e.toArray(arguments):arguments[0];return e.each(a,function(l){if(l.litmus(o))return e.each(l.conversions,function(c,f){if(r=c.read(o),n===!1&&r!==!1)return n=r,r.conversionName=f,r.conversion=c,e.BREAK}),e.BREAK}),n},a=[{litmus:e.isString,conversions:{THREE_CHAR_HEX:{read:function(o){var l=o.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return l===null?!1:{space:"HEX",hex:parseInt("0x"+l[1].toString()+l[1].toString()+l[2].toString()+l[2].toString()+l[3].toString()+l[3].toString())}},write:t},SIX_CHAR_HEX:{read:function(o){var l=o.match(/^#([A-F0-9]{6})$/i);return l===null?!1:{space:"HEX",hex:parseInt("0x"+l[1].toString())}},write:t},CSS_RGB:{read:function(o){var l=o.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return l===null?!1:{space:"RGB",r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3])}},write:t},CSS_RGBA:{read:function(o){var l=o.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return l===null?!1:{space:"RGB",r:parseFloat(l[1]),g:parseFloat(l[2]),b:parseFloat(l[3]),a:parseFloat(l[4])}},write:t}}},{litmus:e.isNumber,conversions:{HEX:{read:function(o){return{space:"HEX",hex:o,conversionName:"HEX"}},write:function(o){return o.hex}}}},{litmus:e.isArray,conversions:{RGB_ARRAY:{read:function(o){return o.length!=3?!1:{space:"RGB",r:o[0],g:o[1],b:o[2]}},write:function(o){return[o.r,o.g,o.b]}},RGBA_ARRAY:{read:function(o){return o.length!=4?!1:{space:"RGB",r:o[0],g:o[1],b:o[2],a:o[3]}},write:function(o){return[o.r,o.g,o.b,o.a]}}}},{litmus:e.isObject,conversions:{RGBA_OBJ:{read:function(o){return e.isNumber(o.r)&&e.isNumber(o.g)&&e.isNumber(o.b)&&e.isNumber(o.a)?{space:"RGB",r:o.r,g:o.g,b:o.b,a:o.a}:!1},write:function(o){return{r:o.r,g:o.g,b:o.b,a:o.a}}},RGB_OBJ:{read:function(o){return e.isNumber(o.r)&&e.isNumber(o.g)&&e.isNumber(o.b)?{space:"RGB",r:o.r,g:o.g,b:o.b}:!1},write:function(o){return{r:o.r,g:o.g,b:o.b}}},HSVA_OBJ:{read:function(o){return e.isNumber(o.h)&&e.isNumber(o.s)&&e.isNumber(o.v)&&e.isNumber(o.a)?{space:"HSV",h:o.h,s:o.s,v:o.v,a:o.a}:!1},write:function(o){return{h:o.h,s:o.s,v:o.v,a:o.a}}},HSV_OBJ:{read:function(o){return e.isNumber(o.h)&&e.isNumber(o.s)&&e.isNumber(o.v)?{space:"HSV",h:o.h,s:o.s,v:o.v}:!1},write:function(o){return{h:o.h,s:o.s,v:o.v}}}}}];return s})(i.color.toString,i.utils.common),i.color.math=(function(){var t;return{hsv_to_rgb:function(e,r,n){var s=Math.floor(e/60)%6,a=e/60-Math.floor(e/60),o=n*(1-r),l=n*(1-a*r),c=n*(1-(1-a)*r),f=[[n,c,o],[l,n,o],[o,n,c],[o,l,n],[c,o,n],[n,o,l]][s];return{r:f[0]*255,g:f[1]*255,b:f[2]*255}},rgb_to_hsv:function(e,r,n){var s=Math.min(e,r,n),a=Math.max(e,r,n),o=a-s,l,c;if(a!=0)c=o/a;else return{h:NaN,s:0,v:0};return e==a?l=(r-n)/o:r==a?l=2+(n-e)/o:l=4+(e-r)/o,l/=6,l<0&&(l+=1),{h:l*360,s:c,v:a/255}},rgb_to_hex:function(e,r,n){var s=this.hex_with_component(0,2,e);return s=this.hex_with_component(s,1,r),s=this.hex_with_component(s,0,n),s},component_from_hex:function(e,r){return e>>r*8&255},hex_with_component:function(e,r,n){return n<<(t=r*8)|e&~(255<<t)}}})(),i.color.toString,i.utils.common),ps.exports}var Ml;function oy(){return Ml||(Ml=1,ar.exports=ny(),ar.exports.color=sy()),ar.exports}oy();var js=function(i,t){this.cars=t;var e=new Dt.dyn.b2ContactListener,r=this;e.BeginContact=function(n){r.HandleContact(n,!0)},e.EndContact=function(n){r.HandleContact(n,!1)},i.SetContactListener(e)};js.prototype.HandleContact=function(i,t){var e=this.ExtractContactType(i);if(e.type!=="wall")if(t)switch(e.type){case"cp":this.cars[0].checkPointManager.step(parseInt(e.id));break;case"puddle":this.cars[0].adherence=!1,this.cars[0].paddleEffect=puddleRandomDirectionArray[Math.floor(Math.random()*2)];break;case"boost":var r=new Dt.cMath.b2Vec2(e.boostVector.x,e.boostVector.y);this.cars[0].applyImpulse(r);break}else this.cars[0].adherence=!0,this.cars[0].paddleEffect=0};js.prototype.ExtractContactType=function(i){var t=i.GetFixtureA(),e=i.GetFixtureB();return t.name==="wallFixture"||e.name==="wallFixture"?{type:"wall"}:t.name.indexOf("cp")===0?{type:"cp",id:t.name.substr(2,3)}:e.name.indexOf("cp")===0?{type:"cp",id:e.name.substr(2,3)}:t.name.indexOf("boost")===0?{type:"boost",boostVector:t.customProperties[0].vec2}:e.name.indexOf("boost")===0?{type:"boost",boostVector:e.customProperties[0].vec2}:{type:""}};var Dr=function(i){this.b2World=new Dt.dyn.b2World(new Dt.cMath.b2Vec2(0,0),!0),this.playerCar=null,this.otherCars=[],this.trackBodySet={},this.b2Loader=new qe(this),this.contactManager=null,this.debugDrawActive=i,i&&Dt.initDebugDraw(this.b2World)};Dr.prototype.addB2Element=function(i){this.b2Loader.addElement(i)};Dr.prototype.update=function(){var i,t,e;if(this.playerCar)for(this.b2World.Step(1/60,3,3),this.b2World.ClearForces(),this.debugDrawActive&&this.b2World.DrawDebugData(),this.playerCar.updateData(),this.playerCar.handleKeyboard(Di.keys),this.playerCar.updateSpritePosition(),this.contactManager||(this.contactManager=new js(this.b2World,[this.playerCar])),t=0,e=this.otherCars.length;t<e;t++)i=this.otherCars[t],i.updateData(),i.updateFriction()};Dr.prototype.toggleDebugDraw=function(){this.debugDrawActive=!this.debugDrawActive,this.debugDrawActive&&!this.b2World.m_debugDraw&&Dt.initDebugDraw(this.b2World);var i=document.getElementById("canvas");i&&(i.style.display=this.debugDrawActive?"block":"none")};var ch=function(i){this.pixiFacade=i.pixiFacade,this.b2WorldFacade=new Dr(Ot.technical.debugDraw),this.b2WorldFacade.addB2Element({id:"track",type:"track",data:Ot.tracks[i.trackId],onAddedAndPlaced:e=>{console.log("Adding track sprite, trackId:",i.trackId);var r=this.pixiFacade.createThenAddSprite({frameId:"track"+i.trackId+".png",anchor:0});r.position.set(0,0),console.log("Track sprite created:",r)}});var t=0;this.b2WorldFacade.addB2Element({id:"playercar",type:"car",data:Ot.cars[t],onAddedAndPlaced:e=>{if(this.b2WorldFacade.playerCar)this.b2WorldFacade.otherCars.push(e);else{var r=new Ee(t,this.pixiFacade.container);r.checkPointManager=new Ir(3),r.setBox2dData(e),r.name="player",this.b2WorldFacade.playerCar=r}}})};ch.prototype.update=function(){this.b2WorldFacade.update()};var ay=function(){var i,t,e=0,r=0,n=Date.now(),s=n,a=n,o=0,l=1e3,c=0,f,_,x,y=[[16,16,48],[0,255,255]],M=0,G=1e3,h=0,v,C,E,k=[[16,48,16],[0,255,0]];for(i=document.createElement("div"),i.style.cursor="pointer",i.style.width="80px",i.style.opacity="0.9",i.style.zIndex="10001",i.addEventListener("mousedown",function(J){J.preventDefault(),e=(e+1)%2,e==0?(f.style.display="block",v.style.display="none"):(f.style.display="none",v.style.display="block")},!1),f=document.createElement("div"),f.style.textAlign="left",f.style.lineHeight="1.2em",f.style.backgroundColor="rgb("+Math.floor(y[0][0]/2)+","+Math.floor(y[0][1]/2)+","+Math.floor(y[0][2]/2)+")",f.style.padding="0 0 3px 3px",i.appendChild(f),_=document.createElement("div"),_.style.fontFamily="Helvetica, Arial, sans-serif",_.style.fontSize="9px",_.style.color="rgb("+y[1][0]+","+y[1][1]+","+y[1][2]+")",_.style.fontWeight="bold",_.innerHTML="FPS",f.appendChild(_),x=document.createElement("div"),x.style.position="relative",x.style.width="74px",x.style.height="30px",x.style.backgroundColor="rgb("+y[1][0]+","+y[1][1]+","+y[1][2]+")",f.appendChild(x);74>x.children.length;)t=document.createElement("span"),t.style.width="1px",t.style.height="30px",t.style.cssFloat="left",t.style.backgroundColor="rgb("+y[0][0]+","+y[0][1]+","+y[0][2]+")",x.appendChild(t);for(v=document.createElement("div"),v.style.textAlign="left",v.style.lineHeight="1.2em",v.style.backgroundColor="rgb("+Math.floor(k[0][0]/2)+","+Math.floor(k[0][1]/2)+","+Math.floor(k[0][2]/2)+")",v.style.padding="0 0 3px 3px",v.style.display="none",i.appendChild(v),C=document.createElement("div"),C.style.fontFamily="Helvetica, Arial, sans-serif",C.style.fontSize="9px",C.style.color="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")",C.style.fontWeight="bold",C.innerHTML="MS",v.appendChild(C),E=document.createElement("div"),E.style.position="relative",E.style.width="74px",E.style.height="30px",E.style.backgroundColor="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")",v.appendChild(E);74>E.children.length;)t=document.createElement("span"),t.style.width="1px",t.style.height=30*Math.random()+"px",t.style.cssFloat="left",t.style.backgroundColor="rgb("+k[0][0]+","+k[0][1]+","+k[0][2]+")",E.appendChild(t);return{domElement:i,update:function(){n=Date.now(),M=n-s,G=Math.min(G,M),h=Math.max(h,M),C.textContent=M+" MS ("+G+"-"+h+")";var J=Math.min(30,30-30*(M/200));E.appendChild(E.firstChild).style.height=J+"px",s=n,r++,n>a+1e3&&(o=Math.round(1e3*r/(n-a)),l=Math.min(l,o),c=Math.max(c,o),_.textContent=o+" FPS ("+l+"-"+c+")",J=Math.min(30,30-30*(o/100)),x.appendChild(x.firstChild).style.height=J+"px",a=n,r=0)}}},ly=function(){var i,t=new ay;i=document.createElement("div"),i.appendChild(t.domElement),document.body.appendChild(i),t.domElement.style.position="absolute"},Me=function(i){this.pixiStage=i.pixiStage,this.specs=i,this.currentRace=null;var t=this;this.menuContainer=document.getElementById("menuContainer"),this.track0Button=document.getElementById("track0Button"),this.track1Button=document.getElementById("track1Button"),this.controlsElement=document.getElementById("controls"),this.debugToggleButton=document.getElementById("debugToggleButton"),this.track0Button&&(this.track0Button.onclick=function(){t.hideTrackButtons(),t.showMenuButton(),t.showDebugToggleButton(),t.showControls(),i.onStartRace(0)}),this.track1Button&&(this.track1Button.onclick=function(){t.hideTrackButtons(),t.showMenuButton(),t.showDebugToggleButton(),t.showControls(),i.onStartRace(1)}),this.createMenuButton(),this.createDebugToggleButton(),i.onMenuLoaded()};Me.prototype.hideTrackButtons=function(){this.menuContainer&&(this.menuContainer.style.display="none")};Me.prototype.showTrackButtons=function(){this.menuContainer&&(this.menuContainer.style.display="flex")};Me.prototype.createMenuButton=function(){this.menuButton=document.getElementById("menuButton"),this.menuButton&&(this.menuButton.onclick=function(){window.location.reload()})};Me.prototype.showMenuButton=function(){this.menuButton&&(this.menuButton.style.display="block")};Me.prototype.hideMenuButton=function(){this.menuButton&&(this.menuButton.style.display="none")};Me.prototype.showControls=function(){this.controlsElement&&(this.controlsElement.style.display="flex")};Me.prototype.hideControls=function(){this.controlsElement&&(this.controlsElement.style.display="none")};Me.prototype.createDebugToggleButton=function(){var i=this;this.debugToggleButton&&(this.debugToggleButton.onclick=function(){Ot.technical.debugDraw=!Ot.technical.debugDraw,i.debugToggleButton.textContent=Ot.technical.debugDraw?"SPRITES":"DEBUG",i.currentRace&&(i.currentRace.b2WorldFacade&&i.currentRace.b2WorldFacade.toggleDebugDraw(),i.currentRace.pixiFacade&&i.currentRace.pixiFacade.setVisible(!Ot.technical.debugDraw))})};Me.prototype.showDebugToggleButton=function(){this.debugToggleButton&&(this.debugToggleButton.style.display="block",this.updateDebugButtonText())};Me.prototype.updateDebugButtonText=function(){this.debugToggleButton&&(this.debugToggleButton.textContent=Ot.technical.debugDraw?"SPRITES":"DEBUG")};Me.prototype.setCurrentRace=function(i){this.currentRace=i};var cy=function(){var i={};return i.loadQueryConfig=function(){var t,e;return e=i.parseQueryString(),t={},e.hasOwnProperty("track")?t.track=parseInt(e.track,10):t.track=Ot.defaultSetup.trackId,e.hasOwnProperty("cars")?t.cars=e.cars.split(",").map(function(r){return parseInt(r,10)}):t.cars=Ot.defaultSetup.carIds,t},i.parseQueryString=function(){var t,e,r,n,s,a,o;for(t={},s=location.search.slice(1).split("&"),e=function(l){return decodeURIComponent(l.replace(/\+/g," "))},r=0,a=s.length;r<a;r++)o=s[r],n=o.split("="),1<n.length&&(t[e(n[0])]=e(n[1]));return t},i};const Pl=cy();var hy=function(){var i=Pl.loadQueryConfig();i.debug!==void 0&&(Ot.technical.debugDraw=i.debug==="true"||i.debug===!0),this.currentRace=null,this.menu=null,this.pixiFacade=new Ji,this.gameEvents={frameStep:()=>{this.currentRace&&this.currentRace.update(),this.pixiFacade.step(),window.requestAnimationFrame(this.gameEvents.frameStep)},menuLoaded:()=>{console.log("Pixi page loaded"),window.requestAnimationFrame(this.gameEvents.frameStep)},startRace:t=>{console.log("Race creation !");var e=Pl.loadQueryConfig();console.log("URL config:",e);var r=t!==void 0?t:e.track;console.log("Selected track:",r),this.currentRace=new ch({trackId:r,pixiFacade:this.pixiFacade}),this.menu.setCurrentRace(this.currentRace),this.menu.showMenuButton(),window.requestAnimationFrame(this.gameEvents.frameStep)}},this.pixiFacade.loadAtlas((t,e)=>{console.log("Atlas loaded ",e),this.menu=new Me({pixiStage:this.pixiFacade.container,onMenuLoaded:this.gameEvents.menuLoaded,onStartRace:this.gameEvents.startRace})}),document.onkeydown=function(t){Di.handleKeyDown.apply(Di,[t])},document.onkeyup=function(t){Di.handleKeyUp.apply(Di,[t])},new ly};new hy;export{ru as $,vc as A,xe as B,Ue as C,qt as D,wt as E,ql as F,wr as G,yo as H,ri as I,Pu as J,Vu as K,Ui as L,Bt as M,Kt as N,Zt as O,pe as P,tf as Q,ws as R,Gs as S,He as T,dr as U,go as V,zr as W,xo as X,su as Y,mr as Z,le as _,lc as a,zl as a0,bc as a1,Gt as a2,ae as a3,of as a4,If as a5,Sf as a6,Yf as a7,Zf as a8,ip as a9,np as aa,sp as ab,ou as ac,ei as ad,pr as ae,hr as af,Ps as ag,sa as ah,Vc as ai,Fo as aj,Eo as ak,aa as al,om as am,Ut as an,Mh as ao,xr as ap,Oc as aq,Re as b,vf as c,zi as d,ue as e,Ro as f,_f as g,cr as h,Ls as i,_c as j,Ql as k,Fe as l,fc as m,Es as n,Xf as o,Kf as p,tp as q,Nh as r,rp as s,Pt as t,Ah as u,op as v,Jt as w,Ae as x,Gl as y,De as z};
