{
	"auto_complete":
	{
		"selected_items":
		[
			[
				"rever",
				"reverseFilter"
			],
			[
				"border",
				"borderradius"
			],
			[
				"text",
				"text-align"
			]
		]
	},
	"buffers":
	[
		{
			"file": "js/b2Helper.js",
			"settings":
			{
				"buffer_size": 2708,
				"line_ending": "Unix"
			}
		},
		{
			"file": "js/utils/b2.js",
			"settings":
			{
				"buffer_size": 127,
				"line_ending": "Unix"
			}
		},
		{
			"file": "js/utils/Consts.js",
			"settings":
			{
				"buffer_size": 263,
				"line_ending": "Unix"
			}
		},
		{
			"file": "js/Car.js",
			"settings":
			{
				"buffer_size": 3997,
				"line_ending": "Unix"
			}
		},
		{
			"contents": "Searching 3291 files for \"images/\" (regex)\n\nD:\\Prog\\Git\\SuperSprint\\app\\gruntfile.js:\n   44  				files: [{\n   45  					expand: true,                  // Enable dynamic expansion\n   46: 					cwd: '../Content/images/elements/',                   // Src matches are relative to this path\n   47  					src: ['*.{png,gif}'],   // Actual patterns to match\n   48: 					dest: '../Content/images/elements/min',// Destination path prefix\n   49  				}]\n   50  			},\n\nD:\\Prog\\Git\\SuperSprint\\app\\supersprint.sublime-workspace:\n  273  			\"@contentTextColor\",\n  274  			\"@contentBgColor\",\n  275: 			\"./images/\"\n  276  		],\n  277  		\"reverse\": false,\n\nD:\\Prog\\Git\\SuperSprint\\app\\js\\Sprites.js:\n    1  var Sprites = \n    2  {\n    3: 	car: \"Content/images/car.png\"\n    4  };\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt\\node_modules\\js-yaml\\node_modules\\argparse\\node_modules\\underscore\\index.html:\n   12        font-size: 14px;\n   13        line-height: 22px;\n   14:       background: #f4f4f4 url(docs/images/background.png);\n   15        color: #000;\n   16        font-family: Helvetica Neue, Helvetica, Arial;\n   ..\n  331  \n  332      <p id=\"introduction\">\n  333:       <img id=\"logo\" src=\"docs/images/underscore.png\" alt=\"Underscore.js\" />\n  334      </p>\n  335  \n  ...\n 2453        <p>\n 2454          <a href=\"http://documentcloud.org/\" title=\"A DocumentCloud Project\" style=\"background:none;\">\n 2455:           <img src=\"http://jashkenas.s3.amazonaws.com/images/a_documentcloud_project.png\" alt=\"A DocumentCloud Project\" />\n 2456          </a>\n 2457        </p>\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-cssmin\\node_modules\\clean-css\\lib\\clean.js:\n   15  var ShorthandNotations = require('./properties/shorthand-notations');\n   16  var ImportInliner = require('./imports/inliner');\n   17: var UrlRebase = require('./images/url-rebase');\n   18  var EmptyRemoval = require('./selectors/empty-removal');\n   19  \n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-cssmin\\node_modules\\clean-css\\lib\\imports\\inliner.js:\n    5  var url = require('url');\n    6  \n    7: var UrlRewriter = require('../images/url-rewriter');\n    8  \n    9  var merge = function(source1, source2) {\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-cssmin\\node_modules\\maxmin\\node_modules\\gzip-size\\node_modules\\zlib-browserify\\node_modules\\tape\\package.json:\n   39    },\n   40    \"license\": \"MIT\",\n   41:   \"readme\": \"# tape\\n\\ntap-producing test harness for node and browsers\\n\\n[![build status](https://secure.travis-ci.org/substack/tape.png)](http://travis-ci.org/substack/tape)\\n\\n![tape](http://substack.net/images/tape_drive.png)\\n\\n# browser compatibility\\n\\nchrome, firefox, opera, safari, IE6, IE7, IE8, IE9\\n\\nusing browserify@1.16.5\\n\\n# example\\n\\n``` js\\nvar test = require('tape');\\n\\ntest('timing test', function (t) {\\n    t.plan(2);\\n    \\n    t.equal(typeof Date.now, 'function');\\n    var start = Date.now();\\n    \\n    setTimeout(function () {\\n        t.equal(Date.now() - start, 100);\\n    }, 100);\\n});\\n```\\n\\n```\\n$ node example/timing.js\\nTAP version 13\\n# timing test\\nok 1 should be equal\\nnot ok 2 should be equal\\n  ---\\n    operator: equal\\n    expected: 100\\n    actual:   107\\n  ...\\n\\n1..2\\n# tests 2\\n# pass  1\\n# fail  1\\n```\\n\\n# methods\\n\\nThe assertion methods in tape are heavily influenced or copied from the methods\\nin [node-tap](https://github.com/isaacs/node-tap).\\n\\n```\\nvar test = require('tape')\\n```\\n\\n## test(name, cb)\\n\\nCreate a new test with an optional `name` string. `cb(t)` fires with the new\\ntest object `t` once all preceeding tests have finished. Tests execute serially.\\n\\nIf you forget to `t.plan()` out how many assertions you are going to run and you\\ndon't call `t.end()` explicitly, your test will hang.\\n\\n## t.plan(n)\\n\\nDeclare that `n` assertions should be run. `t.end()` will be called\\nautomatically after the `n`th assertion. If there are any more assertions after\\nthe `n`th, or after `t.end()` is called, they will generate errors.\\n\\n## t.end()\\n\\nDeclare the end of a test explicitly.\\n\\n## t.fail(msg)\\n\\nGenerate a failing assertion with a message `msg`.\\n\\n## t.pass(msg)\\n\\nGenerate a passing assertion with a message `msg`.\\n\\n## t.skip(msg)\\n \\nGenerate an assertion that will be skipped over.\\n\\n## t.ok(value, msg)\\n\\nAssert that `value` is truthy with an optional description message `msg`.\\n\\nAliases: `t.true()`, `t.assert()`\\n\\n## t.notOk(value, msg)\\n\\nAssert that `value` is falsy with an optional description message `msg`.\\n\\nAliases: `t.false()`, `t.notok()`\\n\\n## t.error(err, msg)\\n\\nAssert that `err` is falsy. If `err` is non-falsy, use its `err.message` as the\\ndescription message.\\n\\nAliases: `t.ifError()`, `t.ifErr()`, `t.iferror()`\\n\\n## t.equal(a, b, msg)\\n\\nAssert that `a === b` with an optional description `msg`.\\n\\nAliases: `t.equals()`, `t.isEqual()`, `t.is()`, `t.strictEqual()`,\\n`t.strictEquals()`\\n\\n## t.notEqual(a, b, msg)\\n\\nAssert that `a !== b` with an optional description `msg`.\\n\\nAliases: `t.notEquals()`, `t.notStrictEqual()`, `t.notStrictEquals()`,\\n`t.isNotEqual()`, `t.isNot()`, `t.not()`, `t.doesNotEqual()`, `t.isInequal()`\\n\\n## t.deepEqual(a, b, msg)\\n\\nAssert that `a` and `b` have the same structure and nested values using\\n[node's deepEqual() algorithm](https://github.com/substack/node-deep-equal)\\nwith an optional description `msg`.\\n\\nAliases: `t.deepEquals()`, `t.isEquivalent()`, `t.looseEqual()`,\\n`t.looseEquals()`, `t.same()`\\n\\n## t.notDeepEqual(a, b, msg)\\n\\nAssert that `a` and `b` do not have the same structure and nested values using\\n[node's deepEqual() algorithm](https://github.com/substack/node-deep-equal)\\nwith an optional description `msg`.\\n\\nAliases: `t.notEquivalent()`, `t.notDeeply()`, `t.notSame()`,\\n`t.isNotDeepEqual()`, `t.isNotDeeply()`, `t.isNotEquivalent()`,\\n`t.isInequivalent()`\\n\\n## t.throws(fn, expected, msg)\\n\\nAssert that the function call `fn()` throws an exception.\\n\\n## t.doesNotThrow(fn, expected, msg)\\n\\nAssert that the function call `fn()` does not throw an exception.\\n\\n## t.test(name, cb)\\n\\nCreate a subtest with a new test handle `st` from `cb(st)` inside the current\\ntest `t`. `cb(st)` will only fire when `t` finishes. Additional tests queued up\\nafter `t` will not be run until all subtests finish.\\n\\n## var htest = test.createHarness()\\n\\nCreate a new test harness instance, which is a function like `test()`, but with\\na new pending stack and test state.\\n\\nBy default the TAP output goes to `process.stdout` or `console.log()` if the\\nenvironment doesn't have `process.stdout`. You can pipe the output to someplace\\nelse if you `test.stream.pipe()` to a destination stream on the first tick.\\n\\n## test.only(name, cb)\\n\\nLike `test(name, cb)` except if you use `.only` this is the only test case\\nthat will run for the entire process, all other test cases using tape will\\nbe ignored\\n\\n# install\\n\\nWith [npm](https://npmjs.org) do:\\n\\n```\\nnpm install tape\\n```\\n\\n# license\\n\\nMIT\\n\",\n   42    \"readmeFilename\": \"readme.markdown\",\n   43    \"bugs\": {\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-cssmin\\node_modules\\maxmin\\node_modules\\gzip-size\\node_modules\\zlib-browserify\\node_modules\\tape\\readme.markdown:\n    5  [![build status](https://secure.travis-ci.org/substack/tape.png)](http://travis-ci.org/substack/tape)\n    6  \n    7: ![tape](http://substack.net/images/tape_drive.png)\n    8  \n    9  # browser compatibility\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-jshint\\node_modules\\jshint\\node_modules\\underscore\\index.html:\n   12        font-size: 14px;\n   13        line-height: 22px;\n   14:       background: #f4f4f4 url(docs/images/background.png);\n   15        color: #000;\n   16        font-family: Helvetica Neue, Helvetica, Arial;\n   ..\n  331  \n  332      <p id=\"introduction\">\n  333:       <img id=\"logo\" src=\"docs/images/underscore.png\" alt=\"Underscore.js\" />\n  334      </p>\n  335  \n  ...\n 2453        <p>\n 2454          <a href=\"http://documentcloud.org/\" title=\"A DocumentCloud Project\" style=\"background:none;\">\n 2455:           <img src=\"http://jashkenas.s3.amazonaws.com/images/a_documentcloud_project.png\" alt=\"A DocumentCloud Project\" />\n 2456          </a>\n 2457        </p>\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-uglify\\node_modules\\maxmin\\node_modules\\gzip-size\\node_modules\\zlib-browserify\\node_modules\\tape\\package.json:\n   39    },\n   40    \"license\": \"MIT\",\n   41:   \"readme\": \"# tape\\n\\ntap-producing test harness for node and browsers\\n\\n[![build status](https://secure.travis-ci.org/substack/tape.png)](http://travis-ci.org/substack/tape)\\n\\n![tape](http://substack.net/images/tape_drive.png)\\n\\n# browser compatibility\\n\\nchrome, firefox, opera, safari, IE6, IE7, IE8, IE9\\n\\nusing browserify@1.16.5\\n\\n# example\\n\\n``` js\\nvar test = require('tape');\\n\\ntest('timing test', function (t) {\\n    t.plan(2);\\n    \\n    t.equal(typeof Date.now, 'function');\\n    var start = Date.now();\\n    \\n    setTimeout(function () {\\n        t.equal(Date.now() - start, 100);\\n    }, 100);\\n});\\n```\\n\\n```\\n$ node example/timing.js\\nTAP version 13\\n# timing test\\nok 1 should be equal\\nnot ok 2 should be equal\\n  ---\\n    operator: equal\\n    expected: 100\\n    actual:   107\\n  ...\\n\\n1..2\\n# tests 2\\n# pass  1\\n# fail  1\\n```\\n\\n# methods\\n\\nThe assertion methods in tape are heavily influenced or copied from the methods\\nin [node-tap](https://github.com/isaacs/node-tap).\\n\\n```\\nvar test = require('tape')\\n```\\n\\n## test(name, cb)\\n\\nCreate a new test with an optional `name` string. `cb(t)` fires with the new\\ntest object `t` once all preceeding tests have finished. Tests execute serially.\\n\\nIf you forget to `t.plan()` out how many assertions you are going to run and you\\ndon't call `t.end()` explicitly, your test will hang.\\n\\n## t.plan(n)\\n\\nDeclare that `n` assertions should be run. `t.end()` will be called\\nautomatically after the `n`th assertion. If there are any more assertions after\\nthe `n`th, or after `t.end()` is called, they will generate errors.\\n\\n## t.end()\\n\\nDeclare the end of a test explicitly.\\n\\n## t.fail(msg)\\n\\nGenerate a failing assertion with a message `msg`.\\n\\n## t.pass(msg)\\n\\nGenerate a passing assertion with a message `msg`.\\n\\n## t.skip(msg)\\n \\nGenerate an assertion that will be skipped over.\\n\\n## t.ok(value, msg)\\n\\nAssert that `value` is truthy with an optional description message `msg`.\\n\\nAliases: `t.true()`, `t.assert()`\\n\\n## t.notOk(value, msg)\\n\\nAssert that `value` is falsy with an optional description message `msg`.\\n\\nAliases: `t.false()`, `t.notok()`\\n\\n## t.error(err, msg)\\n\\nAssert that `err` is falsy. If `err` is non-falsy, use its `err.message` as the\\ndescription message.\\n\\nAliases: `t.ifError()`, `t.ifErr()`, `t.iferror()`\\n\\n## t.equal(a, b, msg)\\n\\nAssert that `a === b` with an optional description `msg`.\\n\\nAliases: `t.equals()`, `t.isEqual()`, `t.is()`, `t.strictEqual()`,\\n`t.strictEquals()`\\n\\n## t.notEqual(a, b, msg)\\n\\nAssert that `a !== b` with an optional description `msg`.\\n\\nAliases: `t.notEquals()`, `t.notStrictEqual()`, `t.notStrictEquals()`,\\n`t.isNotEqual()`, `t.isNot()`, `t.not()`, `t.doesNotEqual()`, `t.isInequal()`\\n\\n## t.deepEqual(a, b, msg)\\n\\nAssert that `a` and `b` have the same structure and nested values using\\n[node's deepEqual() algorithm](https://github.com/substack/node-deep-equal)\\nwith an optional description `msg`.\\n\\nAliases: `t.deepEquals()`, `t.isEquivalent()`, `t.looseEqual()`,\\n`t.looseEquals()`, `t.same()`\\n\\n## t.notDeepEqual(a, b, msg)\\n\\nAssert that `a` and `b` do not have the same structure and nested values using\\n[node's deepEqual() algorithm](https://github.com/substack/node-deep-equal)\\nwith an optional description `msg`.\\n\\nAliases: `t.notEquivalent()`, `t.notDeeply()`, `t.notSame()`,\\n`t.isNotDeepEqual()`, `t.isNotDeeply()`, `t.isNotEquivalent()`,\\n`t.isInequivalent()`\\n\\n## t.throws(fn, expected, msg)\\n\\nAssert that the function call `fn()` throws an exception.\\n\\n## t.doesNotThrow(fn, expected, msg)\\n\\nAssert that the function call `fn()` does not throw an exception.\\n\\n## t.test(name, cb)\\n\\nCreate a subtest with a new test handle `st` from `cb(st)` inside the current\\ntest `t`. `cb(st)` will only fire when `t` finishes. Additional tests queued up\\nafter `t` will not be run until all subtests finish.\\n\\n## var htest = test.createHarness()\\n\\nCreate a new test harness instance, which is a function like `test()`, but with\\na new pending stack and test state.\\n\\nBy default the TAP output goes to `process.stdout` or `console.log()` if the\\nenvironment doesn't have `process.stdout`. You can pipe the output to someplace\\nelse if you `test.stream.pipe()` to a destination stream on the first tick.\\n\\n## test.only(name, cb)\\n\\nLike `test(name, cb)` except if you use `.only` this is the only test case\\nthat will run for the entire process, all other test cases using tape will\\nbe ignored\\n\\n# install\\n\\nWith [npm](https://npmjs.org) do:\\n\\n```\\nnpm install tape\\n```\\n\\n# license\\n\\nMIT\\n\",\n   42    \"readmeFilename\": \"readme.markdown\",\n   43    \"bugs\": {\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-uglify\\node_modules\\maxmin\\node_modules\\gzip-size\\node_modules\\zlib-browserify\\node_modules\\tape\\readme.markdown:\n    5  [![build status](https://secure.travis-ci.org/substack/tape.png)](http://travis-ci.org/substack/tape)\n    6  \n    7: ![tape](http://substack.net/images/tape_drive.png)\n    8  \n    9  # browser compatibility\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-uglify\\node_modules\\uglify-js\\node_modules\\optimist\\package.json:\n   36      \"node\": \">=0.4\"\n   37    },\n   38:   \"readme\": \"optimist\\n========\\n\\nOptimist is a node.js library for option parsing for people who hate option\\nparsing. More specifically, this module is for people who like all the --bells\\nand -whistlz of program usage but think optstrings are a waste of time.\\n\\nWith optimist, option parsing doesn't have to suck (as much).\\n\\n[![build status](https://secure.travis-ci.org/substack/node-optimist.png)](http://travis-ci.org/substack/node-optimist)\\n\\nexamples\\n========\\n\\nWith Optimist, the options are just a hash! No optstrings attached.\\n-------------------------------------------------------------------\\n\\nxup.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist').argv;\\n\\nif (argv.rif - 5 * argv.xup > 7.138) {\\n    console.log('Buy more riffiwobbles');\\n}\\nelse {\\n    console.log('Sell the xupptumblers');\\n}\\n````\\n\\n***\\n\\n    $ ./xup.js --rif=55 --xup=9.52\\n    Buy more riffiwobbles\\n    \\n    $ ./xup.js --rif 12 --xup 8.1\\n    Sell the xupptumblers\\n\\n![This one's optimistic.](http://substack.net/images/optimistic.png)\\n\\nBut wait! There's more! You can do short options:\\n-------------------------------------------------\\n \\nshort.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist').argv;\\nconsole.log('(%d,%d)', argv.x, argv.y);\\n````\\n\\n***\\n\\n    $ ./short.js -x 10 -y 21\\n    (10,21)\\n\\nAnd booleans, both long and short (and grouped):\\n----------------------------------\\n\\nbool.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar util = require('util');\\nvar argv = require('optimist').argv;\\n\\nif (argv.s) {\\n    util.print(argv.fr ? 'Le chat dit: ' : 'The cat says: ');\\n}\\nconsole.log(\\n    (argv.fr ? 'miaou' : 'meow') + (argv.p ? '.' : '')\\n);\\n````\\n\\n***\\n\\n    $ ./bool.js -s\\n    The cat says: meow\\n    \\n    $ ./bool.js -sp\\n    The cat says: meow.\\n\\n    $ ./bool.js -sp --fr\\n    Le chat dit: miaou.\\n\\nAnd non-hypenated options too! Just use `argv._`!\\n-------------------------------------------------\\n \\nnonopt.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist').argv;\\nconsole.log('(%d,%d)', argv.x, argv.y);\\nconsole.log(argv._);\\n````\\n\\n***\\n\\n    $ ./nonopt.js -x 6.82 -y 3.35 moo\\n    (6.82,3.35)\\n    [ 'moo' ]\\n    \\n    $ ./nonopt.js foo -x 0.54 bar -y 1.12 baz\\n    (0.54,1.12)\\n    [ 'foo', 'bar', 'baz' ]\\n\\nPlus, Optimist comes with .usage() and .demand()!\\n-------------------------------------------------\\n\\ndivide.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .usage('Usage: $0 -x [num] -y [num]')\\n    .demand(['x','y'])\\n    .argv;\\n\\nconsole.log(argv.x / argv.y);\\n````\\n\\n***\\n \\n    $ ./divide.js -x 55 -y 11\\n    5\\n    \\n    $ node ./divide.js -x 4.91 -z 2.51\\n    Usage: node ./divide.js -x [num] -y [num]\\n\\n    Options:\\n      -x  [required]\\n      -y  [required]\\n\\n    Missing required arguments: y\\n\\nEVEN MORE HOLY COW\\n------------------\\n\\ndefault_singles.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .default('x', 10)\\n    .default('y', 10)\\n    .argv\\n;\\nconsole.log(argv.x + argv.y);\\n````\\n\\n***\\n\\n    $ ./default_singles.js -x 5\\n    15\\n\\ndefault_hash.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .default({ x : 10, y : 10 })\\n    .argv\\n;\\nconsole.log(argv.x + argv.y);\\n````\\n\\n***\\n\\n    $ ./default_hash.js -y 7\\n    17\\n\\nAnd if you really want to get all descriptive about it...\\n---------------------------------------------------------\\n\\nboolean_single.js\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .boolean('v')\\n    .argv\\n;\\nconsole.dir(argv);\\n````\\n\\n***\\n\\n    $ ./boolean_single.js -v foo bar baz\\n    true\\n    [ 'bar', 'baz', 'foo' ]\\n\\nboolean_double.js\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .boolean(['x','y','z'])\\n    .argv\\n;\\nconsole.dir([ argv.x, argv.y, argv.z ]);\\nconsole.dir(argv._);\\n````\\n\\n***\\n\\n    $ ./boolean_double.js -x -z one two three\\n    [ true, false, true ]\\n    [ 'one', 'two', 'three' ]\\n\\nOptimist is here to help...\\n---------------------------\\n\\nYou can describe parameters for help messages and set aliases. Optimist figures\\nout how to format a handy help string automatically.\\n\\nline_count.js\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .usage('Count the lines in a file.\\\\nUsage: $0')\\n    .demand('f')\\n    .alias('f', 'file')\\n    .describe('f', 'Load a file')\\n    .argv\\n;\\n\\nvar fs = require('fs');\\nvar s = fs.createReadStream(argv.file);\\n\\nvar lines = 0;\\ns.on('data', function (buf) {\\n    lines += buf.toString().match(/\\\\n/g).length;\\n});\\n\\ns.on('end', function () {\\n    console.log(lines);\\n});\\n````\\n\\n***\\n\\n    $ node line_count.js\\n    Count the lines in a file.\\n    Usage: node ./line_count.js\\n\\n    Options:\\n      -f, --file  Load a file  [required]\\n\\n    Missing required arguments: f\\n\\n    $ node line_count.js --file line_count.js \\n    20\\n    \\n    $ node line_count.js -f line_count.js \\n    20\\n\\nmethods\\n=======\\n\\nBy itself,\\n\\n````javascript\\nrequire('optimist').argv\\n`````\\n\\nwill use `process.argv` array to construct the `argv` object.\\n\\nYou can pass in the `process.argv` yourself:\\n\\n````javascript\\nrequire('optimist')([ '-x', '1', '-y', '2' ]).argv\\n````\\n\\nor use .parse() to do the same thing:\\n\\n````javascript\\nrequire('optimist').parse([ '-x', '1', '-y', '2' ])\\n````\\n\\nThe rest of these methods below come in just before the terminating `.argv`.\\n\\n.alias(key, alias)\\n------------------\\n\\nSet key names as equivalent such that updates to a key will propagate to aliases\\nand vice-versa.\\n\\nOptionally `.alias()` can take an object that maps keys to aliases.\\n\\n.default(key, value)\\n--------------------\\n\\nSet `argv[key]` to `value` if no option was specified on `process.argv`.\\n\\nOptionally `.default()` can take an object that maps keys to default values.\\n\\n.demand(key)\\n------------\\n\\nIf `key` is a string, show the usage information and exit if `key` wasn't\\nspecified in `process.argv`.\\n\\nIf `key` is a number, demand at least as many non-option arguments, which show\\nup in `argv._`.\\n\\nIf `key` is an Array, demand each element.\\n\\n.describe(key, desc)\\n--------------------\\n\\nDescribe a `key` for the generated usage information.\\n\\nOptionally `.describe()` can take an object that maps keys to descriptions.\\n\\n.options(key, opt)\\n------------------\\n\\nInstead of chaining together `.alias().demand().default()`, you can specify\\nkeys in `opt` for each of the chainable methods.\\n\\nFor example:\\n\\n````javascript\\nvar argv = require('optimist')\\n    .options('f', {\\n        alias : 'file',\\n        default : '/etc/passwd',\\n    })\\n    .argv\\n;\\n````\\n\\nis the same as\\n\\n````javascript\\nvar argv = require('optimist')\\n    .alias('f', 'file')\\n    .default('f', '/etc/passwd')\\n    .argv\\n;\\n````\\n\\nOptionally `.options()` can take an object that maps keys to `opt` parameters.\\n\\n.usage(message)\\n---------------\\n\\nSet a usage message to show which commands to use. Inside `message`, the string\\n`$0` will get interpolated to the current script name or node command for the\\npresent script similar to how `$0` works in bash or perl.\\n\\n.check(fn)\\n----------\\n\\nCheck that certain conditions are met in the provided arguments.\\n\\nIf `fn` throws or returns `false`, show the thrown error, usage information, and\\nexit.\\n\\n.boolean(key)\\n-------------\\n\\nInterpret `key` as a boolean. If a non-flag option follows `key` in\\n`process.argv`, that string won't get set as the value of `key`.\\n\\nIf `key` never shows up as a flag in `process.arguments`, `argv[key]` will be\\n`false`.\\n\\nIf `key` is an Array, interpret all the elements as booleans.\\n\\n.string(key)\\n------------\\n\\nTell the parser logic not to interpret `key` as a number or boolean.\\nThis can be useful if you need to preserve leading zeros in an input.\\n\\nIf `key` is an Array, interpret all the elements as strings.\\n\\n.wrap(columns)\\n--------------\\n\\nFormat usage output to wrap at `columns` many columns.\\n\\n.help()\\n-------\\n\\nReturn the generated usage string.\\n\\n.showHelp(fn=console.error)\\n---------------------------\\n\\nPrint the usage data using `fn` for printing.\\n\\n.parse(args)\\n------------\\n\\nParse `args` instead of `process.argv`. Returns the `argv` object.\\n\\n.argv\\n-----\\n\\nGet the arguments as a plain old object.\\n\\nArguments without a corresponding flag show up in the `argv._` array.\\n\\nThe script name or node command is available at `argv.$0` similarly to how `$0`\\nworks in bash or perl.\\n\\nparsing tricks\\n==============\\n\\nstop parsing\\n------------\\n\\nUse `--` to stop parsing flags and stuff the remainder into `argv._`.\\n\\n    $ node examples/reflect.js -a 1 -b 2 -- -c 3 -d 4\\n    { _: [ '-c', '3', '-d', '4' ],\\n      '$0': 'node ./examples/reflect.js',\\n      a: 1,\\n      b: 2 }\\n\\nnegate fields\\n-------------\\n\\nIf you want to explicity set a field to false instead of just leaving it\\nundefined or to override a default you can do `--no-key`.\\n\\n    $ node examples/reflect.js -a --no-b\\n    { _: [],\\n      '$0': 'node ./examples/reflect.js',\\n      a: true,\\n      b: false }\\n\\nnumbers\\n-------\\n\\nEvery argument that looks like a number (`!isNaN(Number(arg))`) is converted to\\none. This way you can just `net.createConnection(argv.port)` and you can add\\nnumbers out of `argv` with `+` without having that mean concatenation,\\nwhich is super frustrating.\\n\\nduplicates\\n----------\\n\\nIf you specify a flag multiple times it will get turned into an array containing\\nall the values in order.\\n\\n    $ node examples/reflect.js -x 5 -x 8 -x 0\\n    { _: [],\\n      '$0': 'node ./examples/reflect.js',\\n        x: [ 5, 8, 0 ] }\\n\\ndot notation\\n------------\\n\\nWhen you use dots (`.`s) in argument names, an implicit object path is assumed.\\nThis lets you organize arguments into nested objects.\\n\\n     $ node examples/reflect.js --foo.bar.baz=33 --foo.quux=5\\n     { _: [],\\n       '$0': 'node ./examples/reflect.js',\\n         foo: { bar: { baz: 33 }, quux: 5 } }\\n\\ninstallation\\n============\\n\\nWith [npm](http://github.com/isaacs/npm), just do:\\n    npm install optimist\\n \\nor clone this project on github:\\n\\n    git clone http://github.com/substack/node-optimist.git\\n\\nTo run the tests with [expresso](http://github.com/visionmedia/expresso),\\njust do:\\n    \\n    expresso\\n\\ninspired By\\n===========\\n\\nThis module is loosely inspired by Perl's\\n[Getopt::Casual](http://search.cpan.org/~photo/Getopt-Casual-0.13.1/Casual.pm).\\n\",\n   39    \"readmeFilename\": \"readme.markdown\",\n   40    \"bugs\": {\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-uglify\\node_modules\\uglify-js\\node_modules\\optimist\\readme.markdown:\n   38      Sell the xupptumblers\n   39  \n   40: ![This one's optimistic.](http://substack.net/images/optimistic.png)\n   41  \n   42  But wait! There's more! You can do short options:\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-watch\\node_modules\\gaze\\package.json:\n   48      \"LICENSE-MIT\"\n   49    ],\n   50:   \"readme\": \"# gaze [![Build Status](https://travis-ci.org/shama/gaze.png?branch=master)](https://travis-ci.org/shama/gaze)\\n\\nA globbing fs.watch wrapper built from the best parts of other fine watch libs.  \\nCompatible with Node.js 0.10/0.8, Windows, OSX and Linux.\\n\\n![gaze](http://dontkry.com/images/repos/gaze.png)\\n\\n## Usage\\nInstall the module with: `npm install gaze` or place into your `package.json`\\nand run `npm install`.\\n\\n```javascript\\nvar gaze = require('gaze');\\n\\n// Watch all .js files/dirs in process.cwd()\\ngaze('**/*.js', function(err, watcher) {\\n  // Files have all started watching\\n  // watcher === this\\n\\n  // Get all watched files\\n  console.log(this.watched());\\n\\n  // On file changed\\n  this.on('changed', function(filepath) {\\n    console.log(filepath + ' was changed');\\n  });\\n\\n  // On file added\\n  this.on('added', function(filepath) {\\n    console.log(filepath + ' was added');\\n  });\\n\\n  // On file deleted\\n  this.on('deleted', function(filepath) {\\n    console.log(filepath + ' was deleted');\\n  });\\n\\n  // On changed/added/deleted\\n  this.on('all', function(event, filepath) {\\n    console.log(filepath + ' was ' + event);\\n  });\\n\\n  // Get watched files with relative paths\\n  console.log(this.relative());\\n});\\n\\n// Also accepts an array of patterns\\ngaze(['stylesheets/*.css', 'images/**/*.png'], function() {\\n  // Add more patterns later to be watched\\n  this.add(['js/*.js']);\\n});\\n```\\n\\n### Alternate Interface\\n\\n```javascript\\nvar Gaze = require('gaze').Gaze;\\n\\nvar gaze = new Gaze('**/*');\\n\\n// Files have all started watching\\ngaze.on('ready', function(watcher) { });\\n\\n// A file has been added/changed/deleted has occurred\\ngaze.on('all', function(event, filepath) { });\\n```\\n\\n### Errors\\n\\n```javascript\\ngaze('**/*', function() {\\n  this.on('error', function(err) {\\n    // Handle error here\\n  });\\n});\\n```\\n\\n### Minimatch / Glob\\n\\nSee [isaacs's minimatch](https://github.com/isaacs/minimatch) for more\\ninformation on glob patterns.\\n\\n## Documentation\\n\\n### gaze(patterns, [options], callback)\\n\\n* `patterns` {String|Array} File patterns to be matched\\n* `options` {Object}\\n* `callback` {Function}\\n  * `err` {Error | null}\\n  * `watcher` {Object} Instance of the Gaze watcher\\n\\n### Class: gaze.Gaze\\n\\nCreate a Gaze object by instanting the `gaze.Gaze` class.\\n\\n```javascript\\nvar Gaze = require('gaze').Gaze;\\nvar gaze = new Gaze(pattern, options, callback);\\n```\\n\\n#### Properties\\n\\n* `options` The options object passed in.\\n  * `interval` {integer} Interval to pass to fs.watchFile\\n  * `debounceDelay` {integer} Delay for events called in succession for the same\\n    file/event\\n\\n#### Events\\n\\n* `ready(watcher)` When files have been globbed and watching has begun.\\n* `all(event, filepath)` When an `added`, `changed` or `deleted` event occurs.\\n* `added(filepath)` When a file has been added to a watch directory.\\n* `changed(filepath)` When a file has been changed.\\n* `deleted(filepath)` When a file has been deleted.\\n* `renamed(newPath, oldPath)` When a file has been renamed.\\n* `end()` When the watcher is closed and watches have been removed.\\n* `error(err)` When an error occurs.\\n* `nomatch` When no files have been matched.\\n\\n#### Methods\\n\\n* `emit(event, [...])` Wrapper for the EventEmitter.emit.\\n  `added`|`changed`|`deleted` events will also trigger the `all` event.\\n* `close()` Unwatch all files and reset the watch instance.\\n* `add(patterns, callback)` Adds file(s) patterns to be watched.\\n* `remove(filepath)` removes a file or directory from being watched. Does not\\n  recurse directories.\\n* `watched()` Returns the currently watched files.\\n* `relative([dir, unixify])` Returns the currently watched files with relative paths.\\n  * `dir` {string} Only return relative files for this directory.\\n  * `unixify` {boolean} Return paths with `/` instead of `\\\\\\\\` if on Windows.\\n\\n## FAQs\\n\\n### Why Another `fs.watch` Wrapper?\\nI liked parts of other `fs.watch` wrappers but none had all the features I\\nneeded. This lib combines the features I needed from other fine watch libs:\\nSpeedy data behavior from\\n[paulmillr's chokidar](https://github.com/paulmillr/chokidar), API interface\\nfrom [mikeal's watch](https://github.com/mikeal/watch) and file globbing using\\n[isaacs's glob](https://github.com/isaacs/node-glob) which is also used by\\n[cowboy's Grunt](https://github.com/gruntjs/grunt).\\n\\n### How do I fix the error `EMFILE: Too many opened files.`?\\nThis is because of your system's max opened file limit. For OSX the default is\\nvery low (256). Increase your limit temporarily with `ulimit -n 10480`, the\\nnumber being the new max limit.\\n\\n## Contributing\\nIn lieu of a formal styleguide, take care to maintain the existing coding style.\\nAdd unit tests for any new or changed functionality. Lint and test your code\\nusing [grunt](http://gruntjs.com/).\\n\\n## Release History\\n* 0.5.1 - Use setImmediate (process.nextTick for node v0.8) to defer ready/nomatch events (@amasad).\\n* 0.5.0 - Process is now kept alive while watching files. Emits a nomatch event when no files are matching.\\n* 0.4.3 - Track file additions in newly created folders (@brett-shwom).\\n* 0.4.2 - Fix .remove() method to remove a single file in a directory (@kaelzhang). Fixing Cannot call method 'call' of undefined (@krasimir). Track new file additions within folders (@brett-shwom).\\n* 0.4.1 - Fix watchDir not respecting close in race condition (@chrisirhc).\\n* 0.4.0 - Drop support for node v0.6. Use globule for file matching. Avoid node v0.10 path.resolve/join errors. Register new files when added to non-existent folder. Multiple instances can now poll the same files (@jpommerening).\\n* 0.3.4 - Code clean up. Fix path must be strings errors (@groner). Fix incorrect added events (@groner).\\n* 0.3.3 - Fix for multiple patterns with negate.\\n* 0.3.2 - Emit `end` before removeAllListeners.\\n* 0.3.1 - Fix added events within subfolder patterns.\\n* 0.3.0 - Handle safewrite events, `forceWatchMethod` option removed, bug fixes and watch optimizations (@rgaskill).\\n* 0.2.2 - Fix issue where subsequent add calls dont get watched (@samcday). removeAllListeners on close.\\n* 0.2.1 - Fix issue with invalid `added` events in current working dir.\\n* 0.2.0 - Support and mark folders with `path.sep`. Add `forceWatchMethod` option. Support `renamed` events.\\n* 0.1.6 - Recognize the `cwd` option properly\\n* 0.1.5 - Catch too many open file errors\\n* 0.1.4 - Really fix the race condition with 2 watches\\n* 0.1.3 - Fix race condition with 2 watches\\n* 0.1.2 - Read triggering changed event fix\\n* 0.1.1 - Minor fixes\\n* 0.1.0 - Initial release\\n\\n## License\\nCopyright (c) 2013 Kyle Robinson Young  \\nLicensed under the MIT license.\\n\",\n   51    \"readmeFilename\": \"README.md\",\n   52    \"_id\": \"gaze@0.5.1\",\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-watch\\node_modules\\gaze\\README.md:\n    4  Compatible with Node.js 0.10/0.8, Windows, OSX and Linux.\n    5  \n    6: ![gaze](http://dontkry.com/images/repos/gaze.png)\n    7  \n    8  ## Usage\n    .\n   46  \n   47  // Also accepts an array of patterns\n   48: gaze(['stylesheets/*.css', 'images/**/*.png'], function() {\n   49    // Add more patterns later to be watched\n   50    this.add(['js/*.js']);\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\grunt-contrib-watch\\node_modules\\tiny-lr-fork\\node_modules\\qs\\test\\browser\\mocha.js:\n  896  \n  897  function image(name) {\n  898:   return __dirname + '/../images/' + name + '.png';\n  899  }\n  900  \n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\karma\\node_modules\\optimist\\package.json:\n   37      \"node\": \">=0.4\"\n   38    },\n   39:   \"readme\": \"# DEPRECATION NOTICE\\n\\nI don't want to maintain this module anymore since I just use\\n[minimist](https://npmjs.org/package/minimist), the argument parsing engine,\\ndirectly instead nowadays.\\n\\nSee [yargs](https://github.com/chevex/yargs) for the modern, pirate-themed\\nsuccessor to optimist.\\n\\n[![yarrrrrrrgs!](http://i.imgur.com/4WFGVJ9.png)](https://github.com/chevex/yargs)\\n\\nYou should also consider [nomnom](https://github.com/harthur/nomnom).\\n\\noptimist\\n========\\n\\nOptimist is a node.js library for option parsing for people who hate option\\nparsing. More specifically, this module is for people who like all the --bells\\nand -whistlz of program usage but think optstrings are a waste of time.\\n\\nWith optimist, option parsing doesn't have to suck (as much).\\n\\n[![build status](https://secure.travis-ci.org/substack/node-optimist.png)](http://travis-ci.org/substack/node-optimist)\\n\\nexamples\\n========\\n\\nWith Optimist, the options are just a hash! No optstrings attached.\\n-------------------------------------------------------------------\\n\\nxup.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist').argv;\\n\\nif (argv.rif - 5 * argv.xup > 7.138) {\\n    console.log('Buy more riffiwobbles');\\n}\\nelse {\\n    console.log('Sell the xupptumblers');\\n}\\n````\\n\\n***\\n\\n    $ ./xup.js --rif=55 --xup=9.52\\n    Buy more riffiwobbles\\n    \\n    $ ./xup.js --rif 12 --xup 8.1\\n    Sell the xupptumblers\\n\\n![This one's optimistic.](http://substack.net/images/optimistic.png)\\n\\nBut wait! There's more! You can do short options:\\n-------------------------------------------------\\n \\nshort.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist').argv;\\nconsole.log('(%d,%d)', argv.x, argv.y);\\n````\\n\\n***\\n\\n    $ ./short.js -x 10 -y 21\\n    (10,21)\\n\\nAnd booleans, both long and short (and grouped):\\n----------------------------------\\n\\nbool.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar util = require('util');\\nvar argv = require('optimist').argv;\\n\\nif (argv.s) {\\n    util.print(argv.fr ? 'Le chat dit: ' : 'The cat says: ');\\n}\\nconsole.log(\\n    (argv.fr ? 'miaou' : 'meow') + (argv.p ? '.' : '')\\n);\\n````\\n\\n***\\n\\n    $ ./bool.js -s\\n    The cat says: meow\\n    \\n    $ ./bool.js -sp\\n    The cat says: meow.\\n\\n    $ ./bool.js -sp --fr\\n    Le chat dit: miaou.\\n\\nAnd non-hypenated options too! Just use `argv._`!\\n-------------------------------------------------\\n \\nnonopt.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist').argv;\\nconsole.log('(%d,%d)', argv.x, argv.y);\\nconsole.log(argv._);\\n````\\n\\n***\\n\\n    $ ./nonopt.js -x 6.82 -y 3.35 moo\\n    (6.82,3.35)\\n    [ 'moo' ]\\n    \\n    $ ./nonopt.js foo -x 0.54 bar -y 1.12 baz\\n    (0.54,1.12)\\n    [ 'foo', 'bar', 'baz' ]\\n\\nPlus, Optimist comes with .usage() and .demand()!\\n-------------------------------------------------\\n\\ndivide.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .usage('Usage: $0 -x [num] -y [num]')\\n    .demand(['x','y'])\\n    .argv;\\n\\nconsole.log(argv.x / argv.y);\\n````\\n\\n***\\n \\n    $ ./divide.js -x 55 -y 11\\n    5\\n    \\n    $ node ./divide.js -x 4.91 -z 2.51\\n    Usage: node ./divide.js -x [num] -y [num]\\n\\n    Options:\\n      -x  [required]\\n      -y  [required]\\n\\n    Missing required arguments: y\\n\\nEVEN MORE HOLY COW\\n------------------\\n\\ndefault_singles.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .default('x', 10)\\n    .default('y', 10)\\n    .argv\\n;\\nconsole.log(argv.x + argv.y);\\n````\\n\\n***\\n\\n    $ ./default_singles.js -x 5\\n    15\\n\\ndefault_hash.js:\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .default({ x : 10, y : 10 })\\n    .argv\\n;\\nconsole.log(argv.x + argv.y);\\n````\\n\\n***\\n\\n    $ ./default_hash.js -y 7\\n    17\\n\\nAnd if you really want to get all descriptive about it...\\n---------------------------------------------------------\\n\\nboolean_single.js\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .boolean('v')\\n    .argv\\n;\\nconsole.dir(argv);\\n````\\n\\n***\\n\\n    $ ./boolean_single.js -v foo bar baz\\n    true\\n    [ 'bar', 'baz', 'foo' ]\\n\\nboolean_double.js\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .boolean(['x','y','z'])\\n    .argv\\n;\\nconsole.dir([ argv.x, argv.y, argv.z ]);\\nconsole.dir(argv._);\\n````\\n\\n***\\n\\n    $ ./boolean_double.js -x -z one two three\\n    [ true, false, true ]\\n    [ 'one', 'two', 'three' ]\\n\\nOptimist is here to help...\\n---------------------------\\n\\nYou can describe parameters for help messages and set aliases. Optimist figures\\nout how to format a handy help string automatically.\\n\\nline_count.js\\n\\n````javascript\\n#!/usr/bin/env node\\nvar argv = require('optimist')\\n    .usage('Count the lines in a file.\\\\nUsage: $0')\\n    .demand('f')\\n    .alias('f', 'file')\\n    .describe('f', 'Load a file')\\n    .argv\\n;\\n\\nvar fs = require('fs');\\nvar s = fs.createReadStream(argv.file);\\n\\nvar lines = 0;\\ns.on('data', function (buf) {\\n    lines += buf.toString().match(/\\\\n/g).length;\\n});\\n\\ns.on('end', function () {\\n    console.log(lines);\\n});\\n````\\n\\n***\\n\\n    $ node line_count.js\\n    Count the lines in a file.\\n    Usage: node ./line_count.js\\n\\n    Options:\\n      -f, --file  Load a file  [required]\\n\\n    Missing required arguments: f\\n\\n    $ node line_count.js --file line_count.js \\n    20\\n    \\n    $ node line_count.js -f line_count.js \\n    20\\n\\nmethods\\n=======\\n\\nBy itself,\\n\\n````javascript\\nrequire('optimist').argv\\n`````\\n\\nwill use `process.argv` array to construct the `argv` object.\\n\\nYou can pass in the `process.argv` yourself:\\n\\n````javascript\\nrequire('optimist')([ '-x', '1', '-y', '2' ]).argv\\n````\\n\\nor use .parse() to do the same thing:\\n\\n````javascript\\nrequire('optimist').parse([ '-x', '1', '-y', '2' ])\\n````\\n\\nThe rest of these methods below come in just before the terminating `.argv`.\\n\\n.alias(key, alias)\\n------------------\\n\\nSet key names as equivalent such that updates to a key will propagate to aliases\\nand vice-versa.\\n\\nOptionally `.alias()` can take an object that maps keys to aliases.\\n\\n.default(key, value)\\n--------------------\\n\\nSet `argv[key]` to `value` if no option was specified on `process.argv`.\\n\\nOptionally `.default()` can take an object that maps keys to default values.\\n\\n.demand(key)\\n------------\\n\\nIf `key` is a string, show the usage information and exit if `key` wasn't\\nspecified in `process.argv`.\\n\\nIf `key` is a number, demand at least as many non-option arguments, which show\\nup in `argv._`.\\n\\nIf `key` is an Array, demand each element.\\n\\n.describe(key, desc)\\n--------------------\\n\\nDescribe a `key` for the generated usage information.\\n\\nOptionally `.describe()` can take an object that maps keys to descriptions.\\n\\n.options(key, opt)\\n------------------\\n\\nInstead of chaining together `.alias().demand().default()`, you can specify\\nkeys in `opt` for each of the chainable methods.\\n\\nFor example:\\n\\n````javascript\\nvar argv = require('optimist')\\n    .options('f', {\\n        alias : 'file',\\n        default : '/etc/passwd',\\n    })\\n    .argv\\n;\\n````\\n\\nis the same as\\n\\n````javascript\\nvar argv = require('optimist')\\n    .alias('f', 'file')\\n    .default('f', '/etc/passwd')\\n    .argv\\n;\\n````\\n\\nOptionally `.options()` can take an object that maps keys to `opt` parameters.\\n\\n.usage(message)\\n---------------\\n\\nSet a usage message to show which commands to use. Inside `message`, the string\\n`$0` will get interpolated to the current script name or node command for the\\npresent script similar to how `$0` works in bash or perl.\\n\\n.check(fn)\\n----------\\n\\nCheck that certain conditions are met in the provided arguments.\\n\\nIf `fn` throws or returns `false`, show the thrown error, usage information, and\\nexit.\\n\\n.boolean(key)\\n-------------\\n\\nInterpret `key` as a boolean. If a non-flag option follows `key` in\\n`process.argv`, that string won't get set as the value of `key`.\\n\\nIf `key` never shows up as a flag in `process.arguments`, `argv[key]` will be\\n`false`.\\n\\nIf `key` is an Array, interpret all the elements as booleans.\\n\\n.string(key)\\n------------\\n\\nTell the parser logic not to interpret `key` as a number or boolean.\\nThis can be useful if you need to preserve leading zeros in an input.\\n\\nIf `key` is an Array, interpret all the elements as strings.\\n\\n.wrap(columns)\\n--------------\\n\\nFormat usage output to wrap at `columns` many columns.\\n\\n.help()\\n-------\\n\\nReturn the generated usage string.\\n\\n.showHelp(fn=console.error)\\n---------------------------\\n\\nPrint the usage data using `fn` for printing.\\n\\n.parse(args)\\n------------\\n\\nParse `args` instead of `process.argv`. Returns the `argv` object.\\n\\n.argv\\n-----\\n\\nGet the arguments as a plain old object.\\n\\nArguments without a corresponding flag show up in the `argv._` array.\\n\\nThe script name or node command is available at `argv.$0` similarly to how `$0`\\nworks in bash or perl.\\n\\nparsing tricks\\n==============\\n\\nstop parsing\\n------------\\n\\nUse `--` to stop parsing flags and stuff the remainder into `argv._`.\\n\\n    $ node examples/reflect.js -a 1 -b 2 -- -c 3 -d 4\\n    { _: [ '-c', '3', '-d', '4' ],\\n      '$0': 'node ./examples/reflect.js',\\n      a: 1,\\n      b: 2 }\\n\\nnegate fields\\n-------------\\n\\nIf you want to explicity set a field to false instead of just leaving it\\nundefined or to override a default you can do `--no-key`.\\n\\n    $ node examples/reflect.js -a --no-b\\n    { _: [],\\n      '$0': 'node ./examples/reflect.js',\\n      a: true,\\n      b: false }\\n\\nnumbers\\n-------\\n\\nEvery argument that looks like a number (`!isNaN(Number(arg))`) is converted to\\none. This way you can just `net.createConnection(argv.port)` and you can add\\nnumbers out of `argv` with `+` without having that mean concatenation,\\nwhich is super frustrating.\\n\\nduplicates\\n----------\\n\\nIf you specify a flag multiple times it will get turned into an array containing\\nall the values in order.\\n\\n    $ node examples/reflect.js -x 5 -x 8 -x 0\\n    { _: [],\\n      '$0': 'node ./examples/reflect.js',\\n        x: [ 5, 8, 0 ] }\\n\\ndot notation\\n------------\\n\\nWhen you use dots (`.`s) in argument names, an implicit object path is assumed.\\nThis lets you organize arguments into nested objects.\\n\\n     $ node examples/reflect.js --foo.bar.baz=33 --foo.quux=5\\n     { _: [],\\n       '$0': 'node ./examples/reflect.js',\\n         foo: { bar: { baz: 33 }, quux: 5 } }\\n\\nshort numbers\\n-------------\\n\\nShort numeric `head -n5` style argument work too:\\n\\n    $ node reflect.js -n123 -m456\\n    { '3': true,\\n      '6': true,\\n      _: [],\\n      '$0': 'node ./reflect.js',\\n      n: 123,\\n      m: 456 }\\n\\ninstallation\\n============\\n\\nWith [npm](http://github.com/isaacs/npm), just do:\\n    npm install optimist\\n \\nor clone this project on github:\\n\\n    git clone http://github.com/substack/node-optimist.git\\n\\nTo run the tests with [expresso](http://github.com/visionmedia/expresso),\\njust do:\\n    \\n    expresso\\n\\ninspired By\\n===========\\n\\nThis module is loosely inspired by Perl's\\n[Getopt::Casual](http://search.cpan.org/~photo/Getopt-Casual-0.13.1/Casual.pm).\\n\",\n   40    \"readmeFilename\": \"readme.markdown\",\n   41    \"bugs\": {\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\karma\\node_modules\\optimist\\readme.markdown:\n   51      Sell the xupptumblers\n   52  \n   53: ![This one's optimistic.](http://substack.net/images/optimistic.png)\n   54  \n   55  But wait! There's more! You can do short options:\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\karma\\node_modules\\socket.io\\node_modules\\socket.io-client\\node_modules\\active-x-obfuscator\\node_modules\\zeparser\\benchmark.html:\n 13813  if (code.toString().match(/^\\#(.+)$/)) code = \"Nav.go('\"+RegExp.$1+\"')\";\n 13814  html += '<div class=\"tab '+((tab[1] == cur_tab_name) ? 'active' : 'inactive')+'\" onClick=\"'+code+'\">';\n 13815: html += '<div class=\"content ' + (tab[2] ? (' icon\" style=\"background-image:url(images/icons/'+tab[2]+')\"') : '\"') + '>' + tab[1] + '</div>';\n 13816  html += '</div>';\n 13817  }\n .....\n 14866  var html = '';\n 14867  html += '<iframe id=\"i_upload_basic\" src=\"blank.html\" style=\"position:absolute; left:-2000px; top:0px; width:1px; height:1px;\"></iframe>';\n 14868: html += '<div class=\"dialog_bkgnd\" style=\"background-image:url('+png('/effect/images/big_icons/upload.png')+')\">';\n 14869  html += '<table cellspacing=0 cellpadding=0><tr><td width=400 height=200 valign=center align=center>';\n 14870  html += '<div class=\"dialog_title\">Upload File</div>';\n .....\n 15251  var temp_username = session.open_id || session.username || '';\n 15252  var html = '';\n 15253: html += '<div class=\"dialog_bkgnd\" style=\"background-image:url('+png('images/big_icons/key.png')+')\">';\n 15254  html += '<table cellspacing=0 cellpadding=0><tr><td width=450 height=225 valign=center align=center>';\n 15255  html += '<div class=\"dialog_title\">Effect Developer Login</div>';\n .....\n 15276  if (typeof(auto_login_button) == 'undefined') auto_login_button = 1;\n 15277  var html = '';\n 15278: html += '<div class=\"dialog_bkgnd\" style=\"background-image:url('+png('images/big_icons/openid.png')+')\">';\n 15279  html += '<table cellspacing=0 cellpadding=0><tr><td width=450 height=225 valign=center align=center>';\n 15280  html += '<div class=\"dialog_title\">'+title+'</div>';\n .....\n 15301  if (!session.username) session.username = '';\n 15302  var html = '';\n 15303: html += '<div class=\"dialog_bkgnd\" style=\"background-image:url('+png('images/big_icons/key.png')+')\">';\n 15304  html += '<table cellspacing=0 cellpadding=0><tr><td width=450 height=225 valign=center align=center>';\n 15305  html += '<div class=\"dialog_title\">Enter Your Password</div>';\n .....\n 15578  html += '<div class=\"dialog_title\">Image Manager</div>';\n 15579  html += '<div class=\"vert_selector\" id=\"d_user_image_list\" style=\"width:480px; height:200px;\">';\n 15580: html += '<img src=\"images/loading.gif\" width=\"32\" height=\"32\" style=\"margin-left:174px; margin-top:84px\"/>';\n 15581  html += '</div>';\n 15582  html += '<br><table><tr>';\n .....\n 15659  filename = RegExp.$2;\n 15660  }\n 15661: var url = '/effect/api/view/users/' + username + '/images/' + filename.replace(/\\.(\\w+)$/, '_thumb.jpg');\n 15662  return '<img src=\"'+url+'\" width=\"'+width+'\" height=\"'+height+'\" '+compose_attribs(attribs)+'/>';\n 15663  }\n .....\n 15793  html += '<div class=\"h2\" style=\"margin-bottom:5px;\">';\n 15794  html += '<div class=\"fl\">Latest Game Activity</div>';\n 15795: html += '<div class=\"fr\"><a href=\"#GameLog/'+game_id+'\" title=\"View Log\" class=\"icon\" style=\"margin-left:5px; background-image:url(images/icons/application_view_detail.png)\">View Log</a></div>';\n 15796: html += '<div class=\"fr\"><a href=\"javascript:void(show_glog_post_dialog(\\''+game_id+'\\'))\" title=\"Post Message\" class=\"icon\" style=\"margin-left:5px; background-image:url(images/icons/comment_edit.png)\">Post Message</a></div>';\n 15797  html += '<div class=\"clear\"></div>';\n 15798  html += '</div>';\n .....\n 15812  delete session.progress;\n 15813  var html = '';\n 15814: html += '<div class=\"dialog_bkgnd\" style=\"background-image:url('+png('/effect/images/big_icons/pencil_paper.png')+')\">';\n 15815  html += '<table cellspacing=0 cellpadding=0><tr><td width=500 height=175 valign=center align=center>';\n 15816  html += '<div class=\"dialog_title\">Post Game Log Message</div>';\n .....\n 16171  args.offset += args.limit;\n 16172  Debug.trace('blog', \"More Args: \" + dumper(args));\n 16173: div.innerHTML = '<img src=\"images/loading.gif\" width=\"32\" height=\"32\"/>';\n 16174  effect_api_get( 'article_search', args, [this, 'more_response'], { _search_args: args, _div: div } );\n 16175  },\n .....\n 16336  get_control: function(icon, code, text, status_text) {\n 16337  if (!icon.match(/\\.\\w+$/)) icon += '.gif';\n 16338: return '<span class=\"comment_control\" style=\"background-image:url(/effect/images/icons/small/'+icon+')\">' + code_link(code, text, status_text) + '</span>';\n 16339  },\n 16340  get_comment_controls: function(page_id, comment) {\n .....\n 16366  var comment = find_object( this.comments, { ID: comment_id } );\n 16367  var html = '';\n 16368: html += '<div class=\"dialog_bkgnd\" style=\"background-image:url('+png('/effect/images/big_icons/pencil_paper.png')+')\">';\n 16369  html += '<table cellspacing=0 cellpadding=0><tr><td width=600 height=300 valign=center align=center>';\n 16370  html += '<div class=\"dialog_title\">Reply to Comment by \"'+comment.Name+'\"</div>';\n .....\n 16417  var comment = find_object( this.comments, { ID: comment_id } );\n 16418  if (!comment._replies_visible) {\n 16419: $('d_comment_replies_' + comment_id).show().innerHTML = '<img src=\"images/loading.gif\" width=\"32\" height=\"32\"/>';\n 16420  }\n 16421  var args = { page_id: page_id, comment_id: comment_id, offset: 0, limit: 100 };\n .....\n 16475  delete session.progress;\n 16476  var html = '';\n 16477: html += '<div class=\"dialog_bkgnd\" style=\"background-image:url('+png('/effect/images/big_icons/pencil_paper.png')+')\">';\n 16478  html += '<table cellspacing=0 cellpadding=0><tr><td width=600 height=300 valign=center align=center>';\n 16479  html += '<div class=\"dialog_title\">Post New Comment</div>';\n .....\n 17052  (game.Logo ? \n 17053  user_image_thumbnail(game.Logo, 80, 60) : \n 17054: '<img class=\"png\" src=\"/effect/images/logo_80_60.png\" width=\"80\" height=\"60\"/>'\n 17055  ) + '<br/>' + ww_fit_box(game.Title, 80, 2, session.em_width, 1) + '</div>';\n 17056  } \n .....\n 17071  var image_url = row.Params.featured_image;\n 17072  if (image_url && image_url.match(/^(\\w+)\\/(\\w+\\.\\w+)$/)) {\n 17073: image_url = '/effect/api/view/users/' + RegExp.$1 + '/images/' + RegExp.$2;\n 17074  }\n 17075  if (idx % 2 == 0) html += '<tr>';\n .....\n 17210  (game.Logo ? \n 17211  user_image_thumbnail(game.Logo, 80, 60) : \n 17212: '<img class=\"png\" src=\"/effect/images/logo_80_60.png\" width=\"80\" height=\"60\"/>'\n 17213  ) + '<br/>' + ww_fit_box(game.Title, 80, 2, session.em_width, 1) + '</div>';\n 17214  } \n .....\n 17622  Nr=\"ts\",rna=\" = \",Or=\"Reply to all\",sna=\"Recover from Trash\",Pr=\"Ignore\",tna=\"Report phishing\",una=\"Send\",vna=\"Create a new label\",wna=\"Create a filter\",xna=\"Share\",yna=\"Expand all\",zna=\"transliterationConfig\",Qr=\"^act\",Ana=\"Public\",Rr=\"lcv\",Sr=\"plcv\",Bna=\"yH\",Cna=\"dn\",Tr=\"frs\",Dna=\"-iframe\",Ur=\"-1\",Vr=\"visibility\",Wr=\"gwt.hosted\",Xr=\"service\",Ena=\"popupOpensProfiles\",Fna=\"SOURCES\",Yr=\"exp\",Zr=\"alpha\",Gna=\"GB\",as=\"gb\",Hna=\"Ud\",bs=\"Home\",cs=\"Work\",ds=\"Other\",Ina=\"Bt\",Jna=\"Ax\",Kna=\"tx\",Lna=\"ignoreesc\",\n 17623  Mna=\"l1\",Nna=\"Af\",es=\"Bj\",Ona=\"sD\",Pna=\"sit\",fs=\"sii\",Qna=\"sim\",Rna=\"fvi\",Sna=\"Za\",Tna=\"Ya\",gs=\"ab\",Una=\"PICK\",Vna=\"EDIT\",Wna=\"disp\",Xna=\"userId\",Yna=\"hide-media\",hs=\"db\",Zna=\"edit\",aoa=\"sources\",boa=\"new_group\",coa=\"26ac\",is='\" value=\"',doa='\"></span></div>',js=\"uk\",ks=\"link\",eoa=\"Set status here\",foa=\"uf\",goa=\"Loading&hellip;\",hoa=\"Sign into chat\",ioa=\"Try to connect\",ls=\"Offline\",joa='\" action=\"',koa=\"</table></div>\",ms='\"><tr class=\"',ns='</span><span id=\"',os='\" style=\"display:',loa='\">&nbsp; ',\n 17624: moa=\"Invited\",ps=\"<td>\",qs=\"c3\",rs=\"vm\",ss=\"in\",ts=\"1px\",noa=\"vp\",ooa=\"Ae\",poa=\"Ag\",qoa=\"bt\",us=\"sr\",roa=\"Invisible\",soa=\"1m\",vs=\"mp\",toa=\"Available\",uoa=\"Custom Message...\",voa=\"Busy\",ws=\"iv\",woa=\"Sign out of chat\",xs=\"so\",xoa=\"Clear custom messages\",ys=\"de\",yoa='\"><td>',zs='</td><td id=\"',zoa=\"Hide\",As='</span><span class=\"',Aoa=\"Waiting for \",Boa=\"stm\",Coa=\"Ok\",Doa=\"csl\",Bs='\"><img src=\"images/cleardot.gif\" class=\"',Cs='\"/><div class=\"',Eoa=\"iOeLLc\",Ds='\" />',Foa=\"Hm\",Es=\"Ha\",Fs=\"bottom\",Goa=\"dh\",\n 17625  Gs=\"mm\",Hs=\"po\",Hoa=\"Hc\",Ioa=\"Hb\",Joa=\"Hs\",Koa=\"11\",Noa=\"h9\",Ooa=\"results\",Poa=\"Bi\",Qoa=\"ih\",Is=\"drop\",Js=\"dragend\",Ks=\"dragover\",Roa=\"data\",Ls=\"mD\",Ms=' <span class=\"',Soa=\"mG\",Toa=\"Reply by chat to \",Ns='\" idlink>',Uoa=\" is not available to chat\",Voa=\"mF\",Os='\"><img class=\"',Ps='\" src=\"',Qs=\"max\",Rs=\"line\",Woa=\"Hebrew\",Xoa=\"Arabic\",Yoa=\"Urdu\",Zoa=\"Persian\",apa=\"\\u000c\",bpa=\"English\",Ss=\"</td></tr></table>\",cpa=' value=\"',Ts=\"</label>\",Us=\"rc\",Vs='<select id=\"',Ws=\"sA\",Xs='</div><div id=\"',dpa='\"><tr><td><div class=\"',\n 17626  Ys='\" alt=\"',Zs=\"</td></tr></table></div>\",at='\">(',epa=\"main\",fpa=\"fwdandpop\",bt=\"general\",ct='\" target=_blank>',dt=\"sn\",gpa=\"f0\",hpa=\"nY\",et=\"Saving...\",ipa=\"debug\",jpa=\"cpl\",kpa=\"pm\",ft=\"vs\",lpa=\"en-GB\",gt=\"es\",ht=\"fr\",it=\"hr\",mpa=\"lv\",jt=\"nl\",npa=\"pt-BR\",opa=\"pt-PT\",kt=\"ro\",lt=\"sk\",mt=\"vi\",nt=\"el\",ot=\"iw\",ppa=\"zh-TW\",qpa=\"zh-CN\",rpa=\"ko\",pt=\"+bold\",qt=\"+italic\",spa=\"13px\",tpa=\"18px\",upa=\"32px\",rt=\"+fontName\",st=\"+fontSize\",tt=\"+foreColor\",ut=\"+removeFormat\",vt='\"><b>',wt=\"</option>\",xt='<input type=\"checkbox\" id=\"',\n .....\n 17808  g.JA);c.set(VE,g.jz);c.set(ZHa,cIa(b,b.Uxa));c.set(WE,cIa(b,b.amb));b=[aIa];a=c.Sb();for(d=0;d<a[u];d++){f=a[d];if(g=c.J(f)){b[p](f);b[p](ei);b[p](Qf(g));b[p](Sf)}}b.pop();return b[kd](I)}function cIa(b,a){if(!a||a.Nb()==0)return i;b=[];for(var c=a.Sb(),d=0;d<c[u];d++){var f=c[d],g=a.J(f);b[p](f);b[p](xj);b[p](Qf(g));b[p](wj)}b.pop();return b[kd](I)}\n 17809  function dIa(b,a){var c=b.vgb();this.eDd=b.C0-(c?0:1);if(c){this.rh=0;this.PG=b.Mda-b.Esa}else{this.rh=b.jm()?1:2;c=b.NQa;this.PG=c-b.Esa;c=b.Gsa-c;var d=b.vNa();d=d==-1?0:d;if(d>c)d=c;this.jz=d;this.JA=c-this.jz}a=this.A2b=l.max(a-b.Esa,0);if(a>0){c=l.min(a,this.PG);this.PG-=c;a-=c;c=l.min(a,this.JA);this.JA-=c;a-=c;c=l.min(a,this.jz);this.jz-=c;a-=c;if(a>0)this.A2b-=a}this.xEd=this.PG+this.JA+this.jz;this.qHa=b.zcb().qHb}function eIa(){this.Xyb=[]}\n 17810: function fIa(b,a,c){this.Li=b;this.na=a;if(!c){c=new Sh(\"//www.google.com/images/cleardot.gif\");bi(c)}this.Bf=c}var gIa=\"onLine\";function hIa(b){b.J3a++;if(gIa in bp&&!bp[uma])Dh(G(b.tza,b,k),0);else{b.zr=new Image;cp(b.zr,G(b.zTa,b));oa(b.zr,G(b.XP,b));oma(b.zr,G(b.d2c,b));b.QI=Dh(b.e2c,b.Mba,b);b.zr.src=String(b.Bf)}}function iIa(b){if(b.zr){cp(b.zr,i);oa(b.zr,i);oma(b.zr,i);b.zr=i}if(b.QI){Eh(b.QI);b.QI=i}if(b.U0){Eh(b.U0);b.U0=i}}\n 17811: function jIa(){this.Fv=new fIa(this.Wpb,this);this.Kwc=l[kb](51E3)+l[kb](18E3*l[Tc]())}var XE=\"images/cleardot.gif\";function kIa(b,a){if((a?a:Zf())-b.zZb>b.Kwc){if(!b.Fv.Rwa()){a=new Sh(XE);bi(a);b.Fv.sYa(a);b.Fv[Rc]()}return h}return k}function YE(){this.zu=new fC;this.MAa=[];lIa(this,1E3);this.Loa=new Hf;this.pEa=[];this.Q=new kn}\n 17812  function mIa(b,a){var c={};c.Uba=G(b.Hod,b);c.bQ=G(b.OTa,b);c.WH=G(b.WH,b);c.UIc=G(b.qfb,b);c.cfb=G(b.cIc,b);c.osc=G(b.ZFb,b);c.QBd=G(b.qGc,b);c.RBd=G(b.rGc,b);c.Acd=G(b.uVa,b);c.uFb=G(b.D2a,b);a.oM(c);b.pEa[p](a)}function lIa(b,a,c){if(c)b.yya=a;else{if(a<1E3)a=1E3;else if(a>3E5)a=3E5;b.yya=l[kb](0.85*a)+l[kb](0.3*a*l[Tc]())}}function nIa(b){var a=b.zu.Nb();b.ld&&a++;return a}function oIa(b,a,c){b.Loa.set(a,c)}var ZE=\"ACTIVE\";\n 17813  function pIa(b){b.ld.uc();b.N8=0;b.QSa=-1;var a=b.ld,c=Zf();if(a.Esa==-1)a.Esa=c;a.NQa=c;a.C0++;try{b.EG(ZE);b.GAb()}catch(d){e(d)}}var qIa=\";4\";function rIa(b){try{b.ld.Gsa=Zf()}catch(a){rg(tg,qIa,a);b.Vka=a}}var sIa=\";5\";function tIa(b,a){try{b.ld.wWa=new bFa(new aFa(a))}catch(c){rg(tg,sIa,c);b.Vka=c}}function uIa(b,a){b.xOb=a}var vIa=\"RETRY_TIMER\";function wIa(b){if(b.qa==vIa){if(b.Lv){cA(b.Lv);b.Lv=0}pIa(b)}}function xIa(b){if(b.Mw){cA(b.Mw);b.Mw=i}}function yIa(b){b.NCc=h}var zIa=\"nrt\",AIa=\"rhma\";\n .....\n 18054  function e3a(b,a){var c,d;if(a){c=a.tI;d=a.JL}else{c=b.CSa++;d=f3a(b)}a=b.cMa.vc();a.ka(b3a,b.Lx);a.ka(c3a,c);a.ka(d3a,b.MQa);g3a(b,a);c=new kL(b,b.cd,b.Lx,c,b.K5+1);c.R1(b.rE);c[xc](l[kb](1E4)+l[kb](1E4*l[Tc]()));b.Bw=c;b=d;c.Xd=1;c.Qn=bi(a.vc());c.JL=b;c.A8a=h;d2a(c)}function g3a(b,a){if(b.na)(b=b.na.uQb(b))&&Ef(b,function(c,d){a.ka(d,c)})}var h3a=\"count=\",i3a=\"req\";\n 18055  function f3a(b){for(var a=l.min(b.fQ[u],1E3),c=[h3a+a],d=0;d<a;d++){var f=b.fQ[d];Ef(f,function(g,j){c[p](i3a+d+mg+j+ei+aa(g))});b.Hka[p](f)}b.fQ[jd](0,a);return c[kd](Sf)}function j3a(b){if(!b.FD)if(!b.fY){b.kHb=1;b.fY=nL(G(b.u6b,b),0);b.pHa=0}}var k3a=\"Test Connection Finished\",l3a=\"connectChannel_()\";function m3a(b,a,c){b.cd.Ef(k3a);b.cjc=b.Dsc&&c;b.Tw=a.hH();b.cd.Ef(l3a);b.XCc(1,0);b.cMa=n3a(b,b.Vf);a3a(b)}var o3a=\"Test Connection Failed\";function p3a(b,a){b.cd.Ef(o3a);b.Tw=a.hH();pL(b,2)}\n 18056: var q3a=\"Error code \";function pL(b,a){b.cd[dr](q3a+a);if(a==2||a==9){var c=i;if(b.na)c=b.na.MRb(b);var d=G(b.Xmd,b);c=c;if(!c){c=new Sh(\"http://www.google.com/url\");bi(c);gx(c,Ky,\"http://www.google.com/images/cleardot.gif\")}Q1a(c[t](),1E4,d)}else mL(2);b.J0(a)}var r3a=\"GetForwardChannelUri: \";function n3a(b,a){a=s3a(b,i,a);b.cd.Ef(r3a+a);return a}var t3a=\"GetBackChannelUri: \";function S2a(b,a,c){a=s3a(b,L?a:i,c);b.cd.Ef(t3a+a);return a}var u3a=\"VER\";\n 18057  function s3a(b,a,c,d){var f=ba[Ic],g=ci(f[er],i,a?a+He+f[Gma]:f[Gma],d||f.port,c);b.ssa&&Ef(b.ssa,function(j,n){g.ka(n,j)});g.ka(u3a,6);g3a(b,g);return g}function nL(b,a){if(!Ze(b))e(Error(\".166\"));return Je[xc](function(){b()},a)}function mL(b){qL[r](new V2a(qL,b))}function v3a(){}var w3a=\":25\";\n 18058  function x3a(b,a,c,d,f){this.Ze=b;this.lS=a;this.qKb=d||i;this.Xza=new fC;this.NAa=new fC;this.XHb=f||i;this.cd=i;this.vS=c;this.qa=-1;this.wk=0;this.ec=this.cea(this.vS);this.Mw=new aA(w3a,1E3);ih(this.Mw,yj,this.aNb,h,this);this.Mw[Rc]();this.yla=5E3+l[Tc]()*2E4}var y3a=\"Qa\";function z3a(b,a){if(b.qa!=a){var c=b.qa;b.qa=a;switch(b.qa){case 5:A3a(b);break;case 4:b.wk=0;b.usa=k;b.Hg(i);b.Ze[r](y3a);break}b.usa||b.Ze[r](new B3a(c,a,b.wk))}}function C3a(b){if(Ue(b.BSa)){cA(b.BSa);b.BSa=i}}\n .....\n 18544  F.Zua=function $MT(){this.hR&&this.cd.TW(fqb);this.cd[dr](gqb+this.BF);this.tJ();this.wk=2;mL(18);t2a(this)};F.tJ=function $NT(){this.czb();if(this.Tx){var a=this.Tx;this.Tx=i;nh(a,Lh,this.Bkc,k,this);a[wc]()}if(this.EM)this.EM=i};var hqb=\"hR\";F.rua=D(hqb);F.Kga=D(aOa);F.hH=D(\"Tw\");F.Kw=D(\"Lx\");F=N2a[w];F.rE=i;F.Lc=i;F.OVa=k;F.pbb=i;F.Mia=i;F.Vf=i;F.qa=i;F.Tw=-1;F.o7=i;F.r4a=i;F.R1=Ge(\"rE\");var iqb=\"MODE\";F.bs=function $TT(a){this.Vf=a;a=n3a(this.ec,this.Vf);mL(3);gx(a,iqb,dQ);this.Lc=new kL(this,this.cd,void 0,void 0,void 0);this.Lc.R1(this.rE);c2a(this.Lc,a,k,h);this.qa=0};var jqb=\"Test Connection Blocked\";F.Cwc=function $UT(a){if(a){this.qa=2;R2a(this)}else{mL(4);a=this.ec;a.cd.Ef(jqb);a.Tw=a.j4.hH();pL(a,9)}};La(F,function $VT(){if(this.Lc){this.Lc.tf();this.Lc=i}this.Tw=-1});F.G_=E(k);\n 18545  var kqb=\"TestConnection: Got data for stage 1\",lqb=\"TestConnection: Null responseText\",mqb=\"11111\";F.h6b=function $XT(a,c){this.Tw=a.hH();if(this.qa==0){this.cd.Ef(kqb);if(c){try{var d=ix(c)}catch(f){jL(this.cd,f);p3a(this.ec,this,4);return}this.o7=this.ec.dGb?d[0]:i;this.r4a=d[1]}else{this.cd.Ef(lqb);p3a(this.ec,this,4)}}else if(this.qa==2)if(this.OVa){mL(7);this.Mia=Zf()}else if(c==mqb){mL(6);this.OVa=h;this.pbb=Zf()}else{mL(8);this.pbb=this.Mia=Zf();this.OVa=k}};\n 18546: var nqb=\"TestConnection: request complete for initial check\",oqb=\"/mail/images/cleardot.gif\",pqb=\"TestConnection: request complete for stage 2\",qqb=\"Test connection succeeded; using streaming connection\",rqb=\"Test connection failed; not using streaming\",sqb=\"TestConnection: request failed, in state \";\n 18547  F.uL=function $YT(){this.Tw=this.Lc.hH();if(this.Lc.rua())if(this.qa==0){this.cd.Ef(nqb);if(this.r4a){this.qa=1;var a=s3a(this.ec,this.r4a,oqb);bi(a);P1a(a[t](),5E3,G(this.Cwc,this),3,2E3)}else{this.qa=2;R2a(this)}}else{if(this.qa==2){this.cd.Ef(pqb);a=k;if(a=L?this.Mia-this.pbb<200?k:h:this.OVa){this.cd.Ef(qqb);mL(12);m3a(this.ec,this,h)}else{this.cd.Ef(rqb);mL(11);m3a(this.ec,this,k)}}}else{this.cd.Ef(sqb+this.qa);if(this.qa==0)mL(9);else this.qa==2&&mL(10);p3a(this.ec,this,this.Lc.Kga())}};\n 18548  F.hH=D(\"Tw\");F.Eb=function $_T(){return this.ec.Eb()};F=T2a[w];F.rE=i;F.ssa=i;F.Bw=i;F.FD=i;F.Vf=i;F.cMa=i;F.lHb=i;F.o7=i;F.dGb=h;F.CSa=0;F.ELa=k;F.na=i;F.jK=i;F.fY=i;F.j4=i;F.cjc=i;F.Dsc=h;F.MQa=-1;F.Tw=-1;var qL=new uh;H(V2a,N);H(X2a,N);F=T2a[w];F.PQ=Ge(he);var tqb=\"connect()\",uqb=\"connectTest_()\";F.bs=function $1T(a,c,d,f,g){this.cd.Ef(tqb);mL(0);this.Vf=c;this.ssa=d||{};if(f&&Ke(g)){this.ssa.OSID=f;this.ssa.OAID=g}this.cd.Ef(uqb);this.j4=new N2a(this,this.cd);this.j4.R1(this.rE);this.j4.bs(a)};var vqb=\"disconnect()\",wqb=\"terminate\";\n .....\n 18791  F.Ba=function $0Ra(){AHc.C.Ba[z](this);this.H().wb();GG(this.B()).lw(this.b(rIc))};var xIc=\"Please specify who you wish to invite.\";F.Pla=function $1Ra(){var a=this.b(rIc);if(im(a[q]))this.fc[Wp](xIc);else{var c=new kHc(this.B(),a[q]);c.Ie(this);kF(this.Mb,c);c[Mb]();pa(a,I)}};var yIc=\"Oops, we weren't able to send your invite. Please try again later.\";F.wh=function $2Ra(a){if(a.eg){a=new Zz(rB(a));var c=PF(this);c=G(c.Il,c);a.qk=c;this.qV.Ad(a)}else this.fc[Wp](yIc)};\n 18792  F.mqb=function $3Ra(){var a=this.b(rIc)[q];this[r](new TF(this,Sz,0,a))};F.ql=function $4Ra(a){if(a[Sb]==13){a[zb]();GG(this.B()).vj()||this.Pla(a)}};function dKc(b){CY[z](this,b)}function eKc(b){b=kA(b.Bc.B(),bM);Zw(b,function(a){a.tb()});Yw(b,sg)}function fKc(b){b=kA(b.Bc.B(),erb);Zw(b,function(a){a.tb()});Yw(b,sg)}zx(dKc,CY);dKc[w].ZP=function $1Sa(){Nfa.J()&&Mx().oz(4,G(this.UH,this))};dKc[w].UH=function $2Sa(){eKc(this);fKc(this)};function XKc(b){this.Qzb=b}var YKc=\"GOTO_TASKS\",ZKc=\"Go to Tasks\",aLc=\"ADD_TO_TASKS\",bLc=\"Add conversation to Tasks\",cLc=\"Add to Tasks\";\n 18793: function dLc(b){this.Z=Rz(b);var a=Jz(this.Z,998),c=Jz(this.Z,375);a=a&&!c?VCc:undefined;Bx(this);PI[z](this,b,uLb,undefined,G(this.dUa,this,h,k,undefined),this.aa.BJa(UVa),a);OF.Gi(uQ,YKc,ZKc);hlb.bq[p](YKc);s5a=aLc;OF.Gi(bM,s5a,bLc);rQ.bq[p](s5a);SB(95,cLc,mbb,Urb,k,[Oy,cz,az,ez,Py,fz,Nd,ul,iz,pP,kz,ZK,Jy,pz,Yy,sz,aL,ce],3);this.Ma=yy(b);b=Aya(this.Ma);Zw(b,G(this.K8c,this))}function eLc(){}H(XKc,pY);Ax(XKc,pY,0);XKc[w].QRa=function $dTa(a,c){a=kA(a,UF);Zw(a,c)};XKc[w].PRa=E(k);XKc[w].BJa=Ee();H(dLc,PI);yx(pY,dLc);F=dLc[w];F.K8c=function $gTa(){this.Ma.db(L5a)&&this.aa.QRa(this[uq](),G(this.T9c,this))};var fLc=\"tasks_mole_loaded\",gLc=\"gtasks.TasksNavigationTab performAction MOLE_LOAD\";F.dUa=function $hTa(a,c){if(!this.aa.PRa()){this.C3a=new vLb(this[uq](),nbb,this,fLc,gLc);var d=kA(this[uq](),bv);Zw(d,function(f){f.YH(a,!!c)})}};F.T9c=function $iTa(){this.dUa(k,this.Ma.nf(N5a))};F.dXc=function $jTa(){this[r](fLc)};F.Qh=function $kTa(a){a==YKc&&this.dUa(h)};Ax(eLc,rJ,0);eLc[w].AYa=E(h);eLc[w].Pca=function $mTa(a,c){a.Pca(vr,new dLc(c))};Mx().Ug(11,function(b){(new ALc(b)).wc()});var BLc=\"1 Labs feature is enabled\",CLc=\" Labs features are enabled\",DLc='<img src=\"pimages/2/labs/labs_bar_icon.png\" width=\"11\" height=\"11\" alt=\"\" class=\"nG\"/>';function ELc(b,a){var c=a||new U,d=new U;b.TSa==1?d[R](BLc):d[R](b.TSa+CLc);kE({id:b.jRc,title:d[t](),Ab:DLc},c);if(!a)return c[t]()}function FLc(b){this.Rd=b;this.Z=Rz(b.B());this.Bnb=this.Z.TSa();this.ll=i;this.jb=JB(b.B())};zx(FLc,sY,80);var GLc=\"80:la\";FLc[w].HE=function $zTa(){return this.Bnb>0?new tY(ELc({jRc:this.Rd.X(GLc),TSa:this.Bnb}),80):[]};FLc[w].ma=function $ATa(){if(this.Bnb>0)this.ll=ih(this.Rd.b(GLc),P,this.He,k,this)};FLc[w].Ba=function $BTa(){this.ll&&oh(this.ll)};FLc[w].He=function $CTa(a){if(!a[dd]&&!a[Bc]&&!a[Eb]){QF(this.Rd,jP);this.jb[bq]({view:dJ,fk:Wfa});a[zb]()}};function HLc(b){this.O=b;if(this.O[1])this.Wc=new ILc(this.O[1])}function ILc(b){this.O=b}function JLc(b){oH[z](this,b,26)}function KLc(b){this.bi=b;this.Mb=jF(b.B())}HLc[w].Mo=D(jsa);Ha(HLc[w],function $ETa(){return this.O[t]()});HLc[w].kc=D(ae);ILc[w].Ga=function $GTa(){return this.O[0]};ILc[w].Nf=function $HTa(){return this.O[1]};Ha(ILc[w],function $ITa(){return this.O[t]()});ILc[w].kc=D(ae);_B_prog(97)}catch(e){_B_err(e)}\n 18794  \n 18795  try{H(JLc,oH);var LLc=\"lno\",MLc=\"Loading login notification.\";JLc[w].Ja=function $KTa(a){JLc.C.Ja[z](this,a);a.Ua(pd,LLc);a.Ne(mB);a.Se(MLc)};JLc[w].rk=function $LTa(a,c,d){if(c==LLc)this.Wc=(new HLc(d)).Mo()};zx(KLc,vY);F=KLc[w];F.Goa=function $MTa(){Mx().oz(4,G(this.UWa,this))};var NLc=\":48\";F.UWa=function $NTa(){bA(NLc,G(this.Ex,this),5E3)};F.Ex=function $OTa(){var a=new JLc(this.bi.B());a.Ie(this);kF(this.Mb,a);a[Mb]()};F.wh=function $PTa(a){if(a instanceof JLc)(a=a.Wc)&&Vw(O.S(),ksa,G(this.Jra,this,a),this,k,h,h)};F.Jra=function $QTa(a){var c=a.Ga();(this.Eya=OLc().H(c,this.bi.B()))&&this.Eya.DJc(a)};F.D=function $RTa(){if(this.Eya){this.Eya.D();this.Eya=i}};function PLc(b,a,c,d,f){a.w(b,c,d,f)}function QLc(b,a){var c=a||new U;c[R](UZa,b.yZa,Uf);RLc(b,c);c[R](gB);if(!a)return c[t]()}var SLc=\"0.4\",TLc=\"0.3\",ULc=\"0.2\";function RLc(b,a){var c=a||new U;c[R](WG,Rd,jE,ls,As,Rd,J,bDc,W);if(b.PTb)c[R](VCc);else if(b.B6a&&b.G3a)c[R](SLc);else b.B6a||b.G3a?c[R](TLc):c[R](ULc);c[R](gB);if(!a)return c[t]()}function VLc(b){this.Rd=b;this.Z=Rz(b.B());this.K7=Jz(this.Z,1044);this.Lb=Tz(b.B())}function WLc(b){(b=b.Rd.b(cDc))&&ph(b)}\n .....\n 18819  try{H(WUc,xx);WUc[w].tb=B();WUc[w].tb.Ka=h;H(YUc,xx);YUc[w].RJa=B();YUc[w].RJa.ic=h;H(ZUc,RH);yx(YUc,ZUc);F=ZUc[w];F.JJ=function $wZa(a,c,d){a=a;this.U_a(a,d);c=Ke(d.zz)?i1a(a,d[Pc],d.zz):d[Xp]||0;a=aVc(this,a,d[Pc],c,d[x]);a.qc(k);this.xU(a,d);return a};F.TJa=function $xZa(a,c){a=a;var d=c.td();d=d?new Wh(Rf(d)):c.Of();c={uri:c};a=aVc(this,a,aza(Sy,d),1,Hz);this.xU(a,c);return a};\n 18820  F.pga=function $yZa(a,c,d){a=a;this.U_a(a,d);a=Ke(d.zz)?i1a(a,d[Pc],d.zz):d[Xp]||0;var f=d[Pc],g=i;c=GH(c);for(var j=0;j<c[u]&&!g;j++)if(c[j]instanceof dL&&f.Qc(c[j].Bb())&&d[x]==c[j].D0a&&a==c[j].Ut()){g=c[j];d.gkb||g.uW();this.xU(g,d)}return g};F.xU=function $zZa(a,c){bha(c,a.Ut());a.lPa(c.tZa,c.Zo,c.Am,c.Lja);a.qma(c)};F.U_a=function $AZa(a,c){if(!c[x]){a=KC(a);var d=Xy(c[Pc]);a=NC(a,d);lma(c,a?a.wra:Hz)}};H(bVc,xi);yx(WUc,bVc);Xw(O.S(),IB).ym(bVc);bVc[w].tb=function $BZa(a){a=a;mA(a,TE,cVc);var c=Dx(Cx(a));new VUc(c);this.aa.tb(a)};var dVc=\"tBhihb\",eVc='\" style=\"width:16px; height:16px\" onerror=\"this.parentNode.removeChild(this);\">';function fVc(b,a){var c=a||new U;c[R](uI,dVc,Ps,b.Zuc,eVc);if(!a)return c[t]()}function gVc(b){this.Uk=b}function hVc(b){this.vcc=b}function iVc(b){this.ub=b}function jVc(b){if(b.G4a)b.G4a.Uk=b.ub.xa.Zsa();else b.G4a=new gVc(b.ub.xa.Zsa());return b.G4a}var kVc=\"-ot\";function lVc(b,a){dE(b.ub.B()).jj(a,jVc(b).NT()+kVc)}gVc[w].NT=function $CZa(){return this.Uk.nS[0]};gVc[w].Cwa=function $DZa(){return!!this.Uk.nS[1]};\n 18821: gVc[w].twa=function $EZa(){return!!this.Uk.nS[2]};zx(hVc,XYa);hVc[w].Jj=function $FZa(a,c){c=new gVc(c);if((CD()?k:!!c.Uk.nS&&c.NT()&&!c.Cwa()&&c.twa()&&!!!c.Uk.nS[3])&&c.Uk.nS[4]){a.Zuc=c.Uk.nS[4];a.ppa[p](fVc)}};zx(iVc,AK);iVc[w].opa=function $GZa(){if(jVc(this).Uk.nS&&jVc(this).NT())if(jVc(this).Cwa())lVc(this,ikb);else if(jVc(this).twa())jVc(this).Uk.nS[3]?lVc(this,jkb):lVc(this,gkb);else lVc(this,hkb)};function GVc(){this.yGb=[]}function HVc(b,a){b.yGb[p](a)}var IVc=\"earlydata\";function JVc(b){this.V=b;this.Aa=Dx(Cx(this.V));this.Q=new kn(this);(new py(IVc,this.Aa)).set(new GVc);this.Q.w(fy(b).eQ,Fx(JD),this.Zya)}function KVc(b){this.Bra=b}H(GVc,uh);H(JVc,Jf);JVc[w].Zya=function $2Za(a){a=a[dq];if(a[0]==JD){var c=this.Aa.cj(Nrb,h);c&&c.J()?HVc(c.J(),a):this.AQ()}};JVc[w].L=function $3Za(){this.AQ()};JVc[w].AQ=function $4Za(){if(this.Q){this.Q.hb(fy(this.V).eQ,Fx(JD),this.Zya);this.Q.D();this.Q=i}};zx(KVc,WUc);KVc[w].tb=function $5Za(a){this.vBd=new JVc(a)};function LVc(b){this.Bn=b}Ax(LVc,DJ);LVc[w].qqb=function $6Za(){if(Xw(O.S(),vw).hc()){var a=kZ;a&&a.nsb()}};function VXc(b,a,c,d){N[z](this,Psa,b);this.wVc=a;ok(this,c);this.Gnd=d}var WXc=\"oZ\";function XXc(){zJ[z](this,WXc,CK)}function YXc(b){this.uB=b}H(VXc,N);H(XXc,zJ);var ZXc=OUc(Qsa,\"images/2/openhand.cur\",aR,h)+Er;XXc[w].R3b=function $Y_a(a,c){wp(c[x],ZXc);return k};XXc[w].Wya=function $Z_a(a,c,d){var f=this[Oc][Oc].ao(),g=this[Oc].B(),j=d[Vp]();g.Ya()[r](new VXc(f,a,c,j));return XXc.C.Wya[z](this,a,c,d)};zx(YXc,oK);var aYc=[I,EN,IN,CL,DN],bYc=[8,3,9,10,16],cYc=new kK(XF,\"Ci\");F=YXc[w];F.Y_a=function $__a(a){UUc(a.SZa,cYc);TUc(a.TD,new XXc)};F.WKc=function $0_a(){return this.uB.ao()[uk].XG()==dK};F.wcb=function $1_a(){var a=this.uB.ao().Bb();return(a?Xy(a):I)||I};F.y0b=function $2_a(a){var c=this.uB.ao();if(!c[uk].Vo(a)){this.kTa=c[uk].E6();this.kTa.set(a,k);jYa(c[uk]);kYa(c[uk],a)}};F.x0b=function $3_a(){if(this.kTa){this.uB.ao()[uk].zm(this.kTa);delete this.kTa}};\n 18822  F.AVc=function $4_a(a){var c=this.wcb();if(!a||c==a)c=i;else{var d=76;if(KC(this.uB.B()).Rw(a))switch(a){case TI:d=8;break;case oI:if(ef(aYc,c))d=3;break;case AL:d=9;break;case BL:d=10;if(c==CL)d=16;break}else if(ef(aYc,c))d=12;c=d}if(c){a=ef(bYc,c)?i:a;this.uB.ao().nk(c,a)}};F.Krc=function $5_a(a,c){if(!this.uB.ao().aa.pQa()){this.y0b(this.uB.xa[Vp](iK(this.uB,c)).vf());this.uB.ao().nk(12,a);this.x0b()}};F.TQb=function $6_a(){return this.uB.b()[ic](Zn)};function EYc(b){this.Bn=b}var FYc=\"xF\",GYc=\"Additional messages could be available in regular online mode. You can leave Flaky Connection Mode and try your search again.\",HYc=\"Additional messages may be found when you are online.\";function IYc(b,a){var c=a||new U;c[R](SG,FYc,Kl,FYc,Kl,FYc,W);b.bDa?c[R](GYc):c[R](HYc);c[R](TG);if(!a)return c[t]()}function JYc(b,a){switch(a){case cz:case fz:case iz:case kz:case sz:case pz:case Yy:case Zy:case Py:return h}return k}TH[w].fQc=function $A0a(){return this.Zh(HN)};VUc[w].KOc=function $B0a(){Vo()&&cI(this,H7a)};zx(EYc,DJ);var KYc=\"Move to Drafts\";EYc[w].Oca=function $C0a(a){var c=HJ(KYc,101,void 0);a.set(101,c)};EYc[w].Fs=function $D0a(a){return a==101};EYc[w].KW=function $E0a(a){if(a.Ga()==nz){TB(this.Bn,101,h);TB(this.Bn,9,k)}else TB(this.Bn,101,k)};var LYc=\"b4\";VJ[w].a1b=function $F0a(){if(CD())for(var a=this.b()[cc],c=0;c<a[u];c++)if(a[c][Uc](fG)==String(64))m(a[c],LYc)};VJ[w].ZRa=function $_N(){var a=jA(this.B(),Od);a&&a.M2a(this.a1b,this)};VJ[w].d1b=function $0N(){var a=jA(this.B(),Od);a&&a.dub(this.a1b,this)};Lob[p](HN);KK.Wtd=\"ls_esm\";F=dL[w];var MYc=\"No messages waiting to be sent.\",NYc=\"There are no conversations with this label. You can leave Flaky Connection Mode to see all conversations.\",OYc=\"There are no conversations with this label. Additional conversations are only available online.\";\n 18823  F.p1b=function $0S(){var a=this.Ea.Ga();if(a==nz){a=new U;a[R](MYc);a=a[t]();return a}var c=this.Xi.J();if(c.I_()&&(c.fN()||c.DPa())){a=jA(this.B(),Od);a={bDa:a&&a.Gm()==AR};a=a;c=new U;a.bDa?c[R](GYc):c[R](HYc);a=c[t]();return a}if(c.I_()&&c.uua()&&JYc(this,a)){a=jA(this.B(),Od);a={yyc:a&&a.vk()};a=a;c=new U;a.yyc?c[R](NYc):c[R](OYc);a=c[t]();return a}return i};F.k1b=function $sS(a,c){this.IP=new eE(c);this.IP.qc(k);a[p](this.IP)};F.Z0b=function $dS(){Pw(this.H(),this.IP.b(),aB,this.V2c)};\n .....\n 20396  'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\"'+y+'\")';ja(e[G],\"51px\");u(e[G],\"15px\")}else e=qb(y,c,c,e);e=e;T(a,l);if(h){T(h,e);T(n,h)}else T(n,e);this.Ae=f;ib(d);T(d,this.Ae)};N(\"google.search.SearchForm\",m[H].L);m[H].L[E].Ge=function(a,d){this.Ke=R(this,this.Bg,[this]);this.Ob=R(a,d,[this]);this.Ae.onsubmit=this.Ke;oa(this.Nb,this.Ke)};O(m[H].L[E],\"setOnSubmitCallback\",m[H].L[E].Ge);m[H].L[E].Fe=function(a,d){oa(this.ec,R(a,d,[this]))};O(m[H].L[E],\"setOnClearCallback\",m[H].L[E].Fe);\n 20397  m[H].L[E].Bg=function(){var a=this.te.offsetWidth,d=this[w][xa];this.Ob&&this.Ob();if(fb()){var e=this,f;f=d[D]*8>=a?a-6:\"99%\";k[La](function(){ja(e[w][G],f)},1)}return g};qa(m[H].L[E],function(a){if(a)ka(this[w],a);this.Ob&&this.Ob()});O(m[H].L[E],\"execute\",m[H].L[E][L]);\n 20398: m[H].L[E].Kf=function(){var a=this[w],d=function(){if(a[xa]==\"\")a[G].background=\"#FFFFFF url(http://www.google.com/coop/intl/\"+m[H][K]+\"/images/google_custom_search_watermark.gif) left no-repeat\"};a.onblur=d;a.onfocus=function(){a[G].background=\"#FFFFFF\"};d()};m[H].cb=function(){this.xc=0;this.ie=g;this.sb=[]};m[H].cb[E].Jg=function(a){this.xc++;var d=this;return function(){for(var e=[],f=0;f<arguments[D];++f)e[ra](arguments[f]);if(d.ie)this.ge(a,e);else{d.sb[ra]([a,e]);d.xc--;d.xc==0&&d.he()}}};\n 20399  m[H].cb[E].he=function(){for(var a=0;a<this.sb[D];a++)this.ge(this.sb[a][0],this.sb[a][1]);this.sb=[];this.ie=b};m[H].cb[E].ge=function(a,d){k[La](function(){a[Va](c,d)},0)};m[H].cb[E].start=function(a){k[La](R(this,this.he,[]),a)};m[H].j=function(a,d){m[H].b[I](this);this.kb=b;this.S(m[H].a.la);this.jb(\"\",{iframes:b});this.hb=new m[H].g;if(a==o){a={crefUrl:\"http://www.google.com/coop/tools/autocse?referer=\"+k[Pa]};this.Kg=b}this.hb.qa(a);this.hb.Pb=P.cse;d&&d[m[H].a.Na]&&this.hb.R(m[H].a.Na,d[m[H].a.Na]);this.Oa(this.hb);this.yb(m[H].b.qd);this.Fg=(new Date)[Ga]()};N(\"google.search.CustomSearchControl\",m[H].j);$a(m[H].j,m[H].b);\n 20400  m[H].j[E].Ib=function(a,d){(d=d)||(d=new m[H].T);d.De(m[H].b.Ka);if(this.Kg&&this.d[D]==1)this.Cg=b;m[H].b[E].Ib[I](this,a,d);t(this.i,\"gsc-control-cse\")};O(m[H].j[E],\"draw\",m[H].j[E].Ib);\n .....\n 33624  \n 33625  \n 33626: var Base=new Class({initialize:function(){this.p=pipio;this.registerHandlers();if($defined(this.init)){var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i]);}this.init.run(args,this);}},registerHandlers:function(){if($defined(this.EventHandlers)){for(var i=0;i<this.EventHandlers.length;i++){var event=this.EventHandlers[i];try{this.registerHandler(event,this[event].bind(this));}catch(e){Logger().log(event);}}}},registerHandler:function(eventName,func){this.p.registerHandler(eventName,func);},fireEvent:function(){var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i]);}this.p.dispatchEvent.run(args,this.p);},call:function(app,name,params,callbackSuccess,callbackFail,form){this.p.call(app,name,params,callbackSuccess,callbackFail,form);},getPrivateUser:function(){return this.p.currentUser;},getCurrentLocation:function(){return this.p.currentLocation;},getLocation:function(username){return this.p.getLocation(username);},getLocations:function(){return this.p.locationsByUsername;},getProfile:function(username){return this.p.getProfile(username);},getSession:function(){return this.p.xmpp.clientName;},getGroups:function(){return this.p.groups;},getContacts:function(){return this.p.connsByUsername;},getContactRequests:function(){return this.p.requestsByUsername;},getContactsByGroup:function(group_id){return this.p.getContactsByGroup(group_id);},getContact:function(username){return this.p.getContact(username);},hasContact:function(username){return this.p.connsByUsername.has(username);},getRoom:function(username){return this.p.getRoom(username);},getRooms:function(){return this.p.roomsByUsername;},getGroup:function(group_id){return this.p.connections.getGroup(group_id);},getUser:function(username){if(username==this.p.currentUser.username){return this.p.currentUser;}else{return this.p.getUser(username);}},videoEnabled:function(){if(this.p.videoInUse){return false;}else{return this.p.videoEnabled;}},checkTimestamp:function(time){return this.p.checkTimestamp(time);},getAppById:function(appId){return this.p.getAppById(appId);},isLoggedIn:function(){return this.p.isLoggedIn();},getPageTitle:function(){return this.p.pageTitle;},getConnectionState:function(username){var state=0;if(this.p.connsByUsername.has(username)){state=1;}else{if(this.p.requestsByUsername.has(username)){state=2;}else{if(this.p.requestsOutByUsername.has(username)){state=3;}}}return state;}});var App=new Class({Extends:Base,initialize:function(app){this.parent();this.name=app.name;this.iconOptions=app.iconOptions;this.registerApis();this.displayName=app.displayName;this.appId=app.id;this.autoDock=app.autoDock||false;this.isStarted=false;this.isDocked=false;this.isExpanded=true;this.defaultMenu=undefined;this.defaultContent=undefined;this.menus=$H();this.contents=$H();this.navs=$H();},registerApis:function(){if($defined(this.requests)){this.requests.each(function(request){this.p.registerCall(this.name,request);},this);}},start:function(options){if(!this.isStarted){if($defined(this.parseOptions)&&$defined(options)){this.parseOptions(options);}this.createApp();this.onStart();this.isStarted=true;if(this.autoDock){this.dock();}}else{if(this.isStarted&&this.isDocked){this.switchDefault();}}if(!this.isLoggedIn()){this.dock();}this.switchDefault();},stop:function(){Logger().log(\"stopping app\"+this.appId);if(this.isStarted){this.destroyApp();this.onStop();this.isStarted=false;this.isDocked=false;this.isExpanded=true;}},getDockIcon:function(){var icon=new Icon20(this.iconOptions);var el=new Element(\"div\",{\"class\":\"app_button has_submenu\"}).adopt($(icon),$(this.alert));el.addEvent(\"click\",this.switchDefault.bind(this));return el;},dock:function(){DomUtility.hide(this.navSection);this.undockSep=new Element(\"div\",{\"class\":\"nav_seperator\"});this.undockNav=new Nav({displayName:\"Undock\",onClick:this.undock.bind(this),name:\"undock\"});this.undockSep.inject(this.navWrapper);$(this.undockNav).inject(this.navWrapper);this.dockButton=new Element(\"div\",{\"class\":\"app_button_wrapper\"}).adopt(this.getDockIcon(),this.navWrapper);this.dockButton.inject(\"dock\");this.isDocked=true;},undock:function(){if(!this.isLoggedIn()){this.switchDefault();return;}this.undockSep.destroy();$(this.undockNav).destroy();this.undockNav=null;this.navWrapper.inject(this.navSection);this.dockButton.destroy();DomUtility.show(this.navSection);this.isDocked=false;this.switchDefault();},switchDefault:function(){if($defined(this.defaultContent)){this.fireEvent(\"viewSwitch\",this.appId,this.defaultContent,this.defaultMenu);}},menuAdd:function(menuName,menu){this.fireEvent(\"menuAdd\",this.appId,menuName,menu);if(menu.isDefault){this.defaultMenu=menuName;}this.menus.set(menuName,menu);},menuClose:function(menuName){this.fireEvent(\"menuClose\",this.appId,menuName);this.menus.erase(menuName);},contentAdd:function(contentName,content){this.fireEvent(\"contentAdd\",this.appId,contentName,content);if(content.isDefault){this.defaultContent=contentName;}this.contents.set(contentName,content);},contentClose:function(contentName){this.fireEvent(\"contentClose\",this.appId,contentName);this.contents.erase(contentName);},navAdd:function(nav){var navId=this.appId+\"_\"+nav.name;nav.navId=navId;if($defined(nav.parentName)){nav.parentId=this.appId+\"_\"+nav.parentName;}if(this.navs.has(navId)){Logger().log(navId+\" nav exist, did not add\");return;}if($defined(nav.parentId)){if(!this.navs.has(nav.parentId)){Logger().log(nav.parentId+\" parent does not exist\");return;}var parent=this.navs.get(nav.parentId);if(!parent.hasSubnavs){Logger().log(nav.parentId+\" parent does not allow subnavs\");return;}else{parent.addSubnav(nav);}}else{nav.parentId=this.appId;if(nav.bottom){$(nav).inject(this.bottomNav);}else{$(nav).inject(this.nav);}}this.navs.set(navId,nav);},navDelete:function(navName){var navId=this.appId+\"_\"+navName;if(!this.navs.has(navId)){return;}this.navs.get(navId).destroy();this.navs.erase(navId);},createAppAlert:function(){this.alert=new Alert();this.registerHandler(\"alertAdd\",this.alertAdd.bind(this));this.registerHandler(\"alertClear\",this.alertClear.bind(this));},alertAdd:function(navId){if(navId!=this.appId){return;}this.alert.increment();},alertClear:function(navId,count){if(navId!=this.appId){return;}if(!$defined(count)){var alerts=this.alert.clear();}else{this.alert.decrement(count);}},createApp:function(){this.navSection=new Element(\"div\",{\"class\":\"nav_section\"});this.navHeader=new Element(\"div\",{\"class\":\"nav_header clip2\"}).inject(this.navSection);this.navWrapper=new Element(\"div\",{\"class\":\"app_sub_menu sub_elements\"}).inject(this.navSection);this.nav=new Element(\"div\").inject(this.navWrapper);this.bottomNav=new Element(\"div\").inject(this.navWrapper);this.navSection.inject(\"nav\");this.icon=new Icon20(this.iconOptions);$(this.icon).inject(this.navHeader);this.headerName=new Element(\"div\",{\"class\":\"header_name text12 light\",\"text\":TextUtility.unescapeQuotes(this.displayName)}).inject(this.navHeader);this.closeButton=new Element(\"div\",{\"class\":\"button_nav right\"}).adopt(new Element(\"div\",{\"class\":\"action close\"})).inject(this.navHeader);this.closeButton.addEvent(\"click\",this.stop.bind(this));this.dockButton=new Element(\"div\",{\"class\":\"button_nav right\"}).adopt(new Element(\"div\",{\"class\":\"action dock\"})).inject(this.navHeader);this.dockButton.addEvent(\"click\",this.dock.bind(this));this.createAppAlert();if($defined(this.onCreate)){this.onCreate();}},destroyApp:function(){this.contents.each(function(content,contentName){this.contentClose(contentName);},this);this.contents.empty();this.menus.each(function(menu,menuName){this.menuClose(menuName);},this);this.menus.empty();this.navs.each(function(nav){nav.destroy();});this.navs.empty();this.navHeader.destroy();this.nav.destroy();this.navSection.destroy();if($defined(this.dockButton)){this.dockButton.destroy();}this.fireEvent(\"appClose\",this.appId);if($defined(this.onDestroy)){this.onDestroy();}}});var AppInstance=new Class({Extends:Base,Implements:App,initialize:function(app,options){this.parent();this.appId=options.appId;this.parseOptions(options);this.name=app.name;this.registerApis();this.isStarted=false;this.isDocked=false;this.isExpanded=true;this.autoDock=app.autoDock||false;this.defaultMenu=undefined;this.defaultContent=undefined;this.menus=$H();this.contents=$H();this.navs=$H();},start:function(appId){this.appId=appId;if(!this.isStarted){this.appId=appId;this.createApp();this.onStart();this.isStarted=true;if(this.autoDock){this.dock();}}else{if(this.isStarted&&this.isDocked){this.switchDefault();}}if(!this.isLoggedIn()){this.dock();}this.switchDefault();}});var Content=new Class({Extends:Base,init:function(options){if(!$defined(options)){options={};}if($defined(this.onBeforeInit)){this.onBeforeInit(options);}this.className=$defined(options.className)?options.className:\"\";this.isDefault=options.isDefault||false;this.isOn=true;this.firstShow=true;this.bottomFuncCalled=false;this.atBottom=false;this.createContent();if($defined(this.onInit)){this.onInit();}},checkScroll:function(){var maxY=this.contentWrapper.getScrollSize().y;var bottomY=this.contentWrapper.getScroll().y+this.contentWrapper.getSize().y+300;Logger().log(\"checking scroll \"+bottomY+\"-\"+maxY);if(bottomY>maxY&&!this.bottomFuncCalled&&!this.atBottom){this.bottomFuncCalled=true;this.bottomFunc();}},destroy:function(){if($defined(this.onDestroy)){this.onDestroy();}this.contentWrapper.destroy();},on:function(){this.isOn=true;DomUtility.show(this.contentWrapper);if($defined(this.scrollY)){this.scroll.set(0,this.scrollY);}if($defined(this.onShow)){if(this.firstShow){this.onShow(true);this.firstShow=false;}else{this.onShow(false);}}},off:function(){this.isOn=false;if($defined(this.onHide)){this.onHide();}if($defined(this.contentWrapper)){this.scrollY=this.contentWrapper.getScroll().y;}DomUtility.hide(this.contentWrapper);},createContent:function(){this.contentWrapper=new Element(\"div\",{\"class\":\"content_wrapper\"});this.content=new Element(\"div\",{\"class\":\"content \"+this.className}).inject(this.contentWrapper);if($defined(this.bottomFunc)){this.contentWrapper.addEvent(\"mousewheel\",this.checkScroll.bind(this));}this.scroll=new Fx.Scroll(this.contentWrapper);},toElement:function(){return this.contentWrapper;}});var Album=new Class({initialize:function(options){this.className=options.className||\"\";this.id=options.id||\"\";this.displayName=options.displayName||\"Album\";this.albumPhotos=new $H();},addPhoto:function(id,thumb,src,caption){var photo=new Object();photo.id=id;photo.caption=caption;photo.thumb=thumb;photo.src=src;this.albumPhotos.set(id,photo);},getPhoto:function(id){return this.albumPhotos.get(id);},getAllPhotos:function(){return this.albumPhotos.getValues();},getSize:function(){return this.albumPhotos.getLength();},getNextPrevPhoto:function(id){var allIds=this.albumPhotos.getKeys();var index=allIds.indexOf(id);var photos=this.albumPhotos.getValues();var i=index;if(allIds.length<=index+1){i=-1;}var next=photos[i+1];i=index;if(index==0){i=allIds.length;}var prev=photos[i-1];return{prev:prev,next:next};},getIndex:function(id){var allIds=this.albumPhotos.getKeys();return allIds.indexOf(id);},nextPhoto:function(id){var allIds=this.albumPhotos.getKeys();var index=allIds.indexOf(id);var photos=this.albumPhotos.getValues();if(allIds.length<=index+1){index=-1;}return photos[index+1];},prevPhoto:function(id){var allIds=this.albumPhotos.getKeys();var index=allIds.indexOf(id);var photos=this.albumPhotos.getValues();if(index==0){index=allIds.length;}return photos[index-1];}});var Alert=new Class({initialize:function(){this.alerts=0;this.createAlert();},createAlert:function(){this.alert=new Element(\"div\",{\"class\":\"alert\",\"text\":\"0\",\"style\":\"display: none !important\"});},hasAlerts:function(){return this.alerts>0;},update:function(){if(this.alerts<0){this.alerts=0;}this.alert.set(\"text\",this.alerts);if(this.alerts==0){this.alert.setStyle(\"display\",\"none !important\");}else{this.alert.setStyle(\"display\",\"\");}},increment:function(x){if(!$defined(x)){this.alerts++;}else{this.alerts+=x;}this.update();},decrement:function(x){if(!$defined(x)){this.alerts--;}else{this.alerts-=x;}this.update();},clear:function(){var alerts=this.alerts;this.alerts=0;this.update();return alerts;},toElement:function(){return this.alert;},destroy:function(){this.alert.destroy();}});var ButtonMedium=new Class({initialize:function(options){this.displayName=options.displayName;this.className=options.className||\"\";this.action=options.action||undefined;this.disabled=options.disabled||false;this.createButton();},createButton:function(){this.button=new Element(\"div\",{\"class\":\"button_medium\"});this.button.addClass(this.className);if($defined(this.action)){this.button.addClass(\"has_action\");new Element(\"div\",{\"class\":\"action \"+this.action}).inject(this.button);}this.button.appendText(TextUtility.unescapeQuotes(this.displayName));},showProgress:function(){this.button.addClass(\"progress\");},hideProgress:function(){this.button.removeClass(\"progress\");},toElement:function(){return this.button;}});var ButtonSmall=new Class({initialize:function(options){this.displayName=options.displayName;this.className=options.className||\"\";this.action=options.action||undefined;this.disabled=options.disabled||false;this.createButton();},createButton:function(){this.button=new Element(\"div\",{\"class\":\"button_small\"});this.button.addClass(this.className);if($defined(this.action)){this.button.addClass(\"has_action\");new Element(\"div\",{\"class\":\"action \"+this.action}).inject(this.button);}this.button.appendText(TextUtility.unescapeQuotes(this.displayName));},showProgress:function(){this.button.addClass(\"progress\");},hideProgress:function(){this.button.removeClass(\"progress\");},toElement:function(){return this.button;}});var Icon=new Class({initialize:function(options){this.iconAction=options.iconAction||null;this.isUser=$defined(options.user);if(this.isUser){this.user=options.user;}else{this.iconName=options.iconName;if(this.iconName.contains(\"http://\")){this.isClass=false;}else{this.isClass=true;}}this.createIcon();},createIcon:function(){this.icon=new Element(\"div\",{\"class\":\"icon_wrapper\"});if(!this.isUser){if(this.isClass){this.icon.addClass(\"hasicon on \"+this.iconName);this.icon.adopt(new Element(\"div\",{\"class\":\"icon\"}));}else{this.icon.adopt(new Element(\"img\",{\"src\":this.iconName,\"style\":\"height: 16px; width: 16px;\"}));}}else{this.icon.addClass(\"profile_pic_wrapper_16\");this.icon.adopt(new Element(\"img\",{\"class\":\"profile_pic profile_pic_16_\"+this.user.username,\"src\":this.user[\"profile_pic_16\"]}),new Element(\"div\",{\"class\":\"online_status online_status_\"+this.user.username}));}if($defined(this.iconAction)){this.addAction(this.iconAction);}},toElement:function(){return this.icon;},addAction:function(action){this.iconAction=action;if($defined(this.action)){this.action.destroy();}this.action=new Element(\"div\",{\"class\":\"icon_action \"+this.iconAction}).inject(this.icon);}});var Icon20=new Class({initialize:function(options){this.iconAction=options.iconAction||null;this.isUser=$defined(options.user);if(this.isUser){this.user=options.user;}else{this.iconName=options.iconName;if(this.iconName.contains(\"http://\")){this.isClass=false;}else{this.isClass=true;}}this.createIcon();},createIcon:function(){this.icon=new Element(\"div\",{\"class\":\"icon_wrapper\"});if(!this.isUser){if(this.isClass){this.icon.addClass(\"hasicon on \"+this.iconName);this.icon.adopt(new Element(\"div\",{\"class\":\"icon20\"}));}else{this.icon.adopt(new Element(\"img\",{\"src\":this.iconName,\"style\":\"height: 20px; width: 20px;\"}));}}else{this.icon.addClass(\"profile_pic_wrapper_16a\");this.icon.adopt(new Element(\"img\",{\"class\":\"profile_pic profile_pic_16_\"+this.user.username,\"src\":this.user[\"profile_pic_16\"]}),new Element(\"div\",{\"class\":\"online_status online_status_\"+this.user.username}));}if($defined(this.iconAction)){this.addAction(this.iconAction);}},toElement:function(){return this.icon;},addAction:function(action){this.iconAction=action;if($defined(this.action)){this.action.destroy();}this.action=new Element(\"div\",{\"class\":\"icon_action \"+this.iconAction}).inject(this.icon);}});var InlineImage=new Class({initialize:function(attachment){this.attachment=attachment;this.imageWrapper=new Element(\"div\",{\"class\":\"thumbnail\"});this.progress=new Element(\"div\",{\"class\":\"progress\"}).inject(this.imageWrapper);this.image=new Asset.image(this.attachment.url,{title:this.attachment.filename,onload:this.photoLoaded.bind(this)});},photoLoaded:function(){this.progress.destroy();var imageW=this.image.width;var imageH=this.image.height;if(imageH>100){imageW=(100/imageH)*imageW;imageH=100;}this.image.setStyles({height:imageH+\"px\",width:imageW+\"px\"});this.imageWrapper.setStyle(\"width\",imageW+\"px\");this.image.inject(this.imageWrapper);this.image.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showPhotoPopup\",this.attachment]));},toElement:function(){return this.imageWrapper;}});var ItemLoader=new Class({initialize:function(options){this.items=$H();this.sortValues=$H();this.empty=true;this.highestId=0;this.lowestId=0;this.highestSortValue=0;this.lowestSortValue=0;this.idField=options.idField;this.sortField=options.sortField;this.sortAlpha=options.sortAlpha||false;this.sortAscending=$defined(options.sortAscending)?options.sortAscending:true;this.createElementFunc=options.createElementFunc;this.emptyEl=options.emptyEl||null;this.errorEl=options.errorEl||null;this.loadingEl=options.loadingEl||null;this.createLoader();},remove:function(id){if(!this.items.has(id)){return;}DomUtility.fadeOutDestroy(this.items.get(id));var sortKey=this.sortValues.keyOf(id);this.sortValues.erase(sortKey);this.items.erase(id);if(this.items.getLength()==0){this.empty=true;this.highestId=0;this.lowestId=0;this.highestSortValue=0;this.lowestSortValue=0;this.showEmpty();}},showEmpty:function(){if(!$defined(this.emptyEl)){return;}if(this.empty){DomUtility.show(this.emptyEl);}else{DomUtility.hide(this.emptyEl);}},showError:function(){if(!$defined(this.errorEl)){return;}if($defined(this.emptyEl)){DomUtility.hide(this.emptyEl);}if($defined(this.loadingEl)){DomUtility.hide(this.loadingEl);}DomUtility.show(this.errorEl);},hideError:function(){if($defined(this.errorEl)){DomUtility.hide(this.errorEl);}if(this.empty){this.showEmpty();}},showLoading:function(){if(!$defined(this.loadingEl)||!this.empty){return;}if($defined(this.emptyEl)){DomUtility.hide(this.emptyEl);}if($defined(this.errorEl)){DomUtility.hide(this.errorEl);}DomUtility.show(this.loadingEl);},hideLoading:function(){if($defined(this.loadingEl)){DomUtility.hide(this.loadingEl);}if(this.empty){this.showEmpty();}},process:function(data){var id=data[this.idField];var sortValue=data[this.sortField];if(this.items.has(id)){Logger().log(\"item \"+id+\" exists, do not insert\");return;}var position=this.checkBoundary(sortValue,id);if(!position){position=this.findPosition(data);}if(typeof position==\"object\"){this.insertItem(data,\"before\",position);}else{this.insertItem(data,position);}},findPosition:function(data){var id=data[this.idField];var sortValue=data[this.sortField];if(this.empty){this.highestId=id;this.lowestId=id;this.highestSortValue=sortValue;this.lowestSortValue=sortValue;this.empty=false;return\"top\";}else{var sortValues=this.getSortValues();for(var i=0;i<sortValues.length;i++){if(this.sortAlpha){if(this.sortAscending){if(sortValue.toString()<sortValues[i].toString()){return this.items[this.sortValues[sortValues[i]]];}}else{if(sortValue.toString()>sortValues[i].toString()){return this.items[this.sortValues[sortValues[i]]];}}}else{if(this.sortAscending){if(parseInt(sortValue)<parseInt(sortValues[i])){return this.items[this.sortValues[sortValues[i]]];}}else{if(parseInt(sortValue)>parseInt(sortValues[i])){return this.items[this.sortValues[sortValues[i]]];}}}}}},getSortValues:function(){if(this.sortAlpha){if(this.sortAscending){return this.sortValues.getKeys().sort();}else{return this.sortValues.getKeys().sort().reverse();}}else{if(this.sortAscending){return this.sortValues.getKeys().sort(this.sortIntAsc);}else{return this.sortValues.getKeys().sort(this.sortIntDesc);}}},sortIntAsc:function(a,b){return a-b;},sortIntDesc:function(a,b){return b-a;},checkBoundary:function(sortValue,id){if(this.sortAlpha){if(this.empty){this.highestId=id;this.lowestId=id;this.highestSortValue=sortValue.toString();this.lowestSortValue=sortValue.toString();this.empty=false;return\"top\";}if(sortValue.toString()>this.highestSortValue.toString()){this.highestSortValue=sortValue.toString();this.highestId=id;return(this.sortAscending)?\"bottom\":\"top\";}else{if(sortValue.toString()<this.lowestSortValue.toString()){this.lowestSortValue=sortValue.toString();this.lowestId=id;return(this.sortAscending)?\"top\":\"bottom\";}else{return false;}}}else{if(this.empty){this.highestId=id;this.lowestId=id;this.highestSortValue=sortValue.toString();this.lowestSortValue=sortValue.toString();this.empty=false;return\"top\";}if(parseInt(sortValue)>parseInt(this.highestSortValue)){this.highestSortValue=parseInt(sortValue);this.highestId=id;return(this.sortAscending)?\"bottom\":\"top\";}else{if(parseInt(sortValue)<parseInt(this.lowestSortValue)){this.lowestSortValue=parseInt(sortValue);this.lowestId=id;return(this.sortAscending)?\"top\":\"bottom\";}else{return false;}}}},insertItem:function(data,position,beforeEl){var el=this.createElementFunc(data);var sortValue=data[this.sortField];var id=data[this.idField];this.items.set(id,el);this.sortValues.set(sortValue,id);if(position==\"top\"){el.inject(this.loader,\"top\");}else{if(position==\"before\"){el.inject(beforeEl,\"before\");}else{el.inject(this.loader,\"bottom\");}}this.empty=false;this.showEmpty();this.hideLoading();this.hideError();},createLoader:function(){this.loader=new Element(\"div\",{});if($defined(this.emptyEl)){this.emptyEl.inject(this.loader);}if($defined(this.errorEl)){this.errorEl.inject(this.loader);DomUtility.hide(this.errorEl);}if($defined(this.loadingEl)){this.loadingEl.inject(this.loader);DomUtility.hide(this.loadingEl);}},count:function(){return this.items.getLength();},toElement:function(){return this.loader;}});function MarkerLight(latlng,opts){this.latlng=latlng;var size=26;var smallSize=20;if(!opts){opts={};}this.user_=opts.user;this.size_=opts.size||size;this.height_=opts.size||size;this.width_=opts.size||size;this.image_=UserUtility.getProfilePic(this.user_.user_hash,this.user_.user_id,this.size_);this.imageOver_=opts.imageOver;this.clicked_=0;this.divClass_=\"profile_pic_wrapper_\"+this.size_;this.imgClass_=\"profile_pic profile_pic_\"+this.size_+\"_\"+opts.user.username;this.divStyleClass_=\"online_status online_status_\"+opts.user.username;}MarkerLight.prototype=new GOverlay();MarkerLight.prototype.initialize=function(map){var me=this;var div=document.createElement(\"div\");div.className=me.divClass_;div.style.position=\"absolute\";div.style.paddingLeft=\"0px\";div.style.cursor=\"pointer\";div.style.zIndex=1;var tip=new Element(\"div\",{\"class\":\"tooltip above_right\",\"text\":TextUtility.unescape(me.user_.fullname)}).adopt(new Element(\"div\",{\"class\":\"tip_corner\"}));tip.inject(div);var img=document.createElement(\"img\");img.src=me.image_;img.className=me.imgClass_;img.style.width=me.width_+\"px\";img.style.height=me.height_+\"px\";div.appendChild(img);var styleDiv=document.createElement(\"div\");styleDiv.className=me.divStyleClass_;div.appendChild(styleDiv);GEvent.addDomListener(div,\"click\",function(event){me.clicked_=1;GEvent.trigger(me,\"click\");pipio.dispatchEvent(\"showUser\",me.user_);});map.getPane(G_MAP_MARKER_PANE).appendChild(div);this.map_=map;this.div_=div;};MarkerLight.prototype.remove=function(){if($defined(this.div_.parentNode)){this.div_.parentNode.removeChild(this.div_);}};MarkerLight.prototype.copy=function(){var opts={};opts.color=this.color_;opts.height=this.height_;opts.width=this.width_;opts.image=this.image_;opts.imageOver=this.image_;return new MarkerLight(this.latlng,opts);};MarkerLight.prototype.redraw=function(force){if(!force){return;}var divPixel=this.map_.fromLatLngToDivPixel(this.latlng);this.div_.style.width=this.width_+\"px\";this.div_.style.left=(divPixel.x-Math.round(this.width_/2))+\"px\";this.div_.style.width=this.height_+\"px\";this.div_.style.top=(divPixel.y)-this.height_+\"px\";};MarkerLight.prototype.getZIndex=function(m){return GOverlay.getZIndex(marker.getPoint().lat())-m.clicked*10000;};MarkerLight.prototype.getPoint=function(){return this.latlng;};MarkerLight.prototype.setStyle=function(style){for(s in style){this.div_.style[s]=style[s];}};MarkerLight.prototype.setImage=function(image){this.div_.style.background='url(\"'+image+'\")';};var Menu=new Class({Extends:Base,init:function(options){if($defined(this.onBeforeInit)){options=this.onBeforeInit(options);}this.displayName=options.displayName;this.className=$defined(options.className)?options.className:\"\";this.isDefault=options.isDefault||false;this.closeFunc=$defined(options.closeFunc)?options.closeFunc:null;this.firstShow=true;this.isOn=true;this.createMenu();if($defined(this.onInit)){this.onInit();}},on:function(){DomUtility.show(this.menu);if($defined(this.onShow)){if(this.firstShow){this.onShow(true);this.firstShow=false;}else{this.onShow(false);}}this.isOn=true;},off:function(){if($defined(this.onHide)){this.onHide();}DomUtility.hide(this.menu);this.isOn=false;},destroy:function(){if($defined(this.onDestroy)){this.onDestroy();}this.menu.destroy();},addSection:function(section){section.inject(this.menu);},createMenu:function(){this.title=new Element(\"div\",{\"class\":\"menu_text\",\"text\":TextUtility.unescapeQuotes(this.displayName)});this.menu=new Element(\"div\",{\"class\":\"menu \"+this.className}).adopt(new Element(\"div\",{\"class\":\"menu_title text12 light\"}).adopt(this.title));if($defined(this.closeFunc)){this.menu.addClass(\"closable\");this.closeButton=new Element(\"div\",{\"class\":\"button_nav right\"}).adopt(new Element(\"div\",{\"class\":\"action close\"})).inject(this.title,\"after\");$(this.closeButton).addEvent(\"click\",this.closeFunc);}},toElement:function(){return this.menu;}});var Nav=new Class({Extends:Base,EventHandlers:[\"contentSwitched\",\"alertAdd\",\"alertClear\"],init:function(options){if($defined(this.onBeforeInit)){options=this.onBeforeInit(options);}this.name=options.name;this.iconOptions=$defined(options.iconOptions)?options.iconOptions:null;this.displayName=options.displayName;this.className=$defined(options.className)?options.className:\"\";this.parentName=options.parentName||undefined;if($defined(this.parentName)){this.className+=\" sub1\";}this.bottom=$defined(options.bottom)?options.bottom:false;this.hasSubnavs=$defined(options.hasSubnavs)?options.hasSubnavs:false;this.closable=$defined(options.closable)?options.closable:false;this.onClose=$defined(options.onClose)?options.onClose:undefined;this.defaultClosed=$defined(options.defaultClosed)?options.defaultClosed:false;this.onClick=$defined(options.onClick)?options.onClick:undefined;this.isExpanded=true;this.isOn=false;this.subnavEls=$H();this.createNav();if($defined(this.onInit)){this.onInit();}},alertAdd:function(navId){if(!$defined(this.navId)||!$defined(this.alert)){return;}if(navId!=this.navId){return;}if(this.isOn){return;}this.alert.increment();if($defined(this.parentId)){this.fireEvent(\"alertAdd\",this.parentId);}},alertClear:function(navId,count){if(!$defined(this.navId)||!$defined(this.alert)){return;}if(navId!=this.navId){return;}if(!$defined(count)){var alerts=this.alert.clear();if($defined(this.parentId)){this.fireEvent(\"alertClear\",this.parentId,alerts);}}else{this.alert.decrement(count);if($defined(this.parentId)){this.fireEvent(\"alertClear\",this.parentId,count);}}},contentSwitched:function(navId){if(!$defined(this.navId)){return;}if(navId==this.navId){this.on();this.alertClear(this.navId);}else{if(navId!=this.navId&&this.isOn){this.off();}}},on:function(){this.nav.addClass(\"on\");this.isOn=true;},off:function(){this.nav.removeClass(\"on\");this.isOn=false;},click:function(){if($defined(this.onClick)){this.onClick();}},close:function(e){e.stopPropagation();if($defined(this.onClose)){this.onClose();}this.destroy();},toggleSubnav:function(e){e.stopPropagation();if(!this.isExpanded){this.expand();}else{this.collapse();}},expand:function(){if(!this.isExpanded&&this.hasSubnavs){DomUtility.expand(this.subnavs);this.pivot.removeClass(\"pivot_right\");this.pivot.addClass(\"pivot_down\");this.nav.removeClass(\"collapsed\");this.isExpanded=true;if($defined(this.onExpand)){this.onExpand();}}},collapse:function(){if(this.isExpanded&&this.hasSubnavs){DomUtility.collapse(this.subnavs);this.pivot.removeClass(\"pivot_down\");this.pivot.addClass(\"pivot_right\");this.nav.addClass(\"collapsed\");this.isExpanded=false;if($defined(this.onCollapse)){this.onCollapse();}}},toElement:function(){return this.navWrapper;},addSubnav:function(nav){if(nav.bottom){$(nav).inject(this.subnavBottomItems);}else{$(nav).inject(this.subnavItems);}this.subnavEls.set(nav.name,nav);},deleteSubnav:function(name){if(!this.subnavEls.has(name)){return;}this.subnavEls.get(name).destroy();this.subnavEls.erase(name);},hasSubnav:function(name){return this.subnavEls.has(name);},createNav:function(){this.navWrapper=new Element(\"div\");this.nav=new Element(\"div\",{\"class\":\"nav\"}).inject(this.navWrapper);this.nav.addEvent(\"click\",this.click.bind(this));if(this.hasSubnavs){this.subnavItems=new Element(\"div\");this.subnavBottomItems=new Element(\"div\");this.subnavs=new Element(\"div\",{\"class\":\"sub_elements\"}).adopt(this.subnavItems,this.subnavBottomItems).inject(this.navWrapper);this.nav.addClass(\"has_submenu\");}this.nav.addClass(this.className);this.pivot=new Element(\"div\",{\"class\":\"action pivot_down\"}).inject(this.nav);this.pivot.addEvent(\"click\",this.toggleSubnav.bindWithEvent(this));if($defined(this.iconOptions)){this.icon=new Icon(this.iconOptions);$(this.icon).inject(this.nav);}else{this.nav.addClass(\"noicon\");}this.alert=new Alert();$(this.alert).inject(this.nav);this.navName=new Element(\"div\",{\"class\":\"nav_name text12 light\",\"text\":TextUtility.unescapeQuotes(this.displayName)}).inject(this.nav);if(this.closable){this.closeButton=new Element(\"div\",{\"class\":\"action close\"}).inject(this.nav);this.closeButton.addEvent(\"click\",this.close.bindWithEvent(this));}if(this.defaultClosed){this.collapse();}},destroy:function(){if($defined(this.navWrapper)){this.navWrapper.destroy();}if($defined(this.alert)){this.alert.destroy();this.alert=null;}}});var ScrollBar=new Class({initialize:function(content,wrapper){this.content=$(content);this.wrapper=$(wrapper);this.disabled=false;this.createScrollbar();this.setupHandlers();},disable:function(){this.disabled=true;},enable:function(){this.disabled=false;},createScrollbar:function(){this.scrollbar=new Element(\"div\",{\"class\":\"scrollbar\"});this.scrollbar.inject(this.wrapper);},dragOn:function(){this.wrapper.addClass(\"on\");},dragOff:function(){this.wrapper.removeClass(\"on\");},setupHandlers:function(){this.scrollHandleDrag=new Drag(this.scrollbar,{snap:0,limit:{\"x\":[0,0],\"y\":[0,this.getHandleYMax.bind(this)]},onStart:this.dragOn.bind(this),onDrag:this.handleDragHandler.bind(this),onComplete:this.dragOff.bind(this),onCancel:this.dragOff.bind(this)});this.contentScroller=new Fx.Scroll(this.content,{wheelStops:false});this.content.addEvent(\"mousewheel\",this.scrollHandler.bindWithEvent(this));this.update.periodical(500,this,true);},update:function(){if(this.disabled){return;}var scrollH=this.content.getScrollSize().y;var h=this.content.getSize().y;if(scrollH>h){this.wrapper.addClass(\"scrolling\");var contentScrollRatio=this.content.getScroll().y/this.getContentYMax();if(contentScrollRatio>1){contentScrollRatio=1;this.content.scrollTo(0,this.getContentYMax());}var handleY=this.getHandleYMax()*contentScrollRatio;this.scrollbar.setStyle(\"top\",handleY);}else{this.wrapper.removeClass(\"scrolling\");}},scrollHandler:function(e){if(this.disabled){return;}e=new Event(e);e.stopPropagation();if(e.wheel>0){this.scrollUp(name);}else{if(e.wheel<0){this.scrollDown(name);}}},scrollUp:function(){var scrollY=this.content.getScroll().y;if(scrollY==0){return;}scrollY-=30;if(scrollY<0){scrollY=0;}this.contentScroller.cancel();this.contentScroller.set(0,scrollY);this.update();},scrollDown:function(){var maxY=this.getContentYMax();if(maxY<0){maxY=0;}var scrollY=this.content.getScroll().y;if(scrollY>=maxY){return;}scrollY+=30;if(scrollY>maxY){scrollY=maxY;}this.contentScroller.cancel();this.contentScroller.set(0,scrollY);this.update();},handleDragHandler:function(){var handleY=this.scrollbar.getPosition(this.wrapper).y;var handleYMax=this.getHandleYMax();var contentY=this.getContentYMax()*(handleY/handleYMax);this.content.scrollTo(0,contentY);},getHandleYMax:function(){return this.wrapper.getSize().y-102;},getContentYMax:function(){return this.content.getScrollSize().y-this.content.getSize().y;}});var StreamLoader=new Class({initialize:function(options){this.items=$H();this.timestamps=$H();this.newestTimestamp=0;this.oldestTimestamp=0;this.newestId=0;this.oldestId=0;this.newestTimestampEl=null;this.empty=true;this.createElementFunc=options.createElementFunc;this.alertFunc=options.alertFunc;this.emptyEl=options.emptyEl||null;this.errorEl=options.errorEl||null;this.loadingEl=options.loadingEl||null;this.idField=options.idField||\"item_id\";this.dateField=options.dateField||\"date_created\";this.createLoader();},remove:function(id){if(!this.items.has(id)){return;}var el=this.items.get(id);var prev=el.getPrevious();var next=el.getNext();if(prev.hasClass(\"seperator\")&&next.hasClass(\"seperator\")){prev.destroy();}DomUtility.fadeOutDestroy(el);this.items.erase(id);if(this.items.getLength()==0){this.empty=true;this.showEmpty();}},process:function(data){var position=this.findPosition(data);if(!position){return;}this.insertItem(data,position);},showEmpty:function(){if(!$defined(this.emptyEl)){return;}if(this.empty){DomUtility.show(this.emptyEl);}else{DomUtility.hide(this.emptyEl);}},showError:function(){if(!$defined(this.errorEl)){return;}if($defined(this.emptyEl)){DomUtility.hide(this.emptyEl);}if($defined(this.loadingEl)){DomUtility.hide(this.loadingEl);}DomUtility.show(this.errorEl);},hideError:function(){if($defined(this.errorEl)){DomUtility.hide(this.errorEl);}if(this.empty){this.showEmpty();}},showLoading:function(){if(!$defined(this.loadingEl)||!this.empty){return;}if($defined(this.emptyEl)){DomUtility.hide(this.emptyEl);}if($defined(this.errorEl)){DomUtility.hide(this.errorEl);}DomUtility.show(this.loadingEl);},hideLoading:function(){if($defined(this.loadingEl)){DomUtility.hide(this.loadingEl);}if(this.empty){this.showEmpty();}},insertTimestamp:function(timestamp,position){var el=StreamItemUtility.createDateSeperatorItem(timestamp);el.inject(this.loader,position);if(position==\"top\"){this.newestTimestampEl=el;}},findPosition:function(data){var id=data[this.idField];var timestamp=this.getTimestamp(data[this.dateField]);if(this.empty){this.insertTimestamp(timestamp,\"top\");this.oldestTimestamp=timestamp;this.newestTimestamp=timestamp;this.newestId=id;this.oldestId=id;this.empty=false;return\"top\";}else{if(timestamp>=this.newestTimestamp&&id>this.newestId){if(!this.checkTimestampSameDay(this.newestTimestamp,timestamp)){this.insertTimestamp(timestamp,\"top\");}this.newestTimestamp=timestamp;this.newestId=id;return\"top\";}else{if(timestamp<=this.oldestTimestamp&&id<this.oldestId){if(!this.checkTimestampSameDay(this.oldestTimestamp,timestamp)){this.insertTimestamp(timestamp,\"bottom\");}this.oldestTimestamp=timestamp;this.oldestId=id;return\"bottom\";}else{return false;}}}},checkTimestampSameDay:function(ts1,ts2){var d1=DateUtility.convertFromTimestamp(ts1);var d2=DateUtility.convertFromTimestamp(ts2);return(d1.getDate()==d2.getDate()&&d1.getMonth()==d2.getMonth());},getTimestamp:function(dateValue){if(parseInt(dateValue)==dateValue){return dateValue;}return Date.parse(dateValue)/1000;},insertItem:function(data,position){var el=this.createElementFunc(data);var id=data[this.idField];var date=this.getTimestamp(data[this.dateField]);this.items.set(id,el);this.timestamps.set(id,date);if(position==\"top\"){el.inject(this.newestTimestampEl,\"after\");DomUtility.fadeIn(el,1000);}else{el.inject(this.loader,\"bottom\");}this.empty=false;this.showEmpty();this.hideLoading();this.hideError();if($defined(this.alertFunc)&&pipio.checkTimestamp(date)){this.alertFunc(data);}},createLoader:function(){this.loader=new Element(\"div\",{});if($defined(this.emptyEl)){this.emptyEl.inject(this.loader);}if($defined(this.errorEl)){this.errorEl.inject(this.loader);DomUtility.hide(this.errorEl);}if($defined(this.loadingEl)){this.loadingEl.inject(this.loader);DomUtility.hide(this.loadingEl);}},toElement:function(){return this.loader;}});var Toggle=new Class({initialize:function(on){this.isOn=$defined(on)?on:false;this.toggle=new Element(\"div\",{\"class\":\"toggle\"}).adopt(new Element(\"div\",{\"class\":\"handle\"}),new Element(\"div\",{\"class\":\"toggle_text on\",\"text\":\"on\"}),new Element(\"div\",{\"class\":\"toggle_text off\",\"text\":\"off\"}));this.toggle.addEvent(\"click\",this.switchToggle.bind(this));this.setOn();},switchToggle:function(){this.isOn=!this.isOn;this.setOn();},on:function(){this.isOn=true;this.setOn();},off:function(){this.isOn=false;this.setOn();},set:function(on){if(on){this.on();}else{this.off();}},setOn:function(){if(this.isOn){this.toggle.addClass(\"on\");this.toggle.removeClass(\"off\");}else{this.toggle.removeClass(\"on\");this.toggle.addClass(\"off\");}},toInt:function(){return(this.isOn)?1:0;},toElement:function(){return this.toggle;}});var Popup=new Class({Extends:Base,initialize:function(options){this.parent();var options=$defined(options)?options:{};this.navs=$H();this.contents=$H();this.contentSize=$defined(options.size)?options.size:{x:400,y:300};this.resizable=$defined(options.resizable)?options.resizable:true;this.dockable=$defined(options.dockable)?options.dockable:true;this.closable=$defined(options.closable)?options.closable:true;this.className=$defined(options.className)?options.className:undefined;this.noHide=$defined(options.noHide)?options.noHide:false;this.onClose=$defined(options.onClose)?options.onClose:undefined;this.hasTabs=false;this.isDocked=false;this.createPopup();},toElement:function(){return this.popup;},addContent:function(contentName,nav,content){if(this.contents.has(contentName)){return;}$(nav).inject(this.nav);$(content).inject(this.content);this.navs.set(contentName,nav);this.contents.set(contentName,content);nav.onClick=this.switchContent.bind(this,[contentName]);content.resizePopup=this.resizePopup.bind(this);if(nav.closable){nav.onClose=this.closeContent.bind(this,[contentName]);content.onClose=this.closeContent.bind(this,[contentName]);}this.checkTabs();this.switchContent(contentName);},closeContent:function(contentName){if(!this.contents.has(contentName)){return;}this.navs.get(contentName).destroy();this.contents.get(contentName).off();this.contents.get(contentName).close();this.navs.erase(contentName);this.contents.erase(contentName);if(this.contents.getLength()==0){this.close();return;}if(contentName==this.currentContent){this.currentContent=null;var last=this.contents.getKeys().pop();this.switchContent(last);}this.checkTabs();this.setTitle();},switchContent:function(contentName){if(!this.contents.has(contentName)){return;}if(this.isDocked){this.undock();}if(contentName==this.currentContent){return;}if($defined(this.currentContent)){this.navs.get(this.currentContent).off();this.contents.get(this.currentContent).off();}this.navs.get(contentName).on();this.contents.get(contentName).on();this.currentContent=contentName;this.setTitle();},setTitle:function(){var nav=this.navs.get(this.currentContent);var icon=new Icon20(nav.iconOptions);var titleText=new Element(\"div\",{\"class\":\"title_text\",\"text\":TextUtility.unescapeQuotes(nav.displayName)});this.titleIcon=$(icon).replaces(this.titleIcon);this.titleText=titleText.replaces(this.titleText);},getDockIcon:function(){var nav=this.navs.get(this.currentContent);var icon=new Icon20(nav.iconOptions);var el=new Element(\"div\",{\"class\":\"app_button has_submenu\"}).adopt($(icon));el.addEvent(\"click\",this.undock.bind(this));return el;},checkTabs:function(){if(this.contents.getLength()>1){this.popup.addClass(\"tabbed\");this._checkBounds();this.hasTabs=true;}else{this.popup.removeClass(\"tabbed\");this.hasTabs=false;}},resizePopup:function(x,y){var size={x:x,y:y+24};this.popup.setStyle(\"height\",size.y+\"px\");this.popup.setStyle(\"width\",size.x+\"px\");this._checkBounds();},reCenter:function(){var size={x:this.popup.getSize().x,y:this.popup.getSize().y};var pos={x:window.getSize().x/2-(size.x/2),y:window.getSize().y/2-(size.y/2)};if(pos.y<0){pos.y=0;}this.popup.setStyles({\"top\":pos.y+\"px\",\"left\":pos.x+\"px\"});},createPopup:function(){this.size={x:this.contentSize.x,y:this.contentSize.y+24};var pos={x:window.getSize().x/2-(this.size.x/2),y:window.getSize().y/2-(this.size.y/2)};if(pos.y<0){pos.y=0;}this.popup=new Element(\"div\",{\"class\":\"popup\",\"styles\":{\"height\":this.size.y+\"px\",\"width\":this.size.x+\"px\",\"top\":pos.y+\"px\",\"left\":pos.x+\"px\"}});if($defined(this.className)){this.popup.addClass(this.className);}this.title=new Element(\"div\",{\"class\":\"popup_title text12 light\"}).inject(this.popup);this.nav=new Element(\"div\",{\"class\":\"app_sub_menu popup_tabs\"}).inject(this.popup);this.content=new Element(\"div\",{\"class\":\"popup_content\"}).inject(this.popup);this.dragBorder=new Element(\"div\",{\"class\":\"popup_drag\",\"text\":\"Drag this window to move it\"}).inject(this.popup);this.popup.inject(\"popups\");DomUtility.fadeIn(this.popup);this.titleIcon=new Element(\"div\").inject(this.title);this.titleText=new Element(\"div\").inject(this.title);if(this.closable){this.closeButton=new Element(\"div\",{\"class\":\"button_nav right\"}).adopt(new Element(\"div\",{\"class\":\"action close\"})).inject(this.title);this.closeButton.addEvent(\"click\",this.close.bind(this));}if(this.dockable){this.dockButton=new Element(\"div\",{\"class\":\"button_nav right\"}).adopt(new Element(\"div\",{\"class\":\"action dock\"})).inject(this.title);this.dockButton.addEvent(\"click\",this.dock.bind(this));}this.drag=this.popup.makeDraggable({handle:this.title,onStart:this._startDrag.bind(this),onComplete:this._stopDrag.bind(this),onCancel:this._stopDrag.bind(this)});if(this.resizable){this.resizeHandle=new Element(\"div\",{\"class\":\"resize\"}).inject(this.popup);this.popup.makeResizable({handle:this.resizeHandle,limit:{x:[400,800],y:[300,800]}});}this.popup.addEvent(\"mousedown\",this._select.bind(this));this._select();this._checkBounds();if($defined(this.onCreate)){this.onCreate();}},close:function(){this.contents.each(function(content){content.close();});this.popup.destroy();if($defined(this.onClose)){this.onClose();}delete (this);},dock:function(){this.navs.get(this.currentContent).off();this.contents.get(this.currentContent).off();this.dockButton=new Element(\"div\",{\"class\":\"app_button_wrapper\"}).adopt(this.getDockIcon(),this.nav);this.dockButton.inject(\"dock\");DomUtility.fadeOut(this.popup);this.isDocked=true;},undock:function(){this.nav.inject(this.popup);this.dockButton.destroy();DomUtility.fadeIn(this.popup);this.navs.get(this.currentContent).on();this.contents.get(this.currentContent).on();this.isDocked=false;},_select:function(){this.popup.setStyle(\"z-index\",DomUtility.getZ(\"popup\"));},_startDrag:function(){if(this.noHide){return;}DomUtility.hide(this.nav);DomUtility.show(this.dragBorder);this.contents.get(this.currentContent).off();},_stopDrag:function(){if(!this.noHide){DomUtility.hide(this.dragBorder);DomUtility.show(this.nav);this.nav.set(\"style\",\"\");this.contents.get(this.currentContent).on();}this._checkBounds();},_checkBounds:function(){var pos=this.popup.getPosition();if(pos.x+this.popup.getSize().x>window.getSize().x){this.popup.setStyle(\"left\",window.getSize().x-this.popup.getSize().x);}if(pos.y+this.popup.getSize().y>window.getSize().y){this.popup.setStyle(\"top\",window.getSize().y-this.popup.getSize().y);}pos=this.popup.getPosition();if(pos.x<0){this.popup.setStyle(\"left\",0);}if(pos.y<0){this.popup.setStyle(\"top\",0);}}});var PopupContent=new Class({Extends:Base,init:function(options){if(!$defined(options)){options={};}if($defined(this.onBeforeInit)){options=this.onBeforeInit(options);}this.isOn=false;this.destroy=$defined(options.destroy)?options.destroy:true;this.createContent();if($defined(this.onInit)){this.onInit();}},on:function(){Logger().log(\"turning on content\");DomUtility.show(this.content);if($defined(this.onShow)){this.onShow();}this.isOn=true;},off:function(){if($defined(this.onHide)){this.onHide();}DomUtility.hide(this.content);this.isOn=false;},close:function(destroy){if(this.destroy||destroy){this.content.destroy();}else{this.content.dispose();}},closeContent:function(){if($defined(this.onClose)){this.onClose();}},createContent:function(){this.content=new Element(\"div\",{\"class\":this.className});this.off();},toElement:function(){return this.content;}});var AlertPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.alertMessage=options.alertMessage;return options;},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":TextUtility.unescape(this.alertMessage)}).inject(this.content);this.actionButton=new ButtonMedium({displayName:\"Close\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.closeContent.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton)).inject(this.content);}});var ConfirmPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.confirmMessage=options.confirmMessage;this.confirmFunc=options.confirmFunc;return options;},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":TextUtility.unescape(this.confirmMessage)}).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Confirm\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.confirmFunc);$(this.actionButton).addEvent(\"click\",this.progressClose.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},progressClose:function(){this.actionButton.showProgress();this.closeContent.delay(1500,this);}});var RoomStatusBox=new Class({Extends:Base,EventHandlers:[\"roomMembershipUpdated\",\"roomStatusUpdated\",\"roomStatusCleared\"],init:function(room){this.room=room;this.defaultStatus=\"has no current status\";this.canPost=(this.room.status==1);this.createStatusBox();},createStatusBox:function(){this.box=ItemUtility.createPostBubble(\"post status_message haspic\");ItemUtility.createProfilePic(this.room,32).inject(this.box);var buttonText=\"Write in \"+this.room.room_name;this.writeButton=new Element(\"div\",{\"class\":\"button\",\"text\":TextUtility.unescape(buttonText)}).inject(this.box);this.writeButton.addEvent(\"click\",this.fireEvent.bind(this,[\"roomShareBoxShow\",this.room]));this.setPostButton();this.content=new Element(\"div\",{\"class\":\"post_content\"}).inject(this.box);var header=new Element(\"div\",{\"class\":\"header\"}).inject(this.content);StreamItemUtility.createStreamUserAction(\"status dark\").inject(header);var creator=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescapeQuotes(this.room.room_name)}).inject(header);creator.addEvent(\"click\",this.fireEvent.bind(this,[\"showRoom\",this.room]));this.statusText=new Element(\"span\",{\"class\":\"status\"}).inject(header);this.editButton=new Element(\"span\",{\"class\":\"edit_link\",\"text\":\"update\"});this.editButton.addEvent(\"click\",this.fireEvent.bind(this,[\"showRoomStatusUpdatePopup\",this.room]));this.clearButton=new Element(\"span\",{\"class\":\"edit_link\",\"text\":\"clear\"});this.clearButton.addEvent(\"click\",this.clearStatus.bind(this));this.editSection=new Element(\"span\").adopt($(this.editButton),$(this.clearButton)).inject(header);this.setEditButton();this.footer=StreamItemUtility.createStatusBoxFooter(this.room.status_message).inject(this.content);this.updateStatus();},roomMembershipUpdated:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.room.status=data.status;this.canPost=(this.room.status==1);this.setPostButton();},setEditButton:function(){if(this.canPost){DomUtility.show(this.editSection,\"inline\");}else{DomUtility.hide(this.editSection);}},setPostButton:function(){if(this.canPost){DomUtility.show(this.writeButton);}else{DomUtility.hide(this.writeButton);}},updateStatus:function(){this.isEmpty=(!$defined(this.room.status_message)||this.room.status_message.status.trim()==\"\");if(this.isEmpty){this.statusText.addClass(\"empty\");this.statusText.set(\"text\",\" \"+TextUtility.unescape(this.defaultStatus));DomUtility.hide(this.clearButton);}else{this.statusText.removeClass(\"empty\");this.statusText.set(\"text\",\" \"+TextUtility.unescape(this.room.status_message.status.trim()));DomUtility.show(this.clearButton,\"inline\");}this.footer.destroy();this.footer=StreamItemUtility.createStatusBoxFooter(this.room.status_message).inject(this.content);},clearStatus:function(){var params={username:this.room.username,body:\"\",res:this.getSession()};this.call(\"pipio\",\"publish_roomstatus\",params);this.roomStatusCleared({username:this.room.username});},roomStatusUpdated:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.room=this.getRoom(data.username);this.updateStatus();},roomStatusCleared:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.room.status_message.status=\"\";this.room.status_message.creator=undefined;this.room.status_message.date_created=undefined;this.room.status_message.location=undefined;this.updateStatus();},toElement:function(){return this.box;}});var StatusBox=new Class({Extends:Base,EventHandlers:[\"userStatusUpdated\",\"userStatusCleared\",\"contactAdded\",\"contactDeleted\"],init:function(user){this.user=user;this.isSelf=this.user.user_id==this.getPrivateUser().user_id;this.defaultStatus=\"has no current status\";this.canPost=$defined(this.getContact(this.user.username))||this.isSelf;this.createStatusBox();},createStatusBox:function(){this.box=ItemUtility.createPostBubble(\"post status_message haspic\");ItemUtility.createProfilePic(this.user,32).inject(this.box);var buttonText=this.isSelf?\"Write in Your Stream\":\"Write in \"+this.user.first_name+\"'s Stream\";this.writeButton=new Element(\"div\",{\"class\":\"button\",\"text\":TextUtility.unescape(buttonText)}).inject(this.box);this.writeButton.addEvent(\"click\",this.fireEvent.bind(this,[\"shareBoxShow\",this.user]));this.setPostButton();this.content=new Element(\"div\",{\"class\":\"post_content\"}).inject(this.box);var header=new Element(\"div\",{\"class\":\"header\"}).inject(this.content);StreamItemUtility.createStreamUserAction(\"status dark\").inject(header);var creator=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescapeQuotes(this.user.fullname)}).inject(header);creator.addEvent(\"click\",this.fireEvent.bind(this,[\"showUser\",this.user]));this.status=new Element(\"span\",{\"class\":\"status\"}).inject(header);if(this.isSelf){this.editButton=new Element(\"span\",{\"class\":\"edit_link\",\"text\":\"update\"}).inject(header);this.editButton.addEvent(\"click\",this.fireEvent.bind(this,[\"showStatusUpdatePopup\"]));this.clearButton=new Element(\"span\",{\"class\":\"edit_link\",\"text\":\"clear\"}).inject(header);this.clearButton.addEvent(\"click\",this.clearStatus.bind(this));}this.footer=StreamItemUtility.createStatusBoxFooter(this.user.status_message).inject(this.content);this.updateStatus();},contactAdded:function(user){if(this.user.username!=user.username){return;}this.canPost=true;this.setPostButton();},contactDeleted:function(username){if(this.user.username!=username){return;}this.canPost=false;this.setPostButton();},setPostButton:function(){if(this.canPost){DomUtility.show(this.writeButton);}else{DomUtility.hide(this.writeButton);}},updateStatus:function(){this.isEmpty=this.user.status_message.status.trim()==\"\";if(this.isEmpty){this.status.addClass(\"empty\");this.status.set(\"text\",\" \"+TextUtility.unescape(this.defaultStatus));if(this.isSelf){DomUtility.hide(this.clearButton);}}else{this.status.removeClass(\"empty\");this.status.set(\"text\",\" \"+TextUtility.unescape(this.user.status_message.status.trim()));if(this.isSelf){DomUtility.show(this.clearButton,\"inline\");}}this.footer.destroy();this.footer=StreamItemUtility.createStatusBoxFooter(this.user.status_message).inject(this.content);},clearStatus:function(){var params={body:\"\",res:this.getSession()};this.call(\"pipio\",\"publish_status\",params);this.userStatusCleared({username:this.user.username});},userStatusUpdated:function(data){if(!$defined(data.username)||data.username!=this.user.username){return;}this.user.status_message=data.status_message;this.updateStatus();},userStatusCleared:function(data){if(!$defined(data.username)||data.username!=this.user.username){return;}this.user.status_message.status=\"\";this.user.status_message.date_created=undefined;this.user.status_message.location=undefined;this.updateStatus();},toElement:function(){return this.box;}});var AttachmentUtility={parseLinkAttachment:function(attachment){if($defined(attachment.processed)){return attachment;}attachment.processed=true;attachment.is_video=false;attachment.is_photo=false;if(attachment.url.contains(\"youtube.com\")){var youtubeId=attachment.url.replace(/^[^v]+v.(.{11}).*/,\"$1\");if(youtubeId!=\"\"){attachment.is_video=true;attachment.video_type=\"youtube\";attachment.youtubeId=youtubeId;return attachment;}}else{if(attachment.url.contains(\"collegehumor.com/video:\")){var vimeoId=attachment.url.split(\"collegehumor.com/video:\")[1];if(vimeoId!=\"\"){attachment.is_video=true;attachment.video_type=\"ch\";attachment.vimeoId=vimeoId;return attachment;}}else{if(attachment.url.contains(\"vimeo.com/\")){var vimeoId=attachment.url.split(\"vimeo.com/\")[1];if(vimeoId!=\"\"){attachment.is_video=true;attachment.video_type=\"vimeo\";attachment.vimeoId=vimeoId;return attachment;}}else{if(attachment.url.contains(\"hulu.com\")){attachment.is_video=true;attachment.video_type=\"hulu\";return attachment;}else{if(attachment.url.contains(\"break.com\")){attachment.is_video=true;attachment.video_type=\"break\";return attachment;}else{if(DataUtility.validatePhotoFile(attachment.url)){attachment.is_photo=true;return attachment;}}}}}}return attachment;},parsePhotoAttachment:function(attachment){if($defined(attachment.processed)){return attachment;}attachment.processed=true;attachment.is_photo=true;return attachment;}};var DataUtility={photoExtensions:[\".jpeg\",\".jpg\",\".gif\",\".png\",\".bmp\"],validateUrl:function(url){var v=new RegExp();v.compile(\"^([A-Za-z]+://[A-Za-z0-9-_]+.[A-Za-z0-9-_%&?/.=,+~!:@()]+(#[A-Za-z0-9-_%&?/.=,+~!:@()]+)?)$\");return v.test(url);},validatePhotoFile:function(filename){if(filename.substring(filename.length-5).toLowerCase()==\".jpeg\"){return true;}var ext=filename.substring(filename.length-4).toLowerCase();return DataUtility.photoExtensions.contains(ext);},getGeoString:function(location){if(!$defined(location)){return false;}var locationString=false;var locality=DataUtility.getGeoLocality(location);if(locality){locationString=locality;}var label=DataUtility.getGeoLabel(location);if(label){locationString=label+\", \"+locality;}return locationString;},getGeoLabel:function(location){if($defined(location.label)&&location.label!=\"\"){return location.label;}else{return false;}},getGeoLocality:function(location){var local=\"\";if(location.country_code==\"US\"){if($defined(location.region)&&$defined(location.city)&&location.region!=\"\"&&location.city!=\"\"){local=location.city+\", \"+location.region;}else{return false;}}else{if($defined(location.city)&&location.city!=\"\"){local=location.city+\", \"+location.country;}else{if(location.city==\"\"&&$defined(location.region)&&location.region!=\"\"){local=location.region+\", \"+location.country;}else{if(!$defined(location.city)&&$defined(location.country)){local=location.country;}else{return false;}}}}return local;},getPipioUrl:function(url,hash){if($defined(hash)){return\"/\"+hash;}else{return url;}},getFacebookPhotoUrl:function(url){return url.replace(\"_s.jpg\",\"_n.jpg\");},sortUsers:function(a,b){return a.last_name.toLowerCase()<b.last_name.toLowerCase();},getCookie:function(c_name){if(document.cookie.length>0){c_start=document.cookie.indexOf(c_name+\"=\");if(c_start!=-1){c_start=c_start+c_name.length+1;c_end=document.cookie.indexOf(\";\",c_start);if(c_end==-1){c_end=document.cookie.length;}return unescape(document.cookie.substring(c_start,c_end));}}return undefined;},getFileUrl:function(hash,file_id,filename){var serverId=file_id%16;return\"http://files\"+serverId.toString(16)+\".pip.io/\"+hash.substring(0,2)+\"/\"+hash.substring(2,3)+\"/\"+hash.substring(3,5)+\"/\"+hash.substring(5,8)+\"/\"+file_id+\"/\"+filename;}};var DateUtility={convertFromGMT:function(date){var offsetMils=date.getTimezoneOffset()*60*1000;date.setTime(date.getTime()-offsetMils);return date;},getTimestamp:function(ts,format){if(!$defined(format)){format=\"%B %D, %I:%M%p\";}if(new Date().getTime()-ts.getTime()>86400000){return ts.format(format);}else{return ts.timeAgoInWords();}},convertFromTimestamp:function(ts){var date=new Date();date.setTime(ts*1000);return date;}};var DomUtility={toggle:function(id){if($(id).getStyle(\"display\")==\"none\"){DomUtility.show(id);}else{DomUtility.hide(id);}},hide:function(id){if($(id)!=null){$(id).setStyle(\"display\",\"none\");}},show:function(id,display){if(!$defined(display)){display=\"block\";}if($(id)!=null){$(id).setStyle(\"display\",display);}},expand:function(id){var el=$(id);el.get(\"tween\",{duration:150}).start(\"height\",el.getScrollSize().y).chain(function(){el.setStyle(\"height\",\"auto\");});},collapse:function(id){var el=$(id);el.setStyle(\"height\",el.getSize().y);el.get(\"tween\",{duration:150}).start(\"height\",0);},setHeight:function(id,h){var el=$(id);el.get(\"tween\",{duration:150}).start(\"height\",h);},expandFade:function(id,h){var el=$(id);el.setStyle(\"opacity\",0);el.get(\"tween\",{duration:150}).start(\"height\",h).chain(function(){el.get(\"tween\",{duration:800}).start(\"opacity\",1);});},collapseFade:function(id){var el=$(id);el.get(\"tween\",{duration:800}).start(\"opacity\",0).chain(function(){el.get(\"tween\",{duration:150}).start(\"height\",0);});},fadeOut:function(id,destroy){var el=$(id);el.setStyle(\"opacity\",1);el.get(\"tween\",{duration:500}).start(\"opacity\",0).chain(function(){if(destroy){el.destroy();}});},fadeOutDestroy:function(id){DomUtility.fadeOut(id,true);},fadeIn:function(id,duration){var el=$(id);duration=duration||500;el.setStyle(\"opacity\",0);el.get(\"tween\",{duration:duration}).start(\"opacity\",1);},getZ:function(name){var zName=name+\"Z\";if(!$defined(window[zName])){window[zName]=200;}window[zName]++;return window[zName];},textareaAutoSize:function(el,min){min=$defined(min)?min:16;el=$(el);if(el.value.trim().length<30&&el.getSize().y>min){el.setStyle(\"height\",min);return true;}if(el.getScrollSize().y>min&&el.getScrollSize().y>el.getSize().y){el.setStyle(\"height\",el.getScrollSize().y);return true;}return false;}};var ItemUtility={createProfilePic:function(user,size){var picSize=(size==\"16a\")?16:size;if($defined(user.fullname)){var el=new Element(\"div\",{\"class\":\"shadowed profile_pic_wrapper_\"+size}).adopt(new Element(\"img\",{\"class\":\"profile_pic profile_pic_\"+picSize+\"_\"+user.username,\"src\":user[\"profile_pic_\"+picSize],\"title\":TextUtility.unescape(user.fullname)}),new Element(\"div\",{\"class\":\"online_status online_status_\"+user.username,\"title\":TextUtility.unescape(user.fullname)}));return el;}else{if($defined(user.room_name)){var el=new Element(\"div\",{\"class\":\"shadowed profile_pic_wrapper_\"+size}).adopt(new Element(\"img\",{\"class\":\"profile_pic profile_pic_\"+picSize+\"_\"+user.username,\"src\":user[\"profile_pic_\"+picSize],\"title\":TextUtility.unescape(user.room_name)}),new Element(\"div\",{\"class\":\"online_status online_status_\"+user.username,\"title\":TextUtility.unescape(user.room_name)}));return el;}}},createItemPic:function(url,size){var picSize=$defined(size)?size:32;var el=new Element(\"div\",{\"class\":\"shadowed profile_pic_wrapper_\"+picSize}).adopt(new Element(\"img\",{\"class\":\"profile_pic profile_pic_\"+picSize,\"src\":url}),new Element(\"div\",{\"class\":\"online_status\"}));return el;},createChatPostItem:function(msg,user){var el=ItemUtility.createPostBubble(\"post chat haspic\");if(!msg.outbound){user=msg.target;}ItemUtility.createProfilePic(user,20).inject(el);new Element(\"div\",{\"class\":\"post_content\"}).adopt(new Element(\"div\",{\"class\":\"header\",\"html\":TextUtility.replaceUrls(TextUtility.cleanText(msg.msg))})).inject(el);return el;},createChatPostHeading:function(user,date){var el=new Element(\"div\",{\"class\":\"post chat heading\"});var ts=$defined(date)?new Element(\"span\",{\"class\":\"timestamp\",\"text\":DateUtility.getTimestamp(date,\"%B %D, %I:%M%p\"),\"ts\":date,\"ts_format\":\"%B %D, %I:%M%p\"}):new Element(\"span\");new Element(\"div\",{\"class\":\"post_content\"}).adopt(new Element(\"div\",{\"class\":\"header\"}).adopt(new Element(\"span\",{\"class\":\"user_name\",\"text\":TextUtility.unescapeQuotes(user.fullname)}),ts)).inject(el);return el;},createChatTypingHeading:function(user){var el=new Element(\"div\",{\"class\":\"post chat heading\"});new Element(\"div\",{\"class\":\"post_content\"}).adopt(new Element(\"div\",{\"class\":\"header\"}).adopt(new Element(\"span\",{\"class\":\"user_name\",\"text\":TextUtility.unescapeQuotes(user.fullname)}),new Element(\"span\",{\"class\":\"status_text\",\"text\":\"is typing\"}))).inject(el);return el;},createPostBubble:function(className,nocorner){if(nocorner){var el=new Element(\"div\",{\"class\":className}).adopt(new Element(\"div\",{\"class\":\"bubble\"}).adopt(new Element(\"div\",{\"class\":\"bubble_inner\"})));}else{var el=new Element(\"div\",{\"class\":className}).adopt(new Element(\"div\",{\"class\":\"bubble\"}).adopt(new Element(\"div\",{\"class\":\"bubble_inner\"}),new Element(\"div\",{\"class\":\"corner\"})));}return el;}};var Logger=(function(){var LoggerSingleton=new Class({initialize:function(){this._log=new Log();this._log.enableLog();},log:function(val){this._log.log(val);}});var singleton;return function(){return singleton?singleton:singleton=new LoggerSingleton();};})();var TextUtility={unescapeQuotes:function(val){if(!$defined(val)){return\"\";}val=val.toString();val=val.split(\"\\\\\\\\\").join(\"\\\\\");val=val.split(\"\\\\'\").join(\"'\");val=val.split('\\\\\"').join('\"');return val;},unescapeHtml:function(val){if(!$defined(val)){return\"\";}val=val.toString();val=val.split(\"&lt;\").join(\"<\");val=val.split(\"&gt;\").join(\">\");val=val.split(\"&amp;\").join(\"&\");return val;},unescape:function(val){return TextUtility.unescapeQuotes(TextUtility.unescapeHtml(val));},escapeHtml:function(val){if(!$defined(val)){return\"\";}val=val.toString();val=val.split(\"<\").join(\"&lt;\");val=val.split(\">\").join(\"&gt;\");return val;},stripHtml:function(val){if(!$defined(val)){return\"\";}val=val.toString();var re=/<\\S[^><]*>/g;val.replace(re,\"\");return val;},cleanText:function(val){if(!$defined(val)){return\"\";}val=val.toString();val=TextUtility.unescapeQuotes(val);val=TextUtility.escapeHtml(val);return val;},pluralText:function(count,singular,plural){if(count==1){return count+\" \"+singular;}else{return count+\" \"+plural;}},replaceUrls:function(val){if(!$defined(val)){return\"\";}return val.replace(/([A-Za-z]+:\\/\\/[A-Za-z0-9-_]+\\.[A-Za-z0-9-_%&\\?\\/.=,+~!:@()]+(#[A-Za-z0-9-_%&\\?\\/.=,+~!:@()]+)?)/g,'<a href=\"$1\" target=\"_blank\">$1</a>');},convertNewLine:function(val){if(!$defined(val)){return\"\";}val=val.toString();val=val.split(\"\\n\").join(\"<br/>\");return val;}};String.format=function(text){if(arguments.length<=1){return text;}var tokenCount=arguments.length-2;for(var token=0;token<=tokenCount;token++){text=text.replace(new RegExp(\"\\\\{\"+token+\"\\\\}\",\"gi\"),arguments[token+1]);}return text;};var UserUtility={profilePicVersionSet:function(user_id,ver){if(!$defined(window.profilePicVer)){window.profilePicVer=new Hash();}window.profilePicVer.set(user_id,ver);},profilePicVersionGet:function(user_id){if(!$defined(window.profilePicVer)){return 0;}if(!window.profilePicVer.has(user_id)){return 0;}return window.profilePicVer.get(user_id);},getProfilePic:function(hash,user_id,size){if(!$defined(size)){size=26;}var serverId=user_id%16;var version=UserUtility.profilePicVersionGet(user_id);return\"http://profilepics\"+serverId.toString(16)+\".pip.io/\"+hash.substring(0,2)+\"/\"+hash.substring(2,3)+\"/\"+hash.substring(3,5)+\"/\"+user_id+\"/\"+size+\".jpg?\"+version;},processSource:function(source){if($defined(source.user_id)){return UserUtility.processUser(source);}else{if($defined(source.room_id)){return UserUtility.processRoom(source);}}},processRoom:function(room){var proom={};proom.username=room.username.toLowerCase();if($defined(room.about)){pipio.profileUpdated({username:room.username,about:room.about});}if($defined(pipio.getRoom(proom.username))){var existing=pipio.getRoom(proom.username);if($defined(room.about)){pipio.profileUpdated({username:proom.username,about:room.about});}if($defined(room.status_message)&&$defined(room.status_message.status)){if($defined(room.status_message.status)&&existing.status_message.status!=room.status_message.status){pipio.dispatchEvent(\"roomStatusUpdated\",{username:room.username,status_message:room.status_message});existing.status_message=room.status_message;}}if($defined(room.is_public)){existing.is_public=parseInt(room.is_public);}if($defined(room.status)){existing.status=parseInt(room.status);}if($defined(room.subscribed)){existing.status=parseInt(room.subscribed);}return existing;}proom.status_message=$defined(room.status_message)?room.status_message:{status:\"\"};proom.room_id=room.room_id;proom.room_name=room.room_name;proom.room_hash=room.room_hash;proom.date_created=room.date_created;proom.creator_id=$defined(room.creator_id)?room.creator_id:0;proom.creator=$defined(room.creator)?UserUtility.processUser(room.creator):null;proom.is_public=parseInt(room.is_public);proom.status=$defined(room.status)?parseInt(room.status):0;proom.subscribed=$defined(room.subscribed)?parseInt(room.subscribed):0;proom.about=$defined(room.about)?room.about:null;proom.profile_pic_16=UserUtility.getProfilePic(room.room_hash,room.room_id,16);proom.profile_pic_20=UserUtility.getProfilePic(room.room_hash,room.room_id,20);proom.profile_pic_26=UserUtility.getProfilePic(room.room_hash,room.room_id,26);proom.profile_pic_32=UserUtility.getProfilePic(room.room_hash,room.room_id,32);proom.profile_pic_42=UserUtility.getProfilePic(room.room_hash,room.room_id,42);proom.profile_pic_60=UserUtility.getProfilePic(room.room_hash,room.room_id,60);proom.profile_pic_100=UserUtility.getProfilePic(room.room_hash,room.room_id,100);proom.profile_pic_200=UserUtility.getProfilePic(room.room_hash,room.room_id,200);pipio.cacheRoom(proom);return proom;},processUser:function(user){var puser={};if(!$defined(user)||!$defined(user.username)){return;}puser.username=user.username.toLowerCase();if($defined(user.current_location)&&user.current_location!=\"\"){pipio.locationUpdated({username:puser.username,location_enabled:$defined(user.location_enabled)?user.location_enabled:0,location:user.current_location});}if($defined(user.about)){pipio.profileUpdated({username:puser.username,about:user.about});}if($defined(pipio.getUser(puser.username))){var existing=pipio.getUser(puser.username);if($defined(user.status_message)&&$defined(user.status_message.status)){if($defined(user.status_message.status)&&existing.status_message.status!=user.status_message.status){pipio.dispatchEvent(\"userStatusUpdated\",{username:user.username,status_message:user.status_message});existing.status_message=user.status_message;}}if($defined(user.location_enabled)){existing.location_enabled=user.location_enabled;}if($defined(user.is_public)){existing.is_public=user.is_public;}return existing;}puser.status_message=$defined(user.status_message)?user.status_message:{status:\"\"};puser.first_name=user.first_name;puser.last_name=user.last_name;puser.fullname=user.first_name+\" \"+user.last_name;puser.user_hash=user.user_hash;puser.user_id=user.user_id;puser.group_id=$defined(user.group_id)?user.group_id:0;puser.about=$defined(user.about)?user.about:null;puser.is_public=user.is_public;puser.location_enabled=$defined(user.location_enabled)?user.location_enabled:0;puser.online=false;puser.show=\"\";puser.video=false;puser.profile_pic_16=UserUtility.getProfilePic(user.user_hash,user.user_id,16);puser.profile_pic_20=UserUtility.getProfilePic(user.user_hash,user.user_id,20);puser.profile_pic_26=UserUtility.getProfilePic(user.user_hash,user.user_id,26);puser.profile_pic_32=UserUtility.getProfilePic(user.user_hash,user.user_id,32);puser.profile_pic_42=UserUtility.getProfilePic(user.user_hash,user.user_id,42);puser.profile_pic_60=UserUtility.getProfilePic(user.user_hash,user.user_id,60);puser.profile_pic_100=UserUtility.getProfilePic(user.user_hash,user.user_id,100);puser.profile_pic_200=UserUtility.getProfilePic(user.user_hash,user.user_id,200);pipio.cacheUser(puser);return puser;},updateStatusMessage:function(user,status_msg){var msgClass=\".status_msg_\"+user.username;$$(msgClass).each(function(el){el.set(\"text\",TextUtility.unescapeQuotes(status_msg));});},getInstalledApps:function(){var apps=new Array();if($defined(user_data)){user_data.apps.each(function(app){apps[app.app_id]=app.external_user_id;},this);}return apps;}};var AlbumViewer=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"viewAlbum\"],init:function(){this.photos=$H();},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){},userLoggedOut:function(){},viewAlbum:function(album,photo,aid){var thumbSize=75;var w=600;var h=450;w+=2;h+=thumbSize+34;var albumPopup=new Popup({size:{x:w,y:h},resizable:false,dockable:true,closable:true,className:\"albumViewer\"});var nav=new Nav({iconOptions:{iconName:\"photo\"},displayName:album.displayName,closable:true});var content=new AlbumPopupContent({album:album,photo:photo,aid:aid,width:w,height:h,thumbSize:thumbSize});albumPopup.addContent(\"album\",nav,content);}});var AlbumPopupContent=new Class({Extends:PopupContent,EventHandlers:[\"albumPicView\"],onBeforeInit:function(options){this.album=options.album;this.curPhoto=options.photo;this.aid=options.aid;this.width=options.width;this.height=options.height;this.thumbSize=options.thumbSize;this.imageEls=$H();return options;},onInit:function(){var img=new Asset.image(this.curPhoto.src,{title:this.curPhoto.caption,onload:(function(image){this.picLoaded(image,this.curPhoto);}).bind(this)});this.nextImage;this.nextId;},picLoaded:function(image,photo){this.curImage=this.photoResize(image);var imgArea=new Element(\"div\",{\"class\":\"albumImage\"}).adopt(this.curImage);imgArea.inject(this.content);this.nextLayer=new Element(\"div\",{\"class\":\"nav_image next nextLayer\"});this.prevLayer=new Element(\"div\",{\"class\":\"nav_image previous prevLayer\"});this.nextLayer.inject(imgArea);this.prevLayer.inject(imgArea);var nextL=this.nextLayer;var prevL=this.prevLayer;imgArea.addEvent(\"mouseover\",function(){DomUtility.show(nextL);},this);imgArea.addEvent(\"mouseover\",function(){DomUtility.show(prevL);},this);imgArea.addEvent(\"mouseout\",function(){DomUtility.hide(nextL);},this);imgArea.addEvent(\"mouseout\",function(){DomUtility.hide(prevL);},this);this.addNextPrevEvents(photo.id,this.aid);this.captionBox=new Element(\"div\",{\"class\":\"photoCaption\",\"text\":photo.caption}).inject(this.content);if($defined(photo.caption)&&photo.caption!=\"\"){DomUtility.show(this.captionBox);}else{DomUtility.hide(this.captionBox);}var imgBarWidth=(this.thumbSize+10)*this.album.getSize();this.imageBarOuter=new Element(\"div\",{\"class\":\"imageBarOuter\",\"styles\":{\"width\":this.w-2}});this.imageBarOuter.inject(this.content);var imageBar=new Element(\"div\",{\"class\":\"imageBar\",\"styles\":{\"width\":imgBarWidth}});imageBar.inject(this.imageBarOuter);var curIndex;var photos=this.album.getAllPhotos();var pic,img,imgContainer;for(var i=0;i<this.album.getSize();i++){pic=photos[i];img=new Element(\"img\",{\"src\":pic.thumb,\"alt\":pic.caption,\"title\":pic.caption});imgContainer=new Element(\"div\",{\"class\":\"imageInBar\"}).adopt(img);imgContainer.inject(imageBar);this.imageEls.set(pic.id,imgContainer);if(pic.id==photo.id){imgContainer.addClass(\"photoHightlight\");this.oldPic=pic;}imgContainer.addEvent(\"click\",pipio.dispatchEvent.bind(this,[\"albumPicView\",pic.id,this.aid]));}this.scrollToPic(photo.id);this.loadNextPic(photo.pid);},photoResize:function(image){var w=parseInt(image.get(\"width\"));var h=parseInt(image.get(\"height\"));var ratio=1;if(h>w){if(h>450){ratio=450/h;h=450;w=ratio*w;}}else{if(w>600){ratio=600/w;w=600;h=ratio*h;}}image.setStyle(\"height\",h);image.setStyle(\"width\",w);return image;},addNextPrevEvents:function(id,aid){var photos=this.album.getNextPrevPhoto(id);$(this.nextLayer).addEvent(\"click\",pipio.dispatchEvent.bind(this,[\"albumPicView\",photos.next.id,aid]));$(this.prevLayer).addEvent(\"click\",pipio.dispatchEvent.bind(this,[\"albumPicView\",photos.prev.id,aid]));},scrollToPic:function(id){var width=600;var index=this.album.getIndex(id);var x=index*(this.thumbSize+10);x=x-(600/2)+(this.thumbSize/2)+4;if(x<0){x=0;}var meh=this.imageEls.get(id).scrollLeft;$(this.imageBarOuter).scrollTo(x,0);},loadNextPic:function(pid){var nextPhoto=this.album.nextPhoto(pid);this.nextId=nextPhoto.id;var img=new Asset.image(nextPhoto.src,{onload:(function(image){this.nextImage=image;}).bind(this)});},albumPicView:function(pid){if($defined(pid[1])&&pid[1]==this.aid){pid=pid[0];if(pid==this.nextId){this.albumPicViewLoaded(this.nextImage,pid,this.aid);}else{var photo=this.album.getPhoto(pid);var img=new Asset.image(photo.src,{onload:(function(image){this.albumPicViewLoaded(image,pid,this.aid);}).bind(this)});}}},albumPicViewLoaded:function(image,pid,aid){var photo=this.album.getPhoto(pid);image=this.photoResize(image);var im=image.replaces($(this.curImage));this.curImage=im;this.captionBox.set(\"text\",photo.caption);if($defined(photo.caption)&&photo.caption!=\"\"){DomUtility.show(this.captionBox);}else{DomUtility.hide(this.captionBox);}this.nextLayer.removeEvents(\"click\");this.prevLayer.removeEvents(\"click\");this.addNextPrevEvents(pid,aid);this.imageEls.get(this.oldPic.id).removeClass(\"photoHighlight\");this.imageEls.get(pid).addClass(\"photoHighlight\");this.scrollToPic(pid);this.loadNextPic(pid);}});var Background=new Class({Extends:Base,EventHandlers:[\"userLoggedIn\",\"userLoggedOut\"],init:function(){this.clouds=new Array();this.stars=new Array();this.container=$(\"background\");this.getBounds();this.setupSky();this.sunrise=6;this.sunset=19;this.moonrise=21;this.moonset=4;this.maxStars=30;this.starsStart=19;this.starsEnd=4;for(var i=0;i<6;i++){var cloud=this.createCloud().inject(this.container);this.clouds.push(cloud);}this.run();},setupSky:function(){this.sky=new Element(\"div\",{\"class\":\"sky\"}).inject(this.container);this.sun=new Element(\"div\",{\"class\":\"celestial sun\"}).inject(this.container);this.dusk=new Element(\"div\",{\"class\":\"sky_dusk\"}).inject(this.container);this.moon=new Element(\"div\",{\"class\":\"celestial moon\"}).inject(this.container);this.moveSky();},run:function(){this.step();this.anim=this.step.periodical(20000,this);},stop:function(){$clear(this.anim);},step:function(){this.moveClouds();this.moveSky();},getBounds:function(){this.xMin=-100;this.xMax=this.container.getSize().x;this.yMin=0;this.yMax=this.container.getSize().y-100;},userLoggedIn:function(){},userLoggedOut:function(){},setStars:function(){var time=this.getTime();if((time>this.starsStart||time<this.starsEnd)&&this.stars.length<this.maxStars){var star=this.createStar();star.inject(this.container);star.setStyles({\"top\":$random(1,this.yMax),\"left\":$random(1,this.xMax)});this.stars.push(star);}else{if(((time>this.starsEnd&&time<this.starsStart)&&this.stars.length>0)||this.stars.length==this.maxStars){this.removeStar();}}},removeStar:function(){if(this.stars.length==0){return;}var i=$random(0,this.stars.length-1);this.stars[i].destroy();this.stars.splice(i,1);},moveClouds:function(){var containerSize=this.container.getSize();this.clouds.each(function(item){var pos=item.getPosition();var speed=$random(2,6);if(pos.x+speed>this.xMax){item.setStyle(\"left\",this.xMin);}else{item.get(\"tween\",{duration:1000}).start(\"left\",pos.x+speed);}},this);},createStar:function(){var star=new Element(\"div\",{\"class\":\"celestial stars star\"+$random(1,4)});return star;},createCloud:function(){var cloud=new Element(\"div\",{\"class\":\"cloud cloud\"+$random(1,6)});cloud.setStyle(\"left\",$random(this.xMin,this.xMax));cloud.setStyle(\"top\",$random(this.yMin,this.yMax));return cloud;},moveSky:function(){this.sky.setStyle(\"top\",this.getSkyPosition());this.dusk.setStyle(\"bottom\",this.getDuskPosition());this.moveSun();this.moveMoon();this.setStars();},moveSun:function(){var pos=this.getSunPosition();this.sun.setStyles({\"top\":pos.y+\"%\",\"left\":pos.x+\"%\"});},moveMoon:function(){var pos=this.getMoonPosition();this.moon.setStyles({\"top\":pos.y+\"%\",\"left\":pos.x+\"%\"});},getSkyPosition:function(){var skyMax=3000-this.container.getSize().y;var time=this.getTime();if(time>=1){time+=23;}else{time-=1;}return -Math.sin(((time)/24)*Math.PI)*Math.sin(((time)/24)*Math.PI)*skyMax;},getGroundOpacity:function(){var opacityMax=80;var time=this.getTime();if(time>=1){time+=23;}else{time-=1;}var dark=(1-Math.sin(((time)/24)*Math.PI))*opacityMax;return dark;},getDuskPosition:function(){var time=this.getTime();if(time>this.sunset-1&&time<this.sunset+1){time=(time-(this.sunset-1))/2;return -183+Math.sin((time)*Math.PI)*183;}else{return -183;}},getSunPosition:function(){var pos={x:90,y:100};var time=this.getTime();if(time>this.sunrise&&time<this.sunset){time=(time-this.sunrise)/(this.sunset-this.sunrise);pos.y=100-Math.sin(time*Math.PI)*100;pos.x=90-time*100;}return pos;},getMoonPosition:function(){var pos={x:90,y:100};var time=this.getTime();if(time<this.moonset){time+=24;}if(time>this.moonrise&&time<this.moonset+24){time=Math.abs((time-this.moonrise)/((this.moonset+24)-this.moonrise));pos.y=100-Math.sin(time*Math.PI)*100;pos.x=90-time*100;}return pos;},getTime:function(){var date=new Date();return date.getHours()+date.getMinutes()/60;}});var Chat=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"chatStart\",\"chatMsgReceived\",\"chatTypingReceived\"],init:function(){this.contents=$H();this.lastMsg=$H();},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){},userLoggedOut:function(){this.resetChatPopup();this.init();},chatStart:function(username,noSwitch){if(!$defined(this.popup)){this.createChatPopup();}var user=this.getContact(username);var content=this.addChatConvo(user);if(!$defined(noSwitch)){this.popup.switchContent(username);}return content;},chatTypingReceived:function(username){if(!this.contents.has(username)){return;}this.contents.get(username).showTyping();},chatMsgReceived:function(msg){var user=msg.target;var content=this.chatStart(user.username,true);if(!this.lastMsg.has(user.username)||this.lastMsg.get(user.username).outbound!=msg.outbound||new Date().getTime()-this.lastMsg.get(user.username).timestamp.getTime()>300000){var ts=msg.timestamp;if(this.lastMsg.has(user.username)&&msg.timestamp.getTime()-this.lastMsg.get(user.username).timestamp.getTime()<300000){ts=null;}var heading=(msg.outbound)?ItemUtility.createChatPostHeading(this.getPrivateUser(),ts):ItemUtility.createChatPostHeading(user,ts);content.insertChatItem(heading);}this.lastMsg.set(user.username,msg);var item=ItemUtility.createChatPostItem(msg,this.getPrivateUser());content.insertChatItem(item);},resetChatPopup:function(){if($defined(this.popup)){this.popup.close();}this.contents.each(function(content,key){content.close(true);this.contents.erase(key);},this);},createChatPopup:function(){this.popup=new ChatPopup({size:{x:400,y:350},resizable:false,className:\"pipioChat\",onClose:this.destroyChatPopup.bind(this)});},destroyChatPopup:function(){this.popup=null;this.isActive=false;},addChatConvo:function(user){if(this.contents.has(user.username)){var nav=new Nav({iconOptions:{user:user},displayName:user.fullname,closable:true});var content=this.contents.get(user.username);this.popup.addContent(user.username,nav,content);content.jumpToBottom();return content;}else{var nav=new Nav({iconOptions:{user:user},displayName:user.fullname,closable:true});var content=new ChatPopupContent({user:user});this.contents.set(user.username,content);this.popup.addContent(user.username,nav,content);return content;}}});Chat.implement({createChatPostItem:function(msg){var item=new Element(\"div\",{\"class\":\"post chat haspic\"});}});var ChatPopup=new Class({Extends:Popup,setTitle:function(){if(this.hasTabs){var icon=new Icon20({iconName:\"rooms\"});var titleText=new Element(\"div\",{\"class\":\"title_text\",\"text\":this.contents.getLength()+\" Chats\"});}else{var nav=this.navs.get(this.currentContent);var icon=new Icon20(nav.iconOptions);var titleText=new Element(\"div\",{\"class\":\"title_text\",\"text\":\"Chat with \"+TextUtility.unescapeQuotes(nav.displayName)});}this.titleIcon=$(icon).replaces(this.titleIcon);this.titleText=titleText.replaces(this.titleText);}});var ChatPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){options.destroy=false;this.user=options.user;return options;},onInit:function(){this.lastOutbound=null;this.typingSent=false;this.chatContent=new Element(\"div\",{\"class\":\"chatContent\"}).inject(this.content);this.chatInput=new Element(\"textarea\",{\"maxlength\":2000});this.chatInput.addEvent(\"keyup\",this.chatInputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"chatInput\"}).adopt(new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.chatInput)).inject(this.content);this.scroll=new Fx.Scroll(this.chatContent);},jumpToBottom:function(){this.scroll.set(0,this.chatContent.getScrollSize().y);},onShow:function(){if($defined(this.scrollY)){this.scroll.set(0,this.scrollY);}this.focus();var msg=this.user.first_name+\" says...\";this.fireEvent(\"titleMessageDelete\",msg);},onHide:function(){if($defined(this.chatContent)){this.scrollY=this.chatContent.getScroll().y;}},focus:function(){this.chatInput.focus.delay(500,this.chatInput);},clearInput:function(){this.chatInput.value=\"\";},chatInputKeyUp:function(e){if(e.key==\"enter\"){var msg=e.target.value.trim();if(msg==\"\"){return;}this.fireEvent(\"sendIM\",this.user,msg);this.resetTypingSent();this.clearInput();this.focus();}else{this.sendTyping();}DomUtility.textareaAutoSize(e.target,16);},insertChatItem:function(el){this.hideTyping();el.inject(this.chatContent);this.scroll.toBottom();if(!this.isOn){var msg=this.user.first_name+\" says...\";this.fireEvent(\"titleMessageAdd\",msg);}},showTyping:function(){if($defined(this.typingHeading)){return;}this.typingHeading=ItemUtility.createChatTypingHeading(this.user);this.typingHeading.inject(this.chatContent);this.scroll.toBottom();this.hideTyping.delay(9000,this);},hideTyping:function(){if($defined(this.typingHeading)){this.typingHeading.destroy();this.typingHeading=null;}},sendTyping:function(){if(this.typingSent||!this.user.online){return;}this.typingSent=true;this.fireEvent(\"sendTyping\",this.user);this.resetTypingSent.delay(6000,this);},resetTypingSent:function(){this.typingSent=false;}});var Invite=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"searchUserShow\",\"searchEmailShow\",\"inviteUserShow\"],userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){},userLoggedOut:function(){},searchUserShow:function(){if($defined(this.searchUserPopup)){this.searchUserPopup._select();return;}this.createSearchUserPopup();},closeSearchUserPopup:function(){if($defined(this.searchUserPopup)){this.searchUserPopup.close();}},createSearchUserPopup:function(){this.searchUserPopup=new Popup({size:{x:350,y:110},resizable:false,dockable:false,className:\"userSearch\",onClose:this.destroySearchUserPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"search\"},displayName:\"Search for Users on Pip.io\",closable:true});var content=new UserSearchPopupContent({});this.searchUserPopup.addContent(\"login\",nav,content);},destroySearchUserPopup:function(){this.searchUserPopup=null;},searchEmailShow:function(){if($defined(this.searchEmailPopup)){this.searchEmailPopup._select();return;}this.createSearchEmailPopup();},closeSearchEmailPopup:function(){if($defined(this.searchEmailPopup)){this.searchEmailPopup.close();}},createSearchEmailPopup:function(){this.searchEmailPopup=new Popup({size:{x:350,y:140},resizable:false,dockable:false,className:\"userSearch\",onClose:this.destroySearchEmailPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"search\"},displayName:\"Search Contacts for Pip.io Users\",closable:true});var content=new EmailSearchPopupContent({});this.searchEmailPopup.addContent(\"login\",nav,content);},destroySearchEmailPopup:function(){this.searchEmailPopup=null;},inviteUserShow:function(email){if($defined(this.inviteUserPopup)){this.inviteUserPopup._select();return;}this.createInviteUserPopup(email);},closeInviteUserPopup:function(){if($defined(this.inviteUserPopup)){this.inviteUserPopup.close();}},createInviteUserPopup:function(email){this.inviteUserPopup=new Popup({size:{x:350,y:160},resizable:false,dockable:false,className:\"userSearch\",onClose:this.destroyInviteUserPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"users\"},displayName:\"Invite Friend to Join Pip.io\",closable:true});var content=new UserInvitePopupContent({email:email});this.inviteUserPopup.addContent(\"login\",nav,content);},destroyInviteUserPopup:function(){this.inviteUserPopup=null;}});var EmailSearchPopupContent=new Class({Extends:PopupContent,strings:{emailLabel:\"Email:\",passwordLabel:\"Password:\",userSearchMessage:\"Search your email contacts for Pip.io users\"},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":this.strings.userSearchMessage}).inject(this.content);this.emailInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"50\"});this.emailInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"input_section email\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.emailLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.emailInput)).inject(this.content);this.passwordInput=new Element(\"input\",{\"type\":\"password\",\"maxlength\":\"50\"});this.passwordInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"input_section email\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.passwordLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.passwordInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Search\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.search.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.passwordInput.value.trim()!=\"\"&&this.emailInput.value.trim()!=\"\"){this.search();}}},search:function(){var email_address=this.emailInput.value.trim();var password=this.passwordInput.value.trim();var params={email_address:email_address,password:password};this.call(\"contacts\",\"search_email\",params,this.searchSuccess.bind(this),this.searchFail.bind(this));this.actionButton.showProgress();},searchSuccess:function(data){this.actionButton.hideProgress();if(!$defined(data.users)&&!$defined(data.contacts)){return;}if(data.users.length==0&&data.contacts.length==0){var name=\"search_user\";var title=\"No Results\";var message=\"Your search returned no results\";this.fireEvent(\"showAlert\",name,title,message);}else{this.showResultsPopup(data.users,data.contacts);}},searchFail:function(status){this.actionButton.hideProgress();var name=\"search_user\";var title=\"Error\";var message=status.message;this.fireEvent(\"showAlert\",name,title,message);},showResultsPopup:function(users,contacts){if($defined(this.resultsPopup)){this.resultsPopup.close();}this.createResultsPopup(users,contacts);},closeResultsPopup:function(){if($defined(this.resultsPopup)){this.resultsPopup.close();}},createResultsPopup:function(users,contacts){this.resultsPopup=new Popup({size:{x:350,y:400},resizable:false,dockable:false,className:\"userSearch\",onClose:this.destroyResultsPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"search\"},displayName:\"Search Results\",closable:true});var content=new UserSearchResultPopupContent({users:users,contacts:contacts});this.resultsPopup.addContent(\"results\",nav,content);},destroyResultsPopup:function(){this.resultsPopup=null;},onShow:function(){this.focus();},focus:function(){this.emailInput.focus.delay(500,this.emailInput);},onClose:function(){this.closeResultsPopup();}});var UserInvitePopupContent=new Class({Extends:PopupContent,strings:{emailLabel:\"Email:\",messageLabel:\"Message:\",defaultMessage:\"Connect with me on Pip.io!\"},onBeforeInit:function(options){this.email=options.email;return options;},onInit:function(){this.emailInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"50\",\"value\":this.email});new Element(\"div\",{\"class\":\"input_section email\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.emailLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.emailInput)).inject(this.content);this.messageInput=new Element(\"textarea\",{\"value\":TextUtility.unescape(this.strings.defaultMessage)});new Element(\"div\",{\"class\":\"input_section email message\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.messageLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.messageInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Send Invite\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.sendInvite.bind(this));this.message=new Element(\"div\",{\"class\":\"message success\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},sendInvite:function(){var email=this.emailInput.value.trim();var message=this.messageInput.value.trim();if(email==\"\"){var name=\"invite_user\";var title=\"Error\";var message=\"Please enter an email address\";this.fireEvent(\"showAlert\",name,title,message);return;}var params={email:email,message:message};this.call(\"contacts\",\"invite_create\",params,this.sendInviteSuccess.bind(this),this.sendInviteFail.bind(this));this.actionButton.showProgress();this.message.empty();},sendInviteSuccess:function(){this.actionButton.hideProgress();this.emailInput.value=\"\";this.message.set(\"text\",\"Invite sent\");},sendInviteFail:function(status){this.actionButton.hideProgress();var name=\"invite_user\";var title=\"Error\";var message=status.message;this.fireEvent(\"showAlert\",name,title,message);}});var UserSearchPopupContent=new Class({Extends:PopupContent,strings:{userSearchMessage:\"You can enter a name or email to search\",errorMessage:\"There was an error creating this group\"},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":this.strings.userSearchMessage}).inject(this.content);this.searchInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"50\"});this.searchInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.searchInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Search\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.search.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.searchInput.value.trim()!=\"\"){this.search();}}},search:function(){var query=this.searchInput.value.trim();var params={query:query};this.call(\"contacts\",\"search_user\",params,this.searchSuccess.bind(this),this.searchFail.bind(this));this.actionButton.showProgress();},searchSuccess:function(data){this.actionButton.hideProgress();if(!$defined(data.users)&&!$defined(data.contacts)){return;}if(data.users.length==0&&data.contacts.length==0){var name=\"search_user\";var title=\"No Results\";var message=\"Your search returned no results\";this.fireEvent(\"showAlert\",name,title,message);}else{this.showResultsPopup(data.users,data.contacts);}},searchFail:function(status){this.actionButton.hideProgress();var name=\"search_user\";var title=\"Error\";var message=status.message;this.fireEvent(\"showAlert\",name,title,message);},showResultsPopup:function(users,contacts){if($defined(this.resultsPopup)){this.resultsPopup.close();}this.createResultsPopup(users,contacts);},closeResultsPopup:function(){if($defined(this.resultsPopup)){this.resultsPopup.close();}},createResultsPopup:function(users,contacts){this.resultsPopup=new Popup({size:{x:350,y:400},resizable:false,dockable:false,className:\"userSearch\",onClose:this.destroyResultsPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"search\"},displayName:\"Search Results\",closable:true});var content=new UserSearchResultPopupContent({users:users,contacts:contacts});this.resultsPopup.addContent(\"results\",nav,content);},destroyResultsPopup:function(){this.resultsPopup=null;},onShow:function(){this.focus();},focus:function(){this.searchInput.focus.delay(500,this.searchInput);},onClose:function(){this.closeResultsPopup();}});var UserSearchResultPopupContent=new Class({Extends:PopupContent,strings:{searchResultMessage:\"Search results\"},onBeforeInit:function(options){this.users=options.users;this.contacts=options.contacts;return options;},onInit:function(){this.list=new Element(\"div\",{\"class\":\"itemList\"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Close\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.closeButton)).inject(this.content);if(this.users.length>0){this.insertUsers();this.insertSeperator();}this.insertContacts();},insertContacts:function(){$H(this.contacts).each(function(name,email){this.insertContact(name,email);},this);},insertContact:function(name,email){var el=UserSearchUtility.createEmailItem(name,email);var button=new ButtonSmall({displayName:\"Send Invite\",className:\"dark\",action:\"check\"});$(button).inject(el);$(button).addEvent(\"click\",this.fireEvent.bind(this,[\"inviteUserShow\",email]));el.inject(this.list);},insertUsers:function(){this.users.each(function(user){user=UserUtility.processUser(user);this.insertUser(user);},this);},insertUser:function(user){var el=UserSearchUtility.createUserItem(user);if(!this.hasContact(user.username)){var button=new ButtonSmall({displayName:\"Add Contact\",className:\"dark\",action:\"check\"});$(button).inject(el);$(button).addEvent(\"click\",this.contactRequest.bindWithEvent(this,[user.username,el]));}else{el.addClass(\"connected\");}el.addEvent(\"click\",this.fireEvent.bind(this,[\"showUser\",user]));el.inject(this.list);},insertSeperator:function(){new Element(\"div\",{\"class\":\"listItem seperator\"}).inject(this.list);},contactRequest:function(e,username,el){e.stopPropagation();this.fireEvent(\"connectionRequestCreate\",username);el.addClass(\"invited\");}});var UserSearchUtility={createUserItem:function(user){var el=new Element(\"div\",{\"class\":\"listItem user\"});ItemUtility.createProfilePic(user,32).inject(el);var name=new Element(\"div\",{\"class\":\"listText text12 light\",\"text\":TextUtility.cleanText(user.fullname+\" (\"+user.username+\")\")}).inject(el);if($defined(user.about)&&$defined(user.about.bio)){new Element(\"div\",{\"class\":\"about_text text11 light3\",\"text\":TextUtility.cleanText(user.about.bio)}).inject(el);}new Element(\"div\",{\"class\":\"invited_text text11 success\",\"text\":\"Request Sent\"}).inject(el);new Element(\"div\",{\"class\":\"connected_text text11 success\",\"text\":\"Connected\"}).inject(el);return el;},createEmailItem:function(name,email){var el=new Element(\"div\",{\"class\":\"listItem\"});var icon=new Icon20({iconName:\"users\"});$(icon).inject(el);new Element(\"div\",{\"class\":\"listText text12 light\",\"text\":TextUtility.cleanText(email)}).inject(el);var button=new ButtonSmall({displayName:\"Invite\",className:\"dark\",action:\"check\"});$(button).inject(el);new Element(\"div\",{\"class\":\"invited_text text11 success\",\"text\":\"Invited\"}).inject(el);return el;}};var Location=new Class({Extends:Base,EventHandlers:[\"showLocationEditPopup\",\"showUsersMapPopup\"],init:function(){},reset:function(){},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){},userLoggedOut:function(){this.closeLocationEditPopup();},showLocationEditPopup:function(){this.closeLocationEditPopup();this.createLocationEditPopup();},closeLocationEditPopup:function(){if($defined(this.locationEditPopup)){this.locationEditPopup.close();}},createLocationEditPopup:function(){this.locationEditPopup=new Popup({size:{x:350,y:110},resizable:false,dockable:false,closable:true,className:\"locationSearch\",onClose:(function(){this.locationEditPopup=null;}).bind(this)});var nav=new Nav({iconOptions:{iconName:\"global\"},displayName:\"Edit Your Location\",closable:true});var content=new UserLocationEditPopupContent({});content.resizePopup=this.locationEditPopup.resizePopup.bind(this.locationEditPopup);content.reCenter=this.locationEditPopup.reCenter.bind(this.locationEditPopup);this.locationEditPopup.addContent(\"edit_location\",nav,content);},showUsersMapPopup:function(user){this.closeUsersMapPopup();this.createUsersMapPopup(user);},closeUsersMapPopup:function(){if($defined(this.usersMapPopup)){this.usersMapPopup.close();}},createUsersMapPopup:function(user){this.usersMapPopup=new Popup({size:{x:550,y:350},resizable:false,dockable:true,closable:true,className:\"usersMap\"});var nav=new Nav({iconOptions:{iconName:\"location\"},displayName:\"Global Map\",closable:true});var content=new UsersMapPopupContent({user:user,locations:this.getLocations()});this.usersMapPopup.addContent(\"users_maps\",nav,content);}});var GlobalMapMenuSection=new Class({Extends:Base,EventHandlers:[],init:function(options){this.location=options.location;this.createMap();},createMap:function(){this.wrapper=new Element(\"div\");this.updateMap();},updateMap:function(){this.wrapper.empty();if($defined(this.location)){this.mapWrapper=new Element(\"div\",{\"class\":\"gmap_content\"});this.expandButton=new Element(\"div\",{\"class\":\"button_nav show\"}).adopt(new Element(\"div\",{\"class\":\"action dock\"}));var map=new Element(\"div\",{\"class\":\"map_section\"}).adopt(new Element(\"div\",{\"class\":\"gmap\"}).adopt(new Element(\"div\",{\"class\":\"gmap_border\"}),this.mapWrapper));this.gmap=new GMap2(this.mapWrapper,{size:new GSize(156,156)});this.gmap.setCenter(new GLatLng(this.location.lat,this.location.lon),11);map.inject(this.wrapper);}this.updateLabel();},updateLabel:function(){if($defined(this.label)){this.label.destroy();}if($defined(this.location)){var locationLabel=DataUtility.getGeoLabel(this.location);var locationStr=DataUtility.getGeoLocality(this.location);if(locationLabel){locationStr=locationLabel+\", \"+locationStr;}this.label=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Location: \"}),new Element(\"span\",{\"html\":TextUtility.unescape(locationStr)})).inject(this.wrapper,\"top\");}},toElement:function(){return this.wrapper;}});var UserMapMenuSection=new Class({Extends:Base,EventHandlers:[\"userLocationUpdated\"],init:function(options){this.user=options.user;this.isSelf=this.user.user_id==this.getPrivateUser().user_id;this.location=this.getLocation(this.user.username);this.createMap();},createMap:function(){this.wrapper=new Element(\"div\");this.updateMap();},updateMap:function(){this.wrapper.empty();if($defined(this.location)){this.mapWrapper=new Element(\"div\",{\"class\":\"gmap_content\"});this.expandButton=new Element(\"div\",{\"class\":\"button_nav show\"}).adopt(new Element(\"div\",{\"class\":\"action dock\"}));this.expandButton.addEvent(\"click\",this.fireEvent.bind(this,[\"showUsersMapPopup\",this.user]));var map=new Element(\"div\",{\"class\":\"map_section\"}).adopt(new Element(\"div\",{\"class\":\"gmap\"}).adopt(new Element(\"div\",{\"class\":\"gmap_border\"}),this.mapWrapper),this.expandButton);this.gmap=new GMap2(this.mapWrapper,{size:new GSize(156,156)});this.gmap.setCenter(new GLatLng(this.location.lat,this.location.lon),11);this.profilePic=ItemUtility.createProfilePic(this.user,60);this.marker=new Element(\"div\",{\"class\":\"map_marker\"}).adopt(new Element(\"div\",{\"class\":\"profile_pic_wrapper\"}).adopt(this.profilePic),new Element(\"div\",{\"class\":\"point_down\"}),new Element(\"div\",{\"class\":\"spot\"})).inject(map);map.inject(this.wrapper);}else{ItemUtility.createProfilePic(this.user,100).inject(this.wrapper);}this.updateLabel();},userLocationUpdated:function(username,location,location_enabled){if(username!=this.user.username){return;}this.user.location_enabled=location_enabled;this.location=$defined(location)?location:null;this.updateMap();},updateLabel:function(){if($defined(this.label)){this.label.destroy();}if($defined(this.location)){var locationLabel=DataUtility.getGeoLabel(this.location);var locationStr=DataUtility.getGeoLocality(this.location);if(locationLabel){locationStr=locationLabel+\", \"+locationStr;}this.label=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Location: \"}),new Element(\"span\",{\"html\":TextUtility.unescape(locationStr)})).inject(this.wrapper,\"top\");}},toElement:function(){return this.wrapper;}});var LocationSearchResultPopupContent=new Class({Extends:PopupContent,strings:{searchResultMessage:\"Search results\"},onBeforeInit:function(options){this.locations=options.locations;this.locationSetFunc=options.locationSetFunc;return options;},onInit:function(){this.list=new Element(\"div\",{\"class\":\"itemList\"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Close\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.closeButton)).inject(this.content);this.insertLocations();},insertLocations:function(){this.locations.each(function(location){this.insertLocation(location);},this);},insertLocation:function(location){var el=LocationSearchUtility.createLocationItem(location);var button=new ButtonSmall({displayName:\"Set Location\",className:\"dark\",action:\"check\"});$(button).inject(el);$(button).addEvent(\"click\",this.setLocation.bind(this,location));el.inject(this.list);},setLocation:function(location){this.locationSetFunc(location);this.closeContent();}});var UserLocationEditPopupContent=new Class({Extends:PopupContent,strings:{locationSearchMessage:\"Enter any address, city, or zip code\",locationLabelLabel:\"Location Name:\"},onInit:function(){this.geocoder=new GClientGeocoder();this.searchTitle=new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":this.strings.locationSearchMessage}).inject(this.content);this.searchInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"50\"});this.searchInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));this.searchInputSection=new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.searchInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Search\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.search.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.searchInput.value.trim()!=\"\"){this.search();}}},search:function(){var query=this.searchInput.value.trim();this.geocoder.getLocations(query,this.searchSuccess.bind(this));this.actionButton.showProgress();},searchSuccess:function(data){this.actionButton.hideProgress();if(data.Status.code==200){this.places=[];data.Placemark.each(function(place){this.places.push(this.parseLocation(place));},this);this.createResultsPopup();}else{var name=\"search_location\";var title=\"No Results\";var message=\"Your search returned no results\";this.fireEvent(\"showAlert\",name,title,message);}},parseLocation:function(location){var place={};place.name=location.address;place.country_code=location.AddressDetails.Country.CountryNameCode;place.country=location.AddressDetails.Country.CountryName;place.region=$defined(location.AddressDetails.Country.AdministrativeArea)?location.AddressDetails.Country.AdministrativeArea.AdministrativeAreaName:null;if($defined(location.AddressDetails.Country.AdministrativeArea)&&$defined(location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea)&&$defined(location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality)){place.city=location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality.LocalityName;}else{if($defined(location.AddressDetails.Country.AddressLine)&&$defined(location.AddressDetails.Country.AddressLine[0])){place.city=location.AddressDetails.Country.AddressLine[0];}}if($defined(location.AddressDetails.Country.AdministrativeArea)&&$defined(location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea)&&$defined(location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality)&&$defined(location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality.Thoroughfare)){place.address=location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality.Thoroughfare.ThoroughfareName;}place.lat=location.Point.coordinates[1];place.lon=location.Point.coordinates[0];place.geohash=GeoHash.encodeGeoHash(place.lat,place.lon);return place;},locationSelect:function(location){DomUtility.hide(this.searchTitle);DomUtility.hide(this.searchInputSection);DomUtility.hide(this.actions);this.searchTitle=new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":TextUtility.unescape(location.name)}).inject(this.content);this.labelInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"50\"});if($defined(location.address)){this.labelInput.value=location.address;}new Element(\"div\",{\"class\":\"input_section label\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.locationLabelLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.labelInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Save Location\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.locationSave.bind(this,[location]));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},locationSave:function(location){var label=this.labelInput.value.trim();var params={\"label\":label,\"country_code\":location.country_code,\"country\":location.country,\"city\":$defined(location.city)?location.city:\"\",\"region\":$defined(location.region)?location.region:\"\",\"lat\":location.lat,\"lon\":location.lon,\"geohash\":location.geohash};this.call(\"pipio\",\"user_location_save\",params,this.locationSaveSuccess.bind(this),this.locationSaveFail.bind(this));this.actionButton.showProgress();},locationSaveSuccess:function(data){this.closeContent();},locationSaveFail:function(status){this.actionButton.hideProgress();},searchFail:function(status){this.actionButton.hideProgress();var name=\"search_user\";var title=\"Error\";var message=status.message;this.fireEvent(\"showAlert\",name,title,message);},showResultsPopup:function(users,contacts){if($defined(this.resultsPopup)){this.resultsPopup.close();}this.createResultsPopup(users,contacts);},closeResultsPopup:function(){if($defined(this.resultsPopup)){this.resultsPopup.close();}},createResultsPopup:function(){this.resultsPopup=new Popup({size:{x:350,y:400},resizable:false,dockable:false,className:\"locationSearch\",onClose:this.destroyResultsPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"global\"},displayName:\"Location Search Results\",closable:true});var content=new LocationSearchResultPopupContent({locations:this.places,locationSetFunc:this.locationSelect.bind(this)});this.resultsPopup.addContent(\"results\",nav,content);},destroyResultsPopup:function(){this.resultsPopup=null;},onShow:function(){this.focus();},focus:function(){this.searchInput.focus.delay(500,this.searchInput);},onClose:function(){this.closeResultsPopup();}});var UsersMapPopupContent=new Class({Extends:PopupContent,EventHandlers:[\"userLocationUpdated\"],onBeforeInit:function(options){this.user=options.user;this.locations=options.locations;this.users=$H();return options;},onInit:function(){this.createMap();this.showUser(this.user.username);this.locations.each(function(location,username){this.showUser(username);},this);},createMap:function(){this.mapWrapper=new Element(\"div\",{\"class\":\"gmap_content\"});var map=new Element(\"div\",{\"class\":\"map_section\"}).adopt(new Element(\"div\",{\"class\":\"gmap\"}).adopt(new Element(\"div\",{\"class\":\"gmap_border\"}),this.mapWrapper));this.gmap=new GMap2(this.mapWrapper,{size:new GSize(526,326)});var location=this.getLocation(this.user.username);this.gmap.setCenter(new GLatLng(location.lat,location.lon),11);this.gmap.enableScrollWheelZoom();this.gmap.enableContinuousZoom();this.gmap.addControl(new GLargeMapControl());this.gmap.addControl(new GMapTypeControl());var mt=this.gmap.getMapTypes();for(var i=0;i<mt.length;i++){mt[i].getMinimumResolution=$lambda(3);mt[i].getMaximumResolution=$lambda(14);}map.inject(this.content);},userLocationUpdated:function(username,location,location_enabled){if($defined(location)){this.showUser(username);}else{this.removeUser(username);}},showUser:function(username){var user=this.getUser(username);var location=this.getLocation(username);if(!$defined(user)||!$defined(location)){return;}if(this.users.has(username)){this.gmap.removeOverlay(this.users.get(username));}var loc=new GLatLng(location.lat,location.lon);var marker=new MarkerLight(loc,{size:26,user:user});this.gmap.addOverlay(marker);this.users.set(username,marker);},removeUser:function(username){if(!this.users.has(username)){return;}this.gmap.removeOverlay(this.users.get(username));}});var LocationSearchUtility={createLocationItem:function(location){var el=new Element(\"div\",{\"class\":\"listItem\"});var icon=new Icon20({iconName:\"location\"});$(icon).inject(el);var name=new Element(\"div\",{\"class\":\"listText text12 light\",\"text\":TextUtility.cleanText(location.name)}).inject(el);return el;}};var Login=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"loginShow\",\"signupShow\",\"logoutShow\",\"passwordResetRequestShow\"],userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.closeLoginPopup();this.closePasswordResetRequestPopup();this.closePasswordResetPopup();this.closeSignupPopup();},userLoggedOut:function(){if(!this.checkCookie()){this.loginShow();}},checkCookie:function(){var destination=DataUtility.getCookie(\"destination\");var token=DataUtility.getCookie(\"password_reset_token\");var email=DataUtility.getCookie(\"password_reset_email\");if(!$defined(destination)){return false;}if(destination==\"password_reset\"&&$defined(token)&&$defined(email)){this.passwordResetShow(token,email);return true;}else{if(destination==\"signup\"){var access_key=DataUtility.getCookie(\"invite_access_key\");if(!$defined(access_key)){access_key=\"\";}this.signupShow(access_key);return true;}else{if(destination==\"email_block\"){var token=DataUtility.getCookie(\"email_block_token\");var email=DataUtility.getCookie(\"email_block_email\");this.emailBlockShow(token,email);return true;}}}return false;},loginShow:function(){if($defined(this.loginPopup)){this.loginPopup._select();return;}this.createLoginPopup();},closeLoginPopup:function(){if($defined(this.loginPopup)){this.loginPopup.close();}},createLoginPopup:function(){this.loginPopup=new Popup({size:{x:350,y:226},resizable:false,dockable:false,className:\"login\",onClose:this.destroyLoginPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"power\"},displayName:\"Log In to Pip.io\",closable:true});var content=new LoginPopupContent({});this.loginPopup.addContent(\"login\",nav,content);},destroyLoginPopup:function(){this.loginPopup=null;},logoutShow:function(){if($defined(this.logoutPopup)){this.logoutPopup._select();return;}this.createLogoutPopup();},closeLogoutPopup:function(){if($defined(this.logoutPopup)){this.logoutPopup.close();}},createLogoutPopup:function(){this.logoutPopup=new Popup({size:{x:350,y:70},resizable:false,dockable:false,onClose:this.destroyLogoutPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"power\"},displayName:\"Log Out \"+TextUtility.unescapeQuotes(this.getPrivateUser().fullname),closable:true});var content=new LogoutPopupContent({});this.logoutPopup.addContent(\"logout\",nav,content);},destroyLogoutPopup:function(){this.logoutPopup=null;},passwordResetRequestShow:function(){if($defined(this.passwordResetRequestPopup)){this.passwordResetRequestPopup.close();}this.createPasswordResetRequestPopup();},closePasswordResetRequestPopup:function(){if($defined(this.passwordResetRequestPopup)){this.passwordResetRequestPopup.close();}},createPasswordResetRequestPopup:function(){this.passwordResetRequestPopup=new Popup({size:{x:350,y:112},resizable:false,dockable:false,className:\"login\",onClose:this.destroyPasswordResetRequestPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"pipio\"},displayName:\"Password Reset\",closable:true});var content=new PasswordResetRequestPopupContent({});this.passwordResetRequestPopup.addContent(\"login\",nav,content);},destroyPasswordResetRequestPopup:function(){this.passwordResetRequestPopup=null;},passwordResetShow:function(token,email){if($defined(this.passwordResetPopup)){this.passwordResetPopup.close();}this.createPasswordResetPopup(token,email);},closePasswordResetPopup:function(){if($defined(this.passwordResetPopup)){this.passwordResetPopup.close();}},createPasswordResetPopup:function(token,email){this.passwordResetPopup=new Popup({size:{x:350,y:142},resizable:false,dockable:false,className:\"login\",onClose:this.destroyPasswordResetPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"pipio\"},displayName:\"Password Reset\",closable:true});var content=new PasswordResetPopupContent({token:token,email:email});this.passwordResetPopup.addContent(\"login\",nav,content);},destroyPasswordResetPopup:function(){this.passwordResetPopup=null;},signupShow:function(access_key){if($defined(this.signupPopup)){this.signupPopup._select();return;}this.createSignupPopup(access_key);},closeSignupPopup:function(){if($defined(this.signupPopup)){this.signupPopup.close();}},createSignupPopup:function(access_key){this.signupPopup=new Popup({size:{x:350,y:366},resizable:false,dockable:false,className:\"login\",onClose:this.destroySignupPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"pipio\"},displayName:\"Sign Up for Pip.io\",closable:true});if(!$defined(access_key)){access_key=\"\";}var content=new SignupPopupContent({access_key:access_key});this.signupPopup.addContent(\"signup\",nav,content);},destroySignupPopup:function(){this.signupPopup=null;},emailBlockShow:function(token,email){if($defined(this.emailBlockPopup)){this.emailBlockPopup.close();}this.createEmailBlockPopup(token,email);},closeEmailBlockPopup:function(){if($defined(this.signupPopup)){this.emailBlockPopup.close();}},createEmailBlockPopup:function(token,email){this.emailBlockPopup=new Popup({size:{x:350,y:110},resizable:false,dockable:false,className:\"login\",onClose:this.destroyEmailBlockPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"pipio\"},displayName:\"Email Settings\",closable:true});var content=new EmailBlockPopupContent({token:token,email:email});this.emailBlockPopup.addContent(\"emailblock\",nav,content);},destroyEmailBlockPopup:function(){this.emailBlockPopup=null;}});var EmailBlockPopupContent=new Class({Extends:PopupContent,strings:{emailBlockMessage:\"Stop all Pip.io emails for:\"},onBeforeInit:function(options){this.token=options.token;this.email=options.email;return options;},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":TextUtility.unescape(this.strings.emailBlockMessage)}).inject(this.content);new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":TextUtility.unescape(this.email)}).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Confirm\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.blockEmail.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},blockEmail:function(){var params={\"token\":this.token,\"email\":this.email};this.call(\"pipio\",\"email_block\",params,this.resetRequestSuccess.bind(this),this.resetRequestFail.bind(this));this.actionButton.showProgress();},resetRequestSuccess:function(data){var name=\"email_block\";var title=\"Email Block Successful\";var message=\"You will no longer receive emails from Pip.io\";this.fireEvent(\"showAlert\",name,title,message);this.actionButton.hideProgress();this.closeContent();},resetRequestFail:function(){var name=\"email_block\";var title=\"Email Block Failed\";var message=\"There was an error processing your request.  Please contact support@pip.io\";this.fireEvent(\"showAlert\",name,title,message);this.actionButton.hideProgress();}});var LoginPopupContent=new Class({Extends:PopupContent,strings:{loginMessage:\"Log in to Pip.io\",signupMessage:\"Don't have an account?   Sign up now!\",usernameLabel:\"Username or email:\",passwordLabel:\"Password:\",rememberMeLabel:\"Remember me:\",errorMessage:\"Incorrect login\",forgotPasswordMessage:\"Forgot your password?\"},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":this.strings.loginMessage}).inject(this.content);var signupMsg=new Element(\"div\",{\"class\":\"text_section centered short text11 light3 clickable\",\"text\":this.strings.signupMessage}).inject(this.content);signupMsg.addEvent(\"click\",this.fireEvent.bind(this,[\"signupShow\"]));this.usernameInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"32\"});this.usernameInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.usernameLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.usernameInput)).inject(this.content);this.passwordInput=new Element(\"input\",{\"type\":\"password\",\"maxlength\":\"32\"});this.passwordInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.passwordLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.passwordInput)).inject(this.content);this.rememberToggle=new Toggle(true);new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.rememberMeLabel}),$(this.rememberToggle)).inject(this.content);var forgotPasswordMsg=new Element(\"div\",{\"class\":\"text_section centered short text11 light3 clickable\",\"text\":this.strings.forgotPasswordMessage}).inject(this.content);forgotPasswordMsg.addEvent(\"click\",this.fireEvent.bind(this,[\"passwordResetRequestShow\"]));this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Log In\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.login.bind(this));this.message=new Element(\"div\",{\"class\":\"message error\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},login:function(){var username=this.usernameInput.value.trim();var password=this.passwordInput.value.trim();var remember_me=this.rememberToggle.toInt();var params={\"username\":username,\"password\":password,\"remember_me\":remember_me};this.call(\"pipio\",\"user_login\",params,this.loginSuccess.bind(this),this.loginFail.bind(this));this.actionButton.showProgress();this.message.empty();},loginSuccess:function(data){this.fireEvent(\"userDataInit\",data);this.actionButton.hideProgress();this.closeContent();},loginFail:function(){this.actionButton.hideProgress();this.message.set(\"text\",this.strings.errorMessage);},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.usernameInput.value.trim()!=\"\"&&this.passwordInput.value.trim()!=\"\"){this.login();}}},onShow:function(){this.focus();},focus:function(){this.usernameInput.focus.delay(500,this.usernameInput);}});var LogoutPopupContent=new Class({Extends:PopupContent,strings:{logoutMessage:\"Are you sure you want to log out?\"},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":this.strings.logoutMessage}).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Log Out\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.logout.bind(this));this.message=new Element(\"div\",{\"class\":\"message\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},logout:function(){this.call(\"pipio\",\"user_logout\",null,this.logoutSuccess.bind(this),this.logoutFail.bind(this));this.actionButton.showProgress();},logoutSuccess:function(data){this.fireEvent(\"userDataInit\",data);this.actionButton.hideProgress();this.closeContent();},logoutFail:function(){this.actionButton.hideProgress();this.closeContent();}});var PasswordResetPopupContent=new Class({Extends:PopupContent,strings:{passwordResetMessage:\"Reset Pip.io password for {0}\",passwordLabel:\"New password:\",verifyPasswordLabel:\"Verify password\"},onBeforeInit:function(options){this.token=options.token;this.email=options.email;return options;},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":String.format(this.strings.passwordResetMessage,TextUtility.unescape(this.email))}).inject(this.content);this.passwordInput=new Element(\"input\",{\"type\":\"password\",\"maxlength\":\"32\"});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.passwordLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.passwordInput)).inject(this.content);this.verifyPasswordInput=new Element(\"input\",{\"type\":\"password\",\"maxlength\":\"32\"});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.verifyPasswordLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.verifyPasswordInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Set New Password\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.resetRequest.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},resetRequest:function(){var new_password=this.passwordInput.value.trim();var verify_password=this.verifyPasswordInput.value.trim();if(new_password==\"\"||verify_password==\"\"){var name=\"reset_request\";var title=\"Password Reset Request Failed\";var message=\"Please enter a new password\";this.fireEvent(\"showAlert\",name,title,message);return;}if(new_password!=verify_password){var name=\"reset_request\";var title=\"Password Reset Request Failed\";var message=\"The passwords you entered do not match\";this.fireEvent(\"showAlert\",name,title,message);return;}var params={\"token\":this.token,\"email\":this.email,\"new_password\":new_password,\"verify_password\":verify_password};this.call(\"pipio\",\"user_password_reset\",params,this.resetRequestSuccess.bind(this),this.resetRequestFail.bind(this));this.actionButton.showProgress();},resetRequestSuccess:function(data){var name=\"reset_request\";var title=\"Password Reset Successful\";var message=\"Your Pip.io password has been successfully reset\";this.fireEvent(\"loginShow\");this.fireEvent(\"showAlert\",name,title,message);this.actionButton.hideProgress();this.closeContent();},resetRequestFail:function(){var name=\"reset_request\";var title=\"Password Reset Failed\";var message=\"There was an error resetting your password.  Please contact support@pip.io\";this.fireEvent(\"showAlert\",name,title,message);this.actionButton.hideProgress();},onShow:function(){this.focus();},focus:function(){this.passwordInput.focus.delay(500,this.passwordInput);}});var PasswordResetRequestPopupContent=new Class({Extends:PopupContent,strings:{passwordResetMessage:\"Forgot your password to Pip.io?\",usernameLabel:\"Username or email:\",forgotPasswordMessage:\"Forgot your password?\"},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":this.strings.passwordResetMessage}).inject(this.content);this.usernameInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"32\"});this.usernameInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.usernameLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.usernameInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Request Reset\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.resetRequest.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},resetRequest:function(){var username=this.usernameInput.value.trim();if(username==\"\"){var name=\"reset_request\";var title=\"Password Reset Request Failed\";var message=\"Please enter your username or email\";this.fireEvent(\"showAlert\",name,title,message);return;}var params={\"username\":username};this.call(\"pipio\",\"user_password_resetrequest\",params,this.resetRequestSuccess.bind(this),this.resetRequestFail.bind(this));this.actionButton.showProgress();},resetRequestSuccess:function(data){var name=\"reset_request\";var title=\"Password Reset Request Sent\";var message=\"Please check your email for directions to reset your password\";this.fireEvent(\"showAlert\",name,title,message);this.actionButton.hideProgress();this.closeContent();},resetRequestFail:function(){var name=\"reset_request\";var title=\"Password Reset Request Failed\";var message=\"We could not locate your account, please make sure the username or email you entered is correct\";this.fireEvent(\"showAlert\",name,title,message);this.actionButton.hideProgress();},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.usernameInput.value.trim()!=\"\"){this.resetRequest();}}},onShow:function(){this.focus();},focus:function(){this.usernameInput.focus.delay(500,this.usernameInput);}});var SignupPopupContent=new Class({Extends:PopupContent,strings:{signUpMessage:\"Sign up for Pip.io\",signUpDetailMessage:\"It only takes a few seconds to create an account!\",usernameLabel:\"Username:\",passwordLabel:\"Password:\",firstNameLabel:\"First Name:\",lastNameLabel:\"Last Name:\",emailLabel:\"Email:\",dobLabel:\"Date of Birth:\",inviteCodeLabel:\"Invite Code:\",inviteCodeMessage:\"Leave this field blank if you do not have an invite code\"},onBeforeInit:function(options){this.access_key=options.access_key;return options;},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":this.strings.signUpMessage}).inject(this.content);new Element(\"div\",{\"class\":\"text_section centered light short text11 light3\",\"text\":this.strings.signUpDetailMessage}).inject(this.content);this.firstNameInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"50\"});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.firstNameLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.firstNameInput)).inject(this.content);this.lastNameInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"50\"});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.lastNameLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.lastNameInput)).inject(this.content);this.emailInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"32\"});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.emailLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.emailInput)).inject(this.content);this.usernameInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"32\"});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.usernameLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.usernameInput)).inject(this.content);this.passwordInput=new Element(\"input\",{\"type\":\"password\",\"maxlength\":\"32\"});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.passwordLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.passwordInput)).inject(this.content);this.monthInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"2\",\"value\":\"MM\"});this.dayInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"2\",\"value\":\"DD\"});this.yearInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"4\",\"value\":\"YYYY\"});this.monthInput.addEvent(\"click\",this.clearField.bind(this,[this.monthInput,\"MM\"]));this.dayInput.addEvent(\"click\",this.clearField.bind(this,[this.dayInput,\"DD\"]));this.yearInput.addEvent(\"click\",this.clearField.bind(this,[this.yearInput,\"YYYY\"]));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.dobLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper month\"}).adopt(this.monthInput),new Element(\"div\",{\"class\":\"textarea_wrapper day\"}).adopt(this.dayInput),new Element(\"div\",{\"class\":\"textarea_wrapper year\"}).adopt(this.yearInput)).inject(this.content);this.inviteCodeInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"10\",\"value\":this.access_key});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.inviteCodeLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.inviteCodeInput)).inject(this.content);new Element(\"div\",{\"class\":\"text_section centered light short text11 light3\",\"text\":this.strings.inviteCodeMessage}).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Sign Up\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.signup.bind(this));this.message=new Element(\"div\",{\"class\":\"message success\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},clearField:function(el,def){if(el.value==def){el.value=\"\";}},signup:function(){var first_name=this.firstNameInput.value.trim();var last_name=this.lastNameInput.value.trim();var username=this.usernameInput.value.trim();var password=this.passwordInput.value.trim();var email=this.emailInput.value.trim();var dob_month=this.monthInput.value.trim();var dob_day=this.dayInput.value.trim();var dob_year=this.yearInput.value.trim();var access_key=this.inviteCodeInput.value.trim();if(first_name==\"\"||last_name==\"\"){this.signupFail({message:\"Please enter your name\"});return;}if(email==\"\"){this.signupFail({message:\"Please enter your email\"});return;}if(username==\"\"){this.signupFail({message:\"Please enter a username\"});return;}if(password==\"\"){this.signupFail({message:\"Please enter a password\"});return;}if(dob_month!=parseInt(dob_month)||dob_month<1||dob_month>12){this.signupFail({message:\"Please enter a valid month\"});return;}if(dob_day!=parseInt(dob_day)||dob_day<1||dob_day>31){this.signupFail({message:\"Please enter a valid day\"});return;}if(dob_year!=parseInt(dob_year)||dob_year<1900||dob_year>2010){this.signupFail({message:\"Please enter a valid year\"});return;}var params={\"first_name\":first_name,\"last_name\":last_name,\"username\":username,\"password\":password,\"email\":email,\"dob_month\":dob_month,\"dob_day\":dob_day,\"dob_year\":dob_year,\"access_key\":access_key};this.call(\"pipio\",\"user_register\",params,this.signupSuccess.bind(this),this.signupFail.bind(this));this.actionButton.showProgress();this.message.set(\"text\",\"please wait...\");},signupSuccess:function(data){this.fireEvent(\"userDataInit\",data);this.actionButton.hideProgress();this.closeContent();this.message.set(\"success!\");},signupFail:function(status){this.actionButton.hideProgress();var name=\"user_register\";var title=\"Error\";var message=status.message;this.message.empty();this.fireEvent(\"showAlert\",name,title,message);},onShow:function(){this.focus();},focus:function(){this.firstNameInput.focus.delay(500,this.firstNameInput);}});var Notifications=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"notificationAdd\",\"titleMessageAdd\",\"titleMessageDelete\"],init:function(){this.notifications=$H();this.timers=$H();this.messages=[];this.messageTimer=0;this.createNotifications();},titleMessageAdd:function(message){if(this.messages.contains(message)){return;}this.messages.push(message);this.titleMessageCheck();},titleMessageDelete:function(message){if(this.messages.contains(message)){this.messages.erase(message);}this.titleMessageCheck();},titleMessageCheck:function(){if(this.messages.length>0&&this.messageTimer==0){this.messageTimer=this.titleMessageRotate.periodical(2000,this);}else{if(this.messages.length==0&&this.messageTimer!=0){$clear(this.messageTimer);document.title=this.getPageTitle();}}},titleMessageRotate:function(){if(this.messages.length==0){return;}if(!$defined(this.currentTitle)){this.currentTitle=this.getPageTitle();}if(this.getPageTitle()==this.currentTitle){var msg=this.messages.shift();this.messages.push(msg);document.title=msg;this.currentTitle=msg;}else{document.title=this.getPageTitle();this.currentTitle=this.getPageTitle();}},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.notifications=$H();},userLoggedOut:function(){this.closeAll();this.notifications=$H();},closeAll:function(){this.notifications.getKeys().each(function(name){this.close(name);},this);},close:function(name){if(!this.notifications.has(name)){return;}var notif=this.notifications.get(name);DomUtility.fadeOutDestroy($(notif));this.notifications.erase(name);$clear(this.timers.get(name));this.timers.erase(name);delete (notif);this.checkShow();},notificationAdd:function(name,notif){if(this.notifications.has(name)){return;}$(notif).inject(this.menu);DomUtility.fadeIn($(notif),1000);this.notifications.set(name,notif);notif.onClose=this.close.bind(this,name);var timer=this.close.delay(notif.timeout,this,[name]);this.timers.set(name,timer);this.checkShow();},checkShow:function(){if(this.notifications.getLength()>0){DomUtility.show(this.menu);}else{DomUtility.hide(this.menu);}},createNotifications:function(){this.menu=new Element(\"div\",{\"class\":\"menu flattop\"});this.menu.inject(\"notifications\");this.checkShow();}});var Notification=new Class({Extends:Base,init:function(options){if($defined(this.onBeforeInit)){options=this.onBeforeInit(options);}this.iconOptions=options.iconOptions;this.timeout=options.timeout||5000;this.hasActions=options.hasActions||false;this.createNotification();if($defined(this.onInit)){this.onInit();}},createNotification:function(){this.notif=new Element(\"div\",{\"class\":\"notification\"});this.icon=new Icon20(this.iconOptions);$(this.icon).inject(this.notif);this.closeButton=new Element(\"div\",{\"class\":\"button_nav show\"}).adopt(new Element(\"div\",{\"class\":\"action close\"})).inject(this.notif);this.closeButton.addEvent(\"click\",this.closeNotification.bind(this));this.getText().inject(this.notif);if(this.hasActions){this.actions=new Element(\"div\",{\"class\":\"actions\"}).inject(this.notif);}},getText:function(){return new Element(\"div\",{\"class\":\"notification_text text11 light1\"});},closeNotification:function(){if($defined(this.onClose)){this.onClose();}},toElement:function(){return this.notif;}});var Settings=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"showSettings\"],userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){},userLoggedOut:function(){this.closeSettings();},showSettings:function(){this.closeSettings();this.settingsPopup=new Popup({size:{x:350,y:368},resizable:false,dockable:false,className:\"settings\",onClose:this.destroySettings.bind(this)});var nav=new Nav({iconOptions:{iconName:\"settings\"},displayName:\"Pip.io Settings\",closable:true});var content=new PipioSettingsPopupContent();this.settingsPopup.addContent(\"pipio_settings\",nav,content);},closeSettings:function(){if($defined(this.settingsPopup)){this.settingsPopup.close();}},destroySettings:function(){this.settingsPopup=null;}});var EmailChangePopupContent=new Class({Extends:PopupContent,strings:{emailLabel:\"Email:\"},onInit:function(){this.emailInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"200\"});this.emailInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.emailLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.emailInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Update Email\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.changeEmail.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.emailInput.value.trim()!=\"\"){this.changeEmail();}}},changeEmail:function(){var email=this.emailInput.value.trim();var params={email:email};this.call(\"pipio\",\"user_email_change\",params,this.changeEmailSuccess.bind(this),this.changeEmailFail.bind(this));this.actionButton.showProgress();},changeEmailSuccess:function(){this.actionButton.hideProgress();this.closeContent();},changeEmailFail:function(status){this.actionButton.hideProgress();var name=\"email_change\";var title=\"Error Updating Email\";var message=status.message;this.fireEvent(\"showAlert\",name,title,message);},onShow:function(){this.focus();},focus:function(){this.emailInput.focus.delay(500,this.emailInput);}});var PasswordChangePopupContent=new Class({Extends:PopupContent,strings:{passwordLabel:\"Current Password:\",newPasswordLabel:\"New Password:\",verifyPasswordLabel:\"Verify Password:\"},onInit:function(){this.passwordInput=new Element(\"input\",{\"type\":\"password\",\"maxlength\":\"50\"});new Element(\"div\",{\"class\":\"input_section passwordChange\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.passwordLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.passwordInput)).inject(this.content);this.newPasswordInput=new Element(\"input\",{\"type\":\"password\",\"maxlength\":\"50\"});new Element(\"div\",{\"class\":\"input_section passwordChange\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.newPasswordLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.newPasswordInput)).inject(this.content);this.verifyPasswordInput=new Element(\"input\",{\"type\":\"password\",\"maxlength\":\"50\"});new Element(\"div\",{\"class\":\"input_section passwordChange\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.verifyPasswordLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.verifyPasswordInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Change Password\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.changePassword.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},changePassword:function(){var password=this.passwordInput.value.trim();var newPassword=this.newPasswordInput.value.trim();var verifyPassword=this.verifyPasswordInput.value.trim();var params={password:password,new_password:newPassword,verify_password:verifyPassword};this.call(\"pipio\",\"user_password_change\",params,this.changePasswordSuccess.bind(this),this.changePasswordFail.bind(this));this.actionButton.showProgress();},changePasswordSuccess:function(){this.actionButton.hideProgress();var name=\"email_change\";var title=\"Password Changed\";var message=\"Your Pip.io password has been updated\";this.fireEvent(\"showAlert\",name,title,message);this.closeContent();},changePasswordFail:function(status){this.actionButton.hideProgress();var name=\"email_change\";var title=\"Error Updating Email\";var message=status.message;this.fireEvent(\"showAlert\",name,title,message);},onShow:function(){this.focus();},focus:function(){this.passwordInput.focus.delay(500,this.passwordInput);}});var PipioSettingsPopupContent=new Class({Extends:PopupContent,EventHandlers:[\"emailBlockUpdated\",\"userEmailUpdated\"],strings:{settingsMessage:\"Change your Pip.io settings\",accountSectionLabel:\"Account Settings\",emailSectionLabel:\"Email Settings\",generalEmailLabel:\"Pip.io service updates:\",postReplyEmailLabel:\"Reply notifications:\",targetedPostEmailLabel:\"Targeted post notifications:\",contactRequestEmailLabel:\"Contact request notifications:\",roomInviteEmailLabel:\"Room invite notifications:\"},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":this.strings.settingsMessage}).inject(this.content);new Element(\"div\",{\"class\":\"text_section light\",\"text\":this.strings.accountSectionLabel}).inject(this.content);var emailChangeButton=new ButtonSmall({displayName:\"Update Email\",className:\"dark\",action:\"edit\"});$(emailChangeButton).addEvent(\"click\",this.showEmailChangePopup.bind(this));this.emailLabel=new Element(\"div\",{\"class\":\"label light2\",\"text\":this.getPrivateUser().email});new Element(\"div\",{\"class\":\"input_section\"}).adopt(this.emailLabel,$(emailChangeButton)).inject(this.content);var passwordChangeButton=new ButtonSmall({displayName:\"Change Password\",className:\"dark\",action:\"lock\"});$(passwordChangeButton).addEvent(\"click\",this.showPasswordChangePopup.bind(this));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light2\",\"text\":\"**********\"}),$(passwordChangeButton)).inject(this.content);new Element(\"div\",{\"class\":\"text_section light\",\"text\":this.strings.emailSectionLabel}).inject(this.content);this.generalEmailToggle=new Toggle(true);$(this.generalEmailToggle).addEvent(\"click\",this.updateBlock.bind(this,[18,this.generalEmailToggle]));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light2\",\"text\":this.strings.generalEmailLabel}),$(this.generalEmailToggle)).inject(this.content);this.postReplyEmailToggle=new Toggle(true);$(this.postReplyEmailToggle).addEvent(\"click\",this.updateBlock.bind(this,[9,this.postReplyEmailToggle]));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light2\",\"text\":this.strings.postReplyEmailLabel}),$(this.postReplyEmailToggle)).inject(this.content);this.targetedPostEmailToggle=new Toggle(true);$(this.targetedPostEmailToggle).addEvent(\"click\",this.updateBlock.bind(this,[14,this.targetedPostEmailToggle]));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light2\",\"text\":this.strings.targetedPostEmailLabel}),$(this.targetedPostEmailToggle)).inject(this.content);this.contactRequestEmailToggle=new Toggle(true);$(this.contactRequestEmailToggle).addEvent(\"click\",this.updateBlock.bind(this,[5,this.contactRequestEmailToggle]));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light2\",\"text\":this.strings.contactRequestEmailLabel}),$(this.contactRequestEmailToggle)).inject(this.content);this.roomInviteEmailToggle=new Toggle(true);$(this.roomInviteEmailToggle).addEvent(\"click\",this.updateBlock.bind(this,[11,this.roomInviteEmailToggle]));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light2\",\"text\":this.strings.roomInviteEmailLabel}),$(this.roomInviteEmailToggle)).inject(this.content);this.actionButton=new ButtonMedium({displayName:\"Done\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.closeContent.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton)).inject(this.content);this.loadBlocks();},userEmailUpdated:function(data){if(!$defined(data.email)){return;}this.emailLabel.set(\"text\",data.email);},loadBlocks:function(){this.call(\"pipio\",\"emailblock_load\",null,this.loadBlocksSuccess.bind(this));},loadBlocksSuccess:function(data){if(!$defined(data.blocks)){return;}data.blocks.each(function(block){this.updateBlockToggle(block.email_type,block.blocked);},this);},emailBlockUpdated:function(data){if(!$defined(data.email_type)||!$defined(data.blocked)){return;}this.updateBlockToggle(data.email_type,data.blocked);},updateBlockToggle:function(email_type,blocked){switch(email_type){case 5:this.contactRequestEmailToggle.set(blocked==0);break;case 9:this.postReplyEmailToggle.set(blocked==0);break;case 11:this.roomInviteEmailToggle.set(blocked==0);break;case 14:this.targetedPostEmailToggle.set(blocked==0);break;case 18:this.generalEmailToggle.set(blocked==0);break;}},updateBlock:function(email_type,toggle){var enabled=toggle.toInt();var blocked=(enabled==1)?0:1;var params={email_type:email_type,blocked:blocked};this.call(\"pipio\",\"emailblock_update\",params);},onClose:function(){this.closeEmailChangePopup();},showEmailChangePopup:function(){this.closeEmailChangePopup();this.emailChangePopup=new Popup({size:{x:350,y:74},resizable:false,dockable:false,className:\"settings\",onClose:this.destroyEmailChangePopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"settings\"},displayName:\"Update Your Email\",closable:true});var content=new EmailChangePopupContent();this.emailChangePopup.addContent(\"pipio_settings\",nav,content);},closeEmailChangePopup:function(){if($defined(this.emailChangePopup)){this.emailChangePopup.close();}},destroyEmailChangePopup:function(){this.emailChangePopup=null;},showPasswordChangePopup:function(){this.closePasswordChangePopup();this.passwordChangePopup=new Popup({size:{x:350,y:142},resizable:false,dockable:false,className:\"settings\",onClose:this.destroyPasswordChangePopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"settings\"},displayName:\"Change Your Password\",closable:true});var content=new PasswordChangePopupContent();this.passwordChangePopup.addContent(\"pipio_settings\",nav,content);},closePasswordChangePopup:function(){if($defined(this.passwordChangePopup)){this.passwordChangePopup.close();}},destroyPasswordChangePopup:function(){this.passwordChangePopup=null;}});var ShareBox=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"shareBoxShow\",\"replyShareBoxShow\",\"forwardShareBoxShow\",\"roomShareBoxShow\"],init:function(){this.shareboxes=$H();},userSwitched:function(){if(!this.isLoggedIn()){this.userLoggedOut();}},userLoggedOut:function(){this.shareboxes.each(function(sharebox,key){sharebox.close();this.shareboxes.erase(key);},this);this.shareboxes=$H();},forwardShareBoxShow:function(forward_id,username,forward_body){if($defined(this.sharebox)){this.sharebox.close();}this.createForwardShareBox(forward_id,username,forward_body);},createForwardShareBox:function(forward_id,username,forward_body){this.sharebox=new Popup({size:{x:500,y:160},resizable:false,dockable:false,className:\"sharebox\",onClose:this.destroyShareBox.bind(this)});var displayName=\"Forward a Post\";var nav=new Nav({iconOptions:{user:this.getPrivateUser()},displayName:displayName,closable:true});var forward_user=this.getUser(username);if(!$defined(forward_user)){forward_user=this.getRoom(username);}var content=new ShareBoxPopupContent({user:this.getPrivateUser(),forward_id:forward_id,forward_user:forward_user,forward_body:forward_body});this.sharebox.addContent(\"sharebox\",nav,content);},replyShareBoxShow:function(reply_id){if($defined(this.sharebox)){this.sharebox.close();}this.createReplyShareBox(reply_id);},createReplyShareBox:function(reply_id){this.sharebox=new Popup({size:{x:500,y:160},resizable:false,dockable:false,className:\"sharebox\",onClose:this.destroyShareBox.bind(this)});var displayName=\"Reply to a Post\";var nav=new Nav({iconOptions:{user:this.getPrivateUser()},displayName:displayName,closable:true});var content=new ShareBoxPopupContent({user:this.getPrivateUser(),reply_id:reply_id});this.sharebox.addContent(\"sharebox\",nav,content);},shareBoxShow:function(user){if($defined(this.sharebox)){this.sharebox.close();}this.createShareBox(user);},createShareBox:function(user){this.sharebox=new Popup({size:{x:500,y:160},resizable:false,dockable:false,className:\"sharebox\",onClose:this.destroyShareBox.bind(this)});var displayName=(user.user_id==this.getPrivateUser().user_id)?\"Write in Your Stream\":\"Write in \"+user.first_name+\"'s Stream\";var nav=new Nav({iconOptions:{user:user},displayName:displayName,closable:true});var content=new ShareBoxPopupContent({user:user});this.sharebox.addContent(\"sharebox\",nav,content);},destroyShareBox:function(name){this.sharebox=null;},roomShareBoxShow:function(room){if($defined(this.sharebox)){this.sharebox.close();}this.createRoomShareBox(room);},createRoomShareBox:function(room){this.sharebox=new Popup({size:{x:500,y:160},resizable:false,dockable:false,className:\"sharebox\",onClose:this.destroyShareBox.bind(this)});var displayName=\"Write in \"+room.room_name+\"'s Stream\";var nav=new Nav({iconOptions:{user:room},displayName:displayName,closable:true});var content=new ShareBoxPopupContent({room:room});this.sharebox.addContent(\"sharebox\",nav,content);}});var AttachLinkPopupContent=new Class({Extends:PopupContent,defaultText:\"Please enter the URL below\",errorText:\"The URL you entered is invalid\",validText:\"Click attach to add this link to your post\",onBeforeInit:function(options){this.attachFunc=options.attachFunc;return options;},onInit:function(){this.valid=false;this.url=\"\";this.text=new Element(\"div\",{\"class\":\"help_text light\",\"text\":this.defaultText}).inject(this.content);this.input=new Element(\"input\",{\"type\":\"text\",\"value\":\"http://\",\"maxlength\":200});this.input.addEvent(\"change\",this.validate.bind(this));this.input.addEvent(\"keyup\",this.validate.bindWithEvent(this));new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.input).inject(this.content);this.attachButton=new ButtonMedium({displayName:\"Attach\",className:\"dark\",action:\"check\"});$(this.attachButton).addEvent(\"click\",this.attach.bind(this));$(this.attachButton).inject(this.content);},onShow:function(){this.focus();},focus:function(){this.input.focus.delay(500,this.input);},validate:function(e){if(e&&e.key==\"enter\"){this.attach();return;}this.url=this.input.value.trim();if(DataUtility.validateUrl(this.url)){this.text.removeClass(\"error\");this.text.addClass(\"success\");this.text.set(\"text\",this.validText);this.valid=true;}else{this.text.removeClass(\"success\");this.text.addClass(\"error\");this.text.set(\"text\",this.errorText);this.valid=false;}},attach:function(){if(!this.valid){return;}var attachment={type:AttachmentType.Link,text:this.url,url:this.url};this.attachFunc(attachment);this.closeContent();}});var AttachPhotoPopupContent=new Class({Extends:PopupContent,defaultText:\"Please choose a photo\",errorText:\"The file you selected is not a photo\",validText:\"Click attach to add this photo to your post\",onBeforeInit:function(options){this.attachFunc=options.attachFunc;return options;},onInit:function(){this.valid=false;this.url=\"\";this.text=new Element(\"div\",{\"class\":\"help_text light\",\"text\":this.defaultText}).inject(this.content);this.input=new Element(\"input\",{\"type\":\"text\",\"value\":\"click to choose a file\"});this.fileInput=new Element(\"input\",{\"type\":\"file\",\"name\":\"file\"});this.form=new Element(\"form\").adopt(this.fileInput);this.fileInput.addEvent(\"change\",this.validate.bind(this));new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.input,this.form).inject(this.content);this.attachButton=new ButtonMedium({displayName:\"Attach\",className:\"dark\",action:\"check\"});$(this.attachButton).addEvent(\"click\",this.attach.bind(this));$(this.attachButton).inject(this.content);},validate:function(){Logger().log(\"validating file\");if(DataUtility.validatePhotoFile(this.fileInput.value)){this.text.removeClass(\"error\");this.text.addClass(\"success\");this.text.set(\"text\",this.validText);this.input.value=this.fileInput.value;this.valid=true;}else{this.text.removeClass(\"success\");this.text.addClass(\"error\");this.text.set(\"text\",this.errorText);this.input.value=\"click to choose a file\";this.valid=false;}},attach:function(){if(!this.valid){return;}this.form.inject(\"hidden\");var attachment={type:AttachmentType.Photo,text:this.fileInput.value};this.attachFunc(attachment,this.form);this.closeContent();}});var AttachmentType={None:0,Photo:1,Link:2};var ShareBoxPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){if($defined(options.user)){this.user=options.user;this.isRoom=false;this.source_id=this.user.user_id;}else{this.user=options.room;this.isRoom=true;this.source_id=this.user.room_id;}this.reply_id=options.reply_id||0;this.source_type=(this.isRoom)?3:1;this.forward_id=options.forward_id||0;this.forward_user=options.forward_user;this.forward_body=options.forward_body;if(this.source_id!=this.getPrivateUser().user_id||!$defined(this.forward_user)){this.forward_id=0;}this.is_forward=this.forward_id!=0;this.is_reply=this.reply_id!=0;this.is_direct=this.source_id!=this.getPrivateUser().user_id;return options;},reset:function(){Logger().log(\"resetting\");this.closeContactPickerPopup();this.closeAttachmentPopup();this.content.empty();this.onInit();},onInit:function(){this.targetContacts=$H();this.targetGroups=$H();this.targetContactEls=$H();this.targetGroupEls=$H();this.targetAllContacts=false;this.allContactsEl=null;this.formEl=null;this.isPublic=true;this.readyToPost=false;this.attachment={type:AttachmentType.None};this.channel_id=0;this.res=this.getSession();if(!this.is_direct&&!this.is_reply){this.privateButton=new ButtonSmall({displayName:\"Private\",className:\"privacy red\",action:\"lock dark\"});$(this.privateButton).addEvent(\"click\",this.togglePrivacy.bind(this));$(this.privateButton).inject(this.content);this.publicButton=new ButtonSmall({displayName:\"Public\",className:\"privacy green\",action:\"broadcast dark\"});$(this.publicButton).addEvent(\"click\",this.togglePrivacy.bind(this));$(this.publicButton).inject(this.content);this.addRecipientButton=new ButtonSmall({displayName:\"Add Recipient\",className:\"dark\",action:\"status dark\"});$(this.addRecipientButton).addEvent(\"click\",this.showContactPickerPopup.bind(this));var selfRecip=new Element(\"div\",{\"class\":\"target self\"});var icon=new Icon20({user:this.getPrivateUser()});$(icon).inject(selfRecip);selfRecip.adopt(new Element(\"div\",{\"class\":\"target_text text11 light\",\"text\":\"Yourself\"}));this.norecipients=new Element(\"div\",{\"class\":\"recipients\",\"text\":\"Everyone can view this post\"}).inject(this.content);this.recipients=new Element(\"div\",{\"class\":\"recipients\"}).adopt(new Element(\"div\",{\"class\":\"target\",\"text\":\"To: \"}),selfRecip,$(this.addRecipientButton),new Element(\"div\",{\"style\":\"clear: both\"})).inject(this.content);this.setPrivacyView();}else{if(this.is_direct){this.norecipients=new Element(\"div\",{\"class\":\"recipients\",\"text\":\"Everyone can view this post\"}).inject(this.content);}else{this.norecipients=new Element(\"div\",{\"class\":\"recipients\",\"text\":\"All recipients of the original can view this post\"}).inject(this.content);}}this.input=new Element(\"textarea\",{\"maxlength\":2000});this.input.addEvent(\"keydown\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.input).inject(this.content);this.linkButton=new ButtonSmall({displayName:\"Link\",className:\"dark\",action:\"link\"});$(this.linkButton).addEvent(\"click\",this.showAttachmentPopup.bind(this,[\"link\"]));this.photoButton=new ButtonSmall({displayName:\"Photo\",className:\"dark\",action:\"photo\"});$(this.photoButton).addEvent(\"click\",this.showAttachmentPopup.bind(this,[\"photo\"]));this.fileButton=new ButtonSmall({displayName:\"File\",className:\"dark\",action:\"file\"});this.attachments=new Element(\"div\",{\"class\":\"attachments\"}).inject(this.content);this.attachmentSelect=new Element(\"div\").adopt(new Element(\"div\",{\"class\":\"attachment_text light\",\"text\":\"Attach:\"}),$(this.linkButton),$(this.photoButton)).inject(this.attachments);this.attachmentItems=new Element(\"div\").inject(this.attachments);this.cancelButton=new ButtonMedium({displayName:\"Close\",className:\"dark\",action:\"cross\"});$(this.cancelButton).addEvent(\"click\",this.closeContent.bind(this));this.updateButton=new ButtonMedium({displayName:\"Post\",className:\"dark\",action:\"check\"});$(this.updateButton).addEvent(\"click\",this.post.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.updateButton),$(this.cancelButton)).inject(this.content);this.focus();if(this.forward_id!=0){this.attachForward();}},setPrivacyView:function(){if(this.isPublic){DomUtility.show(this.publicButton);DomUtility.hide(this.privateButton);DomUtility.show(this.norecipients);DomUtility.hide(this.recipients);}else{DomUtility.hide(this.publicButton);DomUtility.show(this.privateButton);DomUtility.hide(this.norecipients);DomUtility.show(this.recipients);}},togglePrivacy:function(){if(this.isPublic){this.showContactPickerPopup();}else{this.closeContactPickerPopup();}this.isPublic=!this.isPublic;this.setPrivacyView();},inputKeyUp:function(e){if(e.shift&&e.key==\"enter\"){e.preventDefault();this.post();}if(DomUtility.textareaAutoSize(e.target,40)){this.updateSize();}},updateSize:function(){var h=(this.isPublic)?this.norecipients.getSize().y:this.recipients.getSize().y;h+=this.input.getSize().y+10;h+=this.attachments.getSize().y+20;h+=this.actions.getSize().y+30;this.resizePopup(500,h);},parseTargets:function(){if(this.isPublic){return\"\";}var targets=[this.getPrivateUser().user_id];if(this.targetAllContacts){this.getContacts().each(function(user){targets.include(user.user_id);},this);return targets.join(\",\");}this.targetGroups.each(function(group){var contacts=this.getContactsByGroup(group.group_id);contacts.each(function(user){targets.include(user.user_id);},this);},this);this.targetContacts.each(function(user){targets.include(user.user_id);},this);return targets.join(\",\");},post:function(){var targets=this.parseTargets();var body=this.input.value.trim();var is_public=(this.isPublic)?1:0;Logger().log(targets);Logger().log(body);if(this.forward_id==0){if(body==\"\"&&this.attachment.type==AttachmentType.None){this.fireEvent(\"showAlert\",\"empty_post\",\"Problem Posting\",\"Please enter some content to post.\");return;}var params={\"body\":body,\"targets\":targets,\"source_id\":this.source_id,\"source_type\":this.source_type,\"reply_id\":this.reply_id,\"channel_id\":this.channel_id,\"is_public\":is_public,\"res\":this.res,\"attachment\":JSON.encode(this.attachment)};this.call(\"home\",\"publish\",params,this.postSuccess.bind(this),this.postFail.bind(this),this.formEl);}else{var params={\"body\":body,\"targets\":targets,\"source_id\":this.source_id,\"source_type\":this.source_type,\"forward_id\":this.forward_id,\"channel_id\":this.channel_id,\"is_public\":is_public,\"res\":this.res};this.call(\"home\",\"forward\",params,this.postSuccess.bind(this),this.postFail.bind(this));}this.updateButton.showProgress();},postSuccess:function(){this.updateButton.hideProgress();this.closeContent();},postFail:function(){this.updateButton.hideProgress();},addAllContacts:function(){if(this.isPublic||$defined(this.allContactsEl)){return;}var el=ShareBoxUtility.createAllContactsItem();el.addEvent(\"click\",this.removeAllContacts.bind(this));el.inject($(this.addRecipientButton),\"before\");this.allContactsEl=el;this.targetAllContacts=true;this.updateSize();},removeAllContacts:function(){if(!$defined(this.allContactsEl)){return;}this.allContactsEl.destroy();this.targetAllContacts=false;this.updateSize();},addTargetGroup:function(group){if(this.isPublic||this.targetGroupEls.has(group.group_id)){return;}var el=ShareBoxUtility.createGroupItem(group);el.addEvent(\"click\",this.removeTargetGroup.bind(this,[group.group_id]));el.inject($(this.addRecipientButton),\"before\");this.targetGroupEls.set(group.group_id,el);this.targetGroups.set(group.group_id,group);this.updateSize();},removeTargetGroup:function(group_id){if(!this.targetGroupEls.has(group_id)){return;}this.targetGroupEls.get(group_id).destroy();this.targetGroupEls.erase(group_id);this.targetGroups.erase(group_id);this.updateSize();},addTargetContact:function(user){if(this.isPublic||this.targetContactEls.has(user.username)){return;}var el=ShareBoxUtility.createContactItem(user);el.addEvent(\"click\",this.removeTargetContact.bind(this,[user.username]));el.inject($(this.addRecipientButton),\"before\");this.targetContactEls.set(user.username,el);this.targetContacts.set(user.username,user);this.updateSize();},removeTargetContact:function(username){if(!this.targetContactEls.has(username)){return;}this.targetContactEls.get(username).destroy();this.targetContactEls.erase(username);this.targetContacts.erase(username);this.updateSize();},showContactPickerPopup:function(){if($defined(this.contactPicker)){this.contactPicker._select();return;}this.createContactPickerPopup();},closeContactPickerPopup:function(){if($defined(this.contactPicker)){this.contactPicker.close();}},createContactPickerPopup:function(){this.contactPicker=new Popup({size:{x:200,y:350},resizable:false,dockable:false,className:\"contactPicker\",onClose:this.destroyContactPickerPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"users\"},displayName:\"Select Recipients\",closable:true});var content=new ContactPickerPopupContent({groups:this.getGroups(),contacts:this.getContacts(),groupAddFunc:this.addTargetGroup.bind(this),contactAddFunc:this.addTargetContact.bind(this),allContactsAddFunc:this.addAllContacts.bind(this)});this.contactPicker.addContent(\"contactPicker\",nav,content);},destroyContactPickerPopup:function(){this.contactPicker=null;},showAttachmentPopup:function(type){if($defined(this.attachmentPopup)){if(this.attachmentPopupType==type){this.attachmentPopup._select();return;}else{this.closeAttachmentPopup();}}this.createAttachmentPopup(type);},closeAttachmentPopup:function(){if($defined(this.attachmentPopup)){this.attachmentPopup.close();}},createAttachmentPopup:function(type){var popupClass;var typeName;switch(type){case\"link\":popupClass=AttachLinkPopupContent;typeName=\"Link\";break;case\"photo\":popupClass=AttachPhotoPopupContent;typeName=\"Photo\";break;}this.attachmentPopup=new Popup({size:{x:400,y:74},resizable:false,dockable:false,className:\"attachments\",onClose:this.destroyAttachmentPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:type},displayName:\"Attach \"+typeName,closable:true});var content=new popupClass({attachFunc:this.attachContent.bind(this)});this.attachmentPopupType=type;this.attachmentPopup.addContent(\"attachment\",nav,content);},destroyAttachmentPopup:function(){this.attachmentPopup=null;this.attachmentPopupType=null;},attachForward:function(){DomUtility.show(this.attachmentItems);DomUtility.hide(this.attachmentSelect);var attachElement=ShareBoxUtility.createForwardAttachmentItem(this.forward_user,this.forward_body);attachElement.inject(this.attachmentItems);},attachContent:function(attachment,formEl){this.attachment=attachment;if($defined(formEl)){this.formEl=formEl;}Logger().log(\"attached \"+this.formEl);DomUtility.show(this.attachmentItems);DomUtility.hide(this.attachmentSelect);var attachElement=ShareBoxUtility.createAttachmentItem(attachment);var removeButton=new ButtonSmall({displayName:\"Remove\",className:\"dark\",action:\"cross\"});$(removeButton).addEvent(\"click\",this.removeAttachment.bind(this));$(removeButton).inject(attachElement);attachElement.inject(this.attachmentItems);},removeAttachment:function(){this.attachment=null;this.attachmentItems.empty();if($defined(this.formEl)){this.formEl.destroy();}this.formEl=null;DomUtility.hide(this.attachmentItems);DomUtility.show(this.attachmentSelect);this.forward_id=0;},onShow:function(){this.focus();},focus:function(){this.input.focus.delay(500,this.input);}});var ShareBoxUtility={createContactRoomInviteItem:function(user){var el=new Element(\"div\",{\"class\":\"listItem\"});var icon=new Icon20({user:user});$(icon).inject(el);new Element(\"div\",{\"class\":\"listText text12 light\",\"text\":TextUtility.cleanText(user.fullname)}).inject(el);el.set(\"val1\",user.fullname.toLowerCase());el.set(\"val2\",user.last_name.toLowerCase());var button=new ButtonSmall({displayName:\"Invite\",className:\"dark\",action:\"check\"});$(button).inject(el);new Element(\"div\",{\"class\":\"invited_text text11 success\",\"text\":\"Invited\"}).inject(el);return el;},createContactPickerItem:function(user){var el=new Element(\"div\",{\"class\":\"listItem\"});var icon=new Icon20({user:user});$(icon).inject(el);new Element(\"div\",{\"class\":\"listText text12 light\",\"text\":TextUtility.cleanText(user.fullname)}).inject(el);el.set(\"val1\",user.fullname.toLowerCase());el.set(\"val2\",user.last_name.toLowerCase());return el;},createGroupPickerItem:function(group){var el=new Element(\"div\",{\"class\":\"listItem\"});var icon=new Icon20({iconName:\"group\"});$(icon).inject(el);new Element(\"div\",{\"class\":\"listText text12 light\",\"text\":TextUtility.cleanText(group.name)}).inject(el);el.set(\"val1\",group.name.toLowerCase());return el;},createAllContactsPickerItem:function(){var el=new Element(\"div\",{\"class\":\"listItem\"});var icon=new Icon20({iconName:\"contacts\"});$(icon).inject(el);new Element(\"div\",{\"class\":\"listText text12 light\",\"text\":\"All Contacts\"}).inject(el);el.set(\"val1\",\"all contacts\");return el;},createContactItem:function(user){var el=new Element(\"div\",{\"class\":\"target\"});var icon=new Icon20({user:user});$(icon).inject(el);el.adopt(new Element(\"div\",{\"class\":\"target_text text11 light\",\"text\":TextUtility.cleanText(user.first_name)}),new Element(\"div\",{\"class\":\"action cross\"}));return el;},createGroupItem:function(group){var el=new Element(\"div\",{\"class\":\"target\"});var icon=new Icon20({iconName:\"group\"});$(icon).inject(el);el.adopt(new Element(\"div\",{\"class\":\"target_text text11 light\",\"text\":TextUtility.cleanText(group.name)}),new Element(\"div\",{\"class\":\"action cross\"}));return el;},createAllContactsItem:function(){var el=new Element(\"div\",{\"class\":\"target\"});var icon=new Icon20({iconName:\"contacts\"});$(icon).inject(el);el.adopt(new Element(\"div\",{\"class\":\"target_text text11 light\",\"text\":\"All Contacts\"}),new Element(\"div\",{\"class\":\"action cross\"}));return el;},createForwardAttachmentItem:function(forward_user,forward_body){var el=new Element(\"div\",{\"class\":\"attachment\"});var name=($defined(forward_user.user_id))?forward_user.fullname:forward_user.room_name;el.adopt(new Element(\"span\",{\"class\":\"indicator\",\"html\":\"&raquo;\"}),new Element(\"span\",{\"class\":\"attachment_title light2\"}).adopt(new Element(\"span\",{\"text\":\"Forwarding: \"}),new Element(\"span\",{\"class\":\"user_name\",\"text\":TextUtility.unescape(name)}),new Element(\"span\",{\"text\":\" \"+TextUtility.unescape(forward_body)})));return el;},createAttachmentItem:function(attachment){var el=new Element(\"div\",{\"class\":\"attachment\"});el.adopt(new Element(\"span\",{\"class\":\"indicator\",\"html\":\"&raquo;\"}),new Element(\"span\",{\"class\":\"attachment_title light2\",\"text\":attachment.text}));return el;}};var UI=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"viewSwitch\",\"menuAdd\",\"contentAdd\",\"menuClose\",\"contentClose\",\"appClose\",\"showUser\",\"showRoom\",\"showConvo\",\"showGlobal\",\"showConfirmation\",\"showAlert\",\"showVideoPopup\",\"showPhotoPopup\",\"showPipioUpdatePopup\",\"showSearchRoomPopup\"],init:function(){this.historyManager=new HistoryManager();this.historyManager.addEvent(\"onHistoryChange\",this.historyChanged.bind(this));this.history=$H();this.navScrollBar=new ScrollBar(\"nav\",\"nav_wrapper\");this.idleTimeout=10*60*1000;this.updateTimestamps.periodical(1000*90,this);this.menus=$H();this.contents=$H();this.confirms=$H();this.alerts=$H();this.reset();},reset:function(){this.currentMenu=null;this.currentContent=null;},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.reset();this.setCurrentUser();this.toggleHeader(true);},userLoggedOut:function(){this.reset();this.resetCurrentUser();this.toggleHeader(false);},appClose:function(app){this.contents.each(function(content,key){var appId=key.split(\"_\",1)[0];if(appId==app){this.contentCloseKey(key);}},this);this.menus.each(function(menu,key){var appId=key.split(\"_\",1)[0];if(appId==app){this.menuCloseKey(key);}},this);},viewSwitch:function(appId,contentName,menuName){var menuKey=appId+\"_\"+menuName;var contentKey=appId+\"_\"+contentName;if(!this.contents.has(contentKey)){Logger().log(\"content \"+contentName+\" not found!\");return false;}if($defined(menuName)&&!this.menus.has(menuKey)){Logger().log(\"menu \"+menuName+\" not found!\");return false;}if($defined(menuName)){this.contentSwitch(contentKey);this.menuSwitch(menuKey);$(\"content\").addClass(\"hasmenu\");}else{this.contentSwitch(contentKey);$(\"content\").removeClass(\"hasmenu\");}this.historyChange(appId,contentName,menuName);return true;},historyChange:function(appId,contentName,menuName){if(parseInt(appId)==appId){var app=this.getAppById(appId);if(!app){return;}var hash=app.name+\"/\"+contentName;this.history.set(hash,{appId:appId,contentName:contentName,menuName:menuName});this.historyManager.addState(hash);}else{var appParts=appId.split(\"_\");var appName=appParts[0];var appParam=appParts[1];var hash=appName+\"/\"+appParam+\"/\"+contentName;this.history.set(hash,{appId:appId,contentName:contentName,menuName:menuName});this.historyManager.addState(hash);}},historyChanged:function(hash){Logger().log(\"historyChanged - \"+hash);if(this.history.has(hash)){var state=this.history.get(hash);var found=this.viewSwitch(state.appId,state.contentName,state.menuName);if(!found){window.history.back();}}},menuAdd:function(appId,menuName,menu){var menuKey=appId+\"_\"+menuName;Logger().log(\"adding menu \"+menuKey);if(this.menus.has(menuKey)){return;}$(menu).inject(\"menu_wrapper\");menu.off();this.menus.set(menuKey,menu);},menuClose:function(appId,menuName){var menuKey=appId+\"_\"+menuName;this.menuCloseKey(menuKey);},menuCloseKey:function(key){if(!this.menus.has(key)){return;}if(key==this.currentMenu){this.currentMenu=null;}var menu=this.menus.get(key);menu.destroy();this.menus.erase(key);delete (menu);},contentAdd:function(appId,contentName,content){var contentKey=appId+\"_\"+contentName;Logger().log(\"adding content \"+contentKey);if(this.contents.has(contentKey)){return;}$(content).inject(\"content_wrapper\");content.off();this.contents.set(contentKey,content);},contentClose:function(appId,contentName){var contentKey=appId+\"_\"+contentName;this.contentCloseKey(contentKey);if(!$defined(this.currentContent)){window.history.back();}},contentCloseKey:function(key){Logger().log(key);if(!this.contents.has(key)){return;}if(key==this.currentContent){this.currentContent=null;}var content=this.contents.get(key);content.destroy();this.contents.erase(key);delete (content);},menuSwitch:function(menuKey){if(!this.menus.has(menuKey)){return;}if(menuKey==this.currentMenu){return;}if($defined(this.currentMenu)){this.menus.get(this.currentMenu).off();}this.menus.get(menuKey).on();this.currentMenu=menuKey;},contentSwitch:function(contentKey){if(!this.contents.has(contentKey)){return;}if(contentKey==this.currentContent){return;}if($defined(this.currentContent)){this.contents.get(this.currentContent).off();}this.contents.get(contentKey).on();this.fireEvent(\"contentSwitched\",contentKey);this.currentContent=contentKey;},toggleHeader:function(loggedIn){if(loggedIn){DomUtility.show(\"self\");$(\"header\").get(\"tween\").start(\"left\",201).chain(function(){$(\"self\").setStyle(\"z-index\",6);$(\"header_loggedOut\").get(\"tween\").start(\"top\",-36).chain(function(){$(\"header_loggedIn\").get(\"tween\").start(\"top\",0);});});$(\"nav_wrapper\").get(\"tween\").start(\"left\",0);$(\"content\").get(\"tween\").start(\"left\",201);$(\"dock\").inject(\"dock_loggedIn\");}else{$(\"self\").setStyle(\"z-index\",4);$(\"header\").get(\"tween\").start(\"left\",0).chain(function(){DomUtility.hide(\"self\");$(\"header_loggedIn\").get(\"tween\").start(\"top\",-36).chain(function(){$(\"header_loggedOut\").get(\"tween\").start(\"top\",0);});});$(\"nav_wrapper\").get(\"tween\").start(\"left\",-210);$(\"content\").get(\"tween\").start(\"left\",0);$(\"dock\").inject(\"dock_loggedOut\");}},setCurrentUser:function(){$(\"self_name\").set(\"text\",this.getPrivateUser().fullname);$(\"self_profile_pic_26\").set(\"src\",this.getPrivateUser().profile_pic_26);$(\"self_profile_pic_26\").addClass(\"profile_pic_26_\"+this.getPrivateUser().username);$(\"self_online_status\").addClass(\"online_status_\"+this.getPrivateUser().username);},resetCurrentUser:function(){$(\"self_name\").set(\"text\",\"\");$(\"self_profile_pic_26\").set(\"src\",\"\");$(\"self_profile_pic_26\").set(\"class\",\"profile_pic\");$(\"self_online_status\").set(\"class\",\"online_status\");},showUser:function(user){var options={user:user};this.fireEvent(\"startAppInstance\",\"user\",user.username,options);},showRoom:function(room){var options={room:room};this.fireEvent(\"startAppInstance\",\"room\",room.username,options);},showGlobal:function(location){var options={location:location};var geohash=location.geohash.substring(0,6);this.fireEvent(\"startAppInstance\",\"global\",geohash,options);},showConvo:function(){},showConfirmation:function(name,title,message,confirmFunc){if(this.confirms.has(name)){this.confirms.get(name)._select();return;}this.createConfirmation(name,title,message,confirmFunc);},createConfirmation:function(name,title,message,confirmFunc){var popup=new Popup({size:{x:350,y:100},resizable:false,dockable:false,className:\"confirm\",onClose:this.destroyConfirmation.bind(this,[name])});var nav=new Nav({iconOptions:{iconName:\"info\"},displayName:title,closable:true});var content=new ConfirmPopupContent({confirmMessage:message,confirmFunc:confirmFunc});popup.addContent(\"confirm\",nav,content);this.confirms.set(name,popup);},destroyConfirmation:function(name){this.confirms.erase(name);},showAlert:function(name,title,message){if(this.alerts.has(name)){this.alerts.get(name)._select();return;}this.createAlert(name,title,message);},createAlert:function(name,title,message){var popup=new Popup({size:{x:350,y:100},resizable:false,dockable:false,className:\"confirm\",onClose:this.destroyAlert.bind(this,[name])});var nav=new Nav({iconOptions:{iconName:\"info\"},displayName:title,closable:true});var content=new AlertPopupContent({alertMessage:message});popup.addContent(\"confirm\",nav,content);this.alerts.set(name,popup);},destroyAlert:function(name){this.alerts.erase(name);},updateTimestamps:function(){$$(\".timestamp\").each(function(el){if($defined(el.get(\"ts\"))){var ts=new Date(el.get(\"ts\"));var format=el.get(\"ts_format\");var timeStr=DateUtility.getTimestamp(ts,format);el.set(\"text\",timeStr);}});}});UI.implement({showVideoPopup:function(attachment){switch(attachment.video_type){case\"youtube\":this.createYoutubePopup(attachment);break;case\"vimeo\":this.createVimeoPopup(attachment);break;case\"ch\":this.createChPopup(attachment);break;case\"hulu\":this.createHuluPopup(attachment);break;case\"break\":this.createBreakPopup(attachment);break;}},showPhotoPopup:function(attachment){this.createPhotoPopup(attachment);},createPhotoPopup:function(attachment){var popup=new Popup({size:{x:300,y:100},resizable:false,dockable:false,closable:true,className:\"photoViewer\"});var displayName=attachment.filename;var nav=new Nav({iconOptions:{iconName:\"photo\"},displayName:displayName,closable:true});var content=new PhotoPopupContent({attachment:attachment});content.resizePopup=popup.resizePopup.bind(popup);content.reCenter=popup.reCenter.bind(popup);popup.addContent(\"photo\",nav,content);},createYoutubePopup:function(attachment){var popup=new Popup({size:{x:425,y:350},resizable:false,dockable:false,noHide:true,closable:true,className:\"videoPlayer\"});var displayName=\"Youtube Video\";var nav=new Nav({iconOptions:{iconName:\"youtube\"},displayName:displayName,closable:true});var content=new YoutubePopupContent({attachment:attachment});popup.addContent(\"video\",nav,content);},createVimeoPopup:function(attachment){var popup=new Popup({size:{x:425,y:350},resizable:false,dockable:false,noHide:true,closable:true,className:\"videoPlayer\"});var displayName=\"Vimeo Video\";var nav=new Nav({iconOptions:{iconName:\"tv\"},displayName:displayName,closable:true});var content=new VimeoPopupContent({attachment:attachment});popup.addContent(\"video\",nav,content);},createChPopup:function(attachment){var popup=new Popup({size:{x:425,y:350},resizable:false,dockable:false,noHide:true,closable:true,className:\"videoPlayer\"});var displayName=\"College Humor Video\";var nav=new Nav({iconOptions:{iconName:\"tv\"},displayName:displayName,closable:true});var content=new ChPopupContent({attachment:attachment});popup.addContent(\"video\",nav,content);},createBreakPopup:function(attachment){var popup=new Popup({size:{x:425,y:350},resizable:false,dockable:false,noHide:true,closable:true,className:\"videoPlayer\"});var displayName=\"Break.com Video\";var nav=new Nav({iconOptions:{iconName:\"tv\"},displayName:displayName,closable:true});var content=new BreakPopupContent({attachment:attachment});popup.addContent(\"video\",nav,content);},createHuluPopup:function(attachment){var popup=new Popup({size:{x:512,y:296},resizable:false,dockable:false,noHide:true,closable:true,className:\"videoPlayer\"});var displayName=\"Hulu Video\";var nav=new Nav({iconOptions:{iconName:\"tv\"},displayName:displayName,closable:true});var content=new HuluPopupContent({attachment:attachment});popup.addContent(\"video\",nav,content);},showPipioUpdatePopup:function(version){if($defined(this.updatePopup)){return;}this.updatePopup=popup=new Popup({size:{x:350,y:70},resizable:false,dockable:false,closable:false,className:\"login\"});var nav=new Nav({iconOptions:{iconName:\"pipio\"},displayName:\"Pip.io Updated\",closable:true});var content=new PipioUpdatePopupContent({version:version});this.updatePopup.addContent(\"update\",nav,content);},showSearchRoomPopup:function(){this.closeSearchRoomPopup();this.createSearchRoomPopup();},closeSearchRoomPopup:function(){if($defined(this.searchRoomPopup)){this.searchRoomPopup.close();}},createSearchRoomPopup:function(){this.searchRoomPopup=new Popup({size:{x:350,y:110},resizable:false,dockable:false,className:\"roomSearch\",onClose:this.destroySearchRoomPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"search\"},displayName:\"Search for Rooms on Pip.io\",closable:true});var content=new RoomSearchPopupContent({});this.searchRoomPopup.addContent(\"roomSearch\",nav,content);},destroySearchRoomPopup:function(){this.searchRoomPopup=null;}});var BreakPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){this.call(\"home\",\"parse_break_url\",{url:this.attachment.url},this.parseSuccess.bind(this),this.parseFail.bind(this));},parseSuccess:function(data){var swf=\"http://embed.break.com/\"+data.id;var vid=new Swiff(swf,{id:swf,width:425,height:350,params:{movie:swf,allowfullscreen:true}});vid.inject(this.content);},parseFail:function(){this.closeContent();}});var ChPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){var swf=\"http://www.collegehumor.com/moogaloop/moogaloop.swf?clip_id=\"+this.attachment.vimeoId+\"&autoplay=1&fullscreen=1\";var vid=new Swiff(swf,{id:swf,width:425,height:350,params:{movie:swf,allowfullscreen:true}});vid.inject(this.content);}});var HuluPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){this.call(\"home\",\"parse_hulu_url\",{url:this.attachment.url},this.parseSuccess.bind(this),this.parseFail.bind(this));},parseSuccess:function(data){var swf=\"http://www.hulu.com/embed/\"+data.id;var vid=new Swiff(swf,{id:swf,width:512,height:296,params:{movie:swf,allowfullscreen:true}});vid.inject(this.content);},parseFail:function(){this.closeContent();}});var PhotoPopupContent=new Class({Extends:PopupContent,strings:{loadingMessage:\"Photo loading...\"},onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){this.loadingMsg=new Element(\"div\",{\"class\":\"loading_message\"}).adopt(new Element(\"div\",{\"class\":\"loading_text light\",\"text\":this.strings.loadingMessage}),new Element(\"div\",{\"class\":\"progress\"})).inject(this.content);Logger().log(this.attachment.url);this.image=new Asset.image(this.attachment.url,{title:this.attachment.filename,onload:this.photoLoaded.bind(this)});},photoLoaded:function(){var imageW=this.image.width;var imageH=this.image.height;if(imageW>=imageH&&imageW>1000){imageH=(1000/imageW)*imageH;imageW=1000;}else{if(imageW<imageH&&imageH>1000){imageW=(1000/imageH)*imageW;imageH=1000;}}var w=imageW+20;var h=imageH+20;DomUtility.hide(this.loadingMsg);this.image.inject(this.content);this.resizePopup(w,h);this.reCenter();}});var PipioUpdatePopupContent=new Class({Extends:PopupContent,strings:{updateMessage:\"A new version of Pip.io (v{0}) is available\"},onBeforeInit:function(options){this.version=options.version;return options;},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":String.format(this.strings.updateMessage,this.version)}).inject(this.content);this.actionButton=new ButtonMedium({displayName:\"Reload\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.reload.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton)).inject(this.content);},reload:function(){this.actionButton.showProgress();window.location=\"/\";}});var VimeoPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){var swf=\"http://vimeo.com/moogaloop.swf?clip_id=\"+this.attachment.vimeoId+\"&autoplay=1&fullscreen=1\";Logger().log(swf);var vid=new Swiff(swf,{id:swf,width:425,height:350,params:{movie:swf,allowfullscreen:true}});vid.inject(this.content);}});var YoutubePopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){var swf=\"http://www.youtube.com/v/\"+this.attachment.youtubeId+\"&rel=1&autoplay=1\";var vid=new Swiff(swf,{id:swf,width:425,height:350,params:{movie:swf,allowfullscreen:true}});vid.inject(this.content);}});var VideoChat=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"videoChatStart\",\"videoChatReset\",\"videoChatEnd\",\"videoChatRequestReceived\",\"videoChatRequestAccepted\",\"videoChatAccept\"],init:function(){window.sim=new VideoChatInterface();this.callTimeout=0;this.createVideoChatPopup();},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){window.sim.ChatReady();},userLoggedOut:function(){window.sim.ChatNotReady();},videoChatStart:function(user){if(!this.videoEnabled()){var name=\"video_chat\";var title=\"Unable to Start Video Conference\";var message=\"Your system does not support video conferencing\";this.fireEvent(\"showAlert\",name,title,message);return;}if(window.sim.SwfState==window.sim.SwfReady){this.fireEvent(\"sendVideoChatInvite\",user);window.sim.CallInitiate(this.getPrivateUser().username,user.username);this.callTimeout=this.videoChatEnd.delay(20000,this);this.showVideoChatPopup(user);}},videoChatAccept:function(user,stratusId){this.showVideoChatPopup(user);window.sim.CallAccept(stratusId,this.getPrivateUser().username,user.username);this.fireEvent(\"sendVideoChatAccept\",user);},videoChatReset:function(){Logger().log(\"reset video chat\");this.popup.close();this.fireEvent(\"videoChatEnable\",true);this.fireEvent(\"videoInUse\",false);this.fireEvent(\"selfPresenceUpdate\");$clear(this.callTimeout);},videoChatEnd:function(){Logger().log(\"reset video chat\");window.sim.CallEnd();this.popup.close();this.fireEvent(\"videoChatEnable\",true);this.fireEvent(\"videoInUse\",false);this.fireEvent(\"selfPresenceUpdate\");$clear(this.callTimeout);},videoChatRequestAccepted:function(username,stratusId){$clear(this.callTimeout);window.sim.CallAccepted(stratusId,username);},videoChatRequestReceived:function(username,stratusId){var user=this.getContact(username);var notif=new VideoChatNotification({user:user,stratusId:stratusId});this.fireEvent(\"notificationAdd\",\"videoChat_request_\"+username,notif);window.sim.CallReceived(username);},showVideoChatPopup:function(user){this.popup.show(user);},createVideoChatPopup:function(){this.popup=new VideoChatPopup({size:{x:400,y:340},resizable:false,dockable:false,noHide:true,closable:false,className:\"pipioVideoChat\"});var nav=new Nav({iconOptions:{iconName:\"video_chat\"},displayName:\"Video Conference\",closable:true});var content=new VideoChatPopupContent({});this.popup.addContent(\"video_chat\",nav,content);}});var VideoChatInterface=new Class({Extends:Base,EventHandlers:[],init:function(){this.flexApp=null;this.SwfState=null;this.SwfError=-1;this.SwfNotLoaded=0;this.SwfLoaded=1;this.SwfNotReady=2;this.SwfReady=3;this.SwfCalling=4;this.SwfRinging=5;this.SwfConnecting=6;this.SwfConnected=7;this.SwfDisconnecting=8;},CallInitiate:function(nearUsername,farUsername){if(this.SwfState==this.SwfReady){this.flexApp.AttachOutgoingStream(nearUsername);this.SwfState=this.SwfCalling;}},CallReceived:function(farUsername){if(this.SwfState==this.SwfReady){this.SwfState=this.SwfRinging;}},CallAccept:function(farID,nearUsername,farUsername){if(this.SwfState==this.SwfRinging){this.SwfState=this.SwfConnecting;this.flexApp.AttachIncomingStream(farID,farUsername);this.flexApp.AttachOutgoingStream(nearUsername);this.SwfState=this.SwfConnected;}},CallReject:function(farUsername){if(this.SwfState==this.SwfRinging){this.SwfState=this.SwfDisconnecting;this.SwfState=this.SwfReady;}},CallAccepted:function(farID,farUsername){if(this.SwfState==this.SwfCalling){this.SwfState=this.SwfConnecting;this.flexApp.AttachIncomingStream(farID,farUsername);this.SwfState=this.SwfConnected;}},CallRejected:function(farID,farUsername){if(this.SwfState==this.SwfCalling){this.SwfState=this.SwfReady;}},CallEnd:function(farUsername){if((this.SwfState==this.SwfCalling)||(this.SwfState==this.SwfConnected)||(this.SwfState==this.SwfConnecting)){this.SwfState=this.SwfDisconnecting;this.flexApp.ClientReset();this.SwfState=this.SwfReady;}},ClientReset:function(){if(this.SwfState>=this.SwfReady){this.CallEnd();}this.flexApp.ClientReset();},GetLog:function(logging){if(this.SwfState>=this.SwfLoaded){if(logging==null){logging=true;}return this.flexApp.GetLog(logging);}},GetFarID:function(){id=\"\";if(this.SwfState>=this.SwfLoaded){id=this.flexApp.GetFarID();}return id;},GetNearID:function(){id=\"\";if(this.SwfState>=this.SwfLoaded){id=this.flexApp.GetNearID();}return id;},SetSpeakerVolume:function(volume){if(this.SwfState!=this.SwfError){if(volume<0){volume=0;}else{if(volume>1){volume=1;}}this.flexApp.SetSpeakerVolume(volume);}},SetMicGain:function(gain){if(this.SwfState!=this.SwfError){if(gain<0){gain=0;}else{if(gain>100){gain=100;}}this.flexApp.SetMicGain(gain);}},AudioMute:function(){if(this.SwfState==this.SwfConnected){this.flexApp.AudioMute();}},AudioStart:function(){if(this.SwfState==this.SwfConnected){this.flexApp.AudioStart();}},AudioToggle:function(){if(this.SwfState==this.SwfConnected){this.flexApp.AudioToggle();}},VideoPause:function(){if(this.SwfState==this.SwfConnected){this.flexApp.VideoPause();}},VideoStart:function(){if(this.SwfState==this.SwfConnected){this.flexApp.VideoStart();}},VideoToggle:function(){if(this.SwfState==this.SwfConnected){this.flexApp.VideoToggle();}},LoginError:function(){this.SwfState=this.SwfError;Logger().log(\"LoginError()\");},LoginNotConnected:function(){this.SwfState=this.SwfNotReady;Logger().log(\"LoginNotConnected()\");},LoginConnecting:function(){this.SwfState=this.SwfNotReady;Logger().log(\"LoginConnecting()\");},LoginConnected:function(){this.SwfState=this.SwfReady;Logger().log(\"LoginConnected()\");Logger().log(\"Got Stratus ID of \"+this.GetNearID());},LoginDisconnecting:function(){this.SwfState=this.SwfNotReady;$(\"loginstate\").fireEvent(\"burn\",\"LoginDisconnecting()\");},ChatError:function(){this.SwfState=this.SwfError;Logger().log(\"ChatError()\");},ChatNotReady:function(){this.SwfState=this.SwfNotReady;Logger().log(\"ChatNotReady()\");},ChatReady:function(){this.SwfState=this.SwfReady;Logger().log(\"ChatReady()\");},ChatInitiated:function(){this.SwfState=this.SwfCalling;Logger().log(\"ChatInitiated()\");},ChatEstablished:function(){this.SwfState=this.SwfConnected;Logger().log(\"ChatEstablished()\");},AudioError:function(){this.SwfState=this.SwfError;Logger().log(\"AudioError()\");},AudioNotReady:function(){this.SwfState=this.SwfNotReady;Logger().log(\"AudioNotReady()\");},AudioReady:function(){Logger().log(\"AudioReady()\");},AudioTransmitting:function(){Logger().log(\"AudioTransmitting()\");},AudioPaused:function(){Logger().log(\"AudioPaused()\");},VideoError:function(){this.SwfState=this.SwfError;Logger().log(\"VideoError()\");},VideoNotReady:function(){this.SwfState=this.SwfNotReady;Logger().log(\"VideoNotReady()\");},VideoReady:function(){Logger().log(\"VideoReady()\");Logger().log(\"Camera found.\");this.fireEvent(\"videoChatReset\");},VideoTransmitting:function(){Logger().log(\"VideoTransmitting()\");},VideoPaused:function(){Logger().log(\"VideoPaused()\");},LogChanged:function(){},VideoChatLoaded:function(){this.SwfState=this.SwfLoaded;this.flexApp=$(\"videochat\");},SpeakerVolumeChanged:function(){},MicGainChanged:function(){}});var VideoChatNotification=new Class({Extends:Notification,onBeforeInit:function(options){this.user=options.user;this.stratusId=options.stratusId;options.iconOptions={user:this.user};options.timeout=15000;options.hasActions=true;return options;},onInit:function(){this.acceptButton=new ButtonSmall({displayName:\"Accept\",className:\"dark\",action:\"check\"});this.ignoreButton=new ButtonSmall({displayName:\"Ignore\",className:\"dark\",action:\"cross\"});$(this.ignoreButton).addEvent(\"click\",this.closeNotification.bind(this));$(this.acceptButton).addEvent(\"click\",this.fireEvent.bind(this,[\"videoChatAccept\",this.user,this.stratusId]));$(this.acceptButton).addEvent(\"click\",this.closeNotification.bind(this));$(this.acceptButton).inject(this.actions);$(this.ignoreButton).inject(this.actions);},getText:function(){var el=new Element(\"div\",{\"class\":\"notification_text text11 light1\"}).adopt(new Element(\"span\",{\"text\":this.user.fullname})).appendText(\" invited you to a video conference.\");return el;}});var VideoChatPopup=new Class({Extends:Popup,onCreate:function(){this.shown=true;this.close();},close:function(){if(!this.shown){return;}this.left=this.popup.getStyle(\"left\");this.popup.setStyle(\"left\",\"-5000px\");this.shown=false;},show:function(user){if(this.shown){return;}this.setTitleCustom(user);this.popup.setStyle(\"left\",this.left);this.shown=true;this._select();},setTitleCustom:function(user){var nav=this.navs.get(this.currentContent);var icon=new Icon20({user:user});var titleText=new Element(\"div\",{\"class\":\"title_text\",\"text\":TextUtility.unescapeQuotes(\"Video Conference with \"+user.fullname)});this.titleIcon=$(icon).replaces(this.titleIcon);this.titleText=titleText.replaces(this.titleText);},resetSwf:function(){this.contents.get(this.currentContent).resetSwf();}});var VideoChatPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){options.destroy=false;return options;},onInit:function(){this.videochatWrapper=new Element(\"div\",{\"id\":\"videochatWrapper\"}).inject(this.content);this.actions=new Element(\"div\",{\"class\":\"actions\"}).inject(this.content);this.endButton=new ButtonMedium({displayName:\"End Conference\",className:\"dark\",action:\"cross\"});$(this.endButton).inject(this.actions);$(this.endButton).addEvent(\"click\",this.fireEvent.bind(this,[\"videoChatEnd\"]));},onShow:function(){this.resetSwf();},resetSwf:function(){var flashvars={bridgeName:\"videochat\"};var params={menu:\"false\",allowscriptaccess:\"always\",play:\"true\",quality:\"high\",flashvars:\"bridgeName=videochat\",allowFullScreen:\"true\",wmode:\"window\"};var attributes={id:\"videochat\",name:\"videochat\"};swfobject.embedSWF(\"/swf/VideoChat.swf\",\"videochatWrapper\",\"400\",\"300\",\"10.0.0\",\"expressInstall.swf\",flashvars,params,attributes);},onHide:function(){}});var Appstore=new Class({Extends:App,onStart:function(){this.setupNav();},onStop:function(){},userLoggedIn:function(){},userLoggedOut:function(){this.stop();}});Appstore.implement({requests:[{name:\"apps_get_all\",url:\"/api/apps/app/get_all\"},{name:\"app_create\",params:[\"name\",\"type\",\"likes\",\"state\"],url:\"/api/apps/app/create\"},{name:\"app_update\",params:[\"app_id\",\"name\",\"type\",\"likes\",\"state\"],url:\"/api/apps/app/update\"},{name:\"app_likes_increment\",params:[\"app_id\"],url:\"/api/apps/app/increment\"},{name:\"app_likes_decrement\",params:[\"app_id\"],url:\"/api/apps/app/decrement\"}]});Appstore.implement({setupNav:function(){this.navAdd(new Nav({iconOptions:{iconName:\"updates\"},displayName:\"All Applications\",name:\"apps\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"apps\",\"apps\"])}));var menu=new AppstoreMenu({isDefault:true,closeFunc:this.stop.bind(this)});this.menuAdd(\"apps\",menu);var content=new AppstoreContent({isDefault:true});this.contentAdd(\"apps\",content);}});var AppstoreContent=new Class({Extends:Content,EventHandlers:[\"appInstalled\",\"appUninstalled\"],onBeforeInit:function(options){return options;},onInit:function(){this.loaded=false;this.loader=new ItemLoader({idField:\"app_id\",sortField:\"name\",sortAlpha:true,createElementFunc:AppstoreItemUtility.createAppstoreItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"There are no apps to install\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Applications loading...\"})});$(this.loader).inject(this.content);this.appsInstalled=UserUtility.getInstalledApps();},onShow:function(first){if(first){this.call(\"appstore\",\"apps_get_all\",null,this.loadAppsSuccess.bind(this),null);}this.loader.showLoading();},onHide:function(){},loadAppsSuccess:function(data){this.loader.hideLoading();if(!$defined(data.apps)||data.apps.length==0){}data.apps.each(function(app){if($defined(this.appsInstalled[app.app_id])){app.installed=true;}else{app.installed=false;}this.loader.process(app);},this);},appInstalled:function(data){if(!$defined(data.app_id)){return;}if($defined($(\"appstore_item_\"+data.app_id))){$(\"appstore_item_\"+data.app_id).addClass(\"installed\");$(\"appstore_item_\"+data.app_id).removeClass(\"uninstalled\");}},appUninstalled:function(data){if(!$defined(data.app_id)){return;}if($defined($(\"appstore_item_\"+data.app_id))){$(\"appstore_item_\"+data.app_id).removeClass(\"installed\");$(\"appstore_item_\"+data.app_id).addClass(\"uninstalled\");}}});var AppstoreMenu=new Class({Extends:Menu,EventHandlers:[],onBeforeInit:function(options){options.displayName=\"Pip.io App Store\";return options;},onInit:function(){var appstoreText=\"You can install apps on your Pip.io account to add additional features.  More apps are coming very soon!\";var appstoreText2=\"If you're a developer and interested in creating an app for the Pip.io platform, please contact developers@pip.io\";new Element(\"div\",{\"class\":\"text_section light1\",\"text\":TextUtility.unescape(appstoreText)}).inject(this.menu);new Element(\"div\",{\"class\":\"text_section light1 text11\",\"text\":TextUtility.unescape(appstoreText2)}).inject(this.menu);}});var AppstoreItemUtility={createAppstoreItem:function(app){var el=ItemUtility.createPostBubble(\"post app\",true);el.set(\"id\",\"appstore_item_\"+app.app_id);var installMethod=app.name+\"Install\";var uninstallMethod=app.name+\"Uninstall\";new Element(\"img\",{\"class\":\"app_icon\",\"src\":app.info.icon}).inject(el);new Element(\"div\",{\"class\":\"description\",\"text\":TextUtility.unescape(app.info.description)}).inject(el);var appname=new Element(\"div\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescape(app.display_name)}).inject(el);if(app.type==3){var installButton=new ButtonMedium({displayName:\"Coming Soon!\",action:\"goto dark\"});new Element(\"div\",{\"class\":\"actions\"}).adopt($(installButton)).inject(el);}else{var uninstallButton=new ButtonMedium({className:\"uninstall\",displayName:\"Uninstall Application\",action:\"goto dark\"});$(uninstallButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[uninstallMethod,app]));var installButton=new ButtonMedium({className:\"install\",displayName:\"Install Application\",action:\"goto dark\"});$(installButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[installMethod,app]));if(app.installed){el.addClass(\"installed\");}else{el.addClass(\"uninstalled\");}new Element(\"div\",{\"class\":\"actions\"}).adopt($(installButton),$(uninstallButton)).inject(el);}return el;}};var Contacts=new Class({Extends:App,EventHandlers:[\"userSwitched\",\"userStatusUpdated\",\"userStatusCleared\",\"userOnline\",\"userOffline\",\"userPresenceReceived\",\"selfPresenceReceived\",\"selfPresenceUpdate\",\"userVideoEnabled\",\"showStatusUpdatePopup\",\"userProfilePicUpdated\",\"xmppConnected\",\"xmppConnecting\",\"xmppDisconnected\",\"contactAdded\",\"contactGroupAdded\",\"contactDeleted\",\"contactGroupDeleted\",\"contactGroupMoved\",\"contactRequestAdded\",\"contactRequestDeleted\",\"connectionRequestAccept\",\"connectionRequestDelete\",\"connectionRequestCreate\",\"connectionDelete\",\"userSubscribe\",\"userUnsubscribe\",\"showGroupPickerPopup\",\"showCreateGroupPopup\"],onStart:function(){this.setupNav();},onStop:function(){},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.start();this.initBuddylist();},userLoggedOut:function(){this.stop();},onCreate:function(){this.minButtonAction=new Element(\"div\",{\"class\":\"action pivot_up\"});this.minButton=new Element(\"div\",{\"class\":\"button_nav\"}).adopt(this.minButtonAction).inject(\"self\");this.minButton.addEvent(\"click\",this.toggleNav.bind(this));this.navHeader.destroy();this.connecting=new Element(\"div\",{\"class\":\"connect_state\"}).adopt(new Element(\"div\",{\"class\":\"connect_text light2\",\"text\":\"Connecting to Pip.io...\"}),new Element(\"div\",{\"class\":\"progress\"})).inject(\"nav\");DomUtility.hide(this.navSection);},onDestroy:function(){this.connecting.destroy();},toggleNav:function(){if(!this.isExpanded){this.expand();}else{this.collapse();}},expand:function(){if(!this.isExpanded){DomUtility.expand(this.navWrapper);this.minButtonAction.addClass(\"pivot_up\");this.minButtonAction.removeClass(\"pivot_down\");this.isExpanded=true;}},collapse:function(){if(this.isExpanded){DomUtility.collapse(this.navWrapper);this.minButtonAction.addClass(\"pivot_down\");this.minButtonAction.removeClass(\"pivot_up\");this.isExpanded=false;}},xmppConnected:function(){DomUtility.show(this.navSection);DomUtility.hide(this.connecting);},xmppDisconnected:function(){DomUtility.show(this.connecting);DomUtility.hide(this.navSection);},xmppConnecting:function(){DomUtility.show(this.connecting);DomUtility.hide(this.navSection);},connectionDelete:function(username){this.call(\"contacts\",\"connection_delete\",{username:username},null,null);},connectionRequestCreate:function(username){this.call(\"contacts\",\"connection_request_create\",{username:username},null,null);},connectionRequestAccept:function(username){this.call(\"contacts\",\"connection_request_accept\",{username:username},null,null);},connectionRequestDelete:function(username){this.call(\"contacts\",\"connection_request_delete\",{username:username},null,null);},userSubscribe:function(username){this.call(\"contacts\",\"user_subscribe\",{username:username},null,null);},userUnsubscribe:function(username){this.call(\"contacts\",\"user_unsubscribe\",{username:username},null,null);},userProfilePicUpdated:function(data){if(!$defined(data.username)){return;}var user=this.getUser(data.username);var user_id=user.user_id;var username=user.username;var version=UserUtility.profilePicVersionGet(user_id);version++;UserUtility.profilePicVersionSet(user_id,version);user.profile_pic_16=user.profile_pic_16.split(\"?\")[0]+\"?\"+version;user.profile_pic_20=user.profile_pic_20.split(\"?\")[0]+\"?\"+version;user.profile_pic_26=user.profile_pic_26.split(\"?\")[0]+\"?\"+version;user.profile_pic_32=user.profile_pic_32.split(\"?\")[0]+\"?\"+version;user.profile_pic_42=user.profile_pic_42.split(\"?\")[0]+\"?\"+version;user.profile_pic_60=user.profile_pic_60.split(\"?\")[0]+\"?\"+version;user.profile_pic_100=user.profile_pic_100.split(\"?\")[0]+\"?\"+version;user.profile_pic_200=user.profile_pic_200.split(\"?\")[0]+\"?\"+version;$$(\".profile_pic_16_\"+username).each(function(el){el.set(\"src\",user.profile_pic_16);});$$(\".profile_pic_20_\"+username).each(function(el){el.set(\"src\",user.profile_pic_20);});$$(\".profile_pic_60_\"+username).each(function(el){el.set(\"src\",user.profile_pic_60);});$$(\".profile_pic_26_\"+username).each(function(el){el.set(\"src\",user.profile_pic_26);});$$(\".profile_pic_32_\"+username).each(function(el){el.set(\"src\",user.profile_pic_32);});$$(\".profile_pic_42_\"+username).each(function(el){el.set(\"src\",user.profile_pic_42);});$$(\".profile_pic_100_\"+username).each(function(el){el.set(\"src\",user.profile_pic_100);});$$(\".profile_pic_200_\"+username).each(function(el){el.set(\"src\",user.profile_pic_200);});},destroyApp:function(){this.contents.each(function(content){content.destroy();});this.contents.empty();this.menus.each(function(menu){menu.destroy();});this.menus.empty();this.navs.each(function(nav){nav.destroy();});this.navs.empty();this.navHeader.destroy();this.nav.destroy();this.navSection.destroy();this.fireEvent(\"appClose\",this.appId);if($defined(this.onDestroy)){this.onDestroy();}}});Contacts.implement({initBuddylist:function(){this.contacts=$H();this.contactRequests=$H();this.groups=$H();this.css=new CSS();this.getGroups().each(function(group){this.groupAdd(group);},this);this.getContacts().each(function(user){this.contactAdd(user);},this);this.getContactRequests().each(function(user){this.contactRequestAdd(user);},this);},contactAdded:function(user){if(this.contacts.has(user.username)){return;}this.contactAdd(user);},contactDeleted:function(username){this.contactDelete(username);},contactRequestAdded:function(user){if(this.contactRequests.has(user.username)){return;}this.contactRequestAdd(user);},contactRequestDeleted:function(username){if(!this.contactRequests.has(username)){return;}this.contactRequestDelete(username);},contactGroupAdded:function(group){if(this.groups.has(group.group_id)){return;}this.groupAdd(group);},contactGroupDeleted:function(group){if(!this.groups.has(group.group_id)){return;}this.groupDelete(group);},contactGroupMoved:function(user){this.contactDelete(user.username);Logger().log(\"contactGroupMoved \"+user.username+\" group_id \"+user.group_id);this.contactAdd(user);},selfPresenceUpdate:function(show){if($defined(show)&&this.getPrivateUser().show==show){return;}if($defined(show)){this.getPrivateUser().show=show;}this.p.xmpp.updateSelfPresence(this.getPrivateUser().show,true);},userVideoEnabled:function(username,videoEnabled){if(this.contacts.has(username)){this.contacts.get(username).videoEnabled(videoEnabled);}},userStatusUpdated:function(data){if($defined(this.contacts)&&this.contacts.has(data.username)){this.contacts.get(data.username).statusMsgUpdated(data.status_message.status);}},userStatusCleared:function(data){if($defined(this.contacts)&&this.contacts.has(data.username)){this.contacts.get(data.username).statusMsgUpdated(\"\");}},userOnline:function(username){if(this.contacts.has(username)){var user=this.getContact(username);if(user.status_message.status==\"\"){this.contacts.get(username).online(false);}else{this.contacts.get(username).online(true);}if(!user.online){user.online=true;}}},userOffline:function(username){if(this.contacts.has(username)){this.contacts.get(username).offline();var user=this.getContact(username);if(user.online){user.online=false;}}},userPresenceReceived:function(username,show,online){if(online){this.userOnline(username);if(show==\"\"){this.setUserOnlineClass(username);}else{if(show==\"away\"){this.setUserAwayClass(username);}else{if(show==\"xa\"){this.setUserIdleClass(username);}else{if(show==\"dnd\"){this.userOffline(username);this.setUserOfflineClass(username);}}}}}else{this.userOffline(username);this.setUserOfflineClass(username);}this.getContact(username).show=show;},selfPresenceReceived:function(show,online){if(online){if(show==\"\"){this.setUserOnlineClass(this.getPrivateUser().username);}else{if(show==\"away\"){this.setUserAwayClass(this.getPrivateUser().username);}else{if(show==\"xa\"){this.setUserIdleClass(this.getPrivateUser().username);}else{if(show==\"dnd\"){this.setUserOfflineClass(this.getPrivateUser().username);}}}}}else{this.setUserOfflineClass(this.getPrivateUser().username);}},setUserOnlineClass:function(username){this.css.add_rule(\".online_status_\"+username,{\"border-color\":\"#42a409 !important\"}).refresh();},setUserIdleClass:function(username){this.css.add_rule(\".online_status_\"+username,{\"border-color\":\"#cc8513 !important\"}).refresh();},setUserAwayClass:function(username){this.css.add_rule(\".online_status_\"+username,{\"border-color\":\"#b0191f !important\"}).refresh();},setUserOfflineClass:function(username){this.css.remove_rule(\".online_status_\"+username);this.css.refresh();}});Contacts.implement({requests:[{name:\"connection_group_create\",params:[\"name\"],url:\"/api/user/connection/group/create\"},{name:\"connection_group_delete\",params:[\"group_id\"],url:\"/api/user/connection/group/delete\"},{name:\"connection_group_move\",params:[\"username\",\"group_id\"],url:\"/api/user/connection/group/move\"},{name:\"connection_delete\",params:[\"username\"],url:\"/api/user/connection/delete\"},{name:\"connection_request_create\",params:[\"username\"],url:\"/api/user/connection/request/create\"},{name:\"connection_request_accept\",params:[\"username\"],url:\"/api/user/connection/request/accept\"},{name:\"connection_request_delete\",params:[\"username\"],url:\"/api/user/connection/request/delete\"},{name:\"user_subscribe\",params:[\"username\"],url:\"/api/user/stream/subscribe\"},{name:\"user_unsubscribe\",params:[\"username\"],url:\"/api/user/stream/unsubscribe\"},{name:\"search_user\",params:[\"query\"],url:\"/api/user/search/user\"},{name:\"search_email\",params:[\"email_address\",\"password\"],url:\"/api/user/search/email\"},{name:\"invite_create\",params:[\"email\",\"message\"],url:\"/api/user/invite/create\"}]});Contacts.implement({setupNav:function(){this.navAdd(new Nav({iconOptions:{iconName:\"contacts\",iconAction:\"add\"},hasSubnavs:true,onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"contact_requests\",\"contact_requests\"]),displayName:\"Contact Requests\",defaultClosed:true,name:\"requests\"}));var contactRequestsMenu=new ContactRequestsMenu({displayName:\"Contact Requests\"});this.menuAdd(\"contact_requests\",contactRequestsMenu);var content=new ContactRequestsContent();this.contentAdd(\"contact_requests\",content);this.navAdd(new Nav({iconOptions:{iconName:\"search\"},displayName:\"Search Users...\",onClick:this.fireEvent.bind(this,[\"searchUserShow\"]),name:\"search_user\",bottom:true}));this.navAdd(new Nav({iconOptions:{iconName:\"contacts\",iconAction:\"add\"},displayName:\"Create New Group...\",onClick:this.fireEvent.bind(this,[\"showCreateGroupPopup\"]),name:\"new_group\",bottom:true}));},groupAdd:function(group){var groupNav=new GroupNav({group:group,onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"group_\"+group.group_id,\"menu_\"+group.group_id])});this.navAdd(groupNav);this.groups.set(group.group_id,groupNav);if(group.group_id!=0){var groupMenu=new GroupMenu({displayName:group.name,group:group});}else{var groupMenu=new GroupMenu({displayName:group.name,group:group,unsorted:true});}this.menuAdd(\"menu_\"+group.group_id,groupMenu);var content=new GroupContent({group:group});this.contentAdd(\"group_\"+group.group_id,content);},groupDelete:function(group){this.navDelete(\"group_\"+group.group_id);this.menuClose(\"menu_\"+group.group_id);this.contentClose(\"group_\"+group.group_id);},contactAdd:function(user){var contactNav=new ContactNav({user:user});this.navAdd(contactNav);this.contacts.set(user.username,contactNav);},contactDelete:function(username){if(!this.contacts.has(username)){return;}this.contacts.get(username).destroy();this.navDelete(\"contact_\"+username);this.contacts.erase(username);},contactRequestAdd:function(user){var contactNav=new ContactRequestNav({user:user});this.navAdd(contactNav);this.contactRequests.set(user.username,contactNav);this.fireEvent(\"alertAdd\",\"1_requests\");},contactRequestDelete:function(username){if(!this.contactRequests.has(username)){return;}Logger().log(\"deleting contact request nav \"+username);this.contactRequests.get(username).destroy();this.contactRequests.erase(username);this.navDelete(\"contact_request_\"+username);this.fireEvent(\"alertClear\",\"1_requests\",1);},showStatusUpdatePopup:function(){if($defined(this.statusUpdatePopup)){this.statusUpdatePopup.close();}this.createStatusUpdatePopup();},createStatusUpdatePopup:function(){this.statusUpdatePopup=new Popup({size:{x:350,y:100},resizable:false,dockable:false,className:\"statusUpdate\",onClose:this.destroyStatusUpdatePopup.bind(this)});var nav=new Nav({iconOptions:{user:this.getPrivateUser()},displayName:\"Update Your Status\",closable:true});var content=new StatusUpdatePopupContent({user:this.getPrivateUser()});this.statusUpdatePopup.addContent(\"status_update\",nav,content);},destroyStatusUpdatePopup:function(){this.statusUpdatePopup=null;},showGroupPickerPopup:function(user){if($defined(this.groupPickerPopup)){this.groupPickerPopup.close();}this.createGroupPickerPopup(user);},createGroupPickerPopup:function(user){this.groupPickerPopup=new Popup({size:{x:200,y:250},resizable:false,dockable:false,className:\"groupPicker\",onClose:this.destroyGroupPickerPopup.bind(this)});var nav=new Nav({iconOptions:{user:user},displayName:\"Edit \"+TextUtility.unescape(user.fullname),closable:true});var content=new GroupPickerPopupContent({user:user});this.groupPickerPopup.addContent(\"group_picker\",nav,content);},destroyGroupPickerPopup:function(){this.groupPickerPopup=null;},showCreateGroupPopup:function(){if($defined(this.createGroupPopup)){this.createGroupPopup.close();}this.createCreateGroupPopup();},createCreateGroupPopup:function(){this.createGroupPopup=new Popup({size:{x:350,y:74},resizable:false,dockable:false,className:\"createGroup\",onClose:this.destroyCreateGroupPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"contacts\",iconAction:\"add\"},displayName:\"Create New Group\",closable:true});var content=new CreateGroupPopupContent({});this.createGroupPopup.addContent(\"create_group\",nav,content);},destroyCreateGroupPopup:function(){this.createGroupPopup=null;}});var ContactRequestsContent=new Class({Extends:Content,EventHandlers:[\"contactRequestAdded\",\"contactRequestDeleted\"],onInit:function(){this.loaded=false;this.loader=new ItemLoader({idField:\"username\",sortField:\"last_name\",sortAlpha:true,createElementFunc:ContactItemUtility.createContactRequestItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"You do not have any contact requests\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.populateContacts();}},onHide:function(){},populateContacts:function(){var contacts=this.getContactRequests();contacts.each(function(user){this.loader.process(user);},this);this.loaded=true;},contactRequestAdded:function(user){this.loader.process(user);},contactRequestDeleted:function(username){this.loader.remove(username);}});var GroupContent=new Class({Extends:Content,EventHandlers:[\"contactAdded\",\"contactDeleted\",\"contactGroupMoved\"],onBeforeInit:function(options){this.group=options.group;return options;},onInit:function(){this.loaded=false;this.loader=new ItemLoader({idField:\"user_id\",sortField:\"last_name\",sortAlpha:true,createElementFunc:ContactItemUtility.createContactItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"There are no contacts in this group\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.populateContacts();}},onHide:function(){},populateContacts:function(){var contacts=this.group.users;contacts.each(function(user){this.loader.process(user);},this);this.loaded=true;},contactAdded:function(user){if(!this.loaded||user.group_id!=this.group.group_id){return;}this.loader.process(user);},contactDeleted:function(username,group_id){if(!this.loaded||group_id!=this.group.group_id){return;}var user=this.getUser(username);this.loader.remove(user.user_id);},contactGroupMoved:function(user){if(user.group_id==this.group.group_id){this.loader.process(user);}else{this.loader.remove(user.user_id);}}});var ContactRequestsMenu=new Class({Extends:Menu,strings:{contactRequestsText:\"These users requested to add you as their contact\"},onInit:function(){new Element(\"div\",{\"class\":\"text_section light1\",\"text\":this.strings.contactRequestsText}).inject(this.menu);}});var GroupMenu=new Class({Extends:Menu,strings:{groupMenuText:'These are contacts in your group \"{0}\"',unsortedGroupMenuText:\"These are contacts that have not been added to a group\"},onBeforeInit:function(options){this.group=options.group;this.unsorted=options.unsorted||false;return options;},onInit:function(){if(this.unsorted){new Element(\"div\",{\"class\":\"text_section light1\",\"text\":String.format(this.strings.unsortedGroupMenuText)}).inject(this.menu);}else{new Element(\"div\",{\"class\":\"text_section light1\",\"text\":String.format(this.strings.groupMenuText,TextUtility.unescape(this.group.name))}).inject(this.menu);}if(!this.unsorted){this.deleteButton=new ButtonMedium({displayName:\"Delete Group\",className:\"dark\",action:\"cross\"});var name=\"groupDelete_\"+this.group.group_id;var title=\"Delete \"+this.group.name;var message=\"Are you sure you want to delete the group \"+this.group.name+\"?\";var func=this.deleteGroup.bind(this);$(this.deleteButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showConfirmation\",name,title,message,func]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.deleteButton)).inject(this.menu);}},deleteGroup:function(){var params={group_id:this.group.group_id};this.call(\"contacts\",\"connection_group_delete\",params,this.deleteGroupSuccess.bind(this),this.deleteGroupFail.bind(this));this.deleteButton.showProgress();},deleteGroupSuccess:function(data){this.deleteButton.hideProgress();},deleteGroupFail:function(){this.deleteButton.hideProgress();}});var ContactNav=new Class({Extends:Nav,onBeforeInit:function(options){this.user=options.user;this.isOnline=false;options.name=\"contact_\"+this.user.username;options.iconOptions={user:this.user};options.onClick=this.fireEvent.bind(this,[\"chatStart\",this.user.username]);options.displayName=this.user.fullname;options.className=\"contact\";options.parentName=\"group_\"+this.user.group_id;return options;},onInit:function(){$(this.icon).destroy();this.icon=new Icon20(this.iconOptions);$(this.icon).inject(this.nav);$(this.icon).addEvent(\"click\",this.openUser.bindWithEvent(this));this.videoChatIcon=new Icon({iconName:\"video_chat\"});$(this.videoChatIcon).inject(this.nav);$(this.videoChatIcon).addEvent(\"click\",this.videoChatStart.bindWithEvent(this));var statusMsg=($defined(this.user.status_message)&&$defined(this.user.status_message.status))?this.user.status_message.status:\"\";this.statusMsg=new Element(\"div\",{\"class\":\"status_msg status_msg_\"+this.user.username,\"text\":TextUtility.unescape(statusMsg)}).inject(this.nav);if(this.user.online){if(statusMsg==\"\"){this.online(false);}else{this.online(true);}}},statusMsgUpdated:function(statusMsg){this.statusMsg.set(\"text\",TextUtility.unescape(statusMsg));if(this.isOnline){if(statusMsg==\"\"){DomUtility.setHeight(this.nav,22);}else{DomUtility.setHeight(this.nav,36);}}},online:function(hasStatus){if(hasStatus){DomUtility.expandFade(this.nav,36);}else{DomUtility.expandFade(this.nav,22);}this.navWrapper.addClass(\"online\");this.isOnline=true;},offline:function(){DomUtility.collapseFade(this.nav);this.navWrapper.removeClass(\"online\");this.isOnline=false;},videoEnabled:function(enabled){if(enabled){this.nav.addClass(\"videoEnabled\");}else{this.nav.removeClass(\"videoEnabled\");}},openUser:function(e){e.stopPropagation();this.fireEvent(\"showUser\",this.user);},videoChatStart:function(e){e.stopPropagation();this.fireEvent(\"videoChatStart\",this.user);}});var ContactRequestNav=new Class({Extends:Nav,onBeforeInit:function(options){this.user=options.user;options.name=\"contact_request_\"+this.user.username;options.iconOptions={user:this.user};options.onClick=this.fireEvent.bind(this,[\"showUser\",this.user]);options.displayName=this.user.fullname;options.className=\"contact request\";options.parentName=\"requests\";return options;},onInit:function(){$(this.icon).destroy();this.icon=new Icon20(this.iconOptions);$(this.icon).inject(this.nav);}});var GroupNav=new Class({Extends:Nav,onBeforeInit:function(options){this.group=options.group;options.name=\"group_\"+this.group.group_id;options.iconOptions={iconName:\"contacts\"};options.displayName=this.group.name;options.className=\"group_nav\";options.hasSubnavs=true;return options;},onInit:function(){this.onlineCount=new Element(\"div\",{\"class\":\"online_count text11 light2\"}).inject(this.nav);DomUtility.hide(this.onlineCount);},onExpand:function(){this.hideOnlineCount();},onCollapse:function(){this.showOnlineCount();},showOnlineCount:function(){this.onlineCount.set(\"text\",this.getOnlineCount());DomUtility.show(this.onlineCount);},hideOnlineCount:function(){DomUtility.hide(this.onlineCount);},getOnlineCount:function(){return this.subnavItems.getChildren(\".online\").length+\"/\"+this.subnavItems.getChildren().length;}});var SubscribersNav=new Class({Extends:Nav,onBeforeInit:function(options){this.users=$H();options.name=\"subscribers\";options.iconOptions={iconName:\"broadcast\"};options.displayName=\"Subscribers\";options.className=\"subscribers_nav\";options.hasSubnavs=true;return options;},onInit:function(){this.clear=new Element(\"div\",{\"style\":\"clear: both\"});this.list=new Element(\"div\",{\"class\":\"menu_list\"}).adopt(this.clear).inject(this.subnavs);},addUsers:function(users){$splat(users).each(function(user){user=UserUtility.processUser(user);if(!this.users.has(user.username)){var pic=ItemUtility.createProfilePic(user,\"16a\");pic.addEvent(\"click\",this.fireEvent.bind(this,[\"showUser\",user]));pic.inject(this.clear,\"before\");this.users.set(user.username,pic);}},this);},removeUser:function(username){if(!this.users.has(username)){return;}this.users.get(username).destroy();this.users.erase(username);}});var SubscriptionsNav=new Class({Extends:Nav,onBeforeInit:function(options){this.users=$H();options.name=\"subscriptions\";options.iconOptions={iconName:\"broadcast\"};options.displayName=\"Subscriptions\";options.className=\"subscribers_nav\";options.hasSubnavs=true;return options;},onInit:function(){this.clear=new Element(\"div\",{\"style\":\"clear: both\"});this.list=new Element(\"div\",{\"class\":\"menu_list\"}).adopt(this.clear).inject(this.subnavs);},addUsers:function(users){$splat(users).each(function(user){user=UserUtility.processSource(user);if(!this.users.has(user.username)){var pic=ItemUtility.createProfilePic(user,\"16a\");if($defined(user.user_id)){pic.addEvent(\"click\",this.fireEvent.bind(this,[\"showUser\",user]));}else{if($defined(user.room_id)){pic.addEvent(\"click\",this.fireEvent.bind(this,[\"showRoom\",user]));}}pic.inject(this.clear,\"before\");this.users.set(user.username,pic);}},this);},removeUser:function(username){if(!this.users.has(username)){return;}this.users.get(username).destroy();this.users.erase(username);}});var ContactPickerPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.contacts=options.contacts;this.contactAddFunc=options.contactAddFunc;this.hasGroups=options.hasGroups||true;if(this.hasGroups){this.groups=options.groups;this.groupAddFunc=options.groupAddFunc;}this.hasAllContacts=options.hasAllContacts||true;if(this.hasAllContacts){this.allContactsAddFunc=options.allContactsAddFunc;}return options;},onInit:function(){this.css=new CSS();this.input=new Element(\"input\",{\"type\":\"text\",\"maxlength\":50});this.input.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.input).inject(this.content);this.list=new Element(\"div\",{\"class\":\"itemList\"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Close\",className:\"dark\",action:\"cross\"});new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.closeButton)).inject(this.content);$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.insertContacts();this.scroll=new Fx.Scroll(this.list);},insertContacts:function(){if(this.hasAllContacts){var el=ShareBoxUtility.createAllContactsPickerItem();el.addEvent(\"click\",this.addAllContacts.bind(this,[el]));el.inject(this.list);this.insertSeperator();}if(this.hasGroups){this.groups.each(function(group){var el=ShareBoxUtility.createGroupPickerItem(group);el.addEvent(\"click\",this.addGroup.bind(this,[group,el]));el.inject(this.list);},this);this.insertSeperator();}this.contacts.getValues().sort(DataUtility.sortUsers).each(function(user){var el=ShareBoxUtility.createContactPickerItem(user);el.addEvent(\"click\",this.addContact.bind(this,[user,el]));el.inject(this.list);},this);},insertSeperator:function(){new Element(\"div\",{\"class\":\"listItem seperator\"}).inject(this.list);},addAllContacts:function(el){this.allContactsAddFunc();el.destroy();this.closeContent();},addContact:function(user,el){this.contactAddFunc(user);el.destroy();},addGroup:function(group,el){this.groupAddFunc(group);el.destroy();},inputKeyUp:function(e){if(e.key==\"esc\"){e.target.value=\"\";}var val=e.target.value.trim().toLowerCase();if(val.length<2){this.list.removeClass(\"search\");return;}this.list.addClass(\"search\");if($defined(this.lastSelector)){this.css.remove_rule(this.lastSelector);}var selector=\".listItem[val1^='\"+val+\"'], .listItem[val2^='\"+val+\"']\";this.css.add_rule(selector,{\"display\":\"block !important\"}).refresh();this.lastSelector=selector;},focus:function(){this.input.focus.delay(500,this.input);},onClose:function(){if($defined(this.lastSelector)){this.css.remove_rule(this.lastSelector).refresh();}},onShow:function(){if($defined(this.scrollY)){this.scroll.set(0,this.scrollY);}this.focus();},onHide:function(){if($defined(this.list)){this.scrollY=this.list.getScroll().y;}}});var CreateGroupPopupContent=new Class({Extends:PopupContent,strings:{groupNameLabel:\"Group Name:\",errorMessage:\"There was an error creating this group\"},onInit:function(){this.groupNameInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"32\"});this.groupNameInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.groupNameLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.groupNameInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Create Group\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.createGroup.bind(this));this.message=new Element(\"div\",{\"class\":\"message error\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.groupNameInput.value.trim()!=\"\"){this.createGroup();}}},createGroup:function(){var name=this.groupNameInput.value.trim();var params={name:name};this.call(\"contacts\",\"connection_group_create\",params,this.createGroupSuccess.bind(this),this.createGroupFail.bind(this));this.actionButton.showProgress();},createGroupSuccess:function(){this.actionButton.hideProgress();this.closeContent();},createGroupFail:function(){this.actionButton.hideProgress();this.closeContent();},onShow:function(){this.focus();},focus:function(){this.groupNameInput.focus.delay(500,this.groupNameInput);}});var GroupPickerPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.user=options.user;return options;},onInit:function(){this.list=new Element(\"div\",{\"class\":\"itemList\"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Close\",className:\"dark\",action:\"cross\"});new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.closeButton)).inject(this.content);$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.insertGroups();},insertGroups:function(){var groups=this.getGroups();groups.each(function(group){var el=ShareBoxUtility.createGroupPickerItem(group);if(this.user.group_id==group.group_id){el.addClass(\"on\");this.selectedEl=el;}else{el.addEvent(\"click\",this.groupMove.bind(this,[group,el]));}el.inject(this.list);},this);},groupMove:function(group,el){var params={username:this.user.username,group_id:group.group_id};this.call(\"contacts\",\"connection_group_move\",params,this.groupMoveSucess.bind(this),this.groupMoveFail.bind(this));this.selectedEl.removeClass(\"on\");new Element(\"div\",{\"class\":\"progress\"}).inject(el);},groupMoveSucess:function(data){this.closeContent();},groupMoveFail:function(){this.closeContent();}});var StatusUpdatePopupContent=new Class({Extends:PopupContent,onInit:function(){this.statusInput=new Element(\"textarea\",{\"maxlength\":500});this.statusInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.statusInput).inject(this.content);this.cancelButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.cancelButton).addEvent(\"click\",this.closeContent.bind(this));this.updateButton=new ButtonMedium({displayName:\"Update Status\",className:\"dark\",action:\"check\"});$(this.updateButton).addEvent(\"click\",this.updateStatus.bind(this));new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.updateButton),$(this.cancelButton)).inject(this.content);},onShow:function(){this.focus();},focus:function(){this.statusInput.focus.delay(500,this.statusInput);},inputKeyUp:function(e){if(e.key==\"enter\"){var msg=e.target.value.trim();if(msg==\"\"){return;}this.updateStatus();}},updateStatus:function(){var params={username:\"\",body:this.statusInput.value.trim(),res:this.getSession()};this.call(\"pipio\",\"publish_status\",params,this.updateStatusSuccess.bind(this),this.updateStatusFail.bind(this));this.updateButton.showProgress();},updateStatusSuccess:function(){this.closeContent();},updateStatusFail:function(){alert(\"There was an error updating your status!\");}});var ContactItemUtility={createContactItem:function(user){var el=ItemUtility.createPostBubble(\"post contact\",true);ItemUtility.createProfilePic(user,60).inject(el);var header=new Element(\"div\",{\"class\":\"heading\"}).inject(el);var username=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescape(user.fullname)}).inject(header);username.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));var status=new Element(\"span\",{\"class\":\"status status_msg_\"+user.username}).inject(header);if(user.status_message.status.trim()!=\"\"){status.set(\"text\",\" \"+TextUtility.unescape(user.status_message.status.trim()));}var viewButton=new ButtonMedium({displayName:\"View Profile\",action:\"goto dark\"});$(viewButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));var editButton=new ButtonMedium({displayName:\"Edit Group\",action:\"status dark\"});$(editButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showGroupPickerPopup\",user]));var deleteButton=new ButtonMedium({displayName:\"Delete Contact\",action:\"cross\"});var name=\"contactDelete_\"+user.username;var title=\"Delete \"+user.fullname;var message=\"Are you sure you want to delete \"+user.fullname+\" from your contacts?\";var func=pipio.dispatchEvent.bind(pipio,[\"connectionDelete\",user.username]);$(deleteButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showConfirmation\",name,title,message,func]));new Element(\"div\",{\"class\":\"actions\"}).adopt($(viewButton),$(editButton),$(deleteButton)).inject(el);return el;},createContactRequestItem:function(user){var el=ItemUtility.createPostBubble(\"post contact\",true);ItemUtility.createProfilePic(user,60).inject(el);var header=new Element(\"div\",{\"class\":\"heading\"}).inject(el);var username=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescape(user.fullname)}).inject(header);username.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));var status=new Element(\"span\",{\"class\":\"status status_msg_\"+user.username}).inject(header);if(user.status_message.status.trim()!=\"\"){status.set(\"text\",\" \"+TextUtility.unescape(user.status_message.status.trim()));}var viewButton=new ButtonMedium({displayName:\"View Profile\",action:\"goto dark\"});$(viewButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));var acceptButton=new ButtonMedium({displayName:\"Accept Request\",action:\"check\"});$(acceptButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"connectionRequestAccept\",user.username]));var deleteButton=new ButtonMedium({displayName:\"Delete Request\",action:\"cross\"});$(deleteButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"connectionRequestDelete\",user.username]));new Element(\"div\",{\"class\":\"actions\"}).adopt($(viewButton),$(acceptButton),$(deleteButton)).inject(el);return el;},createRoomMemberItemFactory:function(room,isAdmin){return function(user){return ContactItemUtility.createRoomMemberItem.run([user,room,isAdmin]);};},createRoomMemberItem:function(user,room,isAdmin){var el=ItemUtility.createPostBubble(\"post contact\",true);ItemUtility.createProfilePic(user,60).inject(el);var header=new Element(\"div\",{\"class\":\"heading\"}).inject(el);var username=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescape(user.fullname)}).inject(header);username.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));var status=new Element(\"span\",{\"class\":\"status status_msg_\"+user.username}).inject(header);if(user.status_message.status.trim()!=\"\"){status.set(\"text\",\" \"+TextUtility.unescape(user.status_message.status.trim()));}if(isAdmin&&user.user_id!=pipio.currentUser.user_id){var viewButton=new ButtonMedium({displayName:\"View Profile\",action:\"goto dark\"});$(viewButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));var removeButton=new ButtonMedium({displayName:\"Remove Member\",action:\"cross\"});$(removeButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"feedRoomKick\",user.username,room.username]));new Element(\"div\",{\"class\":\"actions\"}).adopt($(viewButton),$(removeButton)).inject(el);}else{var viewButton=new ButtonMedium({displayName:\"View Profile\",action:\"goto dark\"});$(viewButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));new Element(\"div\",{\"class\":\"actions\"}).adopt($(viewButton)).inject(el);}return el;},createRoomSubscriberItem:function(user){var el=ItemUtility.createPostBubble(\"post contact\",true);ItemUtility.createProfilePic(user,60).inject(el);var header=new Element(\"div\",{\"class\":\"heading\"}).inject(el);var username=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescape(user.fullname)}).inject(header);username.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));var status=new Element(\"span\",{\"class\":\"status status_msg_\"+user.username}).inject(header);if(user.status_message.status.trim()!=\"\"){status.set(\"text\",\" \"+TextUtility.unescape(user.status_message.status.trim()));}var viewButton=new ButtonMedium({displayName:\"View Profile\",action:\"goto dark\"});$(viewButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));new Element(\"div\",{\"class\":\"actions\"}).adopt($(viewButton)).inject(el);return el;},createRoomRequestItemFactory:function(room){return function(user){return ContactItemUtility.createRoomRequestItem.run([user,room]);};},createRoomRequestItem:function(user,room){var el=ItemUtility.createPostBubble(\"post contact\",true);ItemUtility.createProfilePic(user,60).inject(el);var header=new Element(\"div\",{\"class\":\"heading\"}).inject(el);var username=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescape(user.fullname)}).inject(header);username.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));var status=new Element(\"span\",{\"class\":\"status status_msg_\"+user.username}).inject(header);if(user.status_message.status.trim()!=\"\"){status.set(\"text\",\" \"+TextUtility.unescape(user.status_message.status.trim()));}var viewButton=new ButtonMedium({displayName:\"View Profile\",action:\"goto dark\"});$(viewButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));var removeButton=new ButtonMedium({displayName:\"Reject Member\",action:\"cross\"});$(removeButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"feedRoomRequestDelete\",user.username,room.username]));var acceptButton=new ButtonMedium({displayName:\"Accept Member\",action:\"check\"});$(acceptButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"feedRoomRequestAccept\",user.username,room.username]));new Element(\"div\",{\"class\":\"actions\"}).adopt($(viewButton),$(removeButton),$(acceptButton)).inject(el);return el;}};var Facebook=new Class({Extends:App,EventHandlers:[\"facebookInstall\",\"facebookUninstall\",\"facebookShowUserFeed\",\"facebookShowUserAlbums\",\"facebookTaggedPhotos\",\"userSwitched\"],parseOptions:function(options){this.settings=options.settings;},userSwitched:function(){if(!this.isLoggedIn()){this.userLoggedOut();}},userLoggedOut:function(){FB.Connect.logout();this.stop();},onStart:function(){this.appId=5;FB_RequireFeatures([\"Connect\"],function(){FB.Facebook.init(\"d29a9328a49d798da896066499c0d9d8\",\"/xd_receiver.htm\",{\"forceBrowserPopupForLogin\":true,\"doNotUseCachedConnectState\":true});});this.appsInstalled=UserUtility.getInstalledApps();if($defined(this.appsInstalled[this.appId])){this.external_user_id=this.appsInstalled[this.appId];}this.setupNav();this.albums=$H();},onStop:function(){},userLoggedIn:function(){},userLoggedOut:function(){this.stop();},facebookInstall:function(){this.facebookInstallPopup=new Popup({size:{x:350,y:80},resizable:false,dockable:false,className:\"appInstall\",onClose:this.destroyFacebookInstallPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"facebook\"},displayName:\"Install Facebook\",closable:true});var content=new FacebookInstallPopupContent({});this.facebookInstallPopup.addContent(\"facebook_install\",nav,content);},destroyFacebookInstallPopup:function(){this.facebookInstallPopup=null;},facebookUninstall:function(app){this.call(\"facebook\",\"facebook_disable\",null,this.facebookUninstallSuccess.bind(this),null);},facebookUninstallSuccess:function(data){this.stop();},facebookShowUserFeed:function(user){this.userAdd(user);},facebookShowUserAlbums:function(user){this.userAlbumsAdd(user);},facebookTaggedPhotos:function(uid){var newAlbum=new Album({id:uid});this.albums.set(uid,newAlbum);var params={user_id:uid,aid:\"\"};this.call(\"facebook\",\"facebook_photos\",params,this.facebookTaggedPhotosSuccess.bind(this),this.facebookTaggedPhotosFail.bind(this));},facebookTaggedPhotosSuccess:function(data){if(!$defined(data.photos)){return;}var album=this.albums.get(data.uid);data.photos.each(function(photo){album.addPhoto(photo.pid,photo.src,photo.src_big,photo.caption);photo.auid=photo.uid;},this);var photo=album.getPhoto(data.photos[0].pid);this.fireEvent(\"viewAlbum\",album,photo,data.uid);},facebookTaggedPhotosFail:function(data){}});Facebook.implement({requests:[{name:\"facebook_enable\",params:[\"sync_posts\",\"session_key\",\"uid\"],url:\"/api/app/facebook/account/enable\"},{name:\"facebook_disable\",url:\"/api/app/facebook/account/disable\"},{name:\"facebook_friends_info\",params:[\"uid\",\"limit\",\"sort_field\",\"number\"],url:\"/api/app/facebook/friends/info\"},{name:\"facebook_newsfeed_load\",params:[\"start_time\",\"end_time\"],url:\"/api/app/facebook/newsfeed/load\"},{name:\"facebook_user_show\",params:[\"user_id\"],url:\"/api/app/facebook/user/profile_load\"},{name:\"facebook_user_feed\",params:[\"user_id\",\"start_time\",\"end_time\"],url:\"/api/app/facebook/user/newsfeed_load\"},{name:\"facebook_settings_update\",params:[\"key\",\"value\"],url:\"/api/app/facebook/settings/update\"},{name:\"facebook_albums\",params:[\"user_id\",\"num_photos\"],url:\"/api/app/facebook/albums/get\"},{name:\"facebook_photos\",params:[\"user_id\",\"aid\"],url:\"/api/app/facebook/photos/get\"},{name:\"facebook_notification_send\",params:[\"user_id\",\"message\"],url:\"/api/app/facebook/notification/send\"},{name:\"facebook_post_text\",params:[\"body\",\"post_id\",\"target_id\"],url:\"/api/app/facebook/text/item_create\"},{name:\"facebook_post_link\",params:[\"body\",\"url\",\"post_id\",\"target_id\"],url:\"/api/app/facebook/link/item_create\"},{name:\"facebook_post_photo\",params:[\"body\",\"photo\",\"post_id\",\"target_id\"],url:\"/api/app/facebook/photo/item_create\",multipart:true},{name:\"facebook_comments\",params:[\"post_id\"],url:\"/api/app/facebook/comments/get\"},{name:\"facebook_feed_delete\",params:[\"post_id\",\"created_time\"],url:\"/api/app/facebook/item/delete\"},{name:\"facebook_settings_get\",url:\"/api/app/facebook/settings/get\"},{name:\"facebook_contacts_list\",params:[\"uid\",\"limit\",\"sort_field\",\"number\"],url:\"/api/app/facebook/friends/info\"},{name:\"facebook_post_like\",params:[\"post_id\",\"like_count\"],url:\"/api/app/facebook/like\"},{name:\"facebook_post_unlike\",params:[\"post_id\",\"like_count\"],url:\"/api/app/facebook/unlike\"}]});Facebook.implement({setupNav:function(){this.users=$H();this.fb_albums=$H();this.navAdd(new Nav({iconOptions:{iconName:\"updates\"},displayName:\"News Feed\",name:\"updates\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"updates\",\"fb_self_menu\"])}));this.navAdd(new Nav({iconOptions:{iconName:\"profile_pic\"},displayName:\"My Wall\",name:\"wall\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"wall\",\"fb_self_menu\"])}));this.navAdd(new Nav({iconOptions:{iconName:\"profile_pic\"},displayName:\"Friends\",name:\"friends\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"friends\",\"fb_self_menu\"])}));this.navAdd(new Nav({iconOptions:{iconName:\"photo\"},displayName:\"My Albums\",name:\"albums\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"albums\",\"fb_self_menu\"])}));var user=this.getPrivateUser();var fbSelfMenu=new FacebookSelfMenu({user:user,isDefault:true,uid:this.settings.uid,closeFunc:this.stop.bind(this)});this.menuAdd(\"fb_self_menu\",fbSelfMenu);var content=new FacebookFeedContent({isDefault:true});this.contentAdd(\"updates\",content);var friendsContent=new FacebookFriendContent({user:user,uid:this.settings.uid});this.contentAdd(\"friends\",friendsContent);var wallContent=new FacebookWallContent({user:user,uid:this.settings.uid});this.contentAdd(\"wall\",wallContent);var albumsContent=new FacebookAlbumContent({uid:this.settings.uid});this.contentAdd(\"albums\",albumsContent);},userClose:function(uid){if(!this.users.has(uid)){return;}this.users.get(uid).destroy();this.navDelete(uid);this.users.erase(uid);this.menuClose(uid);this.contentClose(uid);if(this.users.getLength()==0){this.navDelete(\"users\");this.usersNav=null;}},userAdd:function(user){if(!$defined(this.usersNav)){this.usersNav=new Nav({iconOptions:{iconName:\"users\"},hasSubnavs:true,displayName:\"Users\",name:\"users\"});this.navAdd(this.usersNav);}var nav=new Nav({iconOptions:{iconName:user.pic},displayName:user.username,closable:true,name:user.uid,parentName:\"users\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,user.uid,user.uid])});this.navAdd(nav);this.users.set(user.uid,nav);var userContent=new FacebookUserContent({uid:user.uid});this.contentAdd(user.uid,userContent);var fbUserMenu=new FacebookUserMenu({user:user,uid:user.uid,closeFunc:this.userClose.bind(this,[user.uid])});this.menuAdd(user.uid,fbUserMenu);this.fireEvent(\"viewSwitch\",this.appId,user.uid,user.uid);},albumClose:function(uid){if(!this.fb_albums.has(uid)){return;}this.fb_albums.get(uid).destroy();this.navDelete(uid+\"_albums\");this.fb_albums.erase(uid);this.menuClose(uid+\"_albums\");this.contentClose(uid+\"_albums\");if(this.fb_albums.getLength()==0){this.navDelete(\"albums\");this.userAlbumNav=null;}},userAlbumsAdd:function(user){if(!$defined(this.userAlbumNav)){this.usersAlbumNav=new Nav({iconOptions:{iconName:\"photo\"},hasSubnavs:true,displayName:\"Albums\",name:\"fb_albums\"});this.navAdd(this.usersAlbumNav);}var nav=new Nav({iconOptions:{iconName:user.pic_square},displayName:user.name,closable:true,name:user.uid+\"_albums\",parentName:\"fb_albums\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,user.uid+\"_albums\",user.uid])});this.navAdd(nav);this.fb_albums.set(user.uid,nav);var userAlbumContent=new FacebookAlbumContent({uid:user.uid});this.contentAdd(user.uid+\"_albums\",userAlbumContent);var fbUserMenu=new FacebookUserMenu({user:user,uid:user.uid,closeFunc:this.albumClose.bind(this,[user.uid])});this.menuAdd(user.uid+\"_albums\",fbUserMenu);this.fireEvent(\"viewSwitch\",this.appId,user.uid+\"_albums\",user.uid);}});var FacebookAlbumContent=new Class({Extends:Content,EventHandlers:[\"facebookAlbumView\"],onBeforeInit:function(options){this.uid=options.uid;options.displayName=\"Facebook Albums\";return options;},onInit:function(){this.albums=$H();this.albumsLoader=new ItemLoader({idField:\"aid\",sortField:\"modified_major\",createElementFunc:FacebookAlbumUtility.createFacebookAlbumItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"There are no albums here\"}),errorEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"You are not able to view these albums\"})});$(this.albumsLoader).inject(this.content);},onShow:function(first){if(first){this.getFacebookAlbums();}},onHide:function(){},getFacebookAlbums:function(){var params={user_id:this.uid};this.call(\"facebook\",\"facebook_albums\",params,this.facebookGetAlbumsSuccess.bind(this),this.facebookGetAlbumsFail.bind(this));},facebookGetAlbumsSuccess:function(data){if($defined(data.albums)){data.albums.albums.each(function(album){var pid=album.cover_pid;album.coverSrc=data.albums.sources[pid];this.albumsLoader.process(album);},this);}},facebookGetAlbumsFail:function(data){this.albumsLoader.showError();},facebookAlbumView:function(album){var newAlbum=new Album({id:album.aid});this.albums.set(album.aid,newAlbum);var params={user_id:\"\",aid:album.aid};this.call(\"facebook\",\"facebook_photos\",params,this.facebookAlbumViewSuccess.bind(this),null);},facebookAlbumViewSuccess:function(data){if(!$defined(data.photos)){return;}var album=this.albums.get(data.aid);data.photos.each(function(photo){album.addPhoto(photo.pid,photo.src,photo.src_big,photo.caption);photo.auid=photo.aid;},this);var photo=album.getPhoto(data.photos[0].pid);this.fireEvent(\"viewAlbum\",album,photo,data.aid);}});var FacebookFeedContent=new Class({Extends:Content,EventHandlers:[\"facebookItemDelete\",\"facebookItemLike\",\"facebookCommentsShow\",\"facebookSelfData\",\"facebookCommentsUpdated\",\"facebookFeed\"],onInit:function(){this.loader=new ItemLoader({idField:\"post_id\",sortField:\"created_time\",sortAscending:false,createElementFunc:FacebookFeedItemUtility.createFacebookFeedItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"You have no updates\"})});$(this.loader).inject(this.content);this.comments=new Hash();this.commentLoaders=new Hash();this.posts=new Hash();},onShow:function(first){if(first){this.startPoll();}},onHide:function(){},facebookSelfData:function(user){this.statusBox=new FacebookStatusBox(user,true);$(this.statusBox).inject(this.content,\"top\");},startPoll:function(){if(!$defined(this.pollTimer)){this.pollTimer=this.facebookFeed.periodical(55*1000,this);this.facebookFeed();}},facebookFeed:function(){var startTime=this.loader.lowestSortValue;var params={start_time:startTime,end_time:0};this.call(\"facebook\",\"facebook_newsfeed_load\",params,this.loadMoreSuccess.bind(this),null);},loadMore:function(){var endTime=this.loader.lowestSortValue;var startTime=parseInt(endTime)-259200;var params={start_time:startTime,end_time:endTime};this.call(\"facebook\",\"facebook_newsfeed_load\",params,this.loadMoreSuccess.bind(this),null);},loadMoreSuccess:function(data){if(!$defined(data)||data.length==0){this.atBottom=true;return;}data.each(function(item){this.loader.process(item);this.processComments(item);},this);this.bottomFuncCalled=false;},processComments:function(item){if(this.posts.has(item.post_id)){if(this.posts.get(item.post_id)!=item.comment_count){$$(\".comments_\"+item.post_id).each(function(el){var commentText=TextUtility.pluralText(item.comment_count,\"Comment\",\"Comments\");el.set(\"comments\",item.comment_count);el.empty();el.adopt(new Element(\"div\",{\"class\":\"action convo\"}));el.appendText(commentText);});}var likePost=$$(\".likes_\"+item.post_id);if($defined(likePost[0])){var likesCount=parseInt(likePost[0].get(\"likes\"));if(likesCount!=parseInt(item.like_count)){this.facebookItemLikeSuccess({post_id:item.post_id,liked:item.user_likes,like_count:item.like_count});}}}else{this.posts.set(item.post_id,item.comment_count);}},bottomFunc:function(){Logger().log(\"facebook content bottom\");this.loadMore();},facebookItemDelete:function(post_id,created_time){var params={\"post_id\":post_id,\"created_time\":created_time};this.call(\"facebook\",\"facebook_feed_delete\",params,this.facebookItemDeleteSuccess.bind(this),null);},facebookItemDeleteSuccess:function(data){if(!$defined(data.post_id)){return;}this.loader.remove(data.post_id);},facebookItemLike:function(post_id,likeEl){var user_likes=parseInt(likeEl.get(\"is_liked\"));var like_count=parseInt(likeEl.get(\"likes\"));var params={\"post_id\":post_id,\"like_count\":like_count};if(parseInt(user_likes)==0){this.call(\"facebook\",\"facebook_post_like\",params,this.facebookItemLikeSuccess.bind(this),null);}else{this.call(\"facebook\",\"facebook_post_unlike\",params,this.facebookItemLikeSuccess.bind(this),null);}},facebookItemLikeSuccess:function(data){if(!$defined(data.post_id)){return;}$$(\".likes_\"+data.post_id).each(function(el){el.set(\"likes\",data.like_count);if(data.liked!=-1){el.set(\"is_liked\",data.liked);}el.empty();new Element(\"div\",{\"class\":\"text grey text11\",\"text\":data.like_count,\"likes\":data.like_count}).inject(el);if(data.like_count>0){el.addClass(\"other_liked\");}else{el.removeClass(\"other_liked\");}if(data.liked!=-1){if(data.liked==1){el.addClass(\"on\");}else{el.removeClass(\"on\");}}});},facebookCommentsShow:function(el,post_id){if(this.comments.has(post_id)){this.facebookCommentsHide(post_id);}else{this.comments.set(post_id,el);var commentsLoader=new ItemLoader({idField:\"id\",sortField:\"time\",sortAscending:true,createElementFunc:FacebookCommentItemUtility.createFacebookCommentItem});$(commentsLoader).inject(el,\"after\");this.commentLoaders.set(post_id,commentsLoader);var params={\"post_id\":post_id};this.call(\"facebook\",\"facebook_comments\",params,this.facebookCommentsSuccess.bind(this),null);}},facebookCommentsUpdated:function(post_id){var params={\"post_id\":post_id};this.call(\"facebook\",\"facebook_comments\",params,this.facebookCommentsSuccess.bind(this),null);},facebookCommentsHide:function(post_id){var loader=this.commentLoaders.get(post_id);loader.items.each(function(value,key){loader.remove(key);},this);this.commentLoaders.erase(post_id);this.comments.erase(post_id);},facebookCommentsSuccess:function(data){if(!$defined(data.post_id)){return;}var loader=this.commentLoaders.get(data.post_id);if(!$defined(data.comment_list)||data.comment_list.length==0){this.atBottom=true;return;}data.comment_list.each(function(item){loader.process(item);},this);this.bottomFuncCalled=false;}});var FacebookFriendContent=new Class({Extends:Content,EventHandlers:[],onBeforeInit:function(options){this.user=options.user;this.uid=options.uid;},onInit:function(){this.loader=new ItemLoader({idField:\"uid\",sortField:\"last_name\",createElementFunc:FacebookFriendItemUtility.createFacebookFriendItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"You have no friends!\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){var params={\"uid\":this.uid,\"limit\":50,\"sort_field\":\"last_name\",\"number\":\"\"};this.call(\"facebook\",\"facebook_friends_info\",params,this.facebookFriendsSuccess.bind(this),null);}},onHide:function(){},facebookFriendsSuccess:function(data){if(!$defined(data)||data.length==0){return;}data.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){var curBatch=this.loader.count();var nextBatch=curBatch+50;var params={\"uid\":this.uid,\"limit\":curBatch+\",\"+nextBatch,\"sort_field\":\"last_name\",\"number\":\"\"};this.call(\"facebook\",\"facebook_friends_info\",params,this.facebookFriendsSuccess.bind(this),null);}});var FacebookUserContent=new Class({Extends:Content,EventHandlers:[\"facebookUserData\"],onBeforeInit:function(options){this.uid=options.uid;this.name=options.username;options.displayName=options.username;return options;},onInit:function(){this.loader=new ItemLoader({idField:\"post_id\",sortField:\"created_time\",sortAscending:false,createElementFunc:FacebookFeedItemUtility.createFacebookFeedItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"This user has no updates\"})});$(this.loader).inject(this.content);if($defined(this.uid)){this.startPoll();}},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},startPoll:function(){if(!$defined(this.userPollTimer)){this.userPollTimer=this.fbUserFeed.periodical(55*1000,this);this.fbUserFeed();}},fbUserFeed:function(){var startTime=this.loader.lowestSortValue;var params={user_id:this.uid,start_time:startTime,end_time:0};this.call(\"facebook\",\"facebook_user_feed\",params,this.loadMoreSuccess.bind(this),null);},facebookUserData:function(user){if((user.uid!=this.uid)||($defined(this.statusBox))){return;}this.statusBox=new FacebookStatusBox(user,false);$(this.statusBox).inject(this.content,\"top\");},loadMore:function(){var endTime=this.loader.lowestSortValue;var startTime=parseInt(endTime)-259200;var params={user_id:this.uid,start_time:startTime,end_time:endTime};this.call(\"facebook\",\"facebook_user_feed\",params,this.loadMoreSuccess.bind(this),null);},loadMoreSuccess:function(data){if(!$defined(data.feed)||data.feed.length==0){this.atBottom=true;return;}data.feed.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){Logger().log(\"facebook content bottom\");this.loadMore();}});var FacebookWallContent=new Class({Extends:Content,EventHandlers:[\"facebookSelfData\"],onBeforeInit:function(options){this.uid=options.uid;options.displayName=options.username;return options;},onInit:function(){this.loader=new ItemLoader({idField:\"post_id\",sortField:\"created_time\",sortAscending:false,createElementFunc:FacebookFeedItemUtility.createFacebookFeedItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"You have no updates\"})});$(this.loader).inject(this.content);if($defined(this.uid)){this.startPoll();}},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},startPoll:function(){if(!$defined(this.wallPollTimer)){this.wallPollTimer=this.fbUserFeed.periodical(55*1000,this);this.fbUserFeed();}},fbUserFeed:function(){var startTime=this.loader.lowestSortValue;var params={user_id:this.uid,start_time:startTime,end_time:0};this.call(\"facebook\",\"facebook_user_feed\",params,this.loadMoreSuccess.bind(this),null);},facebookSelfData:function(user){if($defined(this.statusBox)){return;}this.statusBox=new FacebookStatusBox(user,true);$(this.statusBox).inject(this.content,\"top\");},loadMore:function(){var endTime=this.loader.lowestSortValue;var startTime=parseInt(endTime)-259200;var params={user_id:this.uid,start_time:startTime,end_time:endTime};this.call(\"facebook\",\"facebook_user_feed\",params,this.loadMoreSuccess.bind(this),null);},loadMoreSuccess:function(data){if(!$defined(data.feed)||data.feed.length==0){this.atBottom=true;return;}data.feed.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){Logger().log(\"facebook content bottom\");this.loadMore();}});var FacebookShareBox=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"facebookShareBoxShow\",\"facebookCommentBoxShow\"],init:function(){this.shareboxes=$H();},userSwitched:function(){if(!this.isLoggedIn()){this.userLoggedOut();}},userLoggedOut:function(){this.shareboxes.each(function(sharebox,key){sharebox.close();this.shareboxes.erase(key);},this);this.shareboxes=$H();},facebookShareBoxShow:function(user,isSelf){if($defined(this.sharebox)){this.sharebox.close();}this.createShareBox(user,isSelf);},createShareBox:function(user,isSelf){this.sharebox=new Popup({size:{x:500,y:100},resizable:false,dockable:false,className:\"facebook sharebox\",onClose:this.destroyShareBox.bind(this)});var displayName=(isSelf)?\"Write in Your Facebook Feed\":\"Write on \"+user.first_name+\"'s Wall\";var nav=new Nav({iconOptions:{iconName:user.pic_square},displayName:displayName,closable:true});var content=new FacebookShareBoxPopupContent({user:user,is_self:isSelf});this.sharebox.addContent(\"sharebox\",nav,content);},facebookCommentBoxShow:function(post_id){if($defined(this.commentbox)){this.commentbox.close();}this.createCommentBox(post_id);},createCommentBox:function(post_id){this.sharebox=new Popup({size:{x:500,y:100},resizable:false,dockable:false,className:\"facebook sharebox\",onClose:this.destroyShareBox.bind(this)});var displayName=\"Comment on a post\";var nav=new Nav({iconOptions:{iconName:\"updates\"},displayName:displayName,closable:true});var content=new FacebookShareBoxPopupContent({post_id:post_id,is_self:true});this.sharebox.addContent(\"sharebox\",nav,content);},destroyShareBox:function(name){this.sharebox=null;}});var FacebookShareBoxPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.user=options.user;this.post_id=options.post_id;if(!options.is_self){this.target_id=this.user.uid;}return options;},reset:function(){Logger().log(\"resetting\");this.closeAttachmentPopup();this.content.empty();this.onInit();},onInit:function(){this.formEl=null;this.isPublic=true;this.readyToPost=false;this.input=new Element(\"textarea\",{\"maxlength\":2000});this.input.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.input).inject(this.content);this.cancelButton=new ButtonMedium({displayName:\"Close\",className:\"dark\",action:\"cross\"});$(this.cancelButton).addEvent(\"click\",this.closeContent.bind(this));this.updateButton=new ButtonMedium({displayName:\"Post\",className:\"dark\",action:\"check\"});$(this.updateButton).addEvent(\"click\",this.post.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.updateButton),$(this.cancelButton)).inject(this.content);this.focus();},inputKeyUp:function(e){if(e.shift&&e.key==\"enter\"){e.preventDefault();this.post();}if(DomUtility.textareaAutoSize(e.target,40)){this.updateSize();}},updateSize:function(){var h=this.input.getSize().y+10;h+=this.actions.getSize().y+30;this.resizePopup(500,h);},post:function(){var body=this.input.value.trim();Logger().log(body);if(body==\"\"&&this.attachment.type==AttachmentType.None){this.fireEvent(\"showAlert\",\"empty_post\",\"Problem Posting\",\"Please enter some content to post.\");return;}if(!$defined(this.post_id)){this.post_id=\"\";}if(!$defined(this.target_id)){this.target_id=0;}var params={\"body\":body,\"post_id\":this.post_id,\"target_id\":this.target_id};this.call(\"facebook\",\"facebook_post_text\",params,this.postSuccess.bind(this),this.postFail.bind(this),this.formEl);this.updateButton.showProgress();},postSuccess:function(){this.updateButton.hideProgress();this.closeContent();if($defined(this.post_id)){this.fireEvent(\"facebookCommentsUpdated\",this.post_id);}this.fireEvent(\"facebookFeed\");},postFail:function(){this.updateButton.hideProgress();},onShow:function(){this.focus();},focus:function(){this.input.focus.delay(500,this.input);}});var FacebookStatusBox=new Class({Extends:Base,EventHandlers:[],init:function(user,isSelf){this.user=user;this.isSelf=isSelf;this.defaultStatus=\"has no current status\";this.createStatusBox();},createStatusBox:function(){this.box=ItemUtility.createPostBubble(\"post status_message haspic\");ItemUtility.createItemPic(this.user.pic_square).inject(this.box);var buttonText=this.isSelf?\"Write in Your Feed\":\"Write on \"+this.user.first_name+\"'s Wall\";this.writeButton=new Element(\"div\",{\"class\":\"button\",\"text\":TextUtility.unescape(buttonText)}).inject(this.box);this.writeButton.addEvent(\"click\",this.fireEvent.bind(this,[\"facebookShareBoxShow\",this.user,this.isSelf]));this.content=new Element(\"div\",{\"class\":\"post_content\"}).inject(this.box);var header=new Element(\"div\",{\"class\":\"header\"}).inject(this.content);var creator=new Element(\"span\",{\"class\":\"user_name\",\"text\":TextUtility.unescapeQuotes(this.user.name)}).inject(header);this.status=new Element(\"span\",{\"class\":\"status\"}).inject(header);this.updateStatus();},updateStatus:function(){if($defined(this.user.status.message)&&this.user.status.message!=\"\"){this.status.removeClass(\"empty\");this.status.set(\"text\",\" \"+TextUtility.unescape(this.user.status.message.trim()));}else{this.status.addClass(\"empty\");this.status.set(\"text\",\" \"+TextUtility.unescape(this.defaultStatus));}},toElement:function(){return this.box;}});var FacebookUserMenu=new Class({Extends:Menu,onBeforeInit:function(options){this.uid=options.user.uid;this.name=options.user.username;options.displayName=this.name;options.className=\"facebook\";this.pic=options.user.pic;this.user=options.user;return options;},onInit:function(){this.aboutSection=new Element(\"div\",{\"class\":\"text_section light1\"}).inject(this.menu);this.call(\"facebook\",\"facebook_user_show\",{user_id:this.uid},this.profileShowSuccess.bind(this),null);},profileShowSuccess:function(data){if(!$defined(data)||data==\"\"){return;}this.user=data;if(data.pic_square==\"\"){data.pic_square;}this.pic=new Element(\"div\",{\"class\":\"user_pic\"}).inject(this.menu);ItemUtility.createItemPic(data.pic_square).inject(this.pic);var location=\"\";if($defined(data.current_location.city)){location=data.current_location.city;if($defined(data.current_location.state)){location=location+\", \"+data.current_location.state;}}else{if($defined(data.current_location.state)){location=data.current_location.state;}else{if($defined(data.current_location.country)){location+=\" \"+data.current_location.country;}}}if(location!=\"\"){this.locSection=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Location: \"}),new Element(\"span\",{\"text\":location})).inject(this.menu);}if($defined(data.affiliations)&&data.affiliations.length>0){var networks=\"\";for(var i=0;i<data.affiliations.length-1;i++){networks+=data.affiliations[i].name+\", \";}networks+=data.affiliations[i].name;this.networksSection=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Networks: \"}),new Element(\"span\",{\"text\":networks})).inject(this.menu);}if($defined(data.sex)&&data.sex!=\"\"){this.genderSection=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Gender: \"}),new Element(\"span\",{\"text\":data.sex})).inject(this.menu);}if($defined(data.birthday)&&data.birthday!=\"\"){this.genderSection=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Birthday: \"}),new Element(\"span\",{\"text\":data.birthday})).inject(this.menu);}if($defined(data.relationship_status)&&data.relationship_status!=\"\"){this.relationSection=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Relationship Status: \"}),new Element(\"span\",{\"text\":data.relationship_status})).inject(this.menu);}this.fireEvent(\"facebookUserData\",data);}});var FacebookSelfMenu=new Class({Extends:Menu,onBeforeInit:function(options){this.appId=5;this.user=options.user;options.displayName=this.user.fullname;options.className=\"facebook\";this.fb_uid=options.uid;return options;},onInit:function(){this.aboutSection=new Element(\"div\",{\"class\":\"text_section light1\"}).inject(this.menu);this.call(\"facebook\",\"facebook_user_show\",{user_id:this.fb_uid},this.profileShowSuccess.bind(this),null);},profileShowSuccess:function(data){if(!$defined(data)||data==\"\"){return;}this.user=data;if(data.pic_square==\"\"){data.pic_square;}this.pic=new Element(\"div\",{\"class\":\"user_pic\"}).inject(this.menu);ItemUtility.createItemPic(data.pic_square).inject(this.pic);var location=\"\";if($defined(data.current_location.city)){location=data.current_location.city;if($defined(data.current_location.state)){location=location+\", \"+data.current_location.state;}}else{if($defined(data.current_location.state)){location=data.current_location.state;}else{if($defined(data.current_location.country)){location+=\" \"+data.current_location.country;}}}if(location!=\"\"){this.locSection=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Location: \"}),new Element(\"span\",{\"text\":location})).inject(this.menu);}if($defined(data.affiliations)&&data.affiliations.length>0){var networks=\"\";for(var i=0;i<data.affiliations.length-1;i++){networks+=data.affiliations[i].name+\", \";}networks+=data.affiliations[i].name;this.networksSection=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Networks: \"}),new Element(\"span\",{\"text\":networks})).inject(this.menu);}if($defined(data.sex)&&data.sex!=\"\"){this.genderSection=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Gender: \"}),new Element(\"span\",{\"text\":data.sex})).inject(this.menu);}if($defined(data.birthday)&&data.birthday!=\"\"){this.genderSection=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Birthday: \"}),new Element(\"span\",{\"text\":data.birthday})).inject(this.menu);}if($defined(data.relationship_status)&&data.relationship_status!=\"\"){this.relationSection=new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Relationship Status: \"}),new Element(\"span\",{\"text\":data.relationship_status})).inject(this.menu);}this.call(\"facebook\",\"facebook_settings_get\",{},this.settingsGetSuccess.bind(this),null);this.fireEvent(\"facebookSelfData\",data);},settingsGetSuccess:function(data){if(!$defined(data.settings.sync_posts)){return;}this.sync_posts=data.settings.sync_posts;new Element(\"div\",{\"class\":\"nav_seperator\"}).inject(this.menu);this.syncPosts=new Toggle(this.sync_posts==1);$(this.syncPosts).addEvent(\"click\",this.syncToggle.bind(this));new Element(\"div\",{\"class\":\"toggle_section\"}).adopt(new Element(\"div\",{\"class\":\"text light\",\"text\":\"Sync Posts:\"}),$(this.syncPosts)).inject(this.menu);},syncToggle:function(){var params={key:\"sync_posts\",value:this.syncPosts.toInt()};this.call(\"facebook\",\"facebook_settings_update\",params);}});var FacebookInstallPopupContent=new Class({Extends:PopupContent,strings:{postSyncLabel:\"Sync posts to Facebook:\",errorMessage:\"There was an error connecting to Facebook\"},onInit:function(){this.appId=5;FB_RequireFeatures([\"Connect\"],function(){FB.Facebook.init(\"d29a9328a49d798da896066499c0d9d8\",\"/xd_receiver.htm\",{\"forceBrowserPopupForLogin\":true,\"doNotUseCachedConnectState\":true});});this.syncPostsToggle=new Toggle(true);new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.postSyncLabel}),$(this.syncPostsToggle)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Install Facebook\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.facebookConnect.bind(this));this.message=new Element(\"div\",{\"class\":\"message error\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},facebookConnect:function(){FB.Connect.requireSession(this.facebookGetPermission.bind(this),this.facebookConnectFail.bind(this));},facebookGetPermission:function(){FB.Connect.showPermissionDialog(\"offline_access,publish_stream,read_stream,status_update,email,xmpp_login\",this.facebookEnable.bind(this));},facebookEnable:function(){this.fb_session=FB.Facebook.apiClient.get_session();var sync=this.syncPostsToggle.toInt();var params={sync_posts:this.syncPostsToggle.toInt(),session_key:this.fb_session.session_key,uid:this.fb_session.uid};this.call(\"facebook\",\"facebook_enable\",params,this.facebookEnableSuccess.bind(this),null);},facebookEnableSuccess:function(){this.closeContent();},facebookConnectFail:function(){var name=\"facebook_connect\";var title=\"Error Connecting to Facebook\";var message=this.strings.errorMessage;this.fireEvent(\"showAlert\",name,title,message);}});var FacebookAlbumUtility={createFacebookAlbumItem:function(album){var el=ItemUtility.createPostBubble(\"post album\",true);var thumb=new Element(\"div\",{\"class\":\"cover\"}).adopt(new Element(\"img\",{\"src\":album.coverSrc,\"alt\":album.description,\"title\":album.description})).inject(el);thumb.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookAlbumView\",album]));var title=new Element(\"div\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescape(album.name)});var header=new Element(\"div\",{\"class\":\"heading\"}).adopt(title).inject(el);title.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookAlbumView\",album]));var size=new Element(\"span\",{\"class\":\"size\",\"text\":TextUtility.pluralText(album.size,\"Photo\",\"Photos\")}).inject(header);var location=new Element(\"span\",{\"class\":\"location\"}).inject(header);if(album.location.trim()!=\"\"){location.set(\"text\",\" | \"+TextUtility.unescape(album.location.trim()));}var description=new Element(\"div\",{\"class\":\"description\"}).inject(el);if(album.description.trim()!=\"\"){description.set(\"text\",\" \"+TextUtility.unescape(album.description.trim()));}var viewButton=new ButtonMedium({displayName:\"View Album\",action:\"goto dark\"});$(viewButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookAlbumView\",album]));new Element(\"div\",{\"class\":\"actions\"}).adopt($(viewButton)).inject(el);return el;}};var FacebookCommentItemUtility={createFacebookCommentItem:function(item){var el=ItemUtility.createPostBubble(\"post haspic fbComment\");ItemUtility.createItemPic(item.profile_pic).inject(el);var content=new Element(\"div\",{\"class\":\"post_content\"}).inject(el);FacebookCommentItemUtility.createFacebookItemHeader(item).inject(content);FacebookCommentItemUtility.createFacebookItemFooter(item).inject(content);return el;},createFacebookItemHeader:function(item){var el=new Element(\"div\",{\"class\":\"header\"});var user={username:item.name,uid:item.fromid,pic:item.profile_pic};var creatorName=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescapeQuotes(item.name)}).inject(el);creatorName.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookShowUserFeed\",user]));if($defined(item.text)&&item.text!=\"\"){new Element(\"span\",{\"html\":\" \"+TextUtility.replaceUrls(TextUtility.stripHtml(TextUtility.unescape(item.text)))}).inject(el);}return el;},createFacebookItemFooter:function(item){var el=new Element(\"div\",{\"class\":\"footer\"});if(!$defined(item.time)){return el;}var date=DateUtility.convertFromTimestamp(item.time);var ts=new Element(\"span\",{\"class\":\"timestamp\",\"text\":DateUtility.getTimestamp(date,\"%B %D at %I:%M%p\"),\"ts\":date,\"ts_format\":\"%B %D at %I:%M%p\"}).inject(el);return el;}};var FacebookFeedItemUtility={createFacebookFeedItem:function(item){var el=ItemUtility.createPostBubble(\"post haspic\");ItemUtility.createItemPic(item.profile_pic).inject(el);var content=new Element(\"div\",{\"class\":\"post_content facebook\"}).inject(el);FacebookFeedItemUtility.createFacebookItemHeader(item).inject(content);FacebookFeedItemUtility.createFacebookItemBody(item).inject(content);FacebookFeedItemUtility.createFacebookItemFooter(item,el).inject(content);FacebookFeedItemUtility.createFacebookItemActions(item).inject(el);return el;},createFacebookItemHeader:function(item){var el=new Element(\"div\",{\"class\":\"header\"});var user={username:item.name,uid:item.actor_id,pic:item.profile_pic};var target={username:item.target_name,uid:item.target_id,pic:\"\"};var creatorName=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescapeQuotes(item.name)}).inject(el);creatorName.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookShowUserFeed\",user]));if(item.target_id>0){StreamItemUtility.createStreamUserAction(\"direct\").inject(el);var targetName=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescapeQuotes(item.target_name)}).inject(el);targetName.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookShowUserFeed\",target]));}if($defined(item.message)&&item.message!=\"\"){new Element(\"span\",{\"html\":\" \"+TextUtility.replaceUrls(TextUtility.stripHtml(TextUtility.unescape(item.message)))}).inject(el);}return el;},createFacebookItemBody:function(item){var el=new Element(\"div\",{\"class\":\"body\"});var fbUrl;if(item.attachment!=\"\"&&$defined(item.attachment.media)&&$defined(item.attachment.media.length)){for(var i=0,n=item.attachment.media.length;i<n;i++){if(item.attachment.media[i].type==\"photo\"){fbUrl=DataUtility.getFacebookPhotoUrl(item.attachment.media[i].src);}else{fbUrl=item.attachment.media[i].src;}var image=new Element(\"img\",{\"src\":item.attachment.media[i].src,\"class\":\"fbPhoto\"}).inject(el);var attachment={url:fbUrl,filename:\"Facebook Photo\"};image.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showPhotoPopup\",attachment]));}new Element(\"br\",{}).inject(el);}if($defined(item.attachment.name)){new Element(\"a\",{\"href\":item.attachment.href,\"target\":\"_blank\",\"text\":item.attachment.name}).inject(el);new Element(\"br\",{}).inject(el);}new Element(\"span\",{\"text\":item.attachment.description}).inject(el);return el;},createFacebookItemFooter:function(item,postElement){var el=new Element(\"div\",{\"class\":\"footer foot_\"+item.post_id});if(!$defined(item.date_created)){return el;}var date=DateUtility.convertFromTimestamp(item.created_time);var ts=new Element(\"span\",{\"class\":\"timestamp\",\"text\":DateUtility.getTimestamp(date,\"%B %D at %I:%M%p\"),\"ts\":date,\"ts_format\":\"%B %D at %I:%M%p\"}).inject(el);FacebookFeedItemUtility.createFacebookFooterActions(item,el,postElement);return el;},createFacebookFooterActions:function(item,el,postElement){var commentsAction=new Element(\"span\",{\"class\":\"footer_action has_action comments_\"+item.post_id,\"comments\":item.comment_count}).adopt(new Element(\"div\",{\"class\":\"action convo\"}));commentsAction.appendText(TextUtility.pluralText(item.comment_count,\"Comment\",\"Comments\"));commentsAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookCommentsShow\",postElement,item.post_id]));commentsAction.inject(el);var replyAction=FacebookFeedItemUtility.createFacebookFooterAction(\"reply\",\"Comment\",true);replyAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookCommentBoxShow\",item.post_id]));replyAction.inject(el);},createFacebookItemActions:function(item){var el=new Element(\"div\",{\"class\":\"post_actions\"});if(item.can_delete){var deleteAction=new Element(\"div\",{\"class\":\"post_action delete\"}).inject(el);deleteAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookItemDelete\",item.post_id,item.created_time]));}var likeAction=new Element(\"div\",{\"class\":\"post_action like likes_\"+item.post_id,\"is_liked\":item.user_likes,\"likes\":item.like_count}).inject(el);likeAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookItemLike\",item.post_id,likeAction]));new Element(\"div\",{\"class\":\"text grey text11\",\"text\":item.like_count,\"likes\":item.like_count}).inject(likeAction);if(item.like_count>0){likeAction.addClass(\"other_liked\");}if(item.user_likes==1){likeAction.addClass(\"on\");}return el;},createFacebookFooterAction:function(actionName,actionText,hide){var el=new Element(\"span\",{\"class\":\"footer_action has_action\"}).adopt(new Element(\"div\",{\"class\":\"action \"+actionName}));el.appendText(actionText);if(hide){el.addClass(\"hide\");}return el;}};var FacebookFriendItemUtility={createFacebookFriendItem:function(user){var el=ItemUtility.createPostBubble(\"post contact\",true);new Element(\"img\",{\"class\":\"profile_pic_wrapper_60 afb_profile_pic\",\"src\":user.pic}).inject(el);var username=new Element(\"div\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescape(user.username)});new Element(\"div\",{\"class\":\"heading\"}).adopt(username).inject(el);username.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookShowUserFeed\",user]));var viewButton=new ButtonMedium({displayName:\"View Wall\",action:\"goto dark\"});$(viewButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"facebookShowUserFeed\",user]));new Element(\"div\",{\"class\":\"actions\"}).adopt($(viewButton)).inject(el);return el;}};var Global=new Class({Extends:AppInstance,EventHandlers:[\"userSwitched\"],parseOptions:function(options){this.location=options.location;this.displayName=\"global\",this.appId=\"global_\"+this.location.geohash;this.iconOptions={iconName:\"location\"};},userSwitched:function(){this.stop();},onStart:function(){this.setupNav();},onStop:function(){var params={geohashs:this.location.geohash,location:JSON.encode(this.location),zoom:4,subscribe:0};this.call(\"global\",\"global_subscribe_delete\",params);}});Global.implement({requests:[{name:\"global_subscribe_add\",params:[\"geohashs\",\"location\",\"zoom\",\"subscribe\"],url:\"/api/pipio/global/subscribe/add\"},{name:\"global_subscribe_delete\",params:[\"geohashs\",\"location\",\"zoom\",\"subscribe\"],url:\"/api/pipio/global/subscribe/delete\"}]});Global.implement({setupNav:function(){Logger().log(\"global setup\");this.navAdd(new Nav({iconOptions:{iconName:\"global\"},displayName:\"Updates\",name:\"updates\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"updates\",\"global_menu\"])}));var globalMenu=new GlobalMenu({location:this.location,isDefault:true,closeFunc:this.stop.bind(this)});this.menuAdd(\"global_menu\",globalMenu);var content=new GlobalContent({isDefault:true,location:this.location});this.contentAdd(\"updates\",content);}});var GlobalContent=new Class({Extends:Content,EventHandlers:[\"globalItemReceived\"],onBeforeInit:function(options){this.location=options.location;},onInit:function(){this.loader=new StreamLoader({createElementFunc:StreamItemUtility.createUserStreamItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"This location has no updates\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Updates loading...\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},globalItemReceived:function(data){if(data.item.geohash.substring(0,4)==this.location.geohash.substring(0,4)){this.loader.process(data.item);}},loadMore:function(){var params={geohash:this.location.geohash.substring(0,4),date_created:this.loader.oldestTimestamp,item_id:this.loader.oldestId};this.call(\"home\",\"stream_global_load\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(this.loader.empty){var params={geohashs:this.location.geohash,location:JSON.encode(this.location),zoom:4,subscribe:0};this.call(\"global\",\"global_subscribe_add\",params);}if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();if(status.code==2002){this.loader.showError();}},bottomFunc:function(){this.loadMore();}});var GlobalMenu=new Class({Extends:Menu,EventHandlers:[],onBeforeInit:function(options){this.location=options.location;var locationLabel=DataUtility.getGeoLabel(this.location);var locationStr=DataUtility.getGeoLocality(this.location);if(locationLabel){locationStr=locationLabel+\", \"+locationStr;}options.displayName=locationStr;return options;},onInit:function(){this.map=new GlobalMapMenuSection({location:this.location});$(this.map).inject(this.menu);new Element(\"div\",{\"class\":\"text_section light1 text11\",\"text\":\"You are viewing updates near this location\"}).inject(this.menu);}});var Home=new Class({Extends:App,EventHandlers:[\"userSwitched\",\"streamItemReplyCountUpdated\",\"streamItemDelete\",\"userStreamItemLiked\",\"streamItemLike\",\"roomProfilePicUpdated\",\"feedRoomKick\",\"feedRoomRequestAccept\",\"feedRoomRequestDelete\",\"feedRoomAdded\",\"feedRoomDeleted\",\"feedRoomDelete\",\"showCreateRoomPopup\",\"showRoomInvitePopup\",\"showRoomStatusUpdatePopup\",\"showEditProfilePopup\",\"showEditRoomProfilePopup\",\"showConvo\"],onStart:function(){this.setupNav();this.initRooms();this.convos=$H();},onStop:function(){},userSwitched:function(){if(this.isLoggedIn()){this.start();}else{this.stop();}},onCreate:function(){this.closeButton.destroy();$(\"app_button_2\").addEvent(\"click\",this.switchDefault.bind(this));},dock:function(){DomUtility.hide(this.navSection);$(this.alert).inject(\"app_button_2\");$(\"app_button_2\").addClass(\"has_submenu\");this.navWrapper.inject(\"app_button_2\",\"after\");$(\"app_button_2\").removeEvents(\"click\");$(\"app_button_2\").addEvent(\"click\",this.undock.bind(this));this.isDocked=true;},undock:function(){this.navWrapper.inject(this.navSection);$(\"app_button_2\").removeClass(\"has_submenu\");$(\"app_button_2\").removeEvents(\"click\");$(\"app_button_2\").addEvent(\"click\",this.switchDefault.bind(this));DomUtility.show(this.navSection);this.isDocked=false;if($defined(this.defaultContent)){this.fireEvent(\"viewSwitch\",this.appId,this.defaultContent,this.defaultMenu);}},streamItemReplyCountUpdated:function(data){if(!$defined(data.item_id)||!$defined(data.count)){return;}StreamItemUtility.updateReplyCount(data.item_id,data.count);},userStreamItemLiked:function(data){if(!$defined(data.item)||!$defined(data.username)){return;}if(data.username==this.getPrivateUser().username){StreamItemUtility.updateItemLiked(data.item.item_id,data.likes,data.is_liked);}else{StreamItemUtility.updateItemLiked(data.item.item_id,data.likes,-1);}},streamItemLike:function(item_id,el){this.call(\"home\",\"stream_item_like\",{item_id:item_id},null,null);var is_liked=parseInt(el.get(\"is_liked\"));var likes=parseInt(el.get(\"likes\"));if(is_liked==1){StreamItemUtility.updateItemLiked(item_id,likes-1,0);}else{StreamItemUtility.updateItemLiked(item_id,likes+1,1);}},streamItemDelete:function(item_id){var name=\"stream_item_delete\";var title=\"Delete Post\";var message=\"Are you sure you want to delete this post?\";var func=this.streamItemDeleteCall.bind(this,[item_id]);this.fireEvent(\"showConfirmation\",name,title,message,func);},streamItemDeleteCall:function(item_id){var params={item_id:item_id};this.call(\"home\",\"delete\",params,null,null);},showRoom:function(room){if(this.rooms.has(room.username)){this.fireEvent(\"viewSwitch\",this.appId,\"room_\"+room.username,\"room_\"+room.username);}else{var options={room:room};this.fireEvent(\"startAppInstance\",\"room\",room.username,options);}},roomProfilePicUpdated:function(data){if(!$defined(data.username)){return;}var room=this.getRoom(data.username);var room_id=room.room_id;var username=room.username;var version=UserUtility.profilePicVersionGet(room_id);version++;UserUtility.profilePicVersionSet(room_id,version);room.profile_pic_16=room.profile_pic_16.split(\"?\")[0]+\"?\"+version;room.profile_pic_20=room.profile_pic_20.split(\"?\")[0]+\"?\"+version;room.profile_pic_26=room.profile_pic_26.split(\"?\")[0]+\"?\"+version;room.profile_pic_32=room.profile_pic_32.split(\"?\")[0]+\"?\"+version;room.profile_pic_42=room.profile_pic_42.split(\"?\")[0]+\"?\"+version;room.profile_pic_60=room.profile_pic_60.split(\"?\")[0]+\"?\"+version;room.profile_pic_100=room.profile_pic_100.split(\"?\")[0]+\"?\"+version;room.profile_pic_200=room.profile_pic_200.split(\"?\")[0]+\"?\"+version;$$(\".profile_pic_16_\"+username).each(function(el){el.set(\"src\",room.profile_pic_16);});$$(\".profile_pic_20_\"+username).each(function(el){el.set(\"src\",room.profile_pic_20);});$$(\".profile_pic_60_\"+username).each(function(el){el.set(\"src\",room.profile_pic_60);});$$(\".profile_pic_26_\"+username).each(function(el){el.set(\"src\",room.profile_pic_26);});$$(\".profile_pic_32_\"+username).each(function(el){el.set(\"src\",room.profile_pic_32);});$$(\".profile_pic_42_\"+username).each(function(el){el.set(\"src\",room.profile_pic_42);});$$(\".profile_pic_100_\"+username).each(function(el){el.set(\"src\",room.profile_pic_100);});$$(\".profile_pic_200_\"+username).each(function(el){el.set(\"src\",room.profile_pic_200);});}});Home.implement({requests:[{name:\"stream_in_load\",params:[\"date_created\",\"item_id\"],url:\"/api/pipio/stream/in/load\"},{name:\"stream_user_load\",params:[\"username\",\"date_created\",\"item_id\"],url:\"/api/pipio/stream/user/load\"},{name:\"public_stream_user_load\",params:[\"username\",\"date_created\",\"item_id\"],url:\"/api/public/stream/user/load\"},{name:\"stream_room_load\",params:[\"username\",\"date_created\",\"item_id\"],url:\"/api/pipio/stream/room/load\"},{name:\"public_stream_room_load\",params:[\"username\",\"date_created\",\"item_id\"],url:\"/api/public/stream/room/load\"},{name:\"stream_convo_load\",params:[\"convo_id\",\"date_created\",\"item_id\"],url:\"/api/pipio/stream/convo/load\"},{name:\"stream_likes_load\",params:[\"username\",\"date_created\",\"item_id\"],url:\"/api/pipio/stream/likes/load\"},{name:\"stream_global_load\",params:[\"geohash\",\"date_created\",\"item_id\"],url:\"/api/pipio/stream/global/load\"},{name:\"stream_item_like\",params:[\"item_id\"],url:\"/api/pipio/stream/like\"},{name:\"publish\",url:\"/api/pipio/stream/publish\",params:[\"body\",\"targets\",\"source_id\",\"source_type\",\"reply_id\",\"channel_id\",\"is_public\",\"res\",\"attachment\"]},{name:\"forward\",url:\"/api/pipio/stream/forward\",params:[\"body\",\"targets\",\"source_id\",\"source_type\",\"forward_id\",\"channel_id\",\"is_public\",\"res\"]},{name:\"delete\",url:\"/api/pipio/stream/delete\",params:[\"item_id\"]},{name:\"parse_hulu_url\",url:\"/api/pipio/link/parse/hulu\",params:[\"url\"]},{name:\"parse_break_url\",url:\"/api/pipio/link/parse/break\",params:[\"url\"]},{name:\"room_create\",url:\"/api/pipio/room/create\",params:[\"username\",\"room_name\",\"room_description\",\"is_public\"]},{name:\"room_delete\",url:\"/api/pipio/room/delete\",params:[\"username\"]},{name:\"room_leave\",url:\"/api/pipio/room/leave\",params:[\"username\"]},{name:\"room_kick\",url:\"/api/pipio/room/kick\",params:[\"username\",\"room_username\"]},{name:\"room_subscribe\",url:\"/api/pipio/room/subscribe\",params:[\"username\"]},{name:\"room_unsubscribe\",url:\"/api/pipio/room/unsubscribe\",params:[\"username\"]},{name:\"room_request_create\",url:\"/api/pipio/room/request/create\",params:[\"username\"]},{name:\"room_request_delete\",url:\"/api/pipio/room/request/delete\",params:[\"username\",\"room_username\"]},{name:\"room_request_accept\",url:\"/api/pipio/room/request/accept\",params:[\"username\",\"room_username\"]},{name:\"room_invite_create\",url:\"/api/pipio/room/invite/create\",params:[\"username\",\"room_username\"]},{name:\"room_invite_accept\",url:\"/api/pipio/room/invite/accept\",params:[\"username\"]},{name:\"room_invite_delete\",url:\"/api/pipio/room/invite/delete\",params:[\"username\",\"room_username\"]},{name:\"room_info_load\",url:\"/api/pipio/room/info/load\",params:[\"username\"]},{name:\"public_room_info_load\",url:\"/api/public/room/info/load\",params:[\"username\"]},{name:\"public_user_info_load\",url:\"/api/public/user/info/load\",params:[\"username\"]},{name:\"room_privacy_set\",url:\"/api/pipio/room/privacy/set\",params:[\"username\",\"is_public\"]},{name:\"room_profile_update\",url:\"/api/pipio/room/profile/update\",params:[\"username\",\"bio\",\"url\"]},{name:\"room_search\",url:\"/api/pipio/room/search\",params:[\"query\"]}]});Home.implement({initRooms:function(){this.rooms=$H();this.roomInvites=$H();this.getRooms().each(function(room){this.roomAdd(room);},this);},feedRoomAdded:function(room){if(!this.rooms.has(room.username)){this.roomAdd(room);}},feedRoomKick:function(username,room_username){this.call(\"home\",\"room_kick\",{username:username,room_username:room_username},null,null);},feedRoomRequestAccept:function(username,room_username){this.call(\"home\",\"room_request_accept\",{username:username,room_username:room_username},null,null);},feedRoomRequestDelete:function(username,room_username){this.call(\"home\",\"room_request_delete\",{username:username,room_username:room_username},null,null);},feedRoomDelete:function(username){this.call(\"home\",\"room_delete\",{username:username},null,null);},feedRoomDeleted:function(username){if(!this.rooms.has(username)){return;}this.roomDelete(username);},showCreateRoomPopup:function(){if($defined(this.createRoomPopup)){this.createRoomPopup.close();}this.createCreateRoomPopup();},createCreateRoomPopup:function(){this.createRoomPopup=new Popup({size:{x:350,y:176},resizable:false,dockable:false,className:\"createRoom\",onClose:this.destroyCreateRoomPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"rooms\",iconAction:\"add\"},displayName:\"Create New Room\",closable:true});var content=new CreateRoomPopupContent({});this.createRoomPopup.addContent(\"create_room\",nav,content);},destroyCreateRoomPopup:function(){this.createRoomPopup=null;}});Home.implement({setupNav:function(){Logger().log(\"home setup\");var homeNav=new Nav({iconOptions:{iconName:\"updates\"},displayName:\"Updates\",name:\"updates\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"updates\",\"self_menu\"])});this.navAdd(homeNav);this.navAdd(new Nav({iconOptions:{iconName:\"star\"},displayName:\"Favorites\",name:\"likes\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"likes\",\"likes_menu\"])}));this.navAdd(new Nav({iconOptions:{iconName:\"rooms\"},hasSubnavs:true,displayName:\"Rooms\",name:\"rooms\"}));this.navAdd(new Nav({iconOptions:{iconName:\"search\"},displayName:\"Search Rooms...\",onClick:this.fireEvent.bind(this,[\"showSearchRoomPopup\"]),name:\"find_room\",parentName:\"rooms\",bottom:true}));this.navAdd(new Nav({iconOptions:{iconName:\"rooms\",iconAction:\"add\"},displayName:\"Create New Room...\",onClick:this.fireEvent.bind(this,[\"showCreateRoomPopup\"]),name:\"new_room\",parentName:\"rooms\",bottom:true}));var selfMenu=new SelfMenu({user:this.getPrivateUser(),isDefault:true});this.menuAdd(\"self_menu\",selfMenu);var content=new HomeContent({isDefault:true,navId:homeNav.navId});this.contentAdd(\"updates\",content);var likesMenu=new LikesMenu({user:this.getPrivateUser()});this.menuAdd(\"likes_menu\",likesMenu);var likesContent=new LikesContent({user:this.getPrivateUser()});this.contentAdd(\"likes\",likesContent);},roomAdd:function(room){var nav=new Nav({iconOptions:{user:room},displayName:room.room_name,name:\"room_\"+room.username,parentName:\"rooms\",onClick:this.fireEvent.bind(this,[\"showRoom\",room])});this.navAdd(nav);this.rooms.set(room.username,nav);},roomDelete:function(username){if(!this.rooms.has(username)){return;}this.rooms.get(username).destroy();this.navDelete(\"room_\"+username);this.rooms.erase(username);this.menuClose(\"room_\"+username);this.contentClose(\"room_\"+username);},showRoomInvitePopup:function(room){if($defined(this.roomInvitePopup)){this.roomInvitePopup.close();}this.createRoomInvitePopup(room);},createRoomInvitePopup:function(room){this.roomInvitePopup=new Popup({size:{x:250,y:350},resizable:false,dockable:false,className:\"roomInvite\",onClose:this.destroyCreateRoomPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"rooms\",iconAction:\"add\"},displayName:\"Invite Users to \"+room.room_name,closable:true});var content=new RoomInvitePopupContent({contacts:this.getContacts(),room:room});this.roomInvitePopup.addContent(\"create_room\",nav,content);},destroyRoomInvitePopup:function(){this.roomInvitePopup=null;},showRoomStatusUpdatePopup:function(room){if($defined(this.roomStatusUpdatePopup)){this.roomStatusUpdatePopup.close();}this.createRoomStatusUpdatePopup(room);},createRoomStatusUpdatePopup:function(room){this.roomStatusUpdatePopup=new Popup({size:{x:350,y:100},resizable:false,dockable:false,className:\"statusUpdate\",onClose:this.destroyRoomStatusUpdatePopup.bind(this)});var nav=new Nav({iconOptions:{user:room},displayName:\"Update Status for \"+room.room_name,closable:true});var content=new RoomStatusUpdatePopupContent({room:room});this.roomStatusUpdatePopup.addContent(\"status_update\",nav,content);},destroyRoomStatusUpdatePopup:function(){this.roomStatusUpdatePopup=null;},showConvo:function(convo_id){if(this.convos.has(convo_id)){this.convos.get(convo_id)._select();return;}this.createConvoPopup(convo_id);},createConvoPopup:function(convo_id){var popup=new Popup({size:{x:500,y:400},resizable:false,dockable:true,className:\"convoViewer\",onClose:this.destroyConvoPopup.bind(this,[convo_id])});var nav=new Nav({iconOptions:{iconName:\"convo\"},displayName:\"View Conversation\",closable:true});var content=new ConvoPopupContent({convo_id:convo_id});popup.addContent(\"convo\",nav,content);this.convos.set(convo_id,popup);},destroyConvoPopup:function(convo_id){this.convos.erase(convo_id);},showEditProfilePopup:function(){if($defined(this.editProfilePopup)){this.editProfilePopup.close();}this.createEditProfilePopup();},createEditProfilePopup:function(room){this.editProfilePopup=new Popup({size:{x:350,y:200},resizable:false,dockable:false,className:\"editProfile\",onClose:this.destroyEditProfilePopup.bind(this)});var nav=new Nav({iconOptions:{user:this.getPrivateUser()},displayName:\"Edit Your Profile\",closable:true});var content=new EditProfilePopupContent({user:this.getPrivateUser()});this.editProfilePopup.addContent(\"edit_profile\",nav,content);},destroyEditProfilePopup:function(){this.editProfilePopup=null;},showEditRoomProfilePopup:function(room){if($defined(this.editRoomProfilePopup)){this.editRoomProfilePopup.close();}this.createEditRoomProfilePopup(room);},createEditRoomProfilePopup:function(room){this.editRoomProfilePopup=new Popup({size:{x:350,y:140},resizable:false,dockable:false,className:\"editProfile\",onClose:this.destroyEditRoomProfilePopup.bind(this)});var nav=new Nav({iconOptions:{user:room},displayName:\"Edit Room Profile\",closable:true});var content=new RoomEditProfilePopupContent({room:room});this.editRoomProfilePopup.addContent(\"edit_room_profile\",nav,content);},destroyEditRoomProfilePopup:function(){this.editRoomProfilePopup=null;}});var HomeContent=new Class({Extends:Content,EventHandlers:[\"streamItemReceived\",\"streamItemDeleted\"],onBeforeInit:function(options){this.navId=options.navId;return options;},onInit:function(){this.statusBox=new StatusBox(this.getPrivateUser());$(this.statusBox).inject(this.content);this.loader=new StreamLoader({createElementFunc:StreamItemUtility.createInStreamItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"You have no updates\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Your updates loading...\"}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},streamItemReceived:function(data){if($defined(data.item)){this.loader.process(data.item);}Logger().log(JSON.encode(data.item.item_id));if(data.item.source_id!=this.getPrivateUser().user_id&&data.item.source_type==3){data.username=data.item.source.username;this.fireEvent(\"roomStreamItemReceived\",data);}},alertCheck:function(item){if(item.creator_id!=this.getPrivateUser().user_id){this.fireEvent(\"alertAdd\",this.navId);}},streamItemDeleted:function(data){if(!$defined(data.item_id)){return;}this.loader.remove(data.item_id);if($defined(data.source_id)&&data.source_id!=this.getPrivateUser().user_id){if(data.source_type==1){this.fireEvent(\"userStreamItemDeleted\",data);}else{if(data.source_type==3){this.fireEvent(\"roomStreamItemDeleted\",data);}}}},loadMore:function(){var params={date_created:this.loader.oldestTimestamp,item_id:this.loader.oldestId};this.call(\"home\",\"stream_in_load\",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){Logger().log(\"home content bottom\");this.loadMore();}});var LikesContent=new Class({Extends:Content,EventHandlers:[\"userStreamItemLiked\",\"streamItemLike\"],onBeforeInit:function(options){this.user=options.user;},onInit:function(){var createFunc=StreamItemUtility.createLikesStreamItem;if(this.user.user_id==this.getPrivateUser().user_id){createFunc=StreamItemUtility.createSelfLikesStreamItem;}this.loader=new ItemLoader({createElementFunc:createFunc,idField:\"item_id\",sortField:\"date_created\",sortAscending:false,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":TextUtility.unescape(this.user.fullname)+\" has no favorites\"}),emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":TextUtility.unescape(this.user.fullname)+\"'s favorites loading...\"}),errorEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":TextUtility.unescape(this.user.fullname)+\"'s stream is private\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},userStreamItemLiked:function(data){if($defined(data.item)&&data.username==this.user.username){if(data.is_liked==1){this.loader.process(data.item);}else{this.loader.remove(data.item.item_id);}}},streamItemLike:function(item_id,likes,is_liked){if(is_liked==1){this.loader.remove(item_id);}},loadMore:function(){var params={username:this.user.username,date_created:this.loader.oldestTimestamp,item_id:this.loader.oldestId};this.call(\"home\",\"stream_likes_load\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();if(status.code==2002){this.loader.showError();}},bottomFunc:function(){this.loadMore();}});var ConvoPopupContent=new Class({Extends:PopupContent,EventHandlers:[],onBeforeInit:function(options){this.convo_id=options.convo_id;return options;},onInit:function(){this.convoWrapper=new Element(\"div\",{\"class\":\"convoWrapper\"}).inject(this.content);this.loader=new ItemLoader({idField:\"item_id\",sortField:\"date_created\",createElementFunc:StreamItemUtility.createConvoStreamItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"This conversation is empty\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Conversation loading...\"})});this.convoWrapper.addEvent(\"mousewheel\",this.checkScroll.bind(this));$(this.loader).inject(this.convoWrapper);this.scroll=new Fx.Scroll(this.convoWrapper);this.loadMore();},onShow:function(){if($defined(this.scrollY)){this.scroll.set(0,this.scrollY);}},onHide:function(){if($defined(this.convoWrapper)){this.scrollY=this.convoWrapper.getScroll().y;}},loadMore:function(){var params={convo_id:this.convo_id,date_created:this.loader.highestSortValue,item_id:this.loader.highestId};this.call(\"home\",\"stream_convo_load\",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){Logger().log(\"home content bottom\");this.loadMore();},checkScroll:function(){var maxY=this.convoWrapper.getScrollSize().y;var bottomY=this.convoWrapper.getScroll().y+this.convoWrapper.getSize().y+100;if(bottomY>maxY&&!this.bottomFuncCalled&&!this.atBottom){this.bottomFuncCalled=true;this.bottomFunc();}}});var CreateRoomPopupContent=new Class({Extends:PopupContent,strings:{roomUsernameLabel:\"Nickname:\",roomNameLabel:\"Room Name:\",roomDescriptionLabel:\"Description:\",publicLabel:\"Public:\",errorMessage:\"There was an error creating this room\"},onInit:function(){this.roomUsernameInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"32\"});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.roomUsernameLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.roomUsernameInput)).inject(this.content);this.roomNameInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"32\"});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.roomNameLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.roomNameInput)).inject(this.content);this.roomDescriptionInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"32\"});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.roomDescriptionLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.roomDescriptionInput)).inject(this.content);this.publicToggle=new Toggle(true);new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.publicLabel}),$(this.publicToggle)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Create Room\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.createRoom.bind(this));this.message=new Element(\"div\",{\"class\":\"message error\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},createRoom:function(){var username=this.roomUsernameInput.value.trim();var room_name=this.roomNameInput.value.trim();var room_description=this.roomDescriptionInput.value.trim();var is_public=this.publicToggle.toInt();var params={username:username,room_name:room_name,room_description:room_description,is_public:is_public};this.call(\"home\",\"room_create\",params,this.createRoomSuccess.bind(this),this.createRoomFail.bind(this));this.actionButton.showProgress();},createRoomSuccess:function(){this.actionButton.hideProgress();this.closeContent();},createRoomFail:function(status){this.actionButton.hideProgress();var name=\"create_room\";var title=\"Error Creating Room\";var message=status.message;this.fireEvent(\"showAlert\",name,title,message);},onShow:function(){this.focus();},focus:function(){this.roomUsernameInput.focus.delay(500,this.roomUsernameInput);}});var EditProfilePopupContent=new Class({Extends:PopupContent,strings:{bioLabel:\"Bio:\",interestsLabel:\"Interests:\",urlLabel:\"Website:\"},onBeforeInit:function(options){this.user=options.user;return options;},onInit:function(){this.bioInput=new Element(\"textarea\",{\"maxlength\":500});new Element(\"div\",{\"class\":\"input_section bio\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.bioLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.bioInput)).inject(this.content);this.interestsInput=new Element(\"textarea\",{\"maxlength\":500});new Element(\"div\",{\"class\":\"input_section bio\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.interestsLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.interestsInput)).inject(this.content);this.urlInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":200});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.urlLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.urlInput)).inject(this.content);var about=this.getProfile(this.user.username);if($defined(about)){if($defined(about.bio)){this.bioInput.set(\"text\",about.bio);}if($defined(about.interests)){this.interestsInput.set(\"text\",about.interests);}if($defined(about.url)){this.urlInput.value=about.url;}}this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Update\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.updateProfile.bind(this));this.message=new Element(\"div\",{\"class\":\"message error\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},updateProfile:function(){var bio=this.bioInput.value.trim();var url=this.urlInput.value.trim();var interests=this.interestsInput.value.trim();var params={bio:bio,url:url,interests:interests};this.call(\"pipio\",\"user_profile_update\",params,this.updateProfileSuccess.bind(this),this.updateProfileFail.bind(this));this.actionButton.showProgress();this.message.empty();},updateProfileSuccess:function(data){this.actionButton.hideProgress();this.closeContent();},updateProfileFail:function(){this.actionButton.hideProgress();this.message.set(\"text\",this.strings.errorMessage);},onShow:function(){this.focus();},focus:function(){this.bioInput.focus.delay(500,this.bioInput);}});var RoomInvitePopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.contacts=options.contacts;this.room=options.room;return options;},onInit:function(){this.css=new CSS();this.input=new Element(\"input\",{\"type\":\"text\",\"maxlength\":50});this.input.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.input).inject(this.content);this.list=new Element(\"div\",{\"class\":\"itemList\"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Close\",className:\"dark\",action:\"cross\"});new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.closeButton)).inject(this.content);$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.insertContacts();this.scroll=new Fx.Scroll(this.list);},insertContacts:function(){this.contacts.each(function(user){var el=ShareBoxUtility.createContactRoomInviteItem(user);el.addEvent(\"click\",this.inviteUser.bind(this,[user,el]));el.inject(this.list);},this);},insertSeperator:function(){new Element(\"div\",{\"class\":\"listItem seperator\"}).inject(this.list);},inviteUser:function(user,el){var params={username:user.username,room_username:this.room.username};this.call(\"home\",\"room_invite_create\",params,null,null);el.addClass(\"invited\");},inputKeyUp:function(e){if(e.key==\"esc\"){e.target.value=\"\";}var val=e.target.value.trim().toLowerCase();if(val.length<2){this.list.removeClass(\"search\");return;}this.list.addClass(\"search\");if($defined(this.lastSelector)){this.css.remove_rule(this.lastSelector);}var selector=\".listItem[val1^='\"+val+\"'], .listItem[val2^='\"+val+\"']\";this.css.add_rule(selector,{\"display\":\"block !important\"}).refresh();this.lastSelector=selector;},focus:function(){this.input.focus.delay(500,this.input);},onClose:function(){if($defined(this.lastSelector)){this.css.remove_rule(this.lastSelector).refresh();}},onShow:function(){if($defined(this.scrollY)){this.scroll.set(0,this.scrollY);}this.focus();},onHide:function(){if($defined(this.list)){this.scrollY=this.list.getScroll().y;}}});var RoomStatusUpdatePopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.room=options.room;return options;},onInit:function(){this.statusInput=new Element(\"textarea\",{\"maxlength\":500});this.statusInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.statusInput).inject(this.content);this.cancelButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.cancelButton).addEvent(\"click\",this.closeContent.bind(this));this.updateButton=new ButtonMedium({displayName:\"Update Status\",className:\"dark\",action:\"check\"});$(this.updateButton).addEvent(\"click\",this.updateStatus.bind(this));new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.updateButton),$(this.cancelButton)).inject(this.content);},onShow:function(){this.focus();},focus:function(){this.statusInput.focus.delay(500,this.statusInput);},inputKeyUp:function(e){if(e.key==\"enter\"){var msg=e.target.value.trim();if(msg==\"\"){return;}this.updateStatus();}},updateStatus:function(){var params={username:this.room.username,body:this.statusInput.value.trim(),res:this.getSession()};this.call(\"pipio\",\"publish_roomstatus\",params,this.updateStatusSuccess.bind(this),this.updateStatusFail.bind(this));this.updateButton.showProgress();},updateStatusSuccess:function(){this.closeContent();},updateStatusFail:function(){alert(\"There was an error updating your status!\");}});var LikesMenu=new Class({Extends:Menu,EventHandlers:[],onBeforeInit:function(options){this.user=options.user;options.displayName=this.user.first_name+\"'s Favorites\";return options;},onInit:function(){this.aboutText=new Element(\"span\");var likesText=\"These are posts \"+this.user.first_name+\" likes\";this.aboutSection=new Element(\"div\",{\"class\":\"text_section light1\",\"text\":TextUtility.unescape(likesText)}).inject(this.menu);}});var SelfMenu=new Class({Extends:Menu,EventHandlers:[\"userLocationUpdated\"],onBeforeInit:function(options){this.user=options.user;options.displayName=this.user.fullname;return options;},onInit:function(){this.map=new UserMapMenuSection({user:this.user});$(this.map).inject(this.menu);this.aboutSection=new UserProfileMenuSection({user:this.user});$(this.aboutSection).inject(this.menu);new Element(\"div\",{\"class\":\"nav_seperator\"}).inject(this.menu);this.locationEnabled=new Toggle(this.user.location_enabled==1);$(this.locationEnabled).addEvent(\"click\",this.locationToggle.bind(this));new Element(\"div\",{\"class\":\"toggle_section\"}).adopt(new Element(\"div\",{\"class\":\"text light\",\"text\":\"Location:\"}),$(this.locationEnabled)).inject(this.menu);this.privacy=new Toggle(this.user.is_public==1);$(this.privacy).addEvent(\"click\",this.privacyToggle.bind(this));new Element(\"div\",{\"class\":\"toggle_section\"}).adopt(new Element(\"div\",{\"class\":\"text light\",\"text\":\"Public:\"}),$(this.privacy)).inject(this.menu);this.profilePicUploadButton=new ButtonMedium({displayName:\"Change Picture\",className:\"dark\",action:\"photo\"});this.fileInput=new Element(\"input\",{\"type\":\"file\",\"name\":\"file\"});this.form=new Element(\"form\").adopt(this.fileInput);this.fileInput.addEvent(\"change\",this.profilePicUpload.bind(this));this.profilePicUploadSection=new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.profilePicUploadButton).adopt(this.form)).inject(this.menu);var editProfileButton=new ButtonMedium({displayName:\"Edit Profile\",className:\"dark\",action:\"edit\"});$(editProfileButton).addEvent(\"click\",this.fireEvent.bind(this,[\"showEditProfilePopup\"]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(editProfileButton)).inject(this.menu);var editLocationButton=new ButtonMedium({displayName:\"Edit Location\",className:\"dark\",action:\"global\"});$(editLocationButton).addEvent(\"click\",this.fireEvent.bind(this,[\"showLocationEditPopup\"]));this.editLocationSection=new Element(\"div\",{\"class\":\"button_section\"}).adopt($(editLocationButton)).inject(this.menu);if(this.user.location_enabled==0){DomUtility.hide(this.editLocationSection);}var searchUserButton=new ButtonMedium({displayName:\"Find Friends\",className:\"dark\",action:\"search\"});$(searchUserButton).addEvent(\"click\",this.fireEvent.bind(this,[\"searchUserShow\"]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(searchUserButton)).inject(this.menu);var inviteUserButton=new ButtonMedium({displayName:\"Invite Friends\",className:\"dark\",action:\"forward\"});$(inviteUserButton).addEvent(\"click\",this.fireEvent.bind(this,[\"inviteUserShow\"]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(inviteUserButton)).inject(this.menu);var searchContactButton=new ButtonMedium({displayName:\"Search Contacts\",className:\"dark\",action:\"status\"});$(searchContactButton).addEvent(\"click\",this.fireEvent.bind(this,[\"searchEmailShow\"]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(searchContactButton)).inject(this.menu);},privacyToggle:function(){this.call(\"pipio\",\"user_privacy_set\",{is_public:this.privacy.toInt()});},userLocationUpdated:function(username,location,location_enabled){if(username!=this.user.username){return;}if(location_enabled==1){DomUtility.show(this.editLocationSection);}else{DomUtility.hide(this.editLocationSection);}},locationToggle:function(){this.call(\"pipio\",\"user_location_enabled\",{location_enabled:this.locationEnabled.toInt()});},resetForm:function(){this.profilePicUploadSection.empty();this.profilePicUploadButton=new ButtonMedium({displayName:\"Change Picture\",className:\"dark\",action:\"photo\"});this.fileInput=new Element(\"input\",{\"type\":\"file\",\"name\":\"file\"});this.form=new Element(\"form\").adopt(this.fileInput);this.fileInput.addEvent(\"change\",this.profilePicUpload.bind(this));this.profilePicUploadSection.adopt($(this.profilePicUploadButton).adopt(this.form));},profilePicUpload:function(){if(DataUtility.validatePhotoFile(this.fileInput.value)){this.call(\"pipio\",\"user_profilepic_upload\",{},this.profilePicUploadSuccess.bind(this),this.profilePicUploadFail.bind(this),this.form);this.profilePicUploadButton.showProgress();}},profilePicUploadSuccess:function(){this.profilePicUploadButton.hideProgress();this.resetForm();},profilePicUploadFail:function(){this.profilePicUploadButton.hideProgress();this.resetForm();}});var MemberRequestsNav=new Class({Extends:Nav,EventHandlers:[],onBeforeInit:function(options){this.room=options.room;this.users=$H();options.name=\"member_requests_\"+this.room.username;options.iconOptions={iconName:\"contacts\",iconAction:\"add\"};options.displayName=\"Member Requests\";options.className=\"members_nav\";options.hasSubnavs=true;return options;},onInit:function(){this.clear=new Element(\"div\",{\"style\":\"clear: both\"});this.list=new Element(\"div\",{\"class\":\"menu_list\"}).adopt(this.clear).inject(this.subnavs);},addUsers:function(users){$splat(users).each(function(user){user=UserUtility.processUser(user);if(!this.users.has(user.username)){var pic=ItemUtility.createProfilePic(user,\"16a\");pic.addEvent(\"click\",this.fireEvent.bind(this,[\"showUser\",user]));pic.inject(this.clear,\"before\");this.users.set(user.username,pic);}},this);},removeUser:function(username){if(!this.users.has(username)){return;}this.users.get(username).destroy();this.users.erase(username);}});var MembersNav=new Class({Extends:Nav,onBeforeInit:function(options){this.room=options.room;this.users=$H();options.name=\"members_\"+this.room.username;options.iconOptions={iconName:\"contacts\"};options.displayName=\"Members\";options.className=\"members_nav\";options.hasSubnavs=true;return options;},onInit:function(){this.clear=new Element(\"div\",{\"style\":\"clear: both\"});this.list=new Element(\"div\",{\"class\":\"menu_list\"}).adopt(this.clear).inject(this.subnavs);},addUsers:function(users){$splat(users).each(function(user){user=UserUtility.processUser(user);if(!this.users.has(user.username)){var pic=ItemUtility.createProfilePic(user,\"16a\");pic.addEvent(\"click\",this.fireEvent.bind(this,[\"showUser\",user]));pic.inject(this.clear,\"before\");this.users.set(user.username,pic);}},this);},removeUser:function(username){if(!this.users.has(username)){return;}this.users.get(username).destroy();this.users.erase(username);}});var StreamItemUtility={createDateSeperatorItem:function(ts){var date=DateUtility.convertFromTimestamp(ts);var timetext=date.format(\"%B %D\");var el=new Element(\"div\",{\"class\":\"post seperator\",\"ts\":ts}).adopt(new Element(\"div\",{\"class\":\"seperator_text\",\"text\":timetext}));return el;},createSeperatorItem:function(str){var el=new Element(\"div\",{\"class\":\"post seperator\"}).adopt(new Element(\"div\",{\"class\":\"seperator_text\",\"text\":TextUtility.unescape(str)}));return el;},createInStreamItem:function(item){return StreamItemUtility.createStreamItem(item,true,false);},createUserStreamItem:function(item){return StreamItemUtility.createStreamItem(item,false,false);},createSelfLikesStreamItem:function(item){return StreamItemUtility.createStreamItem(item,true,true);},createLikesStreamItem:function(item){return StreamItemUtility.createStreamItem(item,false,true);},createStreamItem:function(item,inbound,likes_stream){var el=ItemUtility.createPostBubble(\"post haspic\");item.creator=UserUtility.processSource(item.creator);item.source=UserUtility.processSource(item.source);if($defined(item.post.reply_user)){item.post.reply_user=UserUtility.processSource(item.post.reply_user);}if($defined(item.post.convo_user)){item.post.convo_user=UserUtility.processSource(item.post.convo_user);}if($defined(item.post.forward_user)){item.post.forward_user=UserUtility.processSource(item.post.forward_user);}item.can_delete=false;if(!$defined(item.private_replies)){item.private_replies=0;}var user_id=pipio.currentUser.user_id;if(inbound){item.can_delete=true;}else{if(item.creator_id==user_id){item.can_delete=true;}}if(likes_stream){item.can_delete=false;}if(inbound){item.can_like=true;}else{item.can_like=false;}ItemUtility.createProfilePic(item.creator,32).inject(el);if(item.reply_id!=item.item_id&&$defined(item.post.reply_user)){ItemUtility.createProfilePic(item.post.reply_user,20).inject(el);el.addClass(\"reply\");}if(item.source_id!=item.creator_id){ItemUtility.createProfilePic(item.source,20).inject(el);}var content=new Element(\"div\",{\"class\":\"post_content\"}).inject(el);StreamItemUtility.createStreamItemPostActions(item).inject(el);StreamItemUtility.createStreamItemHeader(item).inject(content);var attachments=StreamItemUtility.createStreamItemAttachments(item);if(attachments){attachments.inject(content);}StreamItemUtility.createStreamItemFooter(item).inject(content);return el;},createConvoStreamItem:function(item){var el=ItemUtility.createPostBubble(\"post haspic\");item.creator=UserUtility.processSource(item.creator);item.source=UserUtility.processSource(item.source);if($defined(item.post.reply_user)){item.post.reply_user=UserUtility.processSource(item.post.reply_user);}if($defined(item.post.convo_user)){item.post.convo_user=UserUtility.processSource(item.post.convo_user);}if($defined(item.post.forward_user)){item.post.forward_user=UserUtility.processSource(item.post.forward_user);}item.can_delete=false;ItemUtility.createProfilePic(item.creator,32).inject(el);if(item.reply_id!=item.item_id&&$defined(item.post.reply_user)){ItemUtility.createProfilePic(item.post.reply_user,20).inject(el);el.addClass(\"reply\");}if(item.source_id!=item.creator_id){ItemUtility.createProfilePic(item.source,20).inject(el);}var content=new Element(\"div\",{\"class\":\"post_content\"}).inject(el);StreamItemUtility.createStreamItemPostActions(item).inject(el);StreamItemUtility.createStreamItemHeader(item).inject(content);var attachments=StreamItemUtility.createStreamItemAttachments(item);if(attachments){attachments.inject(content);}StreamItemUtility.createConvoStreamItemFooter(item).inject(content);return el;},createStreamMemberRoomItem:function(item){return StreamItemUtility.createStreamRoomItem(item,true);},createStreamPublicRoomItem:function(item){return StreamItemUtility.createStreamRoomItem(item,false);},createStreamRoomItem:function(item,is_member){var el=ItemUtility.createPostBubble(\"post haspic\");item.creator=UserUtility.processSource(item.creator);item.source=UserUtility.processSource(item.source);if($defined(item.post.reply_user)){item.post.reply_user=UserUtility.processSource(item.post.reply_user);}if($defined(item.post.convo_user)){item.post.convo_user=UserUtility.processSource(item.post.convo_user);}if($defined(item.post.forward_user)){item.post.forward_user=UserUtility.processSource(item.post.forward_user);}item.can_delete=false;if(!$defined(item.private_replies)){item.private_replies=0;}var user_id=pipio.currentUser.user_id;if(item.creator_id==user_id){item.can_delete=true;}if(is_member&&item.source_id==item.creator_id){item.can_delete=true;}ItemUtility.createProfilePic(item.creator,32).inject(el);if(item.reply_id!=item.item_id&&$defined(item.post.reply_user)){ItemUtility.createProfilePic(item.post.reply_user,20).inject(el);el.addClass(\"reply\");}var content=new Element(\"div\",{\"class\":\"post_content\"}).inject(el);StreamItemUtility.createStreamItemPostActions(item).inject(el);StreamItemUtility.createStreamRoomItemHeader(item).inject(content);var attachments=StreamItemUtility.createStreamItemAttachments(item);if(attachments){attachments.inject(content);}StreamItemUtility.createStreamItemFooter(item).inject(content);return el;},createStreamItemPostActions:function(item){var el=new Element(\"div\",{\"class\":\"post_actions\"});if(item.can_delete){var deleteAction=new Element(\"div\",{\"class\":\"post_action delete\"}).inject(el);deleteAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"streamItemDelete\",item.item_id]));}if(item.can_like){var likeAction=new Element(\"div\",{\"class\":\"post_action like likes_\"+item.item_id,\"is_liked\":item.is_liked,\"likes\":item.likes}).inject(el);likeAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"streamItemLike\",item.item_id,likeAction]));new Element(\"div\",{\"class\":\"text grey text11\",\"text\":item.likes,\"likes\":item.likes}).inject(likeAction);if(item.likes>0){likeAction.addClass(\"other_liked\");}if(item.is_liked==1){likeAction.addClass(\"on\");}}return el;},createStreamRoomItemHeader:function(item){var el=new Element(\"div\",{\"class\":\"header\"});var is_question=false;var creator_action=\"broadcast dark\";if(item.is_public==0){creator_action=\"lock dark\";}else{if(item.post_type==4){creator_action=\"status dark\";}else{if(item.post_type==5){creator_action=\"question dark\";is_question=true;}}}StreamItemUtility.createStreamUserAction(creator_action).inject(el);StreamItemUtility.createUsernameElement(item.creator).inject(el);if(is_question){new Element(\"span\",{\"class\":\"grey2\",\"text\":\" asks \"}).inject(el);}if(item.post_type==3){StreamItemUtility.createStreamUserAction(\"forward\").inject(el);StreamItemUtility.createUsernameElement(item.post.forward_user).inject(el);}if(item.reply_id!=item.item_id){StreamItemUtility.createStreamUserAction(\"reply\").inject(el);StreamItemUtility.createUsernameElement(item.post.reply_user).inject(el);}var body=new Element(\"span\",{\"html\":\" \"+TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescapeQuotes(item.post.body)))}).inject(el);if($defined(item.post.forward_body)&&item.post.forward_body!=\"\"){body.appendText(\" - \"+TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescape(item.post.forward_body))));}return el;},createUsernameElement:function(user){if($defined(user.user_id)){var el=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescapeQuotes(user.fullname)});el.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showUser\",user]));return el;}else{if($defined(user.room_id)){var el=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescapeQuotes(user.room_name)});el.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showRoom\",user]));return el;}}},createStreamItemHeader:function(item){var el=new Element(\"div\",{\"class\":\"header\"});var is_question=false;var creator_action=\"broadcast dark\";if(item.is_public==0){creator_action=\"lock dark\";}else{if(item.post_type==4){creator_action=\"status dark\";}else{if(item.post_type==5){creator_action=\"question dark\";is_question=true;}}}StreamItemUtility.createStreamUserAction(creator_action).inject(el);if($defined(item.source.room_id)){StreamItemUtility.createUsernameElement(item.source).inject(el);new Element(\"span\",{\"class\":\"dark\",\"text\":\": \"}).inject(el);}StreamItemUtility.createUsernameElement(item.creator).inject(el);if(is_question){new Element(\"span\",{\"class\":\"dark\",\"text\":\" asks \"}).inject(el);}if(item.post_type==3){StreamItemUtility.createStreamUserAction(\"forward\").inject(el);StreamItemUtility.createUsernameElement(item.post.forward_user).inject(el);}if(item.reply_id!=item.item_id){StreamItemUtility.createStreamUserAction(\"reply\").inject(el);StreamItemUtility.createUsernameElement(item.post.reply_user).inject(el);}else{if(item.creator_id!=item.source_id&&!$defined(item.source.room_id)){StreamItemUtility.createStreamUserAction(\"direct\").inject(el);StreamItemUtility.createUsernameElement(item.source).inject(el);}}var body=new Element(\"span\",{\"html\":\" \"+TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescapeQuotes(item.post.body)))}).inject(el);if($defined(item.post.forward_body)&&item.post.forward_body!=\"\"){body.appendText(\" - \"+TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescape(item.post.forward_body))));}return el;},createStreamItemAttachments:function(item){if(item.attachment_type==0){return false;}var el=new Element(\"div\",{\"class\":\"attachment\"}).adopt(new Element(\"span\",{\"class\":\"indicator\",\"html\":\"&raquo;\"}));switch(item.attachment_type){case 1:var pipioUrl=DataUtility.getPipioUrl(null,item.attachment[0].hash);item.attachment[0]=AttachmentUtility.parsePhotoAttachment(item.attachment[0]);item.attachment[0].url=pipioUrl;new Element(\"a\",{\"target\":\"_blank\",\"href\":pipioUrl,\"text\":TextUtility.unescape(item.attachment[0].filename)}).inject(el);if(item.attachment[0].is_photo){el.addClass(\"has_thumbnail\");var playButton=new ButtonSmall({displayName:\"View Photo\",action:\"photo\"});$(playButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showPhotoPopup\",item.attachment[0]]));$(playButton).inject(el);var thumb=new InlineImage(item.attachment[0]);$(thumb).inject(el);}break;case 2:var pipioUrl=DataUtility.getPipioUrl(item.attachment[0].url,item.attachment[0].hash);item.attachment[0]=AttachmentUtility.parseLinkAttachment(item.attachment[0]);new Element(\"a\",{\"target\":\"_blank\",\"href\":pipioUrl,\"text\":TextUtility.unescape(item.attachment[0].url)}).inject(el);if(item.attachment[0].is_video){var playButton=new ButtonSmall({displayName:\"Play Video\",action:\"pivot_right dark\"});$(playButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showVideoPopup\",item.attachment[0]]));$(playButton).inject(el);}else{if(item.attachment[0].is_photo){el.addClass(\"has_thumbnail\");var playButton=new ButtonSmall({displayName:\"View Photo\",action:\"photo\"});$(playButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showPhotoPopup\",{filename:\"Photo\",url:item.attachment[0].url}]));$(playButton).inject(el);var thumb=new InlineImage({filename:\"Photo\",url:item.attachment[0].url});$(thumb).inject(el);}}break;}return new Element(\"div\",{\"class\":\"attachments\"}).adopt(el);},createStreamItemFooter:function(item){var el=new Element(\"div\",{\"class\":\"footer\"});if(!$defined(item.date_created)){return el;}var date=DateUtility.convertFromTimestamp(item.date_created);var ts=new Element(\"span\",{\"class\":\"timestamp\",\"text\":DateUtility.getTimestamp(date,\"%B %D at %I:%M%p\"),\"ts\":date,\"ts_format\":\"%B %D at %I:%M%p\"}).inject(el);if($defined(item.location)&&$defined(item.geohash)&&item.geohash!=\"\"){var loc=DataUtility.getGeoString(item.location);if(loc){el.appendText(\" from \");var location=new Element(\"span\",{\"class\":\"clickable\",\"text\":TextUtility.unescape(loc)}).inject(el);location.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showGlobal\",item.location]));}}StreamItemUtility.createFooterActions(item,el);return el;},createConvoStreamItemFooter:function(item){var el=new Element(\"div\",{\"class\":\"footer\"});if(!$defined(item.date_created)){return el;}var date=DateUtility.convertFromTimestamp(item.date_created);var ts=new Element(\"span\",{\"class\":\"timestamp\",\"text\":DateUtility.getTimestamp(date,\"%B %D at %I:%M%p\"),\"ts\":date,\"ts_format\":\"%B %D at %I:%M%p\"}).inject(el);if($defined(item.location)&&$defined(item.geohash)&&item.geohash!=\"\"){var loc=DataUtility.getGeoString(item.location);if(loc){el.appendText(\" from \");var location=new Element(\"span\",{\"class\":\"clickable\",\"text\":TextUtility.unescape(loc)}).inject(el);location.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showGlobal\",item.location]));}}StreamItemUtility.createConvoFooterActions(item,el);return el;},createFooterActions:function(item,el){if(!pipio.isLoggedIn()){return;}if(item.convo_id!=item.item_id){var convoAction=StreamItemUtility.createFooterAction(\"convo\",\"View Conversation\",true);convoAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showConvo\",item.convo_id]));convoAction.inject(el);}else{var convoAction=StreamItemUtility.createRepliesAction(item);convoAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showConvo\",item.convo_id]));convoAction.inject(el);}var replyAction=StreamItemUtility.createFooterAction(\"reply\",\"Reply\",true);replyAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"replyShareBoxShow\",item.item_id]));replyAction.inject(el);if(item.is_public==1){var forward_id=(item.post_type==3&&item.forward_id!=0)?item.forward_id:item.item_id;var forwardAction=StreamItemUtility.createFooterAction(\"forward\",\"Forward\",true).inject(el);forwardAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"forwardShareBoxShow\",forward_id,item.creator.username,item.post.body]));}},createConvoFooterActions:function(item,el){var replyAction=StreamItemUtility.createFooterAction(\"reply\",\"Reply\",true);replyAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"replyShareBoxShow\",item.item_id]));replyAction.inject(el);if(item.is_public==1){var forward_id=(item.forward_id!=0)?item.forward_id:item.item_id;var forwardAction=StreamItemUtility.createFooterAction(\"forward\",\"Forward\",true).inject(el);forwardAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"forwardShareBoxShow\",forward_id,item.creator.username,item.post.body]));}},createRepliesAction:function(item){var repliesClass=\"replies_\"+item.item_id;var replies=item.replies+item.private_replies;var el=new Element(\"span\",{\"class\":\"footer_action has_action \"+repliesClass,\"replies\":replies}).adopt(new Element(\"div\",{\"class\":\"action convo\"}));el.appendText(TextUtility.pluralText(replies,\"Reply\",\"Replies\"));return el;},updateReplyCount:function(item_id,count){$$(\".replies_\"+item_id).each(function(el){var replies=parseInt(el.get(\"replies\"))+count;el.set(\"replies\",replies);el.empty();el.adopt(new Element(\"div\",{\"class\":\"action convo\"}));el.appendText(TextUtility.pluralText(replies,\"Reply\",\"Replies\"));});},updateItemLiked:function(item_id,likes,is_liked){Logger().log(item_id+\"-\"+likes+\"-\"+is_liked);$$(\".likes_\"+item_id).each(function(el){el.set(\"likes\",likes);if(is_liked!=-1){el.set(\"is_liked\",is_liked);}el.empty();new Element(\"div\",{\"class\":\"text grey text11\",\"text\":likes,\"likes\":likes}).inject(el);if(likes>0){el.addClass(\"other_liked\");}else{el.removeClass(\"other_liked\");}if(is_liked!=-1){if(is_liked==1){el.addClass(\"on\");}else{el.removeClass(\"on\");}}});},createFooterAction:function(actionName,actionText,hide){var el=new Element(\"span\",{\"class\":\"footer_action has_action\"}).adopt(new Element(\"div\",{\"class\":\"action \"+actionName}));el.appendText(actionText);if(hide){el.addClass(\"hide\");}return el;},createStreamUserAction:function(user_action){var el=new Element(\"span\",{\"class\":\"user_action\"}).adopt(new Element(\"div\",{\"class\":\"action \"+user_action}));return el;},createStatusBoxFooter:function(status_message){var el=new Element(\"div\",{\"class\":\"footer\"});if(!$defined(status_message)){return el;}if(!$defined(status_message.date_created)){return el;}var date=DateUtility.convertFromTimestamp(status_message.date_created);var ts=new Element(\"span\",{\"class\":\"timestamp\",\"text\":DateUtility.getTimestamp(date,\"%B %D at %I:%M%p\"),\"ts\":date,\"ts_format\":\"%B %D at %I:%M%p\"}).inject(el);if($defined(status_message.location)&&$defined(status_message.location.geohash)&&status_message.location.geohash!=\"\"){var loc=DataUtility.getGeoString(status_message.location);if(loc){el.appendText(\" from \");new Element(\"span\",{\"text\":TextUtility.unescape(loc)}).inject(el);}}return el;}};var Room=new Class({Extends:AppInstance,EventHandlers:[\"roomClosed\",\"userSwitched\"],parseOptions:function(options){this.room=options.room;this.displayName=this.room.room_name;this.appId=\"room_\"+this.room.username;this.iconOptions={user:this.room};},userSwitched:function(){this.stop();},onStart:function(){this.setupNav();},onStop:function(){},roomClosed:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.stop();}});Room.implement({setupNav:function(){Logger().log(\"home setup\");this.navAdd(new Nav({iconOptions:{iconName:\"updates\"},displayName:\"Updates\",name:\"updates\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"updates\",\"room_menu\"])}));var roomMenu=new RoomMenu({displayName:this.room.room_name,room:this.room,appId:this.appId,isDefault:true,closeFunc:this.stop.bind(this)});this.menuAdd(\"room_menu\",roomMenu);var content=new RoomContent({isDefault:true,room:this.room});this.contentAdd(\"updates\",content);var membersContent=new RoomMembersContent({room:this.room});this.contentAdd(\"room_members\",membersContent);var subscribersContent=new RoomSubscribersContent({room:this.room});this.contentAdd(\"room_subscribers\",subscribersContent);var requestsContent=new RoomRequestsContent({room:this.room});this.contentAdd(\"room_requests\",requestsContent);}});var RoomContent=new Class({Extends:Content,EventHandlers:[\"streamItemReceived\",\"roomStreamItemDeleted\"],onBeforeInit:function(options){this.room=options.room;},onInit:function(){this.statusBox=new RoomStatusBox(this.room);$(this.statusBox).inject(this.content);this.loader=new StreamLoader({createElementFunc:StreamItemUtility.createStreamMemberRoomItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"This room has no updates\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Room updates loading...\"}),errorEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"This room is private\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},roomStreamItemReceived:function(data){if(!$defined(data.item)||!$defined(data.username)||data.username!=this.room.username){return;}Logger().log(\"roomItemRecevied, processing\");this.loader.process(data.item);},streamItemReceived:function(data){if($defined(data.item)&&data.item.source.username==this.room.username){this.loader.process(data.item);}},roomStreamItemDeleted:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.loader.remove(data.item_id);},alertCheck:function(item){if(item.creator_id!=this.getPrivateUser().user_id){this.fireEvent(\"alertAdd\",\"2_room_\"+this.room.username);}},loadMore:function(){var params={username:this.room.username,date_created:this.loader.oldestTimestamp,item_id:this.loader.oldestId};if(this.isLoggedIn()){this.call(\"home\",\"stream_room_load\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));}else{this.call(\"home\",\"public_stream_room_load\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));}this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){if(status.code==2002){this.loader.showError();}},bottomFunc:function(){this.loadMore();}});var RoomMembersContent=new Class({Extends:Content,EventHandlers:[\"roomMemberAdded\",\"roomMemberDeleted\"],onBeforeInit:function(options){this.room=options.room;this.isCreator=this.room.creator_id==this.getPrivateUser().user_id;return options;},onInit:function(){this.statusBox=new RoomStatusBox(this.room);$(this.statusBox).inject(this.content);StreamItemUtility.createSeperatorItem(\"Members\").inject(this.content);this.loader=new ItemLoader({idField:\"user_id\",sortField:\"date_created\",sortAscending:false,createElementFunc:ContactItemUtility.createRoomMemberItemFactory(this.room,this.isCreator),emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"There are no members in this room\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Room members loading...\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},loadMore:function(){var params={username:this.room.username,date_created:this.loader.lowestSortValue};this.call(\"pipio\",\"room_members\",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.members)||data.members.length==0){this.atBottom=true;return;}data.members.each(function(user){var user_copy=UserUtility.processUser(user);user_copy.date_created=user.date_created;this.loader.process(user_copy);},this);this.bottomFuncCalled=false;},bottomFunc:function(){this.loadMore();},roomMemberAdded:function(data){if(!$defined(data.room_username)||!$defined(data.user)||data.room_username!=this.room.username){return;}var user=UserUtility.processUser(data.user);user.date_created=new Date().getTime()/1000;this.loader.process(user);},roomMemberDeleted:function(data){if(!$defined(data.username)||!$defined(data.room_username)||data.room_username!=this.room.username){return;}if(!$defined(this.getUser(data.username))){return;}var user=this.getUser(data.username);this.loader.remove(user.user_id);}});var RoomRequestsContent=new Class({Extends:Content,EventHandlers:[\"roomMemberRequestDeleted\",\"roomMemberRequestAdded\",\"roomMemberAdded\"],onBeforeInit:function(options){this.room=options.room;return options;},onInit:function(){this.statusBox=new RoomStatusBox(this.room);$(this.statusBox).inject(this.content);StreamItemUtility.createSeperatorItem(\"Membership Requests\").inject(this.content);this.loader=new ItemLoader({idField:\"user_id\",sortField:\"date_created\",sortAscending:false,createElementFunc:ContactItemUtility.createRoomRequestItemFactory(this.room),emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"There are no membership requests to this room\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Room member requests loading...\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},loadMore:function(){var params={username:this.room.username,date_created:this.loader.lowestSortValue};this.call(\"pipio\",\"room_requests\",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.requests)||data.requests.length==0){this.atBottom=true;return;}data.requests.each(function(user){var user_copy=UserUtility.processUser(user);user_copy.date_created=user.date_created;this.loader.process(user_copy);},this);this.bottomFuncCalled=false;},bottomFunc:function(){this.loadMore();},roomMemberAdded:function(data){if(!$defined(data.room_username)||!$defined(data.user)||data.room_username!=this.room.username){return;}this.loader.remove(data.user.user_id);},roomMemberRequestDeleted:function(data){if(!$defined(data.room_username)||!$defined(data.username)||data.room_username!=this.room.username){return;}if(!$defined(this.getUser(data.username))){return;}var user=this.getUser(data.username);this.loader.remove(user.user_id);},roomMemberRequestAdded:function(data){if(!$defined(data.room_username)||!$defined(data.user)||data.room_username!=this.room.username){return;}var user=UserUtility.processUser(data.user);user.date_created=new Date().getTime()/1000;this.loader.process(user);}});var RoomSubscribersContent=new Class({Extends:Content,EventHandlers:[\"roomSubscriberAdded\",\"roomSubscriberDeleted\"],onBeforeInit:function(options){this.room=options.room;return options;},onInit:function(){this.statusBox=new RoomStatusBox(this.room);$(this.statusBox).inject(this.content);StreamItemUtility.createSeperatorItem(\"Subscribers\").inject(this.content);this.loader=new ItemLoader({idField:\"user_id\",sortField:\"date_created\",sortAscending:false,createElementFunc:ContactItemUtility.createRoomSubscriberItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"There are no subscribers to this room\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Room subscribers loading...\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},roomSubscriberAdded:function(data){if(!$defined(data.username)||!$defined(data.user)||data.username!=this.room.username){return;}var user=UserUtility.processUser(data.user);user.date_created=new Date().getTime()/1000;this.loader.process(user);},roomSubscriberDeleted:function(data){if(!$defined(data.username)||!$defined(data.room_username)||data.room_username!=this.room.username){return;}if(!$defined(this.getUser(data.username))){return;}var user=this.getUser(data.username);this.loader.remove(user.user_id);},loadMore:function(){var params={username:this.room.username,date_created:this.loader.lowestSortValue};this.call(\"pipio\",\"room_subscribers\",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.subscribers)||data.subscribers.length==0){this.atBottom=true;return;}data.subscribers.each(function(user){var user_copy=UserUtility.processUser(user);user_copy.date_created=user.date_created;this.loader.process(user_copy);},this);this.bottomFuncCalled=false;},bottomFunc:function(){this.loadMore();}});var RoomEditProfilePopupContent=new Class({Extends:PopupContent,strings:{bioLabel:\"About:\",urlLabel:\"Website:\"},onBeforeInit:function(options){this.room=options.room;return options;},onInit:function(){this.bioInput=new Element(\"textarea\",{\"maxlength\":500});new Element(\"div\",{\"class\":\"input_section bio\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.bioLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.bioInput)).inject(this.content);this.urlInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":200});new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.urlLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.urlInput)).inject(this.content);var about=this.getProfile(this.room.username);if($defined(about)){if($defined(about.bio)){this.bioInput.set(\"text\",about.bio);}if($defined(about.url)){this.urlInput.value=about.url;}}this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Update\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.updateProfile.bind(this));this.message=new Element(\"div\",{\"class\":\"message error\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},updateProfile:function(){var bio=this.bioInput.value.trim();var url=this.urlInput.value.trim();var params={username:this.room.username,bio:bio,url:url};this.call(\"home\",\"room_profile_update\",params,this.updateProfileSuccess.bind(this),this.updateProfileFail.bind(this));this.actionButton.showProgress();this.message.empty();},updateProfileSuccess:function(data){this.actionButton.hideProgress();this.closeContent();},updateProfileFail:function(){this.actionButton.hideProgress();this.message.set(\"text\",this.strings.errorMessage);},onShow:function(){this.focus();},focus:function(){this.bioInput.focus.delay(500,this.bioInput);}});var RoomSearchPopupContent=new Class({Extends:PopupContent,strings:{roomSearchMessage:\"Enter any terms to search for a room\",errorMessage:\"There was an error creating this group\"},onInit:function(){new Element(\"div\",{\"class\":\"text_section centered light\",\"text\":this.strings.roomSearchMessage}).inject(this.content);this.searchInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"50\"});this.searchInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.searchInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Search\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.search.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.searchInput.value.trim()!=\"\"){this.search();}}},search:function(){var query=this.searchInput.value.trim();var params={query:query};this.call(\"home\",\"room_search\",params,this.searchSuccess.bind(this),this.searchFail.bind(this));this.actionButton.showProgress();},searchSuccess:function(data){this.actionButton.hideProgress();if(!$defined(data.rooms)){return;}if(data.rooms.length==0){var name=\"room_search\";var title=\"No Results\";var message=\"Your search returned no results\";this.fireEvent(\"showAlert\",name,title,message);}else{this.showResultsPopup(data.rooms);}},searchFail:function(status){this.actionButton.hideProgress();var name=\"search_user\";var title=\"Error\";var message=status.message;this.fireEvent(\"showAlert\",name,title,message);},showResultsPopup:function(rooms){if($defined(this.resultsPopup)){this.resultsPopup.close();}this.createResultsPopup(rooms);},closeResultsPopup:function(){if($defined(this.resultsPopup)){this.resultsPopup.close();}},createResultsPopup:function(rooms){this.resultsPopup=new Popup({size:{x:350,y:400},resizable:false,dockable:false,className:\"roomSearch\",onClose:this.destroyResultsPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"search\"},displayName:\"Search Results\",closable:true});var content=new RoomSearchResultPopupContent({rooms:rooms});this.resultsPopup.addContent(\"results\",nav,content);},destroyResultsPopup:function(){this.resultsPopup=null;},onShow:function(){this.focus();},focus:function(){this.searchInput.focus.delay(500,this.searchInput);},onClose:function(){this.closeResultsPopup();}});var RoomSearchResultPopupContent=new Class({Extends:PopupContent,strings:{searchResultMessage:\"Search results\"},onBeforeInit:function(options){this.rooms=options.rooms;return options;},onInit:function(){this.list=new Element(\"div\",{\"class\":\"itemList\"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Close\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.closeButton)).inject(this.content);this.insertRooms();},insertRooms:function(){this.rooms.each(function(room){room=UserUtility.processRoom(room);this.insertRoom(room);},this);},insertRoom:function(room){var el=RoomItemUtility.createRoomItem(room);el.addEvent(\"click\",this.fireEvent.bind(this,[\"showRoom\",room]));el.inject(this.list);}});var RoomItemUtility={createRoomItem:function(room){var el=new Element(\"div\",{\"class\":\"listItem\"});ItemUtility.createProfilePic(room,32).inject(el);new Element(\"div\",{\"class\":\"listText text12 light\",\"text\":TextUtility.cleanText(room.room_name+\" (\"+room.username+\")\")}).inject(el);if($defined(room.about)&&$defined(room.about.bio)){new Element(\"div\",{\"class\":\"about_text text11 light3\",\"text\":TextUtility.cleanText(room.about.bio)}).inject(el);}return el;}};var RoomConnectionMenuSection=new Class({Extends:Base,EventHandlers:[\"roomStreamSubscriptionAdded\",\"roomStreamSubscriptionDeleted\",\"roomMembershipUpdated\"],init:function(options){this.room=this.getRoom(options.room.username);this.subscribed=parseInt(this.room.subscribed)==1;this.isCreator=this.room.creator_id==this.getPrivateUser().user_id;this.createSection();},createSection:function(){this.wrapper=new Element(\"div\");this.generateSection();},setRoom:function(room){this.room=room;this.generateSection();},generateSection:function(){this.wrapper.empty();this.generateSubscriptionSection();if(this.isCreator){this.generatePrivacySection();new Element(\"div\",{\"class\":\"text_section light centered text11\",\"text\":\"You are the creator\"}).inject(this.wrapper);this.button=new ButtonMedium({displayName:\"Close Room\",className:\"dark\",action:\"cross\"});var name=\"roomDelete_\"+this.room.username;var title=\"Close \"+this.room.room_name;var message=\"Are you sure you want to close the room \"+this.room.room_name+\"?\";var func=pipio.dispatchEvent.bind(pipio,[\"feedRoomDelete\",this.room.username]);$(this.button).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showConfirmation\",name,title,message,func]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.button)).inject(this.wrapper);}else{switch(parseInt(this.room.status)){case 1:this.createConnectedSection();break;case 2:this.createRequestSection();break;case 3:this.createRequestOutSection();break;default:this.createNotConnectedSection();break;}}},createNotConnectedSection:function(){this.button=new ButtonMedium({displayName:\"Join Room\",className:\"dark\",action:\"check\"});var name=\"roomRequest_\"+this.room.username;var title=\"Join \"+this.room.room_name;var message=\"Send membership request to \"+this.room.room_name+\"?\";var func=this.roomRequestCreate.bind(this);$(this.button).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showConfirmation\",name,title,message,func]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.button)).inject(this.wrapper);},createConnectedSection:function(){new Element(\"div\",{\"class\":\"text_section light centered text11\",\"text\":\"You are a member\"}).inject(this.wrapper);this.button=new ButtonMedium({displayName:\"Leave Room\",className:\"dark\",action:\"cross\"});var name=\"roomLeave_\"+this.room.username;var title=\"Leave \"+this.room.room_name;var message=\"Are you sure you want to leave \"+this.room.room_name+\"?\";var func=this.roomMembershipDelete.bind(this);$(this.button).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showConfirmation\",name,title,message,func]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.button)).inject(this.wrapper);},createRequestSection:function(){this.button=new ButtonMedium({displayName:\"Accept Membership\",className:\"dark\",action:\"check\"});$(this.button).addEvent(\"click\",this.roomInviteAccept.bind(this));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.button)).inject(this.wrapper);this.button2=new ButtonMedium({displayName:\"Reject Membership\",className:\"dark\",action:\"cross\"});$(this.button2).addEvent(\"click\",this.roomInviteDelete.bind(this));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.button2)).inject(this.wrapper);},roomInviteAccept:function(){this.call(\"home\",\"room_invite_accept\",{username:this.room.username},null,null);this.button.showProgress();},roomInviteDelete:function(){var params={username:this.getPrivateUser().username,room_username:this.room.username};this.call(\"home\",\"room_invite_delete\",params,null,null);this.button2.showProgress();},createRequestOutSection:function(){new Element(\"div\",{\"class\":\"text_section light centered text11\",\"text\":\"Membership request pending\"}).inject(this.wrapper);},roomRequestCreate:function(){this.call(\"home\",\"room_request_create\",{username:this.room.username},null,null);this.button.showProgress();},roomMembershipDelete:function(){this.call(\"home\",\"room_leave\",{username:this.room.username},null,null);this.button.showProgress();},generateSubscriptionSection:function(){this.subscription=new Toggle(this.subscribed);$(this.subscription).addEvent(\"click\",this.subscriptionToggle.bind(this));new Element(\"div\",{\"class\":\"toggle_section\"}).adopt(new Element(\"div\",{\"class\":\"text light\",\"text\":\"Subscribe:\"}),$(this.subscription)).inject(this.wrapper);},generatePrivacySection:function(){this.privacy=new Toggle(this.room.is_public==1);$(this.privacy).addEvent(\"click\",this.privacyToggle.bind(this));new Element(\"div\",{\"class\":\"toggle_section\"}).adopt(new Element(\"div\",{\"class\":\"text light\",\"text\":\"Public:\"}),$(this.privacy)).inject(this.wrapper);},privacyToggle:function(){this.call(\"home\",\"room_privacy_set\",{username:this.room.username,is_public:this.privacy.toInt()});},subscriptionToggle:function(){Logger().log(this.subscribed);if(this.subscribed){this.streamUnsubscribe();}else{this.streamSubscribe();}},streamUnsubscribe:function(){this.subscription.off();this.call(\"home\",\"room_unsubscribe\",{username:this.room.username});},streamSubscribe:function(){this.subscription.on();this.call(\"home\",\"room_subscribe\",{username:this.room.username},null,this.streamSubscribeFail.bind(this));},streamSubscribeFail:function(status){if(status.code==2002){this.subscription.off();var name=\"subscription\";var title=\"Error\";var message=status.message;this.fireEvent(\"showAlert\",name,title,message);}},roomPrivacyUpdated:function(data){if(!$defined(data.username)||data.username!=this.room.username,!$defined(data.is_public)){return;}if(data.is_public==1){this.privacy.on();}else{this.privacy.off();}},roomStreamSubscriptionAdded:function(data){if(!$defined(data.room)||data.room.username!=this.room.username){return;}this.subscribed=true;this.generateSection();},roomStreamSubscriptionDeleted:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.subscribed=false;this.generateSection();},roomMembershipUpdated:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.room.status=parseInt(data.status);this.generateSection();},toElement:function(){return this.wrapper;}});var RoomMenu=new Class({Extends:Menu,EventHandlers:[\"roomMemberAdded\",\"roomMemberDeleted\",\"roomSubscriberAdded\",\"roomSubscriberDeleted\",\"roomMemberRequestDeleted\",\"roomMemberRequestAdded\"],strings:{groupMenuText:'These are contacts in your group \"{0}\"',unsortedGroupMenuText:\"These are contacts that have not been added to a group\"},onBeforeInit:function(options){this.room=options.room;this.appId=options.appId;this.isCreator=this.room.creator_id==this.getPrivateUser().user_id;return options;},onInit:function(){ItemUtility.createProfilePic(this.room,100).inject(this.menu);this.aboutSection=new RoomProfileMenuSection({room:this.room});$(this.aboutSection).inject(this.menu);if(this.isLoggedIn()){this.connect=new RoomConnectionMenuSection({room:this.room});$(this.connect).inject(this.menu);if(this.isCreator){this.profilePicUploadButton=new ButtonMedium({displayName:\"Change Picture\",className:\"dark\",action:\"photo\"});this.fileInput=new Element(\"input\",{\"type\":\"file\",\"name\":\"file\"});this.form=new Element(\"form\").adopt(this.fileInput);this.fileInput.addEvent(\"change\",this.profilePicUpload.bind(this));this.profilePicUploadSection=new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.profilePicUploadButton).adopt(this.form)).inject(this.menu);var editProfileButton=new ButtonMedium({displayName:\"Edit Profile\",className:\"dark\",action:\"edit\"});$(editProfileButton).addEvent(\"click\",this.fireEvent.bind(this,[\"showEditRoomProfilePopup\",this.room]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(editProfileButton)).inject(this.menu);this.inviteButton=new ButtonMedium({displayName:\"Invite Members\",className:\"dark\",action:\"forward\"});$(this.inviteButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showRoomInvitePopup\",this.room]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.inviteButton)).inject(this.menu);}}new Element(\"div\",{\"class\":\"nav_seperator\"}).inject(this.menu);this.members=new MembersNav({room:this.room,appId:this.appId,onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"room_members\",\"room_menu\"])});$(this.members).inject(this.menu);this.subscribers=new SubscribersNav({user:this.room,appId:this.appId,onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"room_subscribers\",\"room_menu\"])});$(this.subscribers).inject(this.menu);if(this.isCreator){this.requests=new MemberRequestsNav({room:this.room,appId:this.appId,onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"room_requests\",\"room_menu\"])});$(this.requests).inject(this.menu);}},onShow:function(first){if(first){this.roomInfoLoad();}},roomInfoLoad:function(){if(this.isLoggedIn()){this.call(\"home\",\"room_info_load\",{username:this.room.username},this.roomInfoLoadSuccess.bind(this),null);}else{this.call(\"home\",\"public_room_info_load\",{username:this.room.username},this.roomInfoLoadSuccess.bind(this),null);}},roomMemberAdded:function(data){if(!$defined(data.room_username)||!$defined(data.user)||data.room_username!=this.room.username){return;}this.members.addUsers(data.user);this.requests.removeUser(data.user.username);},roomMemberDeleted:function(data){if(!$defined(data.username)||!$defined(data.room_username)||data.room_username!=this.room.username){return;}this.members.removeUser(data.username);},roomSubscriberAdded:function(data){if(!$defined(data.username)||!$defined(data.user)||data.username!=this.room.username){return;}this.subscribers.addUsers(data.user);},roomSubscriberDeleted:function(data){if(!$defined(data.username)||!$defined(data.room_username)||data.room_username!=this.room.username){return;}this.subscribers.removeUser(data.username);},roomMemberRequestDeleted:function(data){if(!$defined(data.room_username)||!$defined(data.username)||data.room_username!=this.room.username){return;}this.requests.removeUser(data.username);},roomMemberRequestAdded:function(data){if(!$defined(data.room_username)||!$defined(data.user)||data.room_username!=this.room.username){return;}this.requests.addUsers(data.user);},roomInfoLoadSuccess:function(data){if(!$defined(data.room)){return;}var room=UserUtility.processRoom(data.room);this.subscribers.addUsers(data.subscribers);this.members.addUsers(data.members);if($defined(data.requests)&&$defined(this.requests)){this.requests.addUsers(data.requests);}},profilePicUpload:function(){if(DataUtility.validatePhotoFile(this.fileInput.value)){this.call(\"pipio\",\"room_profilepic_upload\",{username:this.room.username},this.profilePicUploadSuccess.bind(this),this.profilePicUploadFail.bind(this),this.form);this.profilePicUploadButton.showProgress();}},profilePicUploadSuccess:function(){this.profilePicUploadButton.hideProgress();this.resetForm();},profilePicUploadFail:function(){this.profilePicUploadButton.hideProgress();this.resetForm();},resetForm:function(){this.profilePicUploadSection.empty();this.profilePicUploadButton=new ButtonMedium({displayName:\"Change Picture\",className:\"dark\",action:\"photo\"});this.fileInput=new Element(\"input\",{\"type\":\"file\",\"name\":\"file\"});this.form=new Element(\"form\").adopt(this.fileInput);this.fileInput.addEvent(\"change\",this.profilePicUpload.bind(this));this.profilePicUploadSection.adopt($(this.profilePicUploadButton).adopt(this.form));}});var RoomProfileMenuSection=new Class({Extends:Base,EventHandlers:[\"roomProfileUpdated\"],init:function(options){this.room=options.room;this.createSection();},createSection:function(){this.wrapper=new Element(\"div\");this.bioText=new Element(\"span\");this.bioSection=new Element(\"div\",{\"class\":\"text_section light1 text11 edit_option\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"About: \"}),this.bioText).inject(this.wrapper);this.urlText=new Element(\"a\",{\"target\":\"_blank\"});this.urlSection=new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap edit_option\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Web: \"}),this.urlText).inject(this.wrapper);this.roomProfileUpdated(this.room.username,this.getProfile(this.room.username));},roomProfileUpdated:function(username,about){if(username!=this.room.username){return;}if(!$defined(about)){DomUtility.hide(this.bioSection);DomUtility.hide(this.urlSection);return;}if(!$defined(about.bio)||about.bio==\"\"){DomUtility.hide(this.bioSection);}else{this.bioText.set(\"text\",TextUtility.unescape(about.bio));DomUtility.show(this.bioSection);}if(!$defined(about.url)||about.url==\"\"){DomUtility.hide(this.urlSection);}else{this.urlText.set(\"text\",TextUtility.unescape(about.url));this.urlText.set(\"href\",about.url);DomUtility.show(this.urlSection);}},toElement:function(){return this.wrapper;}});var Rss=new Class({Extends:App,EventHandlers:[\"userSwitched\",\"rssInstall\",\"rssUninstall\",\"rssFeedSubscribed\",\"rssFeedUnsubscribed\",\"showAddRssFeedPopup\"],onStart:function(){this.setupNav();this.feeds=$H();this.loadSubscriptions();},onStop:function(){},userSwitched:function(){if(!this.isLoggedIn()){this.stop();}},loadSubscriptions:function(){this.call(\"rss\",\"rss_subscriptions\",null,this.loadSubscriptionsSuccess.bind(this),null);},loadSubscriptionsSuccess:function(data){if(!$defined(data.subscriptions)){return;}data.subscriptions.each(function(subscription){this.rssFeedAdd(subscription);},this);},rssFeedSubscribed:function(data){if(!$defined(data.subscription)){return;}this.rssFeedAdd(data.subscription);},rssFeedUnsubscribed:function(data){if(!$defined(data.atom_id)){return;}this.rssFeedDelete(data.atom_id);},rssUninstall:function(){this.call(\"rss\",\"rss_uninstall\",null,this.rssUninstallSuccess.bind(this),null);},rssUninstallSuccess:function(){this.stop();},rssInstall:function(){this.call(\"rss\",\"rss_install\",null,this.rssInstallSuccess.bind(this),null);},rssInstallSuccess:function(){this.start();}});Rss.implement({requests:[{name:\"rss_subscriptions\",url:\"/api/app/rss/subscriptions\"},{name:\"rss_subscriptions_add\",params:[\"feed_url\"],url:\"/api/app/rss/subscriptions/add\"},{name:\"rss_subscriptions_delete\",params:[\"subscription_id\"],url:\"/api/app/rss/subscriptions/delete\"},{name:\"rss_feed\",params:[\"atom_id\",\"item_id\"],url:\"/api/app/rss/feed\"},{name:\"rss_feed_all\",url:\"/api/app/rss/feed/all\"},{name:\"rss_feed_subscribers\",params:[\"atom_id\"],url:\"/api/app/rss/feed/subscribers\"},{name:\"rss_install\",params:[],url:\"/api/app/rss/install\"},{name:\"rss_uninstall\",params:[],url:\"/api/app/rss/uninstall\"}]});Rss.implement({setupNav:function(){var homeNav=new Nav({iconOptions:{iconName:\"updates\"},displayName:\"All News Updates\",name:\"updates\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"updates\",\"rss_menu\"])});this.navAdd(homeNav);this.navAdd(new Nav({iconOptions:{iconName:\"rss\"},hasSubnavs:true,displayName:\"Feeds\",name:\"feeds\"}));this.navAdd(new Nav({iconOptions:{iconName:\"broadcast\",iconAction:\"add\"},displayName:\"Add New Feed...\",onClick:this.showAddRssFeedPopup.bind(this),name:\"new_feed\",parentName:\"feeds\",bottom:true}));var rssMenu=new RssMenu({isDefault:true,closeFunc:this.stop.bind(this),navId:homeNav.navId});this.menuAdd(\"rss_menu\",rssMenu);var content=new RssContent({isDefault:true});this.contentAdd(\"updates\",content);},rssFeedAdd:function(feed){if(this.feeds.has(feed.atom_id)){return;}var nav=new Nav({iconOptions:{\"iconName\":\"rss\"},displayName:feed.title,name:\"rss_\"+feed.atom_id,parentName:\"feeds\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"rss_\"+feed.atom_id,\"rss_\"+feed.atom_id])});this.navAdd(nav);this.feeds.set(feed.atom_id,nav);var feedMenu=new RssFeedMenu({displayName:feed.title,feed:feed});this.menuAdd(\"rss_\"+feed.atom_id,feedMenu);var content=new RssFeedContent({feed:feed});this.contentAdd(\"rss_\"+feed.atom_id,content);},rssFeedDelete:function(atom_id){if(!this.feeds.has(atom_id)){return;}this.feeds.get(atom_id).destroy();this.navDelete(\"rss_\"+atom_id);this.feeds.erase(atom_id);this.menuClose(\"rss_\"+atom_id);this.contentClose(\"rss_\"+atom_id);},showAddRssFeedPopup:function(){if($defined(this.addFeedPopup)){this.addFeedPopup.close();}this.createAddRssFeedPopup();},createAddRssFeedPopup:function(){this.addFeedPopup=new Popup({size:{x:350,y:94},resizable:false,dockable:false,className:\"addFeed\",onClose:this.destroyAddRssFeedPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"rss\",iconAction:\"add\"},displayName:\"Subscribe to a Feed\",closable:true});var content=new AddRssFeedPopupContent({});this.addFeedPopup.addContent(\"add_feed\",nav,content);},destroyAddRssFeedPopup:function(){this.addFeedPopup=null;}});var RssContent=new Class({Extends:Content,EventHandlers:[\"rssItemReceived\"],onBeforeInit:function(options){this.feed=options.feed;this.sessionTimestamp=(new Date().getTime())/1000;return options;},onInit:function(){this.loader=new ItemLoader({createElementFunc:RssItemUtility.createRssAllItem,idField:\"atom_item_id\",sortField:\"date_created\",sortAscending:false,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"This feed has no items\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Feed loading...\"}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},alertCheck:function(item){if(item.date_created>this.sessionTimestamp){this.fireEvent(\"alertAdd\",this.navId);}},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},rssItemReceived:function(data){if($defined(data.item)){this.loader.process(data.item);}},loadMore:function(){var params={date_created:this.loader.lowestSortValue};this.call(\"rss\",\"rss_feed_all\",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){item.feed=this.feed;this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){this.loadMore();}});var RssFeedContent=new Class({Extends:Content,EventHandlers:[\"rssItemReceived\"],onBeforeInit:function(options){this.feed=options.feed;return options;},onInit:function(){this.loader=new ItemLoader({createElementFunc:RssItemUtility.createRssFeedItem,idField:\"atom_item_id\",sortField:\"date_created\",sortAscending:false,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"This feed has no items\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Feed loading...\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},rssItemReceived:function(data){if($defined(data.item)&&data.item.atom_id==this.feed.atom_id){this.loader.process(data.item);}},loadMore:function(){var params={atom_id:this.feed.atom_id,date_created:this.loader.oldestTimestamp};this.call(\"rss\",\"rss_feed\",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){item.feed=this.feed;this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){Logger().log(\"rss content bottom\");}});var RssFeedMenu=new Class({Extends:Menu,onBeforeInit:function(options){this.feed=options.feed;return options;},onInit:function(){this.urlText=new Element(\"a\",{\"target\":\"_blank\",\"href\":this.feed.link,\"text\":TextUtility.unescape(this.feed.link)});new Element(\"div\",{\"class\":\"text_section nowrap text11 light1\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Web: \"}),this.urlText).inject(this.menu);new Element(\"div\",{\"class\":\"text_section light1\",\"text\":TextUtility.unescape(this.feed.description)}).inject(this.menu);this.deleteButton=new ButtonMedium({displayName:\"Unsubscribe\",className:\"dark\",action:\"cross\"});var name=\"rssFeedUnsubscribe_\"+this.feed.atom_id;var title=\"Unsubscribe \"+this.feed.title;var message=\"Are you sure you want to unsubscribe from the feed \"+this.feed.title+\"?\";var func=this.rssUnsubscribe.bind(this);$(this.deleteButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showConfirmation\",name,title,message,func]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.deleteButton)).inject(this.menu);new Element(\"div\",{\"class\":\"nav_seperator\"}).inject(this.menu);this.subscribers=new SubscribersNav({user:this.feed});$(this.subscribers).inject(this.menu);},onShow:function(first){if(first){this.subscribersLoad();}},subscribersLoad:function(){this.call(\"rss\",\"rss_feed_subscribers\",{atom_id:this.feed.atom_id},this.subscribersLoadSuccess.bind(this),null);},subscribersLoadSuccess:function(data){if(!$defined(data.subscribers)){return;}this.subscribers.addUsers(data.subscribers);},rssUnsubscribe:function(){var params={subscription_id:this.feed.subscription_id};this.call(\"rss\",\"rss_subscriptions_delete\",params,this.rssUnsubscribeSuccess.bind(this),this.rssUnsubscribeFail.bind(this));this.deleteButton.showProgress();},rssUnsubscribeSuccess:function(data){this.deleteButton.hideProgress();},rssUnsubscribeFail:function(){this.deleteButton.hideProgress();}});var RssMenu=new Class({Extends:Menu,onBeforeInit:function(options){options.displayName=\"News Reader\";return options;},onInit:function(){new Element(\"div\",{\"class\":\"text_section light1\",\"text\":TextUtility.unescape(\"All updates from your subscriptions will be visible here\")}).inject(this.menu);}});var AddRssFeedPopupContent=new Class({Extends:PopupContent,strings:{feedUrlLabel:\"Feed URL:\",errorMessage:\"There was an error subscribing to this feed\"},onInit:function(){this.feedUrlInput=new Element(\"textarea\",{\"maxlength\":200});this.feedUrlInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.feedUrlLabel}),new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.feedUrlInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Subscribe\",className:\"dark\",action:\"check\"});$(this.actionButton).addEvent(\"click\",this.feedSubscribe.bind(this));this.message=new Element(\"div\",{\"class\":\"message success\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.feedUrlInput.value.trim()!=\"\"){this.feedSubscribe();}}},feedSubscribe:function(){var url=this.feedUrlInput.value.trim();var params={feed_url:url};this.call(\"rss\",\"rss_subscriptions_add\",params,this.feedSubscribeSuccess.bind(this),this.feedSubscribeFail.bind(this));this.actionButton.showProgress();this.message.set(\"text\",\"please wait...\");},feedSubscribeSuccess:function(){this.actionButton.hideProgress();this.closeContent();},feedSubscribeFail:function(status){this.actionButton.hideProgress();var name=\"feed_subscribe\";var title=\"Error Subscribing to Feed\";var message=status.message;this.message.empty();this.fireEvent(\"showAlert\",name,title,message);},onShow:function(){this.focus();},focus:function(){this.feedUrlInput.focus.delay(500,this.feedUrlInput);}});var RssItemUtility={createRssFeedItem:function(item){return RssItemUtility.createRssItem(item,false);},createRssAllItem:function(item){return RssItemUtility.createRssItem(item,true);},createRssItem:function(item,showFeed){var el=ItemUtility.createPostBubble(\"post haspic\");ItemUtility.createItemPic(\"/images/v5/apps/rss/feed_icon.png\").inject(el);var content=new Element(\"div\",{\"class\":\"post_content\"}).inject(el);RssItemUtility.createRssItemHeader(item,showFeed).inject(content);RssItemUtility.createRssItemFooter(item,showFeed).inject(content);return el;},createRssItemHeader:function(item,showFeed){var el=new Element(\"div\",{\"class\":\"header\"});new Element(\"span\",{}).adopt(new Element(\"a\",{\"href\":item.link,\"class\":\"user_name clickable\",\"text\":TextUtility.unescape(item.title),\"target\":\"_blank\"})).inject(el);if($defined(item.summary)&&item.summary!=\"\"){new Element(\"span\",{\"html\":\" \"+TextUtility.replaceUrls(TextUtility.stripHtml(TextUtility.unescape(item.summary)))}).inject(el);}return el;},createRssItemFooter:function(item){var el=new Element(\"div\",{\"class\":\"footer\"});if(!$defined(item.date_created)){return el;}var date=DateUtility.convertFromTimestamp(item.date_created);var ts=new Element(\"span\",{\"class\":\"timestamp\",\"text\":DateUtility.getTimestamp(date,\"%B %D at %I:%M%p\"),\"ts\":date,\"ts_format\":\"%B %D at %I:%M%p\"}).inject(el);return el;}};var Twitter=new Class({Extends:App,EventHandlers:[\"userSwitched\",\"twitterInstall\",\"twitterUninstall\",\"showTwitterUser\",\"twitterShowFollowing\",\"twitterShowFollowers\",\"showTwitterList\",\"twitterListSubscribed\",\"twitterListUnsubscribed\",\"twitterListsLoaded\",\"showTwitterSearchPopup\",\"twitterSearch\",\"twitterRetweet\",\"twitterDelete\",\"twitterSavedSearchesLoaded\",\"twitterSavedSearchAdd\",\"twitterSavedSearchDelete\"],parseOptions:function(options){this.settings=options.settings;},onStart:function(){this.setupNav();},onStop:function(){},userSwitched:function(){if(!this.isLoggedIn()){this.userLoggedOut();}},userLoggedOut:function(){this.stop();},twitterInstall:function(){this.installPopup=new Popup({size:{x:350,y:80},resizable:false,dockable:false,className:\"appInstall\",onClose:this.destroyTwitterInstallPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"twitter\"},displayName:\"Install Twitter\",closable:true});var content=new TwitterInstallPopupContent({});this.installPopup.addContent(\"install\",nav,content);},destroyTwitterInstallPopup:function(){this.installPopup=null;},twitterUninstall:function(){this.call(\"twitter\",\"twitter_uninstall\",null,this.twitterUninstallSuccess.bind(this));},twitterUninstallSuccess:function(){this.stop();},twitterRetweet:function(id){var name=\"twitterRetweet_\"+id;var title=\"Retweet an Update\";var message=\"Retweet this update?\";var func=this.twitterRetweetCall.bind(this,[id]);this.fireEvent(\"showConfirmation\",name,title,message,func);},twitterRetweetCall:function(id){this.call(\"twitter\",\"twitter_retweet\",{id:id},this.twitterRetweetSuccess.bind(this));},twitterRetweetSuccess:function(data){},twitterDelete:function(id){var name=\"twitterDelete_\"+id;var title=\"Delete Update\";var message=\"Delete this update?\";var func=this.twitterDeleteCall.bind(this,[id]);this.fireEvent(\"showConfirmation\",name,title,message,func);},twitterDeleteCall:function(id){this.call(\"twitter\",\"twitter_item_delete\",{id:id},this.twitterDeleteSuccess.bind(this));},twitterDeleteSuccess:function(data){if(!$defined(data.id)){return;}TwitterItemUtility.deleteTwitterItem(data.id);}});Twitter.implement({requests:[{name:\"twitter_auth_request\",url:\"/api/app/twitter/auth/request\"},{name:\"twitter_install\",params:[\"sync_posts\"],url:\"/api/app/twitter/install\"},{name:\"twitter_uninstall\",url:\"/api/app/twitter/uninstall\"},{name:\"twitter_user_show\",params:[\"screen_name\"],url:\"/api/app/twitter/user/show\"},{name:\"twitter_list_show\",params:[\"screen_name\",\"slug\"],url:\"/api/app/twitter/list/show\"},{name:\"twitter_self_show\",params:[\"screen_name\"],url:\"/api/app/twitter/self/show\"},{name:\"twitter_home_timeline\",params:[\"since_id\",\"max_id\"],url:\"/api/app/twitter/home/timeline\"},{name:\"twitter_user_timeline\",params:[\"username\",\"since_id\",\"max_id\"],url:\"/api/app/twitter/user/timeline\"},{name:\"twitter_lists_timeline\",params:[\"screen_name\",\"list_id\",\"since_id\",\"max_id\"],url:\"/api/app/twitter/lists/timeline\"},{name:\"twitter_mentions\",params:[\"since_id\",\"max_id\",\"count\",\"page\"],url:\"/api/app/twitter/mentions\"},{name:\"twitter_settings_update\",params:[\"key\",\"value\"],url:\"/api/app/twitter/settings/update\"},{name:\"twitter_follow\",params:[\"screen_name\"],url:\"/api/app/twitter/follow\"},{name:\"twitter_unfollow\",params:[\"screen_name\"],url:\"/api/app/twitter/unfollow\"},{name:\"twitter_settings_set\",params:[\"key\",\"value\"],url:\"/api/app/twitter/settings/update\"},{name:\"twitter_friends\",params:[\"username\",\"page\"],url:\"/api/app/twitter/friends\"},{name:\"twitter_followers\",params:[\"username\",\"page\"],url:\"/api/app/twitter/followers\"},{name:\"twitter_block\",params:[\"screen_name\"],url:\"/api/app/twitter/block\"},{name:\"twitter_post_text\",params:[\"body\",\"post_id\"],url:\"/api/app/twitter/text/item_create\"},{name:\"twitter_search\",params:[\"q\",\"page\"],url:\"/api/app/twitter/search\"},{name:\"twitter_searches_create\",params:[\"query\"],url:\"/api/app/twitter/searches/create\"},{name:\"twitter_searches_delete\",params:[\"id\"],url:\"/api/app/twitter/searches/delete\"},{name:\"twitter_retweet\",params:[\"id\"],url:\"/api/app/twitter/retweet\"},{name:\"twitter_item_delete\",params:[\"id\"],url:\"/api/app/twitter/item/delete\"},{name:\"twitter_dm_inbox\",url:\"/api/app/twitter/dm/inbox\"},{name:\"twitter_dm_all\",url:\"/api/app/twitter/dm/all\"},{name:\"twitter_dm_delete\",params:[\"id\"],url:\"/api/app/twitter/dm/delete\"},{name:\"twitter_dm_send\",params:[\"recipient\",\"message\"],url:\"/api/app/twitter/dm/send\"},{name:\"twitter_searches_saved\",url:\"/api/app/twitter/searches/saved\"},{name:\"twitter_trends\",url:\"/api/app/twitter/trends\"},{name:\"twitter_favorites\",url:\"/api/app/twitter/favorites\"},{name:\"twitter_favorites_create\",params:[\"id\",\"element_id\"],url:\"/api/app/twitter/favorites/create\"},{name:\"twitter_favorites_delete\",params:[\"id\",\"element_id\"],url:\"/api/app/twitter/favorites/delete\"},{name:\"twitter_lists\",params:[\"screen_name\"],url:\"/api/app/twitter/lists\"},{name:\"twitter_lists_members\",url:\"/api/app/twitter/lists/members\"},{name:\"twitter_lists_create\",params:[\"name\",\"mode\",\"description\"],url:\"/api/app/twitter/lists/create\"},{name:\"twitter_lists_delete\",params:[\"list_id\"],url:\"/api/app/twitter/lists/delete\"},{name:\"twitter_lists_statuses\",params:[\"screen_name\",\"list_id\",\"cursor\",\"page\"],url:\"/api/app/twitter/lists/statuses\"},{name:\"twitter_lists_add_user\",params:[\"list_id\",\"id\"],url:\"/api/app/twitter/lists/add_user\"},{name:\"twitter_lists_get_users\",params:[\"screen_name\",\"list_id\"],url:\"/api/app/twitter/lists/get_users\"},{name:\"twitter_lists_delete_user\",params:[\"list_id\",\"id\"],url:\"/api/app/twitter/lists/delete_user\"},{name:\"twitter_lists_subscribe\",params:[\"screen_name\",\"list_id\"],url:\"/api/app/twitter/lists/subscribe\"},{name:\"twitter_lists_subscribers\",params:[\"screen_name\",\"list_id\"],url:\"/api/app/twitter/lists/subscribers\"},{name:\"twitter_lists_unsubscribe\",params:[\"screen_name\",\"list_id\"],url:\"/api/app/twitter/lists/unsubscribe\"},{name:\"twitter_lists_subscriptions\",params:[\"screen_name\"],url:\"/api/app/twitter/lists/subscriptions\"},{name:\"twitter_lists_memberships\",params:[\"screen_name\"],url:\"/api/app/twitter/lists/memberships\"},{name:\"twitter_post_link\",params:[\"body\",\"url\",\"post_id\"],url:\"/api/app/twitter/link/item_create\"},{name:\"twitter_post_photo\",params:[\"body\",\"photo\",\"post_id\"],url:\"/api/app/twitter/photo/item_create\",multipart:true},]});Twitter.implement({twitterSavedSearchesLoaded:function(searches){this.saved_searches=$H();searches.each(function(search){this.saved_searches.set(search.id,search);},this);},twitterSavedSearchAdd:function(search){this.saved_searches.set(search.id,search);},twitterSavedSearchDelete:function(id){this.saved_searches.erase(id);},twitterSearch:function(query,search_id){if(!$defined(search_id)){search_id=0;}var search={query:query,id:search_id};if(this.searches.has(query)){this.fireEvent(\"viewSwitch\",this.appId,\"search_\"+query,\"search_\"+query);return;}this.searchAdd(search);},searchAdd:function(search){if(!$defined(this.searchNav)){this.searchNav=new Nav({iconOptions:{iconName:\"search\"},hasSubnavs:true,displayName:\"Searches\",name:\"searches\"});this.navAdd(this.searchNav);}var nav=new Nav({displayName:search.query,closable:true,name:\"search_\"+search.query,parentName:\"searches\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"search_\"+search.query,\"search_\"+search.query])});this.navAdd(nav);this.searches.set(search.query,search);var content=new TwitterSearchContent({search:search,navId:nav.navId});this.contentAdd(\"search_\"+search.query,content);var menu=new TwitterSearchMenu({search:search,searches:this.saved_searches,closable:true,closeFunc:this.searchClose.bind(this,search)});this.menuAdd(\"search_\"+search.query,menu);this.fireEvent(\"viewSwitch\",this.appId,\"search_\"+search.query,\"search_\"+search.query);},searchClose:function(search){Logger().log(\"attempting to close \"+search.query);if(!this.searches.has(search.query)){return;}this.navDelete(\"search_\"+search.query);this.menuClose(\"search_\"+search.query);this.contentClose(\"search_\"+search.query);this.searches.erase(search.query);if(this.searches.getLength()==0){this.navDelete(\"searches\");this.searchNav=null;}}});Twitter.implement({setupNav:function(){this.searches=$H();this.users=$H();this.lists=$H();this.listSubs=$H();var homeNav=new Nav({iconOptions:{iconName:\"updates\"},displayName:\"Home\",name:\"updates\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"updates\",\"self_menu\"])});this.navAdd(homeNav);var mentionsNav=new Nav({iconOptions:{iconName:\"at\"},displayName:this.settings.screen_name,name:\"mentions\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"mentions\",\"self_menu\"])});this.navAdd(mentionsNav);var selfMenu=new TwitterSelfMenu({settings:this.settings,isDefault:true,closeFunc:this.stop.bind(this)});this.menuAdd(\"self_menu\",selfMenu);var content=new TwitterHomeContent({settings:this.settings,isDefault:true,navId:homeNav.navId});this.contentAdd(\"updates\",content);var mentionsContent=new TwitterMentionsContent({settings:this.settings,navId:mentionsNav.navId});this.contentAdd(\"mentions\",mentionsContent);},showTwitterUser:function(screen_name){if(this.users.has(screen_name)){this.fireEvent(\"viewSwitch\",this.appId,screen_name,screen_name);}else{this.call(\"twitter\",\"twitter_user_show\",{screen_name:screen_name},this.userLoaded.bind(this),null);return;}},showTwitterList:function(list_id){if(this.lists.has(list_id)){this.fireEvent(\"viewSwitch\",this.appId,list_id,list_id);}else{var parts=list_id.split(\"/\");this.call(\"twitter\",\"twitter_list_show\",{screen_name:parts[0],slug:parts[1]},this.listLoaded.bind(this),null);return;}},listLoaded:function(data){if(!$defined(data.list)){return;}data.list.following=false;this.listAdd(data.list);},userLoaded:function(data){this.userAdd(data);},twitterListSubscribed:function(list){list.following=true;if(list.following){if(!$defined(this.listsNav)){this.listsNav=new Nav({iconOptions:{iconName:\"contacts\"},hasSubnavs:true,displayName:\"Lists\",name:\"lists\"});this.navAdd(this.listsNav);}var nav=new Nav({iconOptions:{iconName:list.user.profile_image_url},displayName:list.user.screen_name+\"/\"+list.slug,closable:true,name:list.id,parentName:\"lists\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,list.id,list.id]),onClose:this.listClose.bind(this,[list.id])});this.navAdd(nav);this.lists.set(list.id,nav);this.listSubs.set(list.id,list);}},twitterListUnsubscribed:function(list){if(this.listSubs.has(list.id)){this.lists.get(list.id).destroy();this.navDelete(list.id);this.lists.erase(list.id);this.listSubs.erase(list.id);}},twitterListsLoaded:function(data){data.lists.lists.each(function(list){list.following=true;this.listAdd(list);},this);data.list_subscriptions.lists.each(function(list){list.following=true;this.listAdd(list);},this);},userClose:function(screen_name){if(!this.users.has(screen_name)){return;}this.users.get(screen_name).destroy();this.navDelete(screen_name);this.users.erase(screen_name);this.menuClose(screen_name);this.contentClose(screen_name);if(this.users.getLength()==0){this.navDelete(\"users\");this.usersNav=null;}},userAdd:function(user){if(!$defined(this.usersNav)){this.usersNav=new Nav({iconOptions:{iconName:\"users\"},hasSubnavs:true,displayName:\"Users\",name:\"users\"});this.navAdd(this.usersNav);}var nav=new Nav({iconOptions:{iconName:user.profile_image_url},displayName:user.screen_name,closable:true,name:user.screen_name,parentName:\"users\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,user.screen_name,user.screen_name]),onClose:this.userClose.bind(this,[user.screen_name])});this.navAdd(nav);this.users.set(user.screen_name,nav);var content=new TwitterUserContent({screen_name:user.screen_name,navId:nav.navId});this.contentAdd(user.screen_name,content);var menu=new TwitterUserMenu({user:user,closable:true,closeFunc:this.userClose.bind(this,user.screen_name)});this.menuAdd(user.screen_name,menu);this.fireEvent(\"viewSwitch\",this.appId,user.screen_name,user.screen_name);},twitterShowFollowing:function(screen_name){var content=new TwitterFollowingContent({screen_name:screen_name});this.contentAdd(screen_name+\"_following\",content);if(screen_name==this.settings.screen_name){this.fireEvent(\"viewSwitch\",this.appId,screen_name+\"_following\",\"self_menu\");}else{this.fireEvent(\"viewSwitch\",this.appId,screen_name+\"_following\",screen_name);}},twitterShowFollowers:function(screen_name){var content=new TwitterFollowersContent({screen_name:screen_name});this.contentAdd(screen_name+\"_followers\",content);if(screen_name==this.settings.screen_name){this.fireEvent(\"viewSwitch\",this.appId,screen_name+\"_followers\",\"self_menu\");}else{this.fireEvent(\"viewSwitch\",this.appId,screen_name+\"_followers\",screen_name);}},listAdd:function(list){if(list.following){if(!$defined(this.listsNav)){this.listsNav=new Nav({iconOptions:{iconName:\"contacts\"},hasSubnavs:true,displayName:\"Lists\",name:\"lists\"});this.navAdd(this.listsNav);}var nav=new Nav({iconOptions:{iconName:list.user.profile_image_url},displayName:list.user.screen_name+\"/\"+list.slug,closable:true,name:list.id,parentName:\"lists\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,list.id,list.id]),onClose:this.listClose.bind(this,[list.id])});this.navAdd(nav);this.lists.set(list.id,nav);this.listSubs.set(list.id,list);}var content=new TwitterListContent({list:list,navId:nav.navId});this.contentAdd(list.id,content);var menu=new TwitterListMenu({list:list,closable:true,closeFunc:this.listClose.bind(this,list.id)});this.menuAdd(list.id,menu);if(!list.following){this.fireEvent(\"viewSwitch\",this.appId,list.id,list.id);}},listClose:function(list_id){if(!this.listSubs.has(list_id)){this.menuClose(list_id);this.contentClose(list_id);}else{this.switchDefault();}},showTwitterSearchPopup:function(){if($defined(this.twitterSearchPopup)){this.twitterSearchPopup.close();}this.createTwitterSearchPopup();},createTwitterSearchPopup:function(){this.twitterSearchPopup=new Popup({size:{x:350,y:74},resizable:false,dockable:false,className:\"twitterSearch\",onClose:this.destroyTwitterSearchPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:\"twitter\"},displayName:\"Search Twitter\",closable:true});var content=new TwitterSearchPopupContent({});this.twitterSearchPopup.addContent(\"twitter_search\",nav,content);},destroyTwitterSearchPopup:function(){this.twitterSearchPopup=null;}});var TwitterFollowersContent=new Class({Extends:Content,EventHandlers:[\"twitterFollow\",\"twitterUnfollow\",\"twitterBlock\"],onBeforeInit:function(options){this.screen_name=options.screen_name;},onInit:function(){this.loader=new ItemLoader({idField:\"id\",sortField:\"name\",createElementFunc:TwitterFollowsItemUtility.createTwitterFollowItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":this.screen_name+\" has no followers\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":this.screen_name+\"'s followers loading...\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){var params={\"username\":this.screen_name,\"page\":-1};this.call(\"twitter\",\"twitter_followers\",params,this.twitterFollowersSuccess.bind(this),null);this.loader.showLoading();}},onHide:function(){},twitterFollowersSuccess:function(data){this.loader.hideLoading();if(!$defined(data.users)||data.users.length==0){return;}this.nextCursor=data.next_cursor;data.users.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){var params={\"username\":this.screen_name,\"page\":this.nextCursor};this.call(\"twitter\",\"twitter_followers\",params,this.twitterFollowersSuccess.bind(this),null);},twitterFollow:function(screen_name){var params={screen_name:screen_name};this.call(\"twitter\",\"twitter_follow\",params,this.twitterFollowSuccess.bind(this),null);},twitterFollowSuccess:function(data){if(!$defined(data)){return;}},twitterUnfollow:function(screen_name){var params={screen_name:screen_name};this.call(\"twitter\",\"twitter_unfollow\",params,this.twitterUnfollowSuccess.bind(this),null);},twitterUnfollowSuccess:function(data){if(!$defined(data)){return;}this.loader.remove(data.id);},twitterBlock:function(screen_name){var answer=confirm(\"Blocking will prevent this user from following you. And you won't see their tweets in your timeline. Are you sure you want to block?\");if(!answer){return;}var params={screen_name:screen_name};this.call(\"twitter\",\"twitter_block\",params,this.twitterBlockSuccess.bind(this),null);},twitterBlockSuccess:function(data){if(!$defined(data)){return;}this.loader.remove(data.id);}});var TwitterFollowingContent=new Class({Extends:Content,EventHandlers:[\"twitterFollow\",\"twitterUnfollow\",\"twitterBlock\"],onBeforeInit:function(options){this.screen_name=options.screen_name;},onInit:function(){this.loader=new ItemLoader({idField:\"id\",sortField:\"name\",createElementFunc:TwitterFollowsItemUtility.createTwitterFollowItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":this.screen_name+\" has no friends\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":this.screen_name+\"'s friends loading...\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){var params={\"username\":this.screen_name,\"page\":-1};this.call(\"twitter\",\"twitter_friends\",params,this.twitterFollowingSuccess.bind(this),null);this.loader.showLoading();}},onHide:function(){},twitterFollowingSuccess:function(data){this.loader.hideLoading();if(!$defined(data.users)||data.users.length==0){return;}this.nextCursor=data.next_cursor;data.users.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){var params={\"username\":this.screen_name,\"page\":this.nextCursor};this.call(\"twitter\",\"twitter_friends\",params,this.twitterFollowingSuccess.bind(this),null);},twitterUnfollow:function(screen_name){var params={screen_name:screen_name};this.call(\"twitter\",\"twitter_unfollow\",params,this.twitterUnfollowSuccess.bind(this),null);},twitterUnfollowSuccess:function(data){if(!$defined(data)){return;}this.loader.remove(data.id);},twitterBlock:function(screen_name){var answer=confirm(\"Blocking will prevent this user from following you. And you won't see their tweets in your timeline. Are you sure you want to block?\");if(!answer){return;}var params={screen_name:screen_name};this.call(\"twitter\",\"twitter_block\",params,this.twitterBlockSuccess.bind(this),null);},twitterBlockSuccess:function(data){if(!$defined(data)){return;}this.loader.remove(data.id);}});var TwitterHomeContent=new Class({Extends:Content,EventHandlers:[\"twitterUserLoaded\",\"twitterHomeReload\"],onBeforeInit:function(options){this.settings=options.settings;this.navId=options.navId;this.sessionTimestamp=(new Date().getTime())/1000;this.screen_name=options.settings.screen_name;return options;},onInit:function(){this.slowTimerDuration=60*1000*3;this.fastTimerDuration=60*1000*1;this.loader=new StreamLoader({idField:\"id\",dateField:\"created_at\",createElementFunc:TwitterItemUtility.createTwitterItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"You have no updates\"}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},alertCheck:function(item){var ts=Date.parse(item.created_at)/1000;if(ts>this.sessionTimestamp){this.fireEvent(\"alertAdd\",this.navId);}},onShow:function(first){if(first){this.loadMore();}this.updatePoll();},onHide:function(){this.updatePoll();},onDestroy:function(){$clear(this.pollTimer);},twitterHomeReload:function(){this.loadNew();},twitterUserLoaded:function(user){if($defined(this.statusBox)){return;}this.statusBox=new TwitterStatusBox(user,true);$(this.statusBox).inject(this.content,\"top\");},updatePoll:function(){if($defined(this.pollTimer)){$clear(this.pollTimer);}if(this.isOn){this.pollTimer=this.loadNew.periodical(this.fastTimerDuration,this);Logger().log(\"home on fast timer\");}else{this.pollTimer=this.loadNew.periodical(this.slowTimerDuration,this);Logger().log(\"home on slow timer\");}},loadNew:function(){var params={since_id:this.loader.newestId};this.call(\"twitter\",\"twitter_home_timeline\",params,this.loadNewSuccess.bind(this),this.loadMoreFail.bind(this));},loadMore:function(){var params={since_id:\"\"};if(this.loader.oldestId!=0){params.max_id=this.loader.oldestId;}this.call(\"twitter\",\"twitter_home_timeline\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));},loadNewSuccess:function(data){if(!$defined(data.items)||data.items.length==0){return;}data.items.each(function(item){this.loader.process(item);},this);},loadMoreSuccess:function(data){if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.reverse().each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){},bottomFunc:function(){this.loadMore();}});var TwitterListContent=new Class({Extends:Content,EventHandlers:[],onBeforeInit:function(options){this.list=options.list;this.navId=options.navId;this.sessionTimestamp=(new Date().getTime())/1000;return options;},onInit:function(){this.slowTimerDuration=60*1000*5;this.fastTimerDuration=60*1000*2;this.loader=new StreamLoader({idField:\"id\",dateField:\"created_at\",createElementFunc:TwitterItemUtility.createTwitterItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"This list has no updates\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Updates loading...\"}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},alertCheck:function(item){var ts=Date.parse(item.created_at)/1000;if(ts>this.sessionTimestamp){this.fireEvent(\"alertAdd\",this.navId);}},onShow:function(first){if(first){this.loadMore();}this.updatePoll();},onHide:function(){this.updatePoll();},onDestroy:function(){$clear(this.pollTimer);},updatePoll:function(){if($defined(this.pollTimer)){$clear(this.pollTimer);}if(this.isOn){this.pollTimer=this.loadNew.periodical(this.fastTimerDuration,this);}else{this.pollTimer=this.loadNew.periodical(this.slowTimerDuration,this);}},loadNew:function(){var params={screen_name:this.list.user.screen_name,list_id:this.list.id,since_id:this.loader.newestId};this.call(\"twitter\",\"twitter_lists_timeline\",params,this.loadNewSuccess.bind(this),this.loadMoreFail.bind(this));},loadMore:function(){var params={screen_name:this.list.user.screen_name,list_id:this.list.id,since_id:\"\"};if(this.loader.oldestId!=0){params.max_id=this.loader.oldestId;}this.call(\"twitter\",\"twitter_lists_timeline\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadNewSuccess:function(data){if(!$defined(data.items)||data.items.length==0){return;}data.items.reverse().each(function(item){this.loader.process(item);},this);},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();},bottomFunc:function(){this.loadMore();}});var TwitterMentionsContent=new Class({Extends:Content,EventHandlers:[],onBeforeInit:function(options){this.settings=options.settings;this.navId=options.navId;this.screen_name=options.screen_name;this.sessionTimestamp=(new Date().getTime())/1000;return options;},onInit:function(){this.slowTimerDuration=60*1000*5;this.fastTimerDuration=60*1000*2;this.loader=new StreamLoader({idField:\"id\",dateField:\"created_at\",createElementFunc:TwitterItemUtility.createTwitterItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"You have no mentions\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Mentions loading...\"}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},alertCheck:function(item){var ts=Date.parse(item.created_at)/1000;if(ts>this.sessionTimestamp){this.fireEvent(\"alertAdd\",this.navId);}},onShow:function(first){if(first){this.loadMore();}this.updatePoll();},onHide:function(){this.updatePoll();},onDestroy:function(){$clear(this.pollTimer);},updatePoll:function(){if($defined(this.pollTimer)){$clear(this.pollTimer);}if(this.isOn){this.pollTimer=this.loadNew.periodical(this.fastTimerDuration,this);}else{this.pollTimer=this.loadNew.periodical(this.slowTimerDuration,this);}},loadNew:function(){var params={since_id:this.loader.newestId};this.call(\"twitter\",\"twitter_mentions\",params,this.loadNewSuccess.bind(this),this.loadMoreFail.bind(this));},loadMore:function(){var params={since_id:\"\"};if(this.loader.oldestId!=0){params.max_id=this.loader.oldestId;}this.call(\"twitter\",\"twitter_mentions\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadNewSuccess:function(data){if(!$defined(data.items)||data.items.length==0){return;}data.items.each(function(item){this.loader.process(item);},this);},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.reverse().each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();},bottomFunc:function(){this.loadMore();}});var TwitterSearchContent=new Class({Extends:Content,EventHandlers:[],onBeforeInit:function(options){this.search=options.search;this.navId=options.navId;this.sessionTimestamp=(new Date().getTime())/1000;return options;},onInit:function(){this.slowTimerDuration=60*1000*2;this.fastTimerDuration=30*1000;this.loader=new StreamLoader({idField:\"id\",dateField:\"created_at\",createElementFunc:TwitterItemUtility.createTwitterSearchItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"No search results\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"Search results loading...\"}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);this.page=1;},alertCheck:function(item){var ts=Date.parse(item.created_at)/1000;if(ts>this.sessionTimestamp){this.fireEvent(\"alertAdd\",this.navId);}},onShow:function(first){if(first){this.loadMore();}this.updatePoll();},onHide:function(){this.updatePoll();},onDestroy:function(){$clear(this.pollTimer);},updatePoll:function(){if($defined(this.pollTimer)){$clear(this.pollTimer);}if(this.isOn){this.pollTimer=this.loadNew.periodical(this.fastTimerDuration,this);}else{this.pollTimer=this.loadNew.periodical(this.slowTimerDuration,this);}},loadNew:function(){var params={since_id:this.loader.newestId,q:this.search.query};this.call(\"twitter\",\"twitter_search\",params,this.loadNewSuccess.bind(this),this.loadMoreFail.bind(this));},loadMore:function(){var params={since_id:\"\",q:this.search.query};if(this.loader.oldestId!=0){params.page=this.page++;}this.call(\"twitter\",\"twitter_search\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadNewSuccess:function(data){if(!$defined(data.items)||data.items.length==0){return;}data.items.reverse().each(function(item){this.loader.process(item);},this);},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();},bottomFunc:function(){this.loadMore();}});var TwitterUserContent=new Class({Extends:Content,EventHandlers:[\"twitterUserLoaded\"],onBeforeInit:function(options){this.navId=options.navId;this.screen_name=options.screen_name;this.sessionTimestamp=(new Date().getTime())/1000;},onInit:function(){this.slowTimerDuration=60*1000*5;this.fastTimerDuration=60*1000*2;this.loader=new StreamLoader({idField:\"id\",dateField:\"created_at\",createElementFunc:TwitterItemUtility.createTwitterItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":TextUtility.unescape(this.screen_name)+\" has no updates\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":TextUtility.unescape(this.screen_name)+\"'s updates loading...\"}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},alertCheck:function(item){var ts=Date.parse(item.created_at)/1000;if(ts>this.sessionTimestamp){this.fireEvent(\"alertAdd\",this.navId);}},onShow:function(first){if(first){this.loadMore();}this.updatePoll();},onHide:function(){this.updatePoll();},onDestroy:function(){$clear(this.pollTimer);},twitterUserLoaded:function(user){if($defined(this.statusBox)){return;}this.statusBox=new TwitterStatusBox(user,false);$(this.statusBox).inject(this.content,\"top\");},updatePoll:function(){if($defined(this.pollTimer)){$clear(this.pollTimer);}if(this.isOn){this.pollTimer=this.loadNew.periodical(this.fastTimerDuration,this);}else{this.pollTimer=this.loadNew.periodical(this.slowTimerDuration,this);}},loadNew:function(){var params={username:this.screen_name,since_id:this.loader.newestId};this.call(\"twitter\",\"twitter_user_timeline\",params,this.loadNewSuccess.bind(this),this.loadMoreFail.bind(this));},loadMore:function(){var params={username:this.screen_name,since_id:\"\"};if(this.loader.oldestId!=0){params.max_id=this.loader.oldestId;}this.call(\"twitter\",\"twitter_user_timeline\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadNewSuccess:function(data){if(!$defined(data.items)||data.items.length==0){return;}data.items.each(function(item){this.loader.process(item);},this);},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.reverse().each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();},bottomFunc:function(){this.loadMore();}});var TwitterListMenu=new Class({Extends:Menu,EventHandlers:[],onBeforeInit:function(options){this.list=options.list;options.displayName=this.list.user.screen_name+\"/\"+this.list.slug;options.className=\"twitter\";return options;},onInit:function(){this.userShowSuccess(this.list.user);},userShowSuccess:function(data){if(!$defined(data)){return;}this.profile=new Element(\"div\",{\"class\":\"user_profile\"}).inject(this.menu);ItemUtility.createItemPic(data.profile_image_url).inject(this.profile);new Element(\"div\",{\"class\":\"screen_name text12 light\",\"text\":data.screen_name}).inject(this.profile);new Element(\"div\",{\"class\":\"tweets text11 light2\",\"text\":data.statuses_count+\" tweets\"}).inject(this.profile);new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Name: \"}),new Element(\"span\",{\"text\":TextUtility.unescape(data.name)})).inject(this.menu);if($defined(data.location)&&data.location!=\"\"){new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Location: \"}),new Element(\"span\",{\"text\":TextUtility.unescape(data.location)})).inject(this.menu);}if($defined(data.url)&&data.url!=\"\"){new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Web: \"}),new Element(\"a\",{\"target\":\"_blank\",\"href\":data.url,\"text\":data.url})).inject(this.menu);}if($defined(data.description)&&data.description!=\"\"){new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Bio: \"}),new Element(\"span\",{\"text\":TextUtility.unescape(data.description)})).inject(this.menu);}new Element(\"div\",{\"class\":\"nav_seperator\"}).inject(this.menu);this.follow=new Toggle(this.list.following);$(this.follow).addEvent(\"click\",this.followToggle.bind(this));new Element(\"div\",{\"class\":\"toggle_section\"}).adopt(new Element(\"div\",{\"class\":\"text light\",\"text\":\"Following list:\"}),$(this.follow)).inject(this.menu);},followToggle:function(){if(this.follow.isOn){this.call(\"twitter\",\"twitter_lists_subscribe\",{screen_name:this.list.user.screen_name,list_id:this.list.id},this.subscribeSuccess.bind(this));}else{this.call(\"twitter\",\"twitter_lists_unsubscribe\",{screen_name:this.list.user.screen_name,list_id:this.list.id},this.unsubscribeSuccess.bind(this));}},subscribeSuccess:function(data){if(!$defined(data.list)){return;}this.fireEvent(\"twitterListSubscribed\",this.list);},unsubscribeSuccess:function(data){if(!$defined(data.list)){return;}this.fireEvent(\"twitterListUnsubscribed\",this.list);}});var TwitterSearchMenu=new Class({Extends:Menu,EventHandlers:[\"twitterSavedSearchAdd\",\"twitterSavedSearchDelete\"],onBeforeInit:function(options){this.search=options.search;this.searches=options.searches;options.displayName=this.search.query;options.className=\"twitter\";return options;},onInit:function(){new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Query: \"}),new Element(\"span\",{\"text\":TextUtility.unescape(this.search.query)})).inject(this.menu);new Element(\"div\",{\"class\":\"nav_seperator\"}).inject(this.menu);this.saved=new Toggle(this.search.id!=0);$(this.saved).addEvent(\"click\",this.saveToggle.bind(this));new Element(\"div\",{\"class\":\"toggle_section\"}).adopt(new Element(\"div\",{\"class\":\"text light\",\"text\":\"Save Search:\"}),$(this.saved)).inject(this.menu);this.searchButton=new ButtonMedium({displayName:\"Search Twitter\",className:\"dark\",action:\"search\"});$(this.searchButton).addEvent(\"click\",this.fireEvent.bind(this,[\"showTwitterSearchPopup\"]));this.searchSection=new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.searchButton)).inject(this.menu);this.savedSearchesNav=new TwitterSavedSearchesNav({});$(this.savedSearchesNav).inject(this.menu);this.searches.each(function(search){this.twitterSavedSearchAdd(search);},this);},twitterSavedSearchAdd:function(search){this.savedSearchesNav.savedSearchAdd(search);},twitterSavedSearchDelete:function(id){this.savedSearchesNav.savedSearchDelete(id);},saveToggle:function(){if(this.saved.isOn){this.searchSave();}else{this.searchDelete();}},searchSave:function(){this.call(\"twitter\",\"twitter_searches_create\",{query:this.search.query},this.searchSaveSuccess.bind(this));},searchSaveSuccess:function(data){if(!$defined(data.id)){return;}var search={query:data.query,id:data.id};this.search.id=data.id;this.fireEvent(\"twitterSavedSearchAdd\",search);},searchDelete:function(){this.call(\"twitter\",\"twitter_searches_delete\",{id:this.search.id},this.searchDeleteSuccess.bind(this));},searchDeleteSuccess:function(data){if(!$defined(data.id)){return;}this.search.id=0;this.fireEvent(\"twitterSavedSearchDelete\",data.id);}});var TwitterSelfMenu=new Class({Extends:Menu,EventHandlers:[\"twitterSavedSearchAdd\",\"twitterSavedSearchDelete\"],onBeforeInit:function(options){this.settings=options.settings;this.screen_name=this.settings.screen_name;this.sync_posts=this.settings.sync_posts;options.displayName=this.settings.screen_name;options.className=\"twitter\";return options;},onInit:function(){this.call(\"twitter\",\"twitter_self_show\",{screen_name:this.settings.screen_name},this.userShowSuccess.bind(this),null);},userShowSuccess:function(data){if(!$defined(data.user)){return;}var user=data.user;this.profile=new Element(\"div\",{\"class\":\"user_profile\"}).inject(this.menu);ItemUtility.createItemPic(user.profile_image_url).inject(this.profile);new Element(\"div\",{\"class\":\"screen_name text12 light\",\"text\":user.screen_name}).inject(this.profile);new Element(\"div\",{\"class\":\"tweets text11 light2\",\"text\":user.statuses_count+\" tweets\"}).inject(this.profile);new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Name: \"}),new Element(\"span\",{\"text\":TextUtility.unescape(user.name)})).inject(this.menu);if($defined(user.location)&&user.location!=\"\"){new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Location: \"}),new Element(\"span\",{\"text\":TextUtility.unescape(user.location)})).inject(this.menu);}if($defined(user.url)&&user.url!=\"\"){new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Web: \"}),new Element(\"a\",{\"target\":\"_blank\",\"href\":user.url,\"text\":user.url})).inject(this.menu);}if($defined(user.description)&&user.description!=\"\"){new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Bio: \"}),new Element(\"span\",{\"text\":TextUtility.unescape(user.description)})).inject(this.menu);}var followers=new Element(\"span\",{\"class\":\"clickable\",\"text\":user.followers_count});followers.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterShowFollowers\",user.screen_name]));new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Followers: \"}),followers).inject(this.menu);var following=new Element(\"span\",{\"class\":\"clickable\",\"text\":user.friends_count});following.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterShowFollowing\",user.screen_name]));new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Following: \"}),following).inject(this.menu);new Element(\"div\",{\"class\":\"nav_seperator\"}).inject(this.menu);this.syncPosts=new Toggle(this.sync_posts==1);$(this.syncPosts).addEvent(\"click\",this.syncToggle.bind(this));new Element(\"div\",{\"class\":\"toggle_section\"}).adopt(new Element(\"div\",{\"class\":\"text light\",\"text\":\"Sync Posts:\"}),$(this.syncPosts)).inject(this.menu);this.searchButton=new ButtonMedium({displayName:\"Search Twitter\",className:\"dark\",action:\"search\"});$(this.searchButton).addEvent(\"click\",this.fireEvent.bind(this,[\"showTwitterSearchPopup\"]));this.searchSection=new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.searchButton)).inject(this.menu);this.savedSearchesNav=new TwitterSavedSearchesNav({});$(this.savedSearchesNav).inject(this.menu);this.fireEvent(\"twitterUserLoaded\",data.user);this.fireEvent(\"twitterListsLoaded\",data);this.fireEvent(\"twitterSavedSearchesLoaded\",data.saved_searches);data.saved_searches.each(function(search){this.twitterSavedSearchAdd(search);},this);},syncToggle:function(){var params={key:\"sync_posts\",value:this.syncPosts.toInt()};this.call(\"twitter\",\"twitter_settings_update\",params);},twitterSavedSearchAdd:function(search){this.savedSearchesNav.savedSearchAdd(search);},twitterSavedSearchDelete:function(id){this.savedSearchesNav.savedSearchDelete(id);}});var TwitterUserMenu=new Class({Extends:Menu,EventHandlers:[],onBeforeInit:function(options){this.user=options.user;options.displayName=this.user.screen_name;options.className=\"twitter\";return options;},onInit:function(){this.userShowSuccess(this.user);},userShowSuccess:function(data){if(!$defined(data)){return;}this.fireEvent(\"twitterUserLoaded\",data);this.profile=new Element(\"div\",{\"class\":\"user_profile\"}).inject(this.menu);ItemUtility.createItemPic(data.profile_image_url).inject(this.profile);new Element(\"div\",{\"class\":\"screen_name text12 light\",\"text\":data.screen_name}).inject(this.profile);new Element(\"div\",{\"class\":\"tweets text11 light2\",\"text\":data.statuses_count+\" tweets\"}).inject(this.profile);new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Name: \"}),new Element(\"span\",{\"text\":TextUtility.unescape(data.name)})).inject(this.menu);if($defined(data.location)&&data.location!=\"\"){new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Location: \"}),new Element(\"span\",{\"text\":TextUtility.unescape(data.location)})).inject(this.menu);}if($defined(data.url)&&data.url!=\"\"){new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Web: \"}),new Element(\"a\",{\"target\":\"_blank\",\"href\":data.url,\"text\":data.url})).inject(this.menu);}if($defined(data.description)&&data.description!=\"\"){new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Bio: \"}),new Element(\"span\",{\"text\":TextUtility.unescape(data.description)})).inject(this.menu);}var followers=new Element(\"span\",{\"class\":\"clickable\",\"text\":data.followers_count});followers.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterShowFollowers\",data.screen_name]));new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Followers: \"}),followers).inject(this.menu);var following=new Element(\"span\",{\"class\":\"clickable\",\"text\":data.friends_count});following.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterShowFollowing\",data.screen_name]));new Element(\"div\",{\"class\":\"text_section light1 text11\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Following: \"}),following).inject(this.menu);new Element(\"div\",{\"class\":\"nav_seperator\"}).inject(this.menu);this.follow=new Toggle(data.following);$(this.follow).addEvent(\"click\",this.followToggle.bind(this));new Element(\"div\",{\"class\":\"toggle_section\"}).adopt(new Element(\"div\",{\"class\":\"text light\",\"text\":\"Following:\"}),$(this.follow)).inject(this.menu);},followToggle:function(){if(this.follow.isOn){this.call(\"twitter\",\"twitter_follow\",{screen_name:this.user.screen_name});}else{this.call(\"twitter\",\"twitter_unfollow\",{screen_name:this.user.screen_name});}}});var TwitterSavedSearchesNav=new Class({Extends:Nav,onBeforeInit:function(options){options.name=\"savedSearches\";options.hasSubnavs=true;options.iconOptions={iconName:\"search\"};options.displayName=\"Saved Searches\";return options;},onInit:function(){this.savedSearches=$H();this.updateNav();},savedSearchAdd:function(search){if(this.hasSubnav(search.query)){return;}var nav=new Nav({displayName:search.query,name:search.id,parentName:\"savedSearches\",onClick:this.fireEvent.bind(this,[\"twitterSearch\",search.query,search.id])});this.addSubnav(nav);this.savedSearches.set(search.id,search);this.updateNav();},savedSearchDelete:function(id){this.deleteSubnav(id);this.savedSearches.erase(id);this.updateNav();},updateNav:function(){if(this.savedSearches.getLength()==0){DomUtility.hide(this.navWrapper);}else{DomUtility.show(this.navWrapper);}}});var TwitterInstallPopupContent=new Class({Extends:PopupContent,EventHandlers:[\"twitterOauthAccess\"],strings:{postSyncLabel:\"Sync posts to Twitter:\",errorMessage:\"There was an error connecting to Twitter\"},onInit:function(){this.appId=5;this.syncPostsToggle=new Toggle(true);new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"label light\",\"text\":this.strings.postSyncLabel}),$(this.syncPostsToggle)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Install Twitter\",className:\"dark\",action:\"check\"});this.message=new Element(\"div\",{\"class\":\"message error\"});this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);this.authRequest();},authRequest:function(){this.call(\"twitter\",\"twitter_auth_request\",null,this.authRequestSuccess.bind(this));},authRequestSuccess:function(data){if(!$defined(data.authorize_url)){return;}new Element(\"a\",{\"href\":data.authorize_url,\"target\":\"_blank\"}).wraps(this.actionButton);},twitterOauthAccess:function(data){if(data.oauth!=\"success\"){return;}var params={sync_posts:this.syncPostsToggle.toInt()};this.call(\"twitter\",\"twitter_install\",params,this.twitterInstallSuccess.bind(this));},twitterInstallSuccess:function(){this.closeContent();}});var TwitterRetweetPopupContent=new Class({Extends:PopupContent,strings:{},EventHandlers:[],onBeforeInit:function(options){this.post_id=options.post_id;return options;},onInit:function(){this.searchInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"50\"});this.searchInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));this.searchInputSection=new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.searchInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Search\",className:\"dark\",action:\"search\"});$(this.actionButton).addEvent(\"click\",this.search.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.searchInput.value.trim()!=\"\"){this.search();}}},search:function(){var query=this.searchInput.value.trim();if(query!=\"\"){this.fireEvent(\"twitterSearch\",query);}this.closeContent();},onShow:function(){this.focus();},focus:function(){this.searchInput.focus.delay(500,this.searchInput);}});var TwitterSearchPopupContent=new Class({Extends:PopupContent,strings:{},EventHandlers:[],onInit:function(){this.searchInput=new Element(\"input\",{\"type\":\"text\",\"maxlength\":\"50\"});this.searchInput.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));this.searchInputSection=new Element(\"div\",{\"class\":\"input_section\"}).adopt(new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.searchInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:\"Cancel\",className:\"dark\",action:\"cross\"});$(this.closeButton).addEvent(\"click\",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:\"Search\",className:\"dark\",action:\"search\"});$(this.actionButton).addEvent(\"click\",this.search.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key==\"enter\"){if(this.searchInput.value.trim()!=\"\"){this.search();}}},search:function(){var query=this.searchInput.value.trim();if(query!=\"\"){this.fireEvent(\"twitterSearch\",query);}this.closeContent();},onShow:function(){this.focus();},focus:function(){this.searchInput.focus.delay(500,this.searchInput);}});var TwitterShareBox=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"twitterShareBoxShow\"],init:function(){this.shareboxes=$H();},userSwitched:function(){if(!this.isLoggedIn()){this.userLoggedOut();}},userLoggedOut:function(){this.shareboxes.each(function(sharebox,key){sharebox.close();this.shareboxes.erase(key);},this);this.shareboxes=$H();},twitterShareBoxShow:function(user,isSelf,post_id){if($defined(this.sharebox)){this.sharebox.close();}this.createShareBox(user,isSelf,post_id);},createShareBox:function(user,isSelf,post_id){this.sharebox=new Popup({size:{x:500,y:100},resizable:false,dockable:false,className:\"facebook sharebox\",onClose:this.destroyShareBox.bind(this)});var displayName=(isSelf)?\"Tweet\":\"Mention \"+user.screen_name;if($defined(post_id)){displayName=\"Reply to \"+user.screen_name;}var nav=new Nav({iconOptions:{iconName:user.profile_image_url},displayName:displayName,closable:true});var content=new TwitterShareBoxPopupContent({user:user,is_self:isSelf,post_id:post_id});this.sharebox.addContent(\"sharebox\",nav,content);},destroyShareBox:function(name){this.sharebox=null;}});var TwitterShareBoxPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.user=options.user;options.displayName=this.user.screen_name;this.post_id=($defined(options.post_id))?options.post_id:\"\";this.isSelf=options.is_self;return options;},reset:function(){Logger().log(\"resetting\");this.closeAttachmentPopup();this.content.empty();this.onInit();},onInit:function(){this.formEl=null;this.isPublic=true;this.readyToPost=false;if(this.isSelf){this.input=new Element(\"textarea\",{\"maxlength\":140});}else{this.input=new Element(\"textarea\",{\"maxlength\":140,\"value\":\"@\"+this.user.screen_name+\" \"});}this.input.addEvent(\"keyup\",this.inputKeyUp.bindWithEvent(this));new Element(\"div\",{\"class\":\"textarea_wrapper\"}).adopt(this.input).inject(this.content);this.cancelButton=new ButtonMedium({displayName:\"Close\",className:\"dark\",action:\"cross\"});$(this.cancelButton).addEvent(\"click\",this.closeContent.bind(this));this.updateButton=new ButtonMedium({displayName:\"Post\",className:\"dark\",action:\"check\"});$(this.updateButton).addEvent(\"click\",this.post.bind(this));this.actions=new Element(\"div\",{\"class\":\"actions\"}).adopt($(this.updateButton),$(this.cancelButton)).inject(this.content);this.focus();},inputKeyUp:function(e){if(e.shift&&e.key==\"enter\"){e.preventDefault();this.post();}if(DomUtility.textareaAutoSize(e.target,40)){this.updateSize();}},updateSize:function(){h+=this.input.getSize().y+10;h+=this.actions.getSize().y+30;this.resizePopup(500,h);},post:function(){var body=this.input.value.trim();if(body==\"\"&&this.attachment.type==AttachmentType.None){this.fireEvent(\"showAlert\",\"empty_post\",\"Problem Posting\",\"Please enter some content to post.\");return;}var params={\"body\":body,\"post_id\":this.post_id};this.call(\"twitter\",\"twitter_post_text\",params,this.postSuccess.bind(this),this.postFail.bind(this),this.formEl);this.updateButton.showProgress();},postSuccess:function(){this.updateButton.hideProgress();this.fireEvent(\"twitterHomeReload\");this.closeContent();},postFail:function(){this.updateButton.hideProgress();},onShow:function(){this.focus();},focus:function(){this.input.focus.delay(500,this.input);}});var TwitterStatusBox=new Class({Extends:Base,EventHandlers:[],init:function(user,isSelf){this.user=user;this.user.status.can_delete=1;this.isSelf=isSelf;this.defaultStatus=\"has no current status\";this.createStatusBox();},createStatusBox:function(){this.box=ItemUtility.createPostBubble(\"post status_message haspic\");ItemUtility.createItemPic(this.user.profile_image_url).inject(this.box);var buttonText=this.isSelf?\"Tweet\":\"Mention \"+this.user.screen_name;this.writeButton=new Element(\"div\",{\"class\":\"button\",\"text\":TextUtility.unescape(buttonText)}).inject(this.box);this.writeButton.addEvent(\"click\",this.fireEvent.bind(this,[\"twitterShareBoxShow\",this.user,this.isSelf]));this.content=new Element(\"div\",{\"class\":\"post_content\"}).inject(this.box);var header=new Element(\"div\",{\"class\":\"header\"}).inject(this.content);var creator=new Element(\"span\",{\"class\":\"user_name\",\"text\":TextUtility.unescapeQuotes(this.user.name)}).inject(header);this.status=new Element(\"span\",{\"class\":\"status\"}).inject(header);TwitterItemUtility.createTwitterItemFooter(this.user.status).inject(this.content);this.updateStatus();},updateStatus:function(){if($defined(this.user.status.text)&&this.user.status.text!=\"\"){this.status.removeClass(\"empty\");this.status.set(\"html\",\" \"+TwitterItemUtility.parseTwitterUsernames(TwitterItemUtility.parseTwitterLists(TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescapeQuotes(this.user.status.text))))));}else{this.status.addClass(\"empty\");this.status.set(\"text\",\" \"+TextUtility.unescape(this.defaultStatus));}},toElement:function(){return this.box;}});var TwitterFollowsItemUtility={createTwitterFollowItem:function(user){var el=ItemUtility.createPostBubble(\"post contact\",true);new Element(\"img\",{\"class\":\"profile_pic_wrapper_60 afb_profile_pic\",\"src\":user.profile_image_url}).inject(el);var username=new Element(\"div\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescape(user.screen_name)});new Element(\"div\",{\"class\":\"heading\"}).adopt(username).inject(el);username.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showTwitterUser\",user.screen_name]));var viewButton=new ButtonMedium({displayName:\"View \"+user.screen_name,action:\"goto dark\"});$(viewButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showTwitterUser\",user.screen_name]));if(user.following){var unfollowButton=new ButtonMedium({displayName:\"Unfollow \"+user.screen_name,action:\"cross\"});$(unfollowButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterUnfollow\",user.screen_name]));}var blockButton=new ButtonMedium({displayName:\"Block \"+user.screen_name,action:\"goto dark\"});$(blockButton).addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterBlock\",user.screen_name]));var buttons=new Element(\"div\",{\"class\":\"actions\"}).adopt($(viewButton),$(blockButton)).inject(el);if($defined(unfollowButton)){buttons.adopt($(unfollowButton));}return el;}};var TwitterItemUtility={createTwitterSearchItem:function(item){var el=ItemUtility.createPostBubble(\"post haspic\");ItemUtility.createItemPic(item.profile_image_url).inject(el);var content=new Element(\"div\",{\"class\":\"post_content\"}).inject(el);TwitterItemUtility.createTwitterSearchItemHeader(item).inject(content);TwitterItemUtility.createTwitterSearchItemFooter(item).inject(content);TwitterItemUtility.createTwitterItemPostActions(item).inject(el);return el;},createTwitterSearchItemHeader:function(item){var el=new Element(\"div\",{\"class\":\"header\"});TwitterItemUtility.createSearchUsernameElement(item.from_user).inject(el);var body=new Element(\"span\",{\"html\":\" \"+TwitterItemUtility.parseTwitterUsernames(TwitterItemUtility.parseTwitterLists(TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescapeQuotes(item.text)))))}).inject(el);return el;},createSearchUsernameElement:function(screen_name){var el=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescapeQuotes(screen_name)});el.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showTwitterUser\",screen_name]));return el;},createTwitterSearchItemFooter:function(item){var el=new Element(\"div\",{\"class\":\"footer\"});var date=DateUtility.convertFromTimestamp(Date.parse(item.created_at)/1000);var ts=new Element(\"span\",{\"class\":\"timestamp\",\"text\":DateUtility.getTimestamp(date,\"%B %D at %I:%M%p\"),\"ts\":date,\"ts_format\":\"%B %D at %I:%M%p\"}).inject(el);el.appendText(\" from \");new Element(\"span\",{\"html\":TwitterItemUtility.parseTwitterSource(TextUtility.unescapeHtml(item.source))}).inject(el);if($defined(item.to_user)){el.appendText(\" in reply to \");var userEl=new Element(\"span\",{\"text\":item.to_user});new Element(\"span\").adopt(userEl).inject(el);userEl.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showTwitterUser\",item.to_user]));}var reply=TwitterItemUtility.createFooterAction(\"reply\",\"Reply\",true).inject(el);var user={screen_name:item.from_user,profile_image_url:item.profile_image_url};reply.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterShareBoxShow\",user,false,item.id]));var retweet=TwitterItemUtility.createFooterAction(\"forward\",\"Retweet\",true).inject(el);retweet.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterRetweet\",item.id]));return el;},deleteTwitterItem:function(id){$$(\".twitter_item_\"+id).each(function(el){DomUtility.fadeOutDestroy(el);});},createTwitterItem:function(item){var el=ItemUtility.createPostBubble(\"post haspic twitter_item_\"+item.id);ItemUtility.createItemPic(item.user.profile_image_url).inject(el);var content=new Element(\"div\",{\"class\":\"post_content\"}).inject(el);TwitterItemUtility.createTwitterItemHeader(item).inject(content);TwitterItemUtility.createTwitterItemFooter(item).inject(content);TwitterItemUtility.createTwitterItemPostActions(item).inject(el);return el;},createTwitterItemPostActions:function(item){var el=new Element(\"div\",{\"class\":\"post_actions\"});if($defined(item.can_delete)&&item.can_delete==1){var deleteAction=new Element(\"div\",{\"class\":\"post_action delete\"}).inject(el);deleteAction.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterDelete\",item.id]));}return el;},createTwitterItemHeader:function(item){var el=new Element(\"div\",{\"class\":\"header\"});TwitterItemUtility.createUsernameElement(item.user).inject(el);var body=new Element(\"span\",{\"html\":\" \"+TwitterItemUtility.parseTwitterUsernames(TwitterItemUtility.parseTwitterLists(TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescapeQuotes(item.text)))))}).inject(el);return el;},createUsernameElement:function(user){var el=new Element(\"span\",{\"class\":\"user_name clickable\",\"text\":TextUtility.unescapeQuotes(user.screen_name)});el.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"showTwitterUser\",user.screen_name]));return el;},createTwitterItemFooter:function(item){var el=new Element(\"div\",{\"class\":\"footer\"});var date=DateUtility.convertFromTimestamp(Date.parse(item.created_at)/1000);var ts=new Element(\"span\",{\"class\":\"timestamp\",\"text\":DateUtility.getTimestamp(date,\"%B %D at %I:%M%p\"),\"ts\":date,\"ts_format\":\"%B %D at %I:%M%p\"}).inject(el);el.appendText(\" from \");new Element(\"span\",{\"html\":TwitterItemUtility.parseTwitterSource(item.source)}).inject(el);if($defined(item.in_reply_to_status_id)){el.appendText(\" in reply to \");new Element(\"span\").adopt(new Element(\"a\",{\"target\":\"_blank\",\"href\":\"http://twitter.com/\"+item.in_reply_to_screen_name+\"/status/\"+item.in_reply_to_status_id,\"text\":item.in_reply_to_screen_name})).inject(el);}var is_self=$defined(item.can_delete)&&item.can_delete==1;if(!is_self){var reply=TwitterItemUtility.createFooterAction(\"reply\",\"Reply\",true).inject(el);reply.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterShareBoxShow\",item.user,is_self,item.id]));var retweet=TwitterItemUtility.createFooterAction(\"forward\",\"Retweet\",true).inject(el);retweet.addEvent(\"click\",pipio.dispatchEvent.bind(pipio,[\"twitterRetweet\",item.id]));}return el;},createFooterAction:function(actionName,actionText,hide){var el=new Element(\"span\",{\"class\":\"footer_action has_action\"}).adopt(new Element(\"div\",{\"class\":\"action \"+actionName}));el.appendText(actionText);if(hide){el.addClass(\"hide\");}return el;},parseTwitterLists:function(content){if(!$defined(content)){return\"\";}content=content.replace(/([^A-Za-z0-9'>\\/_-])@([A-Za-z0-9_-]+\\/[A-Za-z0-9_-]+)/gi,\"$1<a href=\\\"#\\\" onclick=\\\"pipio.dispatchEvent('showTwitterList', '$2');return false;\\\">@$2</a>\");content=content.replace(/^(@[A-Za-z0-9'>\\/_-]+\\/[A-Za-z0-9_-]+)\\s/gi,\"<a href=\\\"#\\\" onclick=\\\"pipio.dispatchEvent('showTwitterList', '$1');return false;\\\">@$1</a> \");return content;},parseTwitterUsernames:function(content){if(!$defined(content)){return\"\";}content=content.replace(/([^A-Za-z0-9'>\\/_-])@([A-Za-z0-9_-]+)/gi,\"$1<a href=\\\"#\\\" onclick=\\\"pipio.dispatchEvent('showTwitterUser', '$2');return false;\\\">@$2</a>\");content=content.replace(/^@([A-Za-z0-9'>\\/_-]+)\\s/gi,\"<a href=\\\"#\\\" onclick=\\\"pipio.dispatchEvent('showTwitterUser', '$1');return false;\\\">@$1</a> \");return content;},replaceTwitterHashes:function(content){if(!$defined(content)){return\"\";}content=content.replace(/([^A-Za-z0-9'>\\/_-])(#[A-Za-z0-9_-]+)/gi,\"$1<a href=\\\"#\\\" onclick=\\\"pipio.dispatchEvent('twitterSearchShow', '$2');\\\">$2</a>\");content=content.replace(/^(#[A-Za-z0-9'>\\/_-]+)\\s/gi,\"<a href=\\\"#\\\" onclick=\\\"pipio.dispatchEvent('twitterSearchShow', '$1');\\\">$1</a> \");return content;},parseTwitterSource:function(source){if(!$defined(source)){return\"\";}return source.replace(/<a href/g,'<a target=\"_blank\" href');},replaceTwitterSearchSource:function(source){if(!$defined(source)){return\"\";}source=DomUtility.unescapeHtml(source);return source.replace(/<a href/g,'<a target=\"_blank\" href');}};var User=new Class({Extends:AppInstance,EventHandlers:[\"userInfoLoaded\",\"userSwitched\"],parseOptions:function(options){this.user=options.user;this.displayName=this.user.fullname;this.appId=\"user_\"+this.user.username;this.iconOptions={user:this.user};},userSwitched:function(){this.stop();},onStart:function(){this.setupNav();},onStop:function(){}});User.implement({requests:[{name:\"info_load\",params:[\"username\"],url:\"api/user/info/load\"}]});User.implement({setupNav:function(){this.hasRooms=false;Logger().log(\"home setup\");this.navAdd(new Nav({iconOptions:{iconName:\"updates\"},displayName:\"Updates\",name:\"updates\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"updates\",\"user_menu\"])}));this.navAdd(new Nav({iconOptions:{iconName:\"star\"},displayName:\"Favorites\",name:\"likes\",onClick:this.fireEvent.bind(this,[\"viewSwitch\",this.appId,\"likes\",\"likes_menu\"])}));var userMenu=new UserMenu({user:this.user,isDefault:true,closeFunc:this.stop.bind(this)});this.menuAdd(\"user_menu\",userMenu);var content=new UserContent({isDefault:true,user:this.user});this.contentAdd(\"updates\",content);var likesMenu=new LikesMenu({user:this.user});this.menuAdd(\"likes_menu\",likesMenu);var likesContent=new LikesContent({user:this.user});this.contentAdd(\"likes\",likesContent);},roomAdd:function(room){if(!this.hasRooms){this.navAdd(new Nav({iconOptions:{iconName:\"rooms\"},hasSubnavs:true,displayName:\"Rooms\",name:\"rooms\"}));this.hasRooms=true;}var nav=new Nav({iconOptions:{iconName:\"rooms\"},displayName:room.room_name,name:\"room_\"+room.username,parentName:\"rooms\",onClick:this.fireEvent.bind(this,[\"showRoom\",room])});this.navAdd(nav);},userInfoLoaded:function(data){if(!$defined(data.user)||data.user.username!=this.user.username){return;}data.rooms.each(function(room){room=UserUtility.processRoom(room);this.roomAdd(room);},this);}});var UserConnectionMenuSection=new Class({Extends:Base,EventHandlers:[\"contactAdded\",\"contactDeleted\",\"contactRequestAdded\",\"contactRequestDeleted\",\"contactRequestOutAdded\",\"contactRequestOutDeleted\",\"streamSubscriptionAdded\",\"streamSubscriptionDeleted\"],init:function(options){this.user=options.user;this.subscribed=false;this.isSelf=this.user.user_id==this.getPrivateUser().user_id;this.createSection();},createSection:function(){this.wrapper=new Element(\"div\");this.generateSection();},contactAdded:function(user){if(this.user.username!=user.username){return;}this.generateSection();},contactDeleted:function(username){if(this.user.username!=username){return;}this.generateSection();},contactRequestAdded:function(user){if(this.user.username!=user.username){return;}this.generateSection();},contactRequestDeleted:function(username){if(this.user.username!=username){return;}this.generateSection();},contactRequestOutAdded:function(user){if(this.user.username!=user.username){return;}this.generateSection();},contactRequestOutDeleted:function(username){if(this.user.username!=username){return;}this.generateSection();},generateSection:function(){this.wrapper.empty();if(this.isSelf){new Element(\"div\",{\"class\":\"text_section light centered text11\",\"text\":\"This is you\"}).inject(this.wrapper);}else{this.generateSubscriptionSection();var connectionState=this.getConnectionState(this.user.username);switch(connectionState){case 0:this.createNotConnectedSection();break;case 1:this.createConnectedSection();break;case 2:this.createRequestSection();break;case 3:this.createRequestOutSection();break;}}},setSubscription:function(subscribed){this.subscribed=subscribed;this.generateSection();},generateSubscriptionSection:function(){this.subscription=new Toggle(this.subscribed);$(this.subscription).addEvent(\"click\",this.subscriptionToggle.bind(this));new Element(\"div\",{\"class\":\"toggle_section\"}).adopt(new Element(\"div\",{\"class\":\"text light\",\"text\":\"Subscribe:\"}),$(this.subscription)).inject(this.wrapper);},subscriptionToggle:function(){if(this.subscribed){this.streamUnsubscribe();}else{this.streamSubscribe();}},streamUnsubscribe:function(){this.subscription.off();this.fireEvent(\"userUnsubscribe\",this.user.username);},streamSubscribe:function(){this.subscription.on();this.call(\"contacts\",\"user_subscribe\",{username:this.user.username},null,this.streamSubscribeFail.bind(this));},streamSubscribeFail:function(status){if(status.code==2002){this.subscription.off();var name=\"subscription\";var title=\"Error\";var message=status.message;this.fireEvent(\"showAlert\",name,title,message);}},streamSubscriptionAdded:function(data){if(!$defined(data.user)||data.user.username!=this.user.username){return;}this.subscribed=true;this.generateSection();},streamSubscriptionDeleted:function(data){if(!$defined(data.username)||data.username!=this.user.username){return;}this.subscribed=false;this.generateSection();},createNotConnectedSection:function(){this.connectButton=new ButtonMedium({displayName:\"Add Contact\",className:\"dark\",action:\"check\"});$(this.connectButton).addEvent(\"click\",this.sendContactRequest.bind(this));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(this.connectButton)).inject(this.wrapper);},createConnectedSection:function(){new Element(\"div\",{\"class\":\"text_section light centered text11\",\"text\":TextUtility.unescape(this.user.first_name)+\" is your contact\"}).inject(this.wrapper);},createRequestOutSection:function(){new Element(\"div\",{\"class\":\"text_section light centered text11\",\"text\":\"Contact request pending\"}).inject(this.wrapper);},createRequestSection:function(){var button=new ButtonMedium({displayName:\"Accept Request\",className:\"dark\",action:\"check\"});$(button).addEvent(\"click\",this.fireEvent.bind(this,[\"connectionRequestAccept\",this.user.username]));new Element(\"div\",{\"class\":\"button_section\"}).adopt($(button)).inject(this.wrapper);},toElement:function(){return this.wrapper;},sendContactRequest:function(){this.fireEvent(\"connectionRequestCreate\",this.user.username);this.connectButton.showProgress();}});var UserContent=new Class({Extends:Content,EventHandlers:[\"streamItemReceived\",\"userStreamItemDeleted\"],onBeforeInit:function(options){this.user=options.user;},onInit:function(){this.statusBox=new StatusBox(this.user);$(this.statusBox).inject(this.content);this.loader=new StreamLoader({createElementFunc:StreamItemUtility.createUserStreamItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":TextUtility.unescape(this.user.fullname)+\" has no updates\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":TextUtility.unescape(this.user.fullname)+\"'s updates loading...\"}),errorEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":TextUtility.unescape(this.user.fullname)+\"'s stream is private\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},streamItemReceived:function(data){if($defined(data.item)&&data.item.source.username==this.user.username&&data.item.is_public==1){this.loader.process(data.item);}},userStreamItemDeleted:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.loader.remove(data.item_id);},loadMore:function(){var params={username:this.user.username,date_created:this.loader.oldestTimestamp,item_id:this.loader.oldestId};if(this.isLoggedIn()){this.call(\"home\",\"stream_user_load\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));}else{this.call(\"home\",\"public_stream_user_load\",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));}this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){if(status.code==2002){this.loader.showError();}},bottomFunc:function(){this.loadMore();}});var UserMenu=new Class({Extends:Menu,EventHandlers:[\"userSubscriberAdded\",\"userSubscriberDeleted\",\"userSubscriptionAdded\",\"userSubscriptionDeleted\"],onBeforeInit:function(options){this.user=options.user;options.displayName=this.user.fullname;return options;},onInit:function(){this.map=new UserMapMenuSection({user:this.user});$(this.map).inject(this.menu);this.aboutSection=new UserProfileMenuSection({user:this.user});$(this.aboutSection).inject(this.menu);if(this.isLoggedIn()){this.connect=new UserConnectionMenuSection({user:this.user});$(this.connect).inject(this.menu);}new Element(\"div\",{\"class\":\"nav_seperator\"}).inject(this.menu);this.subscriptions=new SubscriptionsNav({user:this.user});$(this.subscriptions).inject(this.menu);this.subscribers=new SubscribersNav({user:this.user});$(this.subscribers).inject(this.menu);},onShow:function(first){if(first){this.userInfoLoad();}},userInfoLoad:function(){if(this.isLoggedIn()){this.call(\"user\",\"info_load\",{username:this.user.username},this.userInfoLoadSuccess.bind(this),null);}else{this.call(\"home\",\"public_user_info_load\",{username:this.user.username},this.userInfoLoadSuccess.bind(this),null);}},userInfoLoadSuccess:function(data){if(!$defined(data.user)){return;}this.fireEvent(\"userInfoLoaded\",data);Logger().log(\"processing user\");var user=UserUtility.processUser(data.user);this.subscribers.addUsers(data.subscribers);this.subscriptions.addUsers(data.subscriptions);var subscribed=(data.subscription_id!=0);this.connect.setSubscription(subscribed);},userSubscriberAdded:function(data){if(!$defined(data.source_username)||!$defined(data.user)||data.source_username!=this.user.username){return;}this.subscribers.addUsers(data.user);},userSubscriberDeleted:function(data){if(!$defined(data.source_username)||!$defined(data.username)||data.source_username!=this.user.username){return;}this.subscribers.removeUser(data.username);},userSubscriptionAdded:function(data){if(!$defined(data.subscriber)||!$defined(data.user)||data.subscriber!=this.user.username){return;}this.subscriptions.addUsers(data.user);},userSubscriptionDeleted:function(data){if(!$defined(data.subscriber)||!$defined(data.username)||data.subscriber!=this.user.username){return;}this.subscriptions.removeUser(data.username);}});var UserProfileMenuSection=new Class({Extends:Base,EventHandlers:[\"userProfileUpdated\"],init:function(options){this.user=options.user;this.isSelf=this.user.user_id==this.getPrivateUser().user_id;this.createSection();},createSection:function(){this.wrapper=new Element(\"div\");this.bioText=new Element(\"span\");this.bioSection=new Element(\"div\",{\"class\":\"text_section light1 text11 edit_option\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Bio: \"}),this.bioText).inject(this.wrapper);this.interestsText=new Element(\"span\");this.interestsSection=new Element(\"div\",{\"class\":\"text_section light1 text11 edit_option\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Interests: \"}),this.interestsText).inject(this.wrapper);this.urlText=new Element(\"a\",{\"target\":\"_blank\"});this.urlSection=new Element(\"div\",{\"class\":\"text_section light1 text11 nowrap edit_option\"}).adopt(new Element(\"span\",{\"class\":\"bold\",\"text\":\"Web: \"}),this.urlText).inject(this.wrapper);this.userProfileUpdated(this.user.username,this.getProfile(this.user.username));},userProfileUpdated:function(username,about){if(username!=this.user.username){return;}if(!$defined(about)){DomUtility.hide(this.bioSection);DomUtility.hide(this.urlSection);DomUtility.hide(this.interestsSection);return;}if(!$defined(about.bio)||about.bio==\"\"){DomUtility.hide(this.bioSection);}else{this.bioText.set(\"text\",TextUtility.unescape(about.bio));DomUtility.show(this.bioSection);}if(!$defined(about.interests)||about.interests==\"\"){DomUtility.hide(this.interestsSection);}else{this.interestsText.set(\"text\",TextUtility.unescape(about.interests));DomUtility.show(this.interestsSection);}if(!$defined(about.url)||about.url==\"\"){DomUtility.hide(this.urlSection);}else{this.urlText.set(\"text\",TextUtility.unescape(about.url));this.urlText.set(\"href\",about.url);DomUtility.show(this.urlSection);}},toElement:function(){return this.wrapper;}});var UserSubscribersContent=new Class({Extends:Content,EventHandlers:[\"userSubscriberAdded\",\"userSubscriberDeleted\"],onBeforeInit:function(options){this.user=options.user;return options;},onInit:function(){this.statusBox=new StatusBox(this.user);$(this.statusBox).inject(this.content);StreamItemUtility.createSeperatorItem(\"Subscribers\").inject(this.content);this.loader=new ItemLoader({idField:\"user_id\",sortField:\"date_created\",sortAscending:false,createElementFunc:ContactItemUtility.createRoomSubscriberItem,emptyEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"This user has no subscribers\"}),loadingEl:new Element(\"div\",{\"class\":\"post empty\",\"text\":\"User subscribers loading...\"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},userSubscriberAdded:function(data){if(!$defined(data.source_username)||!$defined(data.user)||data.source_username!=this.user.username){return;}var user=UserUtility.processUser(data.user);user.date_created=new Date().getTime()/1000;this.loader.process(user);},userSubscriberDeleted:function(data){if(!$defined(data.source_username)||!$defined(data.username)||data.source_username!=this.user.username){return;}if(!$defined(this.getUser(data.username))){return;}var user=this.getUser(data.username);this.loader.remove(user.user_id);},loadMore:function(){var params={username:this.room.username,date_created:this.loader.lowestSortValue};this.call(\"pipio\",\"room_subscribers\",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.subscribers)||data.subscribers.length==0){this.atBottom=true;return;}data.subscribers.each(function(user){var user_copy=UserUtility.processUser(user);user_copy.date_created=user.date_created;this.loader.process(user_copy);},this);this.bottomFuncCalled=false;},bottomFunc:function(){this.loadMore();}});var Pipio=new Class({Implements:Events,initialize:function(){this.version=pipio_version;this.versionTimer=0;this.initApi();this.initVideo();this.registerApis();this.eventHandlers=new Hash();this.pageTitle=\"Pip.io\";this.loggedIn=false;window.addEvent(\"domready\",this.initCore.bind(this));this.registerHandler(\"userDataInit\",this.userDataInit.bind(this));this.registerHandler(\"videoChatEnable\",this.videoChatEnable.bind(this));this.registerHandler(\"videoInUse\",this.videoChatInUse.bind(this));this.registerHandler(\"startApp\",this.startApp.bind(this));this.registerHandler(\"startAppInstance\",this.startAppInstance.bind(this));this.registerHandler(\"appInstalled\",this.appInstalled.bind(this));this.registerHandler(\"appUninstalled\",this.appUninstalled.bind(this));},initCore:function(){this.xmpp=new Xmpp();this.initProfiles();this.initConnections();this.initConnectionEventHandlers();this.initModules();this.initApps();this.setSessionTimestamp();this.userDataInit();this.checkCookie();},checkCookie:function(){var destination=DataUtility.getCookie(\"destination\");if(destination!=\"room\"&&destination!=\"user\"){return;}var userval=DataUtility.getCookie(\"user\");var user=JSON.decode(userval);if($defined(user)){if(destination==\"user\"){user=UserUtility.processUser(user);this.dispatchEvent(\"showUser\",user);}else{user=UserUtility.processRoom(user);this.dispatchEvent(\"showRoom\",user);}}},initModules:function(){this.modules=new Pipio.modules(this);},initApps:function(){this.apps=new Pipio.apps(this);},setSessionTimestamp:function(){this.sessionTimestamp=new Date();},checkTimestamp:function(time){return time>this.sessionTimestamp.getTime()/1000;},userDataInit:function(data){if($defined(data)){user_data=data;}if(user_data.logged_in==1){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.initInstalledApps(user_data.apps);this.initProfiles();this.initLoggedInConnections();this.currentUser=UserUtility.processUser(user_data.user);this.currentUser.email=$defined(user_data.user.email)?user_data.user.email:undefined;this.loggedIn=true;if(!$defined(this.versionTimer)||this.versionTimer==0){$clear(this.versionTimer);}this.versionTimer=this.ping.periodical(1000*60*2,this);this.dispatchEvent(\"userSwitched\");},userLoggedOut:function(){this.initInstalledApps();this.initProfiles();this.initLoggedOutConnections();this.currentUser={user_id:0};this.currentLocation=null;this.loggedIn=false;$clear(this.versionTimer);this.dispatchEvent(\"userSwitched\");},isConnected:function(username){return this.connections.connsByUsername.has(username);},isRequestPending:function(user_id){return this.connections.requestsById.has(user_id)||this.connections.requestsOutById.has(user_id);},isLoggedIn:function(){return this.loggedIn;},dispatchEvent:function(){var eventName=arguments[0];var args=[];for(var i=1;i<arguments.length;i++){args.push(arguments[i]);}Logger().log(\"fired event \"+eventName+\" - \"+args.join(\",\"));this.fireEvent(eventName,args);},registerHandler:function(eventName,func){if(this.eventHandlers.has(eventName)){this.eventHandlers.get(eventName).push(func);this.addEvent(eventName,func);}else{this.eventHandlers.set(eventName,[func]);this.addEvent(eventName,func);}},getSession:function(){return this.xmpp.clientName;},ping:function(){this.call(\"pipio\",\"ping\",{},this.pong.bind(this));},pong:function(data){if(!$defined(data.v)){return;}if(this.version!=data.v){this.dispatchEvent(\"showPipioUpdatePopup\",data.v);}}});Pipio.implement({initApi:function(){this.apiMethods=new Hash();},registerCall:function(app,call){var apiKey=app+\"_\"+call.name;this.apiMethods.set(apiKey,call);},call:function(app,name,params,callbackSuccess,callbackFail,form){var apiKey=app+\"_\"+name;if(!this.apiMethods.has(apiKey)){Logger().log(\"api call not found!\");return;}var call=this.apiMethods.get(apiKey);var paramList=$defined(call.params)?call.params:[];var url=call.url;var method=$defined(call.method)?call.method:\"post\";var multipart=$defined(form);Logger().log(\"multipart \"+multipart);var parsedParams=new Hash();paramList.each(function(paramName){parsedParams.set(paramName,params[paramName]);});if(!multipart){var req=new Request({method:method,url:url,onFailure:function(){var res={status:{code:6000,message:\"request failed\"}};if($defined(callbackFail)){callbackFail(res.status);}},onSuccess:function(response){var res=response;if(res.status==null){try{res=JSON.decode(response);}catch(err){res={status:{code:6000,message:\"request failed\"}};if($defined(callbackFail)){callbackFail(res.status);}}}if($defined(res)&&$defined(res.status)&&res.status.code==0){if($defined(callbackSuccess)){if($defined(res.data)){callbackSuccess(res.data);}else{callbackSuccess();}}}else{if(!$defined(res)||!$defined(res.status)){res={status:{code:6000,message:\"request failed\"}};}if($defined(callbackFail)){callbackFail(res.status);}}}});if(method==\"post\"){req.send(parsedParams.toQueryString());}else{req.send();}}else{var iframeId=\"postIframe\"+$random(10000,99999);form.set(\"target\",iframeId);form.set(\"action\",url);form.set(\"method\",\"post\");form.set(\"enctype\",\"multipart/form-data\");parsedParams.each(function(val,name){new Element(\"input\",{\"type\":\"hidden\",\"name\":name,\"value\":val}).inject(form);},this);var iframe=new IFrame({\"id\":iframeId,\"events\":{load:function(){var response=window.frames[iframeId].document.body.innerHTML;if(response==\"\"){return;}Logger().log(response);var res=JSON.decode(response);if($defined(res)&&$defined(res.status)&&res.status.code==0){if($defined(callbackSuccess)){if($defined(res.data)){callbackSuccess(res.data);}else{callbackSuccess();}}}else{if(!$defined(res)||!$defined(res.status)){res={status:{code:6000,message:\"request failed\"}};}if($defined(callbackSuccess)){callbackFail(res.status);}}}}});iframe.inject(\"hidden\");form.submit();}}});Pipio.implement({moduleList:[{name:\"ui\",classRef:UI},{name:\"login\",classRef:Login},{name:\"background\",classRef:Background},{name:\"chat\",classRef:Chat},{name:\"videochat\",classRef:VideoChat},{name:\"notifications\",classRef:Notifications},{name:\"sharebox\",classRef:ShareBox},{name:\"invite\",classRef:Invite},{name:\"settings\",classRef:Settings},{name:\"albumViewer\",classRef:AlbumViewer},{name:\"facebookSharebox\",classRef:FacebookShareBox},{name:\"twitterSharebox\",classRef:TwitterShareBox},{name:\"location\",classRef:Location}],initModules:function(){this.modules=new Hash();this.moduleList.each(function(module){this.initModule(module.name,module.classRef);},this);},initModule:function(name,classRef){var o=new classRef();this.modules.set(name,o);}});Pipio.implement({initProfiles:function(){this.locationsByUsername=$H();this.profilesByUsername=$H();},locationUpdated:function(data){Logger().log(\"location updated called for \"+data.username);if(!$defined(data.username)||!$defined(data.location_enabled)){return;}if($defined(this.getUser(data.username))){this.getUser(data.username).location_enabled=data.location_enabled;}if($defined(data.location)){this.locationsByUsername.set(data.username,data.location);}this.dispatchEvent(\"userLocationUpdated\",data.username,data.location,data.location_enabled);},locationCleared:function(data){if(!$defined(data.username)){return;}this.locationsByUsername.erase(data.username);this.dispatchEvent(\"userLocationUpdated\",data.username,null,0);},getLocation:function(username){if(this.locationsByUsername.has(username)){return this.locationsByUsername.get(username);}else{return null;}},profileUpdated:function(data){if(!$defined(data.username)||!$defined(data.about)){return;}this.profilesByUsername.set(data.username,data.about);if($defined(this.getUser(data.username))){this.dispatchEvent(\"userProfileUpdated\",data.username,data.about);}else{if($defined(this.getRoom(data.username))){this.dispatchEvent(\"roomProfileUpdated\",data.username,data.about);}}},getProfile:function(username){if(this.profilesByUsername.has(username)){return this.profilesByUsername.get(username);}else{return null;}}});Pipio.implement({initVideo:function(){this.videoEnabled=false;this.videoInUse=false;},videoChatEnable:function(enabled){this.videoEnabled=enabled;},videoChatInUse:function(inUse){if(!this.videoEnabled){return;}this.videoInUse=inUse;}});var Xmpp=new Class({Extends:Base,EventHandlers:[\"userSwitched\",\"sendIM\",\"sendTyping\",\"sendVideoChatInvite\",\"sendVideoChatAccept\"],init:function(){this.newSession();this.domain=\"pip.io\";this.userPresences=new Hash();this.roomsDomain=\"rooms.pip.io\";this.multicastDomain=\"multicast.pip.io\";this.pubsubDomain=\"pubsub.pip.io\";var connArgs={httpbase:\"/pipio-tubes\",timerval:60*20};this.conn=new JSJaCHttpBindingConnection(connArgs);this.setupListeners();this.isConnecting=false;},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.newSession();this.fireEvent(\"xmppConnecting\");this.connect.delay(1000,this);},userLoggedOut:function(){this.disconnect();},newSession:function(){this.sessionId=$random(1000,9999);this.clientName=\"pipio\"+this.sessionId;},connect:function(){if(this.isConnecting){return;}if($defined(this.connectTimer)){$clear(this.connectTimer);}this.isConnecting=true;this.call(\"pipio\",\"token_get\",{},this.tokenGetSuccess.bind(this),this.tokenGetFail.bind(this));},disconnect:function(){this.isConnecting=false;this.updateSelfPresence(\"\",false);this.conn.disconnect();this.fireEvent(\"xmppDisconnected\");},tokenGetSuccess:function(data){Logger().log(\"xmpp token success - \"+data.token+\", connecting...\");this.username=this.getPrivateUser().username;this.password=data.token;this.isConnecting=false;var args={domain:this.domain,username:this.username,resource:this.clientName,pass:this.password,register:false};this.conn.connect(args);},tokenGetFail:function(){this.isConnecting=false;this.connectTimer=this.connect.delay(10*1000,this);},updateSelfPresence:function(show,online){var pres=new JSJaCPresence();pres.setShow(show);var video=this.videoEnabled();if(video){pres.setPriority(10);}else{pres.setPriority(5);}if(online){pres.setType(\"\");}else{pres.setType(\"unavailable\");}var videoEnabled=(video)?1:0;var pip=pres.getDoc().createElementNS(\"http://pip.io/videochat\",\"pip\");pip.setAttribute(\"video\",videoEnabled);pres.appendNode(pip);this.conn.send(pres);},userPresenceReceived:function(username,show,online,session,video){Logger().log(username+\" \"+show+\" - \"+session);var trueOnline=online;if(online){if(!this.userPresences.has(username)){this.userPresences.set(username,new Hash());}this.userPresences.get(username).set(session,video);}else{if(this.userPresences.has(username)){this.userPresences.get(username).erase(session);}if(this.userPresences.get(username).getLength()==0){this.userPresences.erase(username);}}if(this.userPresences.has(username)){trueOnline=true;}else{trueOnline=false;}Logger().log(\"firing \"+username+\" online-\"+trueOnline+\" show -\"+show);this.fireEvent(\"userPresenceReceived\",username,show,trueOnline);if(trueOnline){var videoEnabled=false;this.userPresences.get(username).each(function(videoExists){if(videoExists){videoEnabled=true;}});this.fireEvent(\"userVideoEnabled\",username,videoEnabled);}},selfPresenceReceived:function(show,online){this.fireEvent(\"selfPresenceReceived\",show,online);},sendVideoChatInvite:function(user){if(!$defined(user)){return;}if(!this.videoEnabled()){return;}var stratusId=sim.GetNearID();var userJID=new JSJaCJID(this.getJID(user));var aMsg=new JSJaCMessage();aMsg.setTo(userJID);aMsg.setBody(stratusId);aMsg.setType(\"videoChat\");var success=this.conn.send(aMsg);this.fireEvent(\"videoInUse\",true);this.fireEvent(\"selfPresenceUpdate\");},sendVideoChatAccept:function(user){if(!$defined(user)){return;}if(!this.videoEnabled()){return;}var stratusId=sim.GetNearID();var userJID=new JSJaCJID(this.getJID(user));var aMsg=new JSJaCMessage();aMsg.setTo(userJID);aMsg.setBody(stratusId);aMsg.setType(\"videoChatAccept\");var success=this.conn.send(aMsg);this.fireEvent(\"videoInUse\",true);this.fireEvent(\"selfPresenceUpdate\");},sendIM:function(user,msg){if(!$defined(user)||!$defined(msg)){return;}var userJID=new JSJaCJID(this.getJID(user));var aMsg=new JSJaCMessage();aMsg.setTo(userJID);aMsg.setBody(msg);aMsg.setType(\"chat\");var success=this.conn.send(aMsg);if(success){var msg=this.buildMessage(user,true,msg,new Date());this.fireEvent(\"chatMsgReceived\",msg);}},sendTyping:function(user){if(!$defined(user)){return;}var userJID=new JSJaCJID(this.getJID(user));var aMsg=new JSJaCMessage();aMsg.setTo(userJID);aMsg.setType(\"typing\");var success=this.conn.send(aMsg);},buildMessage:function(target,outbound,msg,date){return{target:target,outbound:outbound,msg:msg,timestamp:date};},getBody:function(packet){var bodyNode=packet.getChild(\"body\");if(!bodyNode){return\"\";}if(typeof(bodyNode.textContent)!=\"undefined\"){return bodyNode.textContent;}return bodyNode.firstChild.nodeValue;},getItem:function(packet){var itemNode=packet.getChild(\"item\");if(!itemNode){return\"\";}if(typeof(itemNode.textContent)!=\"undefined\"){return itemNode.textContent;}return itemNode.firstChild.nodeValue;},handleMessage:function(packet){if(packet.getType()==\"chat\"){var timestamp=new Date();var x=packet.getChild(\"x\");if($defined(x)){timestamp=DateUtility.convertFromGMT(Date.parse(x.getAttribute(\"stamp\")));}var username=packet.getFromJID().getNode();var user=this.getContact(username);var msg=this.buildMessage(user,false,packet.getBody(),timestamp);this.fireEvent(\"chatMsgReceived\",msg);}else{if(packet.getType()==\"videoChat\"){var username=packet.getFromJID().getNode();var stratusId=packet.getBody();this.fireEvent(\"videoChatRequestReceived\",username,stratusId);}else{if(packet.getType()==\"videoChatAccept\"){var username=packet.getFromJID().getNode();var stratusId=packet.getBody();this.fireEvent(\"videoChatRequestAccepted\",username,stratusId);}else{if(packet.getType()==\"typing\"){var username=packet.getFromJID().getNode();this.fireEvent(\"chatTypingReceived\",username);}else{if(packet.getType()==\"event\"&&packet.getFromJID().getNode()==\"server\"){var msg=this.getBody(packet);var item=JSON.decode(msg);Logger().log(\"unicast/multicast received\");if($defined(item.eventName)&&$defined(item.data)){this.fireEvent(item.eventName,item.data);}else{Logger().log(\"unknown event captured\");}}else{if(packet.getChild(\"event\")!=null){Logger().log(\"broadcast received\");var msg=this.getItem(packet);if(msg!=\"\"){var item=JSON.decode(msg);if($defined(item.eventName)&&$defined(item.data)){this.fireEvent(item.eventName,item.data);}else{Logger().log(\"unknown event captured\");}}}}}}}}},handlePresence:function(packet){var jid=packet.getFromJID();var username=jid.getNode();var session=jid.getResource();if(jid.getDomain()==this.domain){Logger().log(username+\" presence received\");if(!packet.getType()){if(username==this.getPrivateUser().username){var show=packet.getShow();this.selfPresenceReceived(show,true);return;}var show=packet.getShow();var video=false;var pip=packet.getChild(\"pip\",\"*\");if(pip){if(pip.getAttribute(\"video\")==1){video=true;}}this.userPresenceReceived(username,show,true,session,video);}else{if(packet.getType()==\"unavailable\"){var username=jid.getNode();if(username==this.getPrivateUser().username){return;}var session=jid.getResource();this.userPresenceReceived(username,\"\",false,session,false);}}}},handleConnected:function(){Logger().log(\"connected\");this.isConnecting=false;this.fireEvent(\"xmppConnected\");this.updateSelfPresence(\"\",true,false);window.onunload=this.disconnect.bind(this);},handleDisconnected:function(){Logger().log(\"disconnected\");this.isConnecting=false;this.fireEvent(\"xmppDisconnected\");this.connectTimer=this.connect.delay(3000,this);},handleError:function(e){this.reconnect();Logger().log(e.xml());},handleInPacket:function(aJSJaCPacket){Logger().log(\"in\");Logger().log(\"packet:\"+aJSJaCPacket.xml());},handleOutPacket:function(aJSJaCPacket){Logger().log(\"out\");Logger().log(\"packet:\"+aJSJaCPacket.xml());},setupListeners:function(){this.conn.registerHandler(\"message\",this.handleMessage.bind(this));this.conn.registerHandler(\"presence\",this.handlePresence.bind(this));this.conn.registerHandler(\"onconnect\",this.handleConnected.bind(this));this.conn.registerHandler(\"onerror\",this.handleError.bind(this));this.conn.registerHandler(\"ondisconnect\",this.handleDisconnected.bind(this));},getJID:function(user){if($defined(user)){return user.username+\"@\"+this.domain;}else{return this.username+\"@\"+this.domain;}}});Pipio.implement({appList:[{id:1,name:\"contacts\",displayName:\"Contacts\",iconOptions:{iconName:\"pipio\"},classRef:Contacts},{id:2,name:\"home\",displayName:\"Home\",iconOptions:{iconName:\"pipio\"},classRef:Home},{id:3,name:\"appstore\",displayName:\"Pip.io App Store\",iconOptions:{iconName:\"applications\"},classRef:Appstore,autoDock:true},{id:4,name:\"rss\",displayName:\"News Reader\",iconOptions:{iconName:\"rss\"},classRef:Rss,autoDock:true},{id:5,name:\"facebook\",displayName:\"Facebook\",iconOptions:{iconName:\"facebook\"},classRef:Facebook,autoDock:true},{id:6,name:\"twitter\",displayName:\"Twitter\",iconOptions:{iconName:\"twitter\"},classRef:Twitter,autoDock:true}],instanceAppList:{user:{name:\"user\",classRef:User,autoDock:true},room:{name:\"room\",classRef:Room,autoDock:true},global:{name:\"global\",classRef:Global,autoDock:true}},initApps:function(){this.apps=new Hash();this.appsById=$H();this.appInstances=new Hash();this.appList.each(function(app){this.initApp(app);},this);},initInstalledApps:function(apps){this.installedApps=$H();if(!$defined(apps)){return;}apps.each(function(app){this.installedApps.set(app.app_id,{settings:app.settings});},this);this.updateAppsMenu();},appInstalled:function(data){if(!$defined(data.app_id)){return;}this.installedApps.set(data.app_id,data);this.updateAppsMenu();var app=this.getAppById(data.app_id);this.startApp(app.name,{settings:data.settings});},appUninstalled:function(data){if(!$defined(data.app_id)){return;}this.installedApps.erase(data.app_id);this.updateAppsMenu();},updateAppsMenu:function(){DomUtility.hide(\"app_menu_item_4\");DomUtility.hide(\"app_menu_item_5\");DomUtility.hide(\"app_menu_item_6\");DomUtility.show(\"no_apps\");if(this.installedApps.getLength()>0){DomUtility.hide(\"no_apps\");this.installedApps.each(function(app,appId){DomUtility.show(\"app_menu_item_\"+appId);},this);}},getAppById:function(appId){if(this.appsById.has(appId)){return this.appsById.get(appId);}else{return false;}},initApp:function(app){var o=new app.classRef(app);this.apps.set(app.name,o);this.appsById.set(app.id,app);},startApp:function(appName,options){if(!this.apps.has(appName)){return;}var appId=this.apps.get(appName).appId;if(this.installedApps.has(appId)){this.apps.get(appName).start(this.installedApps.get(appId));}else{this.apps.get(appName).start(options);}},startAppInstance:function(appName,instanceName,options){if(!$defined(this.instanceAppList[appName])){return;}var appId=appName+\"_\"+instanceName;if(this.appInstances.has(appId)){this.appInstances.get(appId).start(appId);return;}var app=this.instanceAppList[appName];var o=new app.classRef(app,options);this.appInstances.set(appId,o);o.start(appId);}});Pipio.implement({initConnectionEventHandlers:function(){this.registerHandler(\"connectionGroupAdded\",this.connectionGroupAdded.bind(this));this.registerHandler(\"connectionGroupDeleted\",this.connectionGroupDeleted.bind(this));this.registerHandler(\"connectionGroupMoved\",this.connectionGroupMoved.bind(this));this.registerHandler(\"connectionAdded\",this.connectionAdded.bind(this));this.registerHandler(\"connectionDeleted\",this.connectionDeleted.bind(this));this.registerHandler(\"connectionRequestAdded\",this.connectionRequestAdded.bind(this));this.registerHandler(\"connectionRequestDeleted\",this.connectionRequestDeleted.bind(this));this.registerHandler(\"connectionRequestOutAdded\",this.connectionRequestOutAdded.bind(this));this.registerHandler(\"connectionRequestOutDeleted\",this.connectionRequestOutDeleted.bind(this));this.registerHandler(\"roomAdded\",this.roomAdded.bind(this));this.registerHandler(\"roomDeleted\",this.roomDeleted.bind(this));this.registerHandler(\"roomClosed\",this.roomDeleted.bind(this));this.registerHandler(\"roomMembershipUpdated\",this.roomMembershipUpdated.bind(this));this.registerHandler(\"roomStreamSubscriptionDeleted\",this.roomStreamSubscriptionDeleted.bind(this));this.registerHandler(\"roomStreamSubscriptionAdded\",this.roomStreamSubscriptionAdded.bind(this));this.registerHandler(\"profileUpdated\",this.profileUpdated.bind(this));this.registerHandler(\"locationUpdated\",this.locationUpdated.bind(this));this.registerHandler(\"locationCleared\",this.locationCleared.bind(this));},initConnections:function(){this.connsByUsername=$H();this.userCache=$H();this.groups=$H();this.requestsByUsername=$H();this.requestsOutByUsername=$H();this.roomsByUsername=$H();this.roomCache=$H();},initLoggedInConnections:function(){this.initConnections();this.processConnections();},initLoggedOutConnections:function(){this.initConnections();},userAboutUpdated:function(data){if(!$defined(data.username)){return;}if(this.connsByUsername.has(data.username)){this.connsByUsername.get(data.username).about=data.about;}if(this.userCache.has(data.username)){this.userCache.get(data.username).about=data.about;}},processConnections:function(){Logger().log(\"processing user connections\");user_data.groups.each(function(group){this.processGroup(group);},this);var unsorted={group_id:0,name:\"Unsorted\"};this.processGroup(unsorted);user_data.connections.each(function(user){this.processConnection(user);},this);user_data.connection_requests.each(function(user){this.processConnectionRequest(user);},this);user_data.connection_requests_out.each(function(user){this.processConnectionRequestOut(user);},this);user_data.rooms.each(function(room){this.processRoom(room);},this);},processGroup:function(group){group.users=new Hash();this.groups.set(parseInt(group.group_id),group);return group;},processRoom:function(room){room=UserUtility.processRoom(room);this.roomsByUsername.set(room.username,room);return room;},processConnection:function(user){user=UserUtility.processUser(user);this.connsByUsername.set(user.username,user);var group=this.getGroup(user.group_id);this.addUserToGroup(user,group);return user;},processConnectionRequest:function(user){user=UserUtility.processUser(user);this.requestsByUsername.set(user.username,user);return user;},processConnectionRequestOut:function(user){Logger().log(\"procesing out request \"+user.username);user=UserUtility.processUser(user);this.requestsOutByUsername.set(user.username,user);return user;},roomAdded:function(data){if(!$defined(data.room)){return;}var room=this.processRoom(data.room);this.dispatchEvent(\"feedRoomAdded\",room);},roomDeleted:function(data){if(!$defined(data.username)){return;}this.roomsByUsername.erase(data.username);this.roomCache.erase(data.username);this.dispatchEvent(\"feedRoomDeleted\",data.username);},roomMembershipUpdated:function(data){if(!$defined(data.username)||!this.roomsByUsername.has(data.username)){return;}this.roomsByUsername.get(data.username).status=data.status;},roomStreamSubscriptionAdded:function(data){if(!$defined(data.room)||!this.roomsByUsername.has(data.room.username)){return;}this.roomsByUsername.get(data.room.username).subscribed=1;},roomStreamSubscriptionDeleted:function(data){if(!$defined(data.username)||!this.roomsByUsername.has(data.username)){return;}this.roomsByUsername.get(data.username).subscribed=0;},connectionAdded:function(data){if(!$defined(data.user)){return;}var user=this.processConnection(data.user);this.dispatchEvent(\"contactAdded\",user);if(this.requestsByUsername.has(user.username)){this.requestsByUsername.erase(user.username);this.dispatchEvent(\"contactRequestDeleted\",user.username);}if(this.requestsOutByUsername.has(user.username)){this.requestsOutByUsername.erase(user.username);}},connectionDeleted:function(data){if(!$defined(data.username)){return;}var group=this.getGroup(data.group_id);group.users.erase(data.username);this.connsByUsername.erase(data.username);this.dispatchEvent(\"contactDeleted\",data.username,data.group_id);},connectionRequestAdded:function(data){if(!$defined(data.user)){return;}var user=this.processConnectionRequest(data.user);this.dispatchEvent(\"contactRequestAdded\",user);},connectionRequestDeleted:function(data){if(!$defined(data.username)){return;}this.requestsByUsername.erase(data.username);this.dispatchEvent(\"contactRequestDeleted\",data.username);},connectionRequestOutAdded:function(data){if(!$defined(data.user)){return;}var user=this.processConnectionRequestOut(data.user);this.dispatchEvent(\"contactRequestOutAdded\",user);},connectionRequestOutDeleted:function(data){if(!$defined(data.username)){return;}this.requestsOutByUsername.erase(data.username);this.dispatchEvent(\"contactRequestOutDeleted\",data.username);},connectionGroupAdded:function(data){if(!$defined(data.group)){return;}var group=this.processGroup(data.group);this.fireEvent(\"contactGroupAdded\",group);},connectionGroupDeleted:function(data){if(!$defined(data.group_id)||!this.groups.has(data.group_id)){return;}var group=this.getGroup(data.group_id);group.users.each(function(user){this.connectionGroupMoved({username:user.username,group_id:0,old_group_id:data.group_id});group.users.erase(user.username);},this);this.groups.erase(data.group_id);this.fireEvent(\"contactGroupDeleted\",group);},connectionGroupMoved:function(data){if(!$defined(data.group_id)||!$defined(data.username)||!$defined(data.old_group_id)){return;}var user=this.getContact(data.username);user.group_id=data.group_id;this.fireEvent(\"contactGroupMoved\",user);},addUserToGroup:function(user,group){if(!group.users.has(user.username)){group.users.set(user.username,user);}},getGroup:function(group_id){return this.groups.get(parseInt(group_id));},getContact:function(username){return this.connsByUsername.get(username);},getRoom:function(username){if(this.roomsByUsername.has(username)){return this.roomsByUsername.get(username);}else{if(this.roomCache.has(username)){return this.roomCache.get(username);}else{return null;}}},getContactsByGroup:function(group_id){if(!this.groups.has(group_id)){return;}var group=this.getGroup(group_id);return group.users;},getUser:function(username){if(this.userCache.has(username)){return this.userCache.get(username);}else{return null;}},cacheUser:function(user){this.userCache.set(user.username,user);},cacheRoom:function(room){this.roomCache.set(room.username,room);}});Pipio.implement({registerApis:function(){this.requests.each(function(request){this.registerCall(\"pipio\",request);},this);},requests:[{name:\"user_login\",params:[\"username\",\"password\",\"remember_me\"],url:\"/api/auth/user/login\"},{name:\"user_logout\",url:\"/api/auth/user/logout\"},{name:\"user_register\",params:[\"username\",\"password\",\"first_name\",\"last_name\",\"email\",\"dob_month\",\"dob_year\",\"dob_day\",\"access_key\"],url:\"/api/auth/user/register\"},{name:\"user_password_resetrequest\",params:[\"username\"],url:\"/api/auth/user/password/resetrequest\"},{name:\"user_password_reset\",params:[\"token\",\"new_password\",\"verify_password\",\"email\"],url:\"/api/auth/user/password/reset\"},{name:\"user_privacy_set\",params:[\"is_public\"],url:\"/api/user/privacy/set\"},{name:\"user_password_change\",params:[\"password\",\"new_password\",\"verify_password\"],url:\"/api/user/password/change\"},{name:\"user_email_change\",params:[\"email\"],url:\"/api/user/email/change\"},{name:\"user_location_enabled\",params:[\"location_enabled\"],url:\"/api/user/location/enabled\"},{name:\"user_location_save\",params:[\"label\",\"country_code\",\"country\",\"city\",\"region\",\"lat\",\"lon\",\"geohash\"],url:\"/api/user/location/save\"},{name:\"token_get\",url:\"/api/user/token/get\"},{name:\"publish_status\",url:\"/api/pipio/stream/publish/status\",params:[\"body\",\"res\"]},{name:\"publish_roomstatus\",url:\"/api/pipio/stream/publish/roomstatus\",params:[\"username\",\"body\",\"res\"]},{name:\"user_profilepic_upload\",url:\"/api/user/profilepic/upload\",params:[]},{name:\"room_profilepic_upload\",url:\"/api/pipio/room/profilepic/upload\",params:[\"username\"]},{name:\"room_members\",url:\"/api/pipio/room/members\",params:[\"username\",\"date_created\"]},{name:\"room_subscribers\",url:\"/api/pipio/room/subscribers\",params:[\"username\",\"date_created\"]},{name:\"room_requests\",url:\"/api/pipio/room/requests\",params:[\"username\",\"date_created\"]},{name:\"email_block\",url:\"/api/auth/email/block\",params:[\"token\",\"email\"]},{name:\"user_profile_update\",url:\"/api/user/profile/update\",params:[\"bio\",\"url\",\"interests\"]},{name:\"ping\",params:[],url:\"/api/user/session/ping\"},{name:\"emailblock_load\",url:\"/api/user/emailblock/load\"},{name:\"emailblock_update\",params:[\"email_type\",\"blocked\"],url:\"/api/user/emailblock/update\"}]});\n 33627  \n 33628  \n .....\n 43646  (function(){var N=/((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^[\\]]*\\]|[^[\\]]+)+\\]|\\\\.|[^ >+~,(\\[]+)+|[>+~])(\\s*,\\s*)?/g,I=0,F=Object.prototype.toString;var E=function(ae,S,aa,V){aa=aa||[];S=S||document;if(S.nodeType!==1&&S.nodeType!==9){return[]}if(!ae||typeof ae!==\"string\"){return aa}var ab=[],ac,Y,ah,ag,Z,R,Q=true;N.lastIndex=0;while((ac=N.exec(ae))!==null){ab.push(ac[1]);if(ac[2]){R=RegExp.rightContext;break}}if(ab.length>1&&G.match.POS.exec(ae)){if(ab.length===2&&G.relative[ab[0]]){var U=\"\",X;while((X=G.match.POS.exec(ae))){U+=X[0];ae=ae.replace(G.match.POS,\"\")}Y=E.filter(U,E(/\\s$/.test(ae)?ae+\"*\":ae,S))}else{Y=G.relative[ab[0]]?[S]:E(ab.shift(),S);while(ab.length){var P=[];ae=ab.shift();if(G.relative[ae]){ae+=ab.shift()}for(var af=0,ad=Y.length;af<ad;af++){E(ae,Y[af],P)}Y=P}}}else{var ai=V?{expr:ab.pop(),set:D(V)}:E.find(ab.pop(),ab.length===1&&S.parentNode?S.parentNode:S);Y=E.filter(ai.expr,ai.set);if(ab.length>0){ah=D(Y)}else{Q=false}while(ab.length){var T=ab.pop(),W=T;if(!G.relative[T]){T=\"\"}else{W=ab.pop()}if(W==null){W=S}G.relative[T](ah,W,M(S))}}if(!ah){ah=Y}if(!ah){throw\"Syntax error, unrecognized expression: \"+(T||ae)}if(F.call(ah)===\"[object Array]\"){if(!Q){aa.push.apply(aa,ah)}else{if(S.nodeType===1){for(var af=0;ah[af]!=null;af++){if(ah[af]&&(ah[af]===true||ah[af].nodeType===1&&H(S,ah[af]))){aa.push(Y[af])}}}else{for(var af=0;ah[af]!=null;af++){if(ah[af]&&ah[af].nodeType===1){aa.push(Y[af])}}}}}else{D(ah,aa)}if(R){E(R,S,aa,V)}return aa};E.matches=function(P,Q){return E(P,null,null,Q)};E.find=function(V,S){var W,Q;if(!V){return[]}for(var R=0,P=G.order.length;R<P;R++){var T=G.order[R],Q;if((Q=G.match[T].exec(V))){var U=RegExp.leftContext;if(U.substr(U.length-1)!==\"\\\\\"){Q[1]=(Q[1]||\"\").replace(/\\\\/g,\"\");W=G.find[T](Q,S);if(W!=null){V=V.replace(G.match[T],\"\");break}}}}if(!W){W=S.getElementsByTagName(\"*\")}return{set:W,expr:V}};E.filter=function(S,ac,ad,T){var Q=S,Y=[],ah=ac,V,ab;while(S&&ac.length){for(var U in G.filter){if((V=G.match[U].exec(S))!=null){var Z=G.filter[U],R=null,X=0,aa,ag;ab=false;if(ah==Y){Y=[]}if(G.preFilter[U]){V=G.preFilter[U](V,ah,ad,Y,T);if(!V){ab=aa=true}else{if(V===true){continue}else{if(V[0]===true){R=[];var W=null,af;for(var ae=0;(af=ah[ae])!==g;ae++){if(af&&W!==af){R.push(af);W=af}}}}}}if(V){for(var ae=0;(ag=ah[ae])!==g;ae++){if(ag){if(R&&ag!=R[X]){X++}aa=Z(ag,V,X,R);var P=T^!!aa;if(ad&&aa!=null){if(P){ab=true}else{ah[ae]=false}}else{if(P){Y.push(ag);ab=true}}}}}if(aa!==g){if(!ad){ah=Y}S=S.replace(G.match[U],\"\");if(!ab){return[]}break}}}S=S.replace(/\\s*,\\s*/,\"\");if(S==Q){if(ab==null){throw\"Syntax error, unrecognized expression: \"+S}else{break}}Q=S}return ah};var G=E.selectors={order:[\"ID\",\"NAME\",\"TAG\"],match:{ID:/#((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,CLASS:/\\.((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,NAME:/\\[name=['\"]*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)['\"]*\\]/,ATTR:/\\[\\s*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)\\s*(?:(\\S?=)\\s*(['\"]*)(.*?)\\3|)\\s*\\]/,TAG:/^((?:[\\w\\u00c0-\\uFFFF\\*_-]|\\\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\\((even|odd|[\\dn+-]*)\\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^-]|$)/,PSEUDO:/:((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)(?:\\((['\"]*)((?:\\([^\\)]+\\)|[^\\2\\(\\)]*)+)\\2\\))?/},attrMap:{\"class\":\"className\",\"for\":\"htmlFor\"},attrHandle:{href:function(P){return P.getAttribute(\"href\")}},relative:{\"+\":function(T,Q){for(var R=0,P=T.length;R<P;R++){var S=T[R];if(S){var U=S.previousSibling;while(U&&U.nodeType!==1){U=U.previousSibling}T[R]=typeof Q===\"string\"?U||false:U===Q}}if(typeof Q===\"string\"){E.filter(Q,T,true)}},\">\":function(U,Q,V){if(typeof Q===\"string\"&&!/\\W/.test(Q)){Q=V?Q:Q.toUpperCase();for(var R=0,P=U.length;R<P;R++){var T=U[R];if(T){var S=T.parentNode;U[R]=S.nodeName===Q?S:false}}}else{for(var R=0,P=U.length;R<P;R++){var T=U[R];if(T){U[R]=typeof Q===\"string\"?T.parentNode:T.parentNode===Q}}if(typeof Q===\"string\"){E.filter(Q,U,true)}}},\"\":function(S,Q,U){var R=\"done\"+(I++),P=O;if(!Q.match(/\\W/)){var T=Q=U?Q:Q.toUpperCase();P=L}P(\"parentNode\",Q,R,S,T,U)},\"~\":function(S,Q,U){var R=\"done\"+(I++),P=O;if(typeof Q===\"string\"&&!Q.match(/\\W/)){var T=Q=U?Q:Q.toUpperCase();P=L}P(\"previousSibling\",Q,R,S,T,U)}},find:{ID:function(Q,R){if(R.getElementById){var P=R.getElementById(Q[1]);return P?[P]:[]}},NAME:function(P,Q){return Q.getElementsByName?Q.getElementsByName(P[1]):null},TAG:function(P,Q){return Q.getElementsByTagName(P[1])}},preFilter:{CLASS:function(S,Q,R,P,U){S=\" \"+S[1].replace(/\\\\/g,\"\")+\" \";for(var T=0;Q[T];T++){if(U^(\" \"+Q[T].className+\" \").indexOf(S)>=0){if(!R){P.push(Q[T])}}else{if(R){Q[T]=false}}}return false},ID:function(P){return P[1].replace(/\\\\/g,\"\")},TAG:function(Q,P){for(var R=0;!P[R];R++){}return M(P[R])?Q[1]:Q[1].toUpperCase()},CHILD:function(P){if(P[1]==\"nth\"){var Q=/(-?)(\\d*)n((?:\\+|-)?\\d*)/.exec(P[2]==\"even\"&&\"2n\"||P[2]==\"odd\"&&\"2n+1\"||!/\\D/.test(P[2])&&\"0n+\"+P[2]||P[2]);P[2]=(Q[1]+(Q[2]||1))-0;P[3]=Q[3]-0}P[0]=\"done\"+(I++);return P},ATTR:function(Q){var P=Q[1];if(G.attrMap[P]){Q[1]=G.attrMap[P]}if(Q[2]===\"~=\"){Q[4]=\" \"+Q[4]+\" \"}return Q},PSEUDO:function(T,Q,R,P,U){if(T[1]===\"not\"){if(T[3].match(N).length>1){T[3]=E(T[3],null,null,Q)}else{var S=E.filter(T[3],Q,R,true^U);if(!R){P.push.apply(P,S)}return false}}else{if(G.match.POS.test(T[0])){return true}}return T},POS:function(P){P.unshift(true);return P}},filters:{enabled:function(P){return P.disabled===false&&P.type!==\"hidden\"},disabled:function(P){return P.disabled===true},checked:function(P){return P.checked===true},selected:function(P){P.parentNode.selectedIndex;return P.selected===true},parent:function(P){return !!P.firstChild},empty:function(P){return !P.firstChild},has:function(R,Q,P){return !!E(P[3],R).length},header:function(P){return/h\\d/i.test(P.nodeName)},text:function(P){return\"text\"===P.type},radio:function(P){return\"radio\"===P.type},checkbox:function(P){return\"checkbox\"===P.type},file:function(P){return\"file\"===P.type},password:function(P){return\"password\"===P.type},submit:function(P){return\"submit\"===P.type},image:function(P){return\"image\"===P.type},reset:function(P){return\"reset\"===P.type},button:function(P){return\"button\"===P.type||P.nodeName.toUpperCase()===\"BUTTON\"},input:function(P){return/input|select|textarea|button/i.test(P.nodeName)}},setFilters:{first:function(Q,P){return P===0},last:function(R,Q,P,S){return Q===S.length-1},even:function(Q,P){return P%2===0},odd:function(Q,P){return P%2===1},lt:function(R,Q,P){return Q<P[3]-0},gt:function(R,Q,P){return Q>P[3]-0},nth:function(R,Q,P){return P[3]-0==Q},eq:function(R,Q,P){return P[3]-0==Q}},filter:{CHILD:function(P,S){var V=S[1],W=P.parentNode;var U=\"child\"+W.childNodes.length;if(W&&(!W[U]||!P.nodeIndex)){var T=1;for(var Q=W.firstChild;Q;Q=Q.nextSibling){if(Q.nodeType==1){Q.nodeIndex=T++}}W[U]=T-1}if(V==\"first\"){return P.nodeIndex==1}else{if(V==\"last\"){return P.nodeIndex==W[U]}else{if(V==\"only\"){return W[U]==1}else{if(V==\"nth\"){var Y=false,R=S[2],X=S[3];if(R==1&&X==0){return true}if(R==0){if(P.nodeIndex==X){Y=true}}else{if((P.nodeIndex-X)%R==0&&(P.nodeIndex-X)/R>=0){Y=true}}return Y}}}}},PSEUDO:function(V,R,S,W){var Q=R[1],T=G.filters[Q];if(T){return T(V,S,R,W)}else{if(Q===\"contains\"){return(V.textContent||V.innerText||\"\").indexOf(R[3])>=0}else{if(Q===\"not\"){var U=R[3];for(var S=0,P=U.length;S<P;S++){if(U[S]===V){return false}}return true}}}},ID:function(Q,P){return Q.nodeType===1&&Q.getAttribute(\"id\")===P},TAG:function(Q,P){return(P===\"*\"&&Q.nodeType===1)||Q.nodeName===P},CLASS:function(Q,P){return P.test(Q.className)},ATTR:function(T,R){var P=G.attrHandle[R[1]]?G.attrHandle[R[1]](T):T[R[1]]||T.getAttribute(R[1]),U=P+\"\",S=R[2],Q=R[4];return P==null?false:S===\"=\"?U===Q:S===\"*=\"?U.indexOf(Q)>=0:S===\"~=\"?(\" \"+U+\" \").indexOf(Q)>=0:!R[4]?P:S===\"!=\"?U!=Q:S===\"^=\"?U.indexOf(Q)===0:S===\"$=\"?U.substr(U.length-Q.length)===Q:S===\"|=\"?U===Q||U.substr(0,Q.length+1)===Q+\"-\":false},POS:function(T,Q,R,U){var P=Q[2],S=G.setFilters[P];if(S){return S(T,R,Q,U)}}}};for(var K in G.match){G.match[K]=RegExp(G.match[K].source+/(?![^\\[]*\\])(?![^\\(]*\\))/.source)}var D=function(Q,P){Q=Array.prototype.slice.call(Q);if(P){P.push.apply(P,Q);return P}return Q};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(J){D=function(T,S){var Q=S||[];if(F.call(T)===\"[object Array]\"){Array.prototype.push.apply(Q,T)}else{if(typeof T.length===\"number\"){for(var R=0,P=T.length;R<P;R++){Q.push(T[R])}}else{for(var R=0;T[R];R++){Q.push(T[R])}}}return Q}}(function(){var Q=document.createElement(\"form\"),R=\"script\"+(new Date).getTime();Q.innerHTML=\"<input name='\"+R+\"'/>\";var P=document.documentElement;P.insertBefore(Q,P.firstChild);if(!!document.getElementById(R)){G.find.ID=function(T,U){if(U.getElementById){var S=U.getElementById(T[1]);return S?S.id===T[1]||S.getAttributeNode&&S.getAttributeNode(\"id\").nodeValue===T[1]?[S]:g:[]}};G.filter.ID=function(U,S){var T=U.getAttributeNode&&U.getAttributeNode(\"id\");return U.nodeType===1&&T&&T.nodeValue===S}}P.removeChild(Q)})();(function(){var P=document.createElement(\"div\");P.appendChild(document.createComment(\"\"));if(P.getElementsByTagName(\"*\").length>0){G.find.TAG=function(Q,U){var T=U.getElementsByTagName(Q[1]);if(Q[1]===\"*\"){var S=[];for(var R=0;T[R];R++){if(T[R].nodeType===1){S.push(T[R])}}T=S}return T}}P.innerHTML=\"<a href='#'></a>\";if(P.firstChild.getAttribute(\"href\")!==\"#\"){G.attrHandle.href=function(Q){return Q.getAttribute(\"href\",2)}}})();if(document.querySelectorAll){(function(){var P=E;E=function(T,S,Q,R){S=S||document;if(!R&&S.nodeType===9){try{return D(S.querySelectorAll(T),Q)}catch(U){}}return P(T,S,Q,R)};E.find=P.find;E.filter=P.filter;E.selectors=P.selectors;E.matches=P.matches})()}if(document.documentElement.getElementsByClassName){G.order.splice(1,0,\"CLASS\");G.find.CLASS=function(P,Q){return Q.getElementsByClassName(P[1])}}function L(Q,W,V,Z,X,Y){for(var T=0,R=Z.length;T<R;T++){var P=Z[T];if(P){P=P[Q];var U=false;while(P&&P.nodeType){var S=P[V];if(S){U=Z[S];break}if(P.nodeType===1&&!Y){P[V]=T}if(P.nodeName===W){U=P;break}P=P[Q]}Z[T]=U}}}function O(Q,V,U,Y,W,X){for(var S=0,R=Y.length;S<R;S++){var P=Y[S];if(P){P=P[Q];var T=false;while(P&&P.nodeType){if(P[U]){T=Y[P[U]];break}if(P.nodeType===1){if(!X){P[U]=S}if(typeof V!==\"string\"){if(P===V){T=true;break}}else{if(E.filter(V,[P]).length>0){T=P;break}}}P=P[Q]}Y[S]=T}}}var H=document.compareDocumentPosition?function(Q,P){return Q.compareDocumentPosition(P)&16}:function(Q,P){return Q!==P&&(Q.contains?Q.contains(P):true)};var M=function(P){return P.documentElement&&!P.body||P.tagName&&P.ownerDocument&&!P.ownerDocument.body};n.find=E;n.filter=E.filter;n.expr=E.selectors;n.expr[\":\"]=n.expr.filters;E.selectors.filters.hidden=function(P){return\"hidden\"===P.type||n.css(P,\"display\")===\"none\"||n.css(P,\"visibility\")===\"hidden\"};E.selectors.filters.visible=function(P){return\"hidden\"!==P.type&&n.css(P,\"display\")!==\"none\"&&n.css(P,\"visibility\")!==\"hidden\"};E.selectors.filters.animated=function(P){return n.grep(n.timers,function(Q){return P===Q.elem}).length};n.multiFilter=function(R,P,Q){if(Q){R=\":not(\"+R+\")\"}return E.matches(R,P)};n.dir=function(R,Q){var P=[],S=R[Q];while(S&&S!=document){if(S.nodeType==1){P.push(S)}S=S[Q]}return P};n.nth=function(T,P,R,S){P=P||1;var Q=0;for(;T;T=T[R]){if(T.nodeType==1&&++Q==P){break}}return T};n.sibling=function(R,Q){var P=[];for(;R;R=R.nextSibling){if(R.nodeType==1&&R!=Q){P.push(R)}}return P};return;l.Sizzle=E})();n.event={add:function(H,E,G,J){if(H.nodeType==3||H.nodeType==8){return}if(H.setInterval&&H!=l){H=l}if(!G.guid){G.guid=this.guid++}if(J!==g){var F=G;G=this.proxy(F);G.data=J}var D=n.data(H,\"events\")||n.data(H,\"events\",{}),I=n.data(H,\"handle\")||n.data(H,\"handle\",function(){return typeof n!==\"undefined\"&&!n.event.triggered?n.event.handle.apply(arguments.callee.elem,arguments):g});I.elem=H;n.each(E.split(/\\s+/),function(L,M){var N=M.split(\".\");M=N.shift();G.type=N.slice().sort().join(\".\");var K=D[M];if(n.event.specialAll[M]){n.event.specialAll[M].setup.call(H,J,N)}if(!K){K=D[M]={};if(!n.event.special[M]||n.event.special[M].setup.call(H,J,N)===false){if(H.addEventListener){H.addEventListener(M,I,false)}else{if(H.attachEvent){H.attachEvent(\"on\"+M,I)}}}}K[G.guid]=G;n.event.global[M]=true});H=null},guid:1,global:{},remove:function(J,G,I){if(J.nodeType==3||J.nodeType==8){return}var F=n.data(J,\"events\"),E,D;if(F){if(G===g||(typeof G===\"string\"&&G.charAt(0)==\".\")){for(var H in F){this.remove(J,H+(G||\"\"))}}else{if(G.type){I=G.handler;G=G.type}n.each(G.split(/\\s+/),function(L,N){var P=N.split(\".\");N=P.shift();var M=RegExp(\"(^|\\\\.)\"+P.slice().sort().join(\".*\\\\.\")+\"(\\\\.|$)\");if(F[N]){if(I){delete F[N][I.guid]}else{for(var O in F[N]){if(M.test(F[N][O].type)){delete F[N][O]}}}if(n.event.specialAll[N]){n.event.specialAll[N].teardown.call(J,P)}for(E in F[N]){break}if(!E){if(!n.event.special[N]||n.event.special[N].teardown.call(J,P)===false){if(J.removeEventListener){J.removeEventListener(N,n.data(J,\"handle\"),false)}else{if(J.detachEvent){J.detachEvent(\"on\"+N,n.data(J,\"handle\"))}}}E=null;delete F[N]}}})}for(E in F){break}if(!E){var K=n.data(J,\"handle\");if(K){K.elem=null}n.removeData(J,\"events\");n.removeData(J,\"handle\")}}},trigger:function(H,J,G,D){var F=H.type||H;if(!D){H=typeof H===\"object\"?H[h]?H:n.extend(n.Event(F),H):n.Event(F);if(F.indexOf(\"!\")>=0){H.type=F=F.slice(0,-1);H.exclusive=true}if(!G){H.stopPropagation();if(this.global[F]){n.each(n.cache,function(){if(this.events&&this.events[F]){n.event.trigger(H,J,this.handle.elem)}})}}if(!G||G.nodeType==3||G.nodeType==8){return g}H.result=g;H.target=G;J=n.makeArray(J);J.unshift(H)}H.currentTarget=G;var I=n.data(G,\"handle\");if(I){I.apply(G,J)}if((!G[F]||(n.nodeName(G,\"a\")&&F==\"click\"))&&G[\"on\"+F]&&G[\"on\"+F].apply(G,J)===false){H.result=false}if(!D&&G[F]&&!H.isDefaultPrevented()&&!(n.nodeName(G,\"a\")&&F==\"click\")){this.triggered=true;try{G[F]()}catch(K){}}this.triggered=false;if(!H.isPropagationStopped()){var E=G.parentNode||G.ownerDocument;if(E){n.event.trigger(H,J,E,true)}}},handle:function(J){var I,D;J=arguments[0]=n.event.fix(J||l.event);var K=J.type.split(\".\");J.type=K.shift();I=!K.length&&!J.exclusive;var H=RegExp(\"(^|\\\\.)\"+K.slice().sort().join(\".*\\\\.\")+\"(\\\\.|$)\");D=(n.data(this,\"events\")||{})[J.type];for(var F in D){var G=D[F];if(I||H.test(G.type)){J.handler=G;J.data=G.data;var E=G.apply(this,arguments);if(E!==g){J.result=E;if(E===false){J.preventDefault();J.stopPropagation()}}if(J.isImmediatePropagationStopped()){break}}}},props:\"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which\".split(\" \"),fix:function(G){if(G[h]){return G}var E=G;G=n.Event(E);for(var F=this.props.length,I;F;){I=this.props[--F];G[I]=E[I]}if(!G.target){G.target=G.srcElement||document}if(G.target.nodeType==3){G.target=G.target.parentNode}if(!G.relatedTarget&&G.fromElement){G.relatedTarget=G.fromElement==G.target?G.toElement:G.fromElement}if(G.pageX==null&&G.clientX!=null){var H=document.documentElement,D=document.body;G.pageX=G.clientX+(H&&H.scrollLeft||D&&D.scrollLeft||0)-(H.clientLeft||0);G.pageY=G.clientY+(H&&H.scrollTop||D&&D.scrollTop||0)-(H.clientTop||0)}if(!G.which&&((G.charCode||G.charCode===0)?G.charCode:G.keyCode)){G.which=G.charCode||G.keyCode}if(!G.metaKey&&G.ctrlKey){G.metaKey=G.ctrlKey}if(!G.which&&G.button){G.which=(G.button&1?1:(G.button&2?3:(G.button&4?2:0)))}return G},proxy:function(E,D){D=D||function(){return E.apply(this,arguments)};D.guid=E.guid=E.guid||D.guid||this.guid++;return D},special:{ready:{setup:A,teardown:function(){}}},specialAll:{live:{setup:function(D,E){n.event.add(this,E[0],c)},teardown:function(F){if(F.length){var D=0,E=RegExp(\"(^|\\\\.)\"+F[0]+\"(\\\\.|$)\");n.each((n.data(this,\"events\").live||{}),function(){if(E.test(this.type)){D++}});if(D<1){n.event.remove(this,F[0],c)}}}}}};n.Event=function(D){if(!this.preventDefault){return new n.Event(D)}if(D&&D.type){this.originalEvent=D;this.type=D.type;this.timeStamp=D.timeStamp}else{this.type=D}if(!this.timeStamp){this.timeStamp=e()}this[h]=true};function k(){return false}function t(){return true}n.Event.prototype={preventDefault:function(){this.isDefaultPrevented=t;var D=this.originalEvent;if(!D){return}if(D.preventDefault){D.preventDefault()}D.returnValue=false},stopPropagation:function(){this.isPropagationStopped=t;var D=this.originalEvent;if(!D){return}if(D.stopPropagation){D.stopPropagation()}D.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=t;this.stopPropagation()},isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k};var a=function(E){var D=E.relatedTarget;while(D&&D!=this){try{D=D.parentNode}catch(F){D=this}}if(D!=this){E.type=E.data;n.event.handle.apply(this,arguments)}};n.each({mouseover:\"mouseenter\",mouseout:\"mouseleave\"},function(E,D){n.event.special[D]={setup:function(){n.event.add(this,E,a,D)},teardown:function(){n.event.remove(this,E,a)}}});n.fn.extend({bind:function(E,F,D){return E==\"unload\"?this.one(E,F,D):this.each(function(){n.event.add(this,E,D||F,D&&F)})},one:function(F,G,E){var D=n.event.proxy(E||G,function(H){n(this).unbind(H,D);return(E||G).apply(this,arguments)});return this.each(function(){n.event.add(this,F,D,E&&G)})},unbind:function(E,D){return this.each(function(){n.event.remove(this,E,D)})},trigger:function(D,E){return this.each(function(){n.event.trigger(D,E,this)})},triggerHandler:function(D,F){if(this[0]){var E=n.Event(D);E.preventDefault();E.stopPropagation();n.event.trigger(E,F,this[0]);return E.result}},toggle:function(F){var D=arguments,E=1;while(E<D.length){n.event.proxy(F,D[E++])}return this.click(n.event.proxy(F,function(G){this.lastToggle=(this.lastToggle||0)%E;G.preventDefault();return D[this.lastToggle++].apply(this,arguments)||false}))},hover:function(D,E){return this.mouseenter(D).mouseleave(E)},ready:function(D){A();if(n.isReady){D.call(document,n)}else{n.readyList.push(D)}return this},live:function(F,E){var D=n.event.proxy(E);D.guid+=this.selector+F;n(document).bind(i(F,this.selector),this.selector,D);return this},die:function(E,D){n(document).unbind(i(E,this.selector),D?{guid:D.guid+this.selector+E}:null);return this}});function c(G){var D=RegExp(\"(^|\\\\.)\"+G.type+\"(\\\\.|$)\"),F=true,E=[];n.each(n.data(this,\"events\").live||[],function(H,I){if(D.test(I.type)){var J=n(G.target).closest(I.data)[0];if(J){E.push({elem:J,fn:I})}}});n.each(E,function(){if(!G.isImmediatePropagationStopped()&&this.fn.call(this.elem,G,this.fn.data)===false){F=false}});return F}function i(E,D){return[\"live\",E,D.replace(/\\./g,\"`\").replace(/ /g,\"|\")].join(\".\")}n.extend({isReady:false,readyList:[],ready:function(){if(!n.isReady){n.isReady=true;if(n.readyList){n.each(n.readyList,function(){this.call(document,n)});n.readyList=null}n(document).triggerHandler(\"ready\")}}});var w=false;function A(){if(w){return}w=true;if(document.addEventListener){document.addEventListener(\"DOMContentLoaded\",function(){document.removeEventListener(\"DOMContentLoaded\",arguments.callee,false);n.ready()},false)}else{if(document.attachEvent){document.attachEvent(\"onreadystatechange\",function(){if(document.readyState===\"complete\"){document.detachEvent(\"onreadystatechange\",arguments.callee);n.ready()}});if(document.documentElement.doScroll&&!l.frameElement){(function(){if(n.isReady){return}try{document.documentElement.doScroll(\"left\")}catch(D){setTimeout(arguments.callee,0);return}n.ready()})()}}}n.event.add(l,\"load\",n.ready)}n.each((\"blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error\").split(\",\"),function(E,D){n.fn[D]=function(F){return F?this.bind(D,F):this.trigger(D)}});n(l).bind(\"unload\",function(){for(var D in n.cache){if(D!=1&&n.cache[D].handle){n.event.remove(n.cache[D].handle.elem)}}});(function(){n.support={};var E=document.documentElement,F=document.createElement(\"script\"),J=document.createElement(\"div\"),I=\"script\"+(new Date).getTime();J.style.display=\"none\";J.innerHTML='   <link/><table></table><a href=\"/a\" style=\"color:red;float:left;opacity:.5;\">a</a><select><option>text</option></select><object><param/></object>';var G=J.getElementsByTagName(\"*\"),D=J.getElementsByTagName(\"a\")[0];if(!G||!G.length||!D){return}n.support={leadingWhitespace:J.firstChild.nodeType==3,tbody:!J.getElementsByTagName(\"tbody\").length,objectAll:!!J.getElementsByTagName(\"object\")[0].getElementsByTagName(\"*\").length,htmlSerialize:!!J.getElementsByTagName(\"link\").length,style:/red/.test(D.getAttribute(\"style\")),hrefNormalized:D.getAttribute(\"href\")===\"/a\",opacity:D.style.opacity===\"0.5\",cssFloat:!!D.style.cssFloat,scriptEval:false,noCloneEvent:true,boxModel:null};F.type=\"text/javascript\";try{F.appendChild(document.createTextNode(\"window.\"+I+\"=1;\"))}catch(H){}E.insertBefore(F,E.firstChild);if(l[I]){n.support.scriptEval=true;delete l[I]}E.removeChild(F);if(J.attachEvent&&J.fireEvent){J.attachEvent(\"onclick\",function(){n.support.noCloneEvent=false;J.detachEvent(\"onclick\",arguments.callee)});J.cloneNode(true).fireEvent(\"onclick\")}n(function(){var K=document.createElement(\"div\");K.style.width=\"1px\";K.style.paddingLeft=\"1px\";document.body.appendChild(K);n.boxModel=n.support.boxModel=K.offsetWidth===2;document.body.removeChild(K)})})();var v=n.support.cssFloat?\"cssFloat\":\"styleFloat\";n.props={\"for\":\"htmlFor\",\"class\":\"className\",\"float\":v,cssFloat:v,styleFloat:v,readonly:\"readOnly\",maxlength:\"maxLength\",cellspacing:\"cellSpacing\",rowspan:\"rowSpan\",tabindex:\"tabIndex\"};n.fn.extend({_load:n.fn.load,load:function(F,I,J){if(typeof F!==\"string\"){return this._load(F)}var H=F.indexOf(\" \");if(H>=0){var D=F.slice(H,F.length);F=F.slice(0,H)}var G=\"GET\";if(I){if(n.isFunction(I)){J=I;I=null}else{if(typeof I===\"object\"){I=n.param(I);G=\"POST\"}}}var E=this;n.ajax({url:F,type:G,dataType:\"html\",data:I,complete:function(L,K){if(K==\"success\"||K==\"notmodified\"){E.html(D?n(\"<div/>\").append(L.responseText.replace(/<script(.|\\s)*?\\/script>/g,\"\")).find(D):L.responseText)}if(J){E.each(J,[L.responseText,K,L])}}});return this},serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?n.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password/i.test(this.type))}).map(function(D,E){var F=n(this).val();return F==null?null:n.isArray(F)?n.map(F,function(H,G){return{name:E.name,value:H}}):{name:E.name,value:F}}).get()}});n.each(\"ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend\".split(\",\"),function(D,E){n.fn[E]=function(F){return this.bind(E,F)}});var q=e();n.extend({get:function(D,F,G,E){if(n.isFunction(F)){G=F;F=null}return n.ajax({type:\"GET\",url:D,data:F,success:G,dataType:E})},getScript:function(D,E){return n.get(D,null,E,\"script\")},getJSON:function(D,E,F){return n.get(D,E,F,\"json\")},post:function(D,F,G,E){if(n.isFunction(F)){G=F;F={}}return n.ajax({type:\"POST\",url:D,data:F,success:G,dataType:E})},ajaxSetup:function(D){n.extend(n.ajaxSettings,D)},ajaxSettings:{url:location.href,global:true,type:\"GET\",contentType:\"application/x-www-form-urlencoded\",processData:true,async:true,xhr:function(){return l.ActiveXObject?new ActiveXObject(\"Microsoft.XMLHTTP\"):new XMLHttpRequest()},accepts:{xml:\"application/xml, text/xml\",html:\"text/html\",script:\"text/javascript, application/javascript\",json:\"application/json, text/javascript\",text:\"text/plain\",_default:\"*/*\"}},lastModified:{},ajax:function(L){L=n.extend(true,L,n.extend(true,{},n.ajaxSettings,L));var V,E=/=\\?(&|$)/g,Q,U,F=L.type.toUpperCase();if(L.data&&L.processData&&typeof L.data!==\"string\"){L.data=n.param(L.data)}if(L.dataType==\"jsonp\"){if(F==\"GET\"){if(!L.url.match(E)){L.url+=(L.url.match(/\\?/)?\"&\":\"?\")+(L.jsonp||\"callback\")+\"=?\"}}else{if(!L.data||!L.data.match(E)){L.data=(L.data?L.data+\"&\":\"\")+(L.jsonp||\"callback\")+\"=?\"}}L.dataType=\"json\"}if(L.dataType==\"json\"&&(L.data&&L.data.match(E)||L.url.match(E))){V=\"jsonp\"+q++;if(L.data){L.data=(L.data+\"\").replace(E,\"=\"+V+\"$1\")}L.url=L.url.replace(E,\"=\"+V+\"$1\");L.dataType=\"script\";l[V]=function(W){U=W;H();K();l[V]=g;try{delete l[V]}catch(X){}if(G){G.removeChild(S)}}}if(L.dataType==\"script\"&&L.cache==null){L.cache=false}if(L.cache===false&&F==\"GET\"){var D=e();var T=L.url.replace(/(\\?|&)_=.*?(&|$)/,\"$1_=\"+D+\"$2\");L.url=T+((T==L.url)?(L.url.match(/\\?/)?\"&\":\"?\")+\"_=\"+D:\"\")}if(L.data&&F==\"GET\"){L.url+=(L.url.match(/\\?/)?\"&\":\"?\")+L.data;L.data=null}if(L.global&&!n.active++){n.event.trigger(\"ajaxStart\")}var P=/^(\\w+:)?\\/\\/([^\\/?#]+)/.exec(L.url);if(L.dataType==\"script\"&&F==\"GET\"&&P&&(P[1]&&P[1]!=location.protocol||P[2]!=location.host)){var G=document.getElementsByTagName(\"head\")[0];var S=document.createElement(\"script\");S.src=L.url;if(L.scriptCharset){S.charset=L.scriptCharset}if(!V){var N=false;S.onload=S.onreadystatechange=function(){if(!N&&(!this.readyState||this.readyState==\"loaded\"||this.readyState==\"complete\")){N=true;H();K();G.removeChild(S)}}}G.appendChild(S);return g}var J=false;var I=L.xhr();if(L.username){I.open(F,L.url,L.async,L.username,L.password)}else{I.open(F,L.url,L.async)}try{if(L.data){I.setRequestHeader(\"Content-Type\",L.contentType)}if(L.ifModified){I.setRequestHeader(\"If-Modified-Since\",n.lastModified[L.url]||\"Thu, 01 Jan 1970 00:00:00 GMT\")}I.setRequestHeader(\"X-Requested-With\",\"XMLHttpRequest\");I.setRequestHeader(\"Accept\",L.dataType&&L.accepts[L.dataType]?L.accepts[L.dataType]+\", */*\":L.accepts._default)}catch(R){}if(L.beforeSend&&L.beforeSend(I,L)===false){if(L.global&&!--n.active){n.event.trigger(\"ajaxStop\")}I.abort();return false}if(L.global){n.event.trigger(\"ajaxSend\",[I,L])}var M=function(W){if(I.readyState==0){if(O){clearInterval(O);O=null;if(L.global&&!--n.active){n.event.trigger(\"ajaxStop\")}}}else{if(!J&&I&&(I.readyState==4||W==\"timeout\")){J=true;if(O){clearInterval(O);O=null}Q=W==\"timeout\"?\"timeout\":!n.httpSuccess(I)?\"error\":L.ifModified&&n.httpNotModified(I,L.url)?\"notmodified\":\"success\";if(Q==\"success\"){try{U=n.httpData(I,L.dataType,L)}catch(Y){Q=\"parsererror\"}}if(Q==\"success\"){var X;try{X=I.getResponseHeader(\"Last-Modified\")}catch(Y){}if(L.ifModified&&X){n.lastModified[L.url]=X}if(!V){H()}}else{n.handleError(L,I,Q)}K();if(L.async){I=null}}}};if(L.async){var O=setInterval(M,13);if(L.timeout>0){setTimeout(function(){if(I){if(!J){M(\"timeout\")}if(I){I.abort()}}},L.timeout)}}try{I.send(L.data)}catch(R){n.handleError(L,I,null,R)}if(!L.async){M()}function H(){if(L.success){L.success(U,Q)}if(L.global){n.event.trigger(\"ajaxSuccess\",[I,L])}}function K(){if(L.complete){L.complete(I,Q)}if(L.global){n.event.trigger(\"ajaxComplete\",[I,L])}if(L.global&&!--n.active){n.event.trigger(\"ajaxStop\")}}return I},handleError:function(E,G,D,F){if(E.error){E.error(G,D,F)}if(E.global){n.event.trigger(\"ajaxError\",[G,E,F])}},active:0,httpSuccess:function(E){try{return !E.status&&location.protocol==\"file:\"||(E.status>=200&&E.status<300)||E.status==304||E.status==1223}catch(D){}return false},httpNotModified:function(F,D){try{var G=F.getResponseHeader(\"Last-Modified\");return F.status==304||G==n.lastModified[D]}catch(E){}return false},httpData:function(I,G,F){var E=I.getResponseHeader(\"content-type\"),D=G==\"xml\"||!G&&E&&E.indexOf(\"xml\")>=0,H=D?I.responseXML:I.responseText;if(D&&H.documentElement.tagName==\"parsererror\"){throw\"parsererror\"}if(F&&F.dataFilter){H=F.dataFilter(H,G)}if(typeof H===\"string\"){if(G==\"script\"){n.globalEval(H)}if(G==\"json\"){H=l[\"eval\"](\"(\"+H+\")\")}}return H},param:function(D){var F=[];function G(H,I){F[F.length]=encodeURIComponent(H)+\"=\"+encodeURIComponent(I)}if(n.isArray(D)||D.jquery){n.each(D,function(){G(this.name,this.value)})}else{for(var E in D){if(n.isArray(D[E])){n.each(D[E],function(){G(E,this)})}else{G(E,n.isFunction(D[E])?D[E]():D[E])}}}return F.join(\"&\").replace(/%20/g,\"+\")}});var m={},d=[[\"height\",\"marginTop\",\"marginBottom\",\"paddingTop\",\"paddingBottom\"],[\"width\",\"marginLeft\",\"marginRight\",\"paddingLeft\",\"paddingRight\"],[\"opacity\"]];function s(E,D){var F={};n.each(d.concat.apply([],d.slice(0,D)),function(){F[this]=E});return F}n.fn.extend({show:function(I,K){if(I){return this.animate(s(\"show\",3),I,K)}else{for(var G=0,E=this.length;G<E;G++){var D=n.data(this[G],\"olddisplay\");this[G].style.display=D||\"\";if(n.css(this[G],\"display\")===\"none\"){var F=this[G].tagName,J;if(m[F]){J=m[F]}else{var H=n(\"<\"+F+\" />\").appendTo(\"body\");J=H.css(\"display\");if(J===\"none\"){J=\"block\"}H.remove();m[F]=J}this[G].style.display=n.data(this[G],\"olddisplay\",J)}}return this}},hide:function(G,H){if(G){return this.animate(s(\"hide\",3),G,H)}else{for(var F=0,E=this.length;F<E;F++){var D=n.data(this[F],\"olddisplay\");if(!D&&D!==\"none\"){n.data(this[F],\"olddisplay\",n.css(this[F],\"display\"))}this[F].style.display=\"none\"}return this}},_toggle:n.fn.toggle,toggle:function(F,E){var D=typeof F===\"boolean\";return n.isFunction(F)&&n.isFunction(E)?this._toggle.apply(this,arguments):F==null||D?this.each(function(){var G=D?F:n(this).is(\":hidden\");n(this)[G?\"show\":\"hide\"]()}):this.animate(s(\"toggle\",3),F,E)},fadeTo:function(D,F,E){return this.animate({opacity:F},D,E)},animate:function(H,E,G,F){var D=n.speed(E,G,F);return this[D.queue===false?\"each\":\"queue\"](function(){var J=n.extend({},D),L,K=this.nodeType==1&&n(this).is(\":hidden\"),I=this;for(L in H){if(H[L]==\"hide\"&&K||H[L]==\"show\"&&!K){return J.complete.call(this)}if((L==\"height\"||L==\"width\")&&this.style){J.display=n.css(this,\"display\");J.overflow=this.style.overflow}}if(J.overflow!=null){this.style.overflow=\"hidden\"}J.curAnim=n.extend({},H);n.each(H,function(N,R){var Q=new n.fx(I,J,N);if(/toggle|show|hide/.test(R)){Q[R==\"toggle\"?K?\"show\":\"hide\":R](H)}else{var P=R.toString().match(/^([+-]=)?([\\d+-.]+)(.*)$/),S=Q.cur(true)||0;if(P){var M=parseFloat(P[2]),O=P[3]||\"px\";if(O!=\"px\"){I.style[N]=(M||1)+O;S=((M||1)/Q.cur(true))*S;I.style[N]=S+O}if(P[1]){M=((P[1]==\"-=\"?-1:1)*M)+S}Q.custom(S,M,O)}else{Q.custom(S,R,\"\")}}});return true})},stop:function(E,D){var F=n.timers;if(E){this.queue([])}this.each(function(){for(var G=F.length-1;G>=0;G--){if(F[G].elem==this){if(D){F[G](true)}F.splice(G,1)}}});if(!D){this.dequeue()}return this}});n.each({slideDown:s(\"show\",1),slideUp:s(\"hide\",1),slideToggle:s(\"toggle\",1),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"}},function(D,E){n.fn[D]=function(F,G){return this.animate(E,F,G)}});n.extend({speed:function(F,G,E){var D=typeof F===\"object\"?F:{complete:E||!E&&G||n.isFunction(F)&&F,duration:F,easing:E&&G||G&&!n.isFunction(G)&&G};D.duration=n.fx.off?0:typeof D.duration===\"number\"?D.duration:n.fx.speeds[D.duration]||n.fx.speeds._default;D.old=D.complete;D.complete=function(){if(D.queue!==false){n(this).dequeue()}if(n.isFunction(D.old)){D.old.call(this)}};return D},easing:{linear:function(F,G,D,E){return D+E*F},swing:function(F,G,D,E){return((-Math.cos(F*Math.PI)/2)+0.5)*E+D}},timers:[],timerId:null,fx:function(E,D,F){this.options=D;this.elem=E;this.prop=F;if(!D.orig){D.orig={}}}});n.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(n.fx.step[this.prop]||n.fx.step._default)(this);if((this.prop==\"height\"||this.prop==\"width\")&&this.elem.style){this.elem.style.display=\"block\"}},cur:function(E){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var D=parseFloat(n.css(this.elem,this.prop,E));return D&&D>-10000?D:parseFloat(n.curCSS(this.elem,this.prop))||0},custom:function(H,G,F){this.startTime=e();this.start=H;this.end=G;this.unit=F||this.unit||\"px\";this.now=this.start;this.pos=this.state=0;var D=this;function E(I){return D.step(I)}E.elem=this.elem;n.timers.push(E);if(E()&&n.timerId==null){n.timerId=setInterval(function(){var J=n.timers;for(var I=0;I<J.length;I++){if(!J[I]()){J.splice(I--,1)}}if(!J.length){clearInterval(n.timerId);n.timerId=null}},13)}},show:function(){this.options.orig[this.prop]=n.attr(this.elem.style,this.prop);this.options.show=true;this.custom(this.prop==\"width\"||this.prop==\"height\"?1:0,this.cur());n(this.elem).show()},hide:function(){this.options.orig[this.prop]=n.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(G){var F=e();if(G||F>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var D=true;for(var E in this.options.curAnim){if(this.options.curAnim[E]!==true){D=false}}if(D){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(n.css(this.elem,\"display\")==\"none\"){this.elem.style.display=\"block\"}}if(this.options.hide){n(this.elem).hide()}if(this.options.hide||this.options.show){for(var H in this.options.curAnim){n.attr(this.elem.style,H,this.options.orig[H])}}}if(D){this.options.complete.call(this.elem)}return false}else{var I=F-this.startTime;this.state=I/this.options.duration;this.pos=n.easing[this.options.easing||(n.easing.swing?\"swing\":\"linear\")](this.state,I,0,1,this.options.duration);this.now=this.start+((this.end-this.start)*this.pos);this.update()}return true}};n.extend(n.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(D){n.attr(D.elem.style,\"opacity\",D.now)},_default:function(D){if(D.elem.style&&D.elem.style[D.prop]!=null){D.elem.style[D.prop]=D.now+D.unit}else{D.elem[D.prop]=D.now}}}});if(document.documentElement.getBoundingClientRect){n.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return n.offset.bodyOffset(this[0])}var F=this[0].getBoundingClientRect(),I=this[0].ownerDocument,E=I.body,D=I.documentElement,K=D.clientTop||E.clientTop||0,J=D.clientLeft||E.clientLeft||0,H=F.top+(self.pageYOffset||n.boxModel&&D.scrollTop||E.scrollTop)-K,G=F.left+(self.pageXOffset||n.boxModel&&D.scrollLeft||E.scrollLeft)-J;return{top:H,left:G}}}else{n.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return n.offset.bodyOffset(this[0])}n.offset.initialized||n.offset.initialize();var I=this[0],F=I.offsetParent,E=I,N=I.ownerDocument,L,G=N.documentElement,J=N.body,K=N.defaultView,D=K.getComputedStyle(I,null),M=I.offsetTop,H=I.offsetLeft;while((I=I.parentNode)&&I!==J&&I!==G){L=K.getComputedStyle(I,null);M-=I.scrollTop,H-=I.scrollLeft;if(I===F){M+=I.offsetTop,H+=I.offsetLeft;if(n.offset.doesNotAddBorder&&!(n.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(I.tagName))){M+=parseInt(L.borderTopWidth,10)||0,H+=parseInt(L.borderLeftWidth,10)||0}E=F,F=I.offsetParent}if(n.offset.subtractsBorderForOverflowNotVisible&&L.overflow!==\"visible\"){M+=parseInt(L.borderTopWidth,10)||0,H+=parseInt(L.borderLeftWidth,10)||0}D=L}if(D.position===\"relative\"||D.position===\"static\"){M+=J.offsetTop,H+=J.offsetLeft}if(D.position===\"fixed\"){M+=Math.max(G.scrollTop,J.scrollTop),H+=Math.max(G.scrollLeft,J.scrollLeft)}return{top:M,left:H}}}n.offset={initialize:function(){if(this.initialized){return}var K=document.body,E=document.createElement(\"div\"),G,F,M,H,L,D,I=K.style.marginTop,J='<div style=\"position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;\"><div></div></div><table style=\"position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;\"cellpadding=\"0\"cellspacing=\"0\"><tr><td></td></tr></table>';L={position:\"absolute\",top:0,left:0,margin:0,border:0,width:\"1px\",height:\"1px\",visibility:\"hidden\"};for(D in L){E.style[D]=L[D]}E.innerHTML=J;K.insertBefore(E,K.firstChild);G=E.firstChild,F=G.firstChild,H=G.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(F.offsetTop!==5);this.doesAddBorderForTableAndCells=(H.offsetTop===5);G.style.overflow=\"hidden\",G.style.position=\"relative\";this.subtractsBorderForOverflowNotVisible=(F.offsetTop===-5);K.style.marginTop=\"1px\";this.doesNotIncludeMarginInBodyOffset=(K.offsetTop===0);K.style.marginTop=I;K.removeChild(E);this.initialized=true},bodyOffset:function(D){n.offset.initialized||n.offset.initialize();var F=D.offsetTop,E=D.offsetLeft;if(n.offset.doesNotIncludeMarginInBodyOffset){F+=parseInt(n.curCSS(D,\"marginTop\",true),10)||0,E+=parseInt(n.curCSS(D,\"marginLeft\",true),10)||0}return{top:F,left:E}}};n.fn.extend({position:function(){var H=0,G=0,E;if(this[0]){var F=this.offsetParent(),I=this.offset(),D=/^body|html$/i.test(F[0].tagName)?{top:0,left:0}:F.offset();I.top-=j(this,\"marginTop\");I.left-=j(this,\"marginLeft\");D.top+=j(F,\"borderTopWidth\");D.left+=j(F,\"borderLeftWidth\");E={top:I.top-D.top,left:I.left-D.left}}return E},offsetParent:function(){var D=this[0].offsetParent||document.body;while(D&&(!/^body|html$/i.test(D.tagName)&&n.css(D,\"position\")==\"static\")){D=D.offsetParent}return n(D)}});n.each([\"Left\",\"Top\"],function(E,D){var F=\"scroll\"+D;n.fn[F]=function(G){if(!this[0]){return null}return G!==g?this.each(function(){this==l||this==document?l.scrollTo(!E?G:n(l).scrollLeft(),E?G:n(l).scrollTop()):this[F]=G}):this[0]==l||this[0]==document?self[E?\"pageYOffset\":\"pageXOffset\"]||n.boxModel&&document.documentElement[F]||document.body[F]:this[0][F]}});n.each([\"Height\",\"Width\"],function(G,E){var D=G?\"Left\":\"Top\",F=G?\"Right\":\"Bottom\";n.fn[\"inner\"+E]=function(){return this[E.toLowerCase()]()+j(this,\"padding\"+D)+j(this,\"padding\"+F)};n.fn[\"outer\"+E]=function(I){return this[\"inner\"+E]()+j(this,\"border\"+D+\"Width\")+j(this,\"border\"+F+\"Width\")+(I?j(this,\"margin\"+D)+j(this,\"margin\"+F):0)};var H=E.toLowerCase();n.fn[H]=function(I){return this[0]==l?document.compatMode==\"CSS1Compat\"&&document.documentElement[\"client\"+E]||document.body[\"client\"+E]:this[0]==document?Math.max(document.documentElement[\"client\"+E],document.body[\"scroll\"+E],document.documentElement[\"scroll\"+E],document.body[\"offset\"+E],document.documentElement[\"offset\"+E]):I===g?(this.length?n.css(this[0],H):null):this.css(H,typeof I===\"string\"?I:I+\"px\")}})})();\n 43647  \n 43648: if(!Array.forEach){Array.prototype.forEach=function(D,E){var C=E||window;for(var B=0,A=this.length;B<A;++B){D.call(C,this[B],B,this)}};Array.prototype.map=function(E,F){var D=F||window;var A=[];for(var C=0,B=this.length;C<B;++C){A.push(E.call(D,this[C],C,this))}return A};Array.prototype.filter=function(E,F){var D=F||window;var A=[];for(var C=0,B=this.length;C<B;++C){if(!E.call(D,this[C],C,this)){continue}A.push(this[C])}return A};Array.prototype.every=function(D,E){var C=E||window;for(var B=0,A=this.length;B<A;++B){if(!D.call(C,this[B],B,this)){return false}}return true};Array.prototype.indexOf=function(B,C){var C=C||0;for(var A=0;A<this.length;++A){if(this[A]===B){return A}}return -1}}Array.prototype.contains=function(A){if(Array.contains){return this.contains(A)}return this.indexOf(A)>-1};Array.prototype.insert=function(A){if(!this.contains(A)){this.push(A)}};if(!Array.remove){Array.remove=function(D,C,B){var A=D.slice((B||C)+1||D.length);D.length=C<0?D.length+C:C;return D.push.apply(D,A)}}Function.prototype.method=function(A,B){this.prototype[A]=B;return this};Function.prototype.augmentProto=function(A){for(key in A){this.prototype[key]=A[key]}return this};Function.prototype.pBind=function(B){var A=this;return function(){return A.apply(B,arguments)}};Function.prototype.widget=function(){this.prototype.bind=function(B,A){this.$root.bind(B,A);return this};this.prototype.trigger=function(A,B){this.$root.trigger(A,B)};this.prototype.find=function(A){return this.$root.find(A)};return this};String.prototype.toCamel=function(){return this.replace(/[-_\\s]\\D/gi,function(A){return A.charAt(A.length-1).toUpperCase()})};String.prototype.escapeHTML=function(){return this.replace(/&/g,\"&amp;\").replace(/>/g,\"&gt;\").replace(/</g,\"&lt;\").replace(/\"/g,\"&quot;\")};window.twttr=window.twttr||{};twttr.augmentObject=function(B,C){for(var A in C){B[A]=C[A]}return B};twttr.augmentObject(twttr,{namespaceOf:function(A){return twttr.is.object(A)?A:window},merge:function(){var C=arguments;var F=arguments[arguments.length-1];var B=false;if(twttr.is.nil(C[0])||!twttr.is.def(C[0])){if(C.length<2){return{}}[].shift.call(C);return this.merge.apply(this,C)}if(twttr.is.bool(F)){B=F;[].pop.call(C)}for(var E=0,A=C.length-1;E<A;E++){for(var D in C[E+1]){if(B&&C[0][D]&&twttr.is.object(C[0][D])&&!twttr.is.fn(C[0][D])&&twttr.is.object(C[E+1][D])&&!twttr.is.fn(C[E+1][D])){this.merge(C[0][D],C[E+1][D])}else{C[0][D]=C[E+1][D]}}}return C[0]},extend:function(B,C){var A=function(){};A.prototype=C.prototype;B.prototype=new A();B.prototype.constructor=B;B.uber=C.prototype;if(C.prototype.constructor==Object.prototype.constructor){C.prototype.constructor=C}},klass:function(A,B){return twttr.magic(A,B)},augmentAndExtend:function(B,C,D){var A=twttr.namespaceOf(B);A[C]=function(){A[C].uber.constructor.apply(this,arguments)};twttr.extend(A[C],D);return A[C]},auxo:function(C,D,B){var A=twttr.is.object(B)?B:twttr;return twttr.augmentAndExtend(A,C,D)},augmentString:function(C,A){var B=window;C.split(\".\").forEach(function(F,E,D){B=B[F]=B[F]||(twttr.is.def(D[E+1])?{}:A)});return B},magic:function(B,A){if(twttr.is.string(B)){return twttr.augmentString(B,A)}else{return twttr.augmentObject(B,A)}},inspect:function(B){console.clear();var C=$(B);var H=C.data(\"events\");var A=0;var G=0;var E=[];var D=[];for(key in H){E.push(key);A++;D.push(\"\\n*******************\\n\");D.push(\"Events for \"+key+\"\\n\\n\");for(fn in H[key]){var F=H[key][fn];G++;D.push(F.toString()+\"\\n\")}}console.log(\"************* Summary *************\");console.log(\"for target\",C);console.log(A+\" types of events\",E);console.log(G,\"Total Event Listeners\");console.log(\"Event listeners assigned to target\");console.log(D.join(\" \"))},is:{bool:function(A){return typeof A===\"boolean\"},nil:function(A){return A===null},def:function(A){return !(typeof A===\"undefined\")},number:function(A){return typeof A===\"number\"&&isFinite(A)},fn:function(A){return typeof A===\"function\"},array:function(A){return A?this.number(A.length)&&this.fn(A.splice):false},string:function(A){return typeof A===\"string\"},blank:function(A){return A===\"\"},falsy:function(A){return A===false||A===null||A===undefined},object:function(A){return(A&&(typeof A===\"object\"||this.fn(A)))||false}},widget:function(A){A.prototype.bind=function(C,B){this.$element.bind(C,B)}}});if(!window.console){var names=[\"log\",\"debug\",\"info\",\"warn\",\"error\",\"assert\",\"dir\",\"dirxml\",\"group\",\"groupEnd\",\"time\",\"timeEnd\",\"count\",\"trace\",\"profile\",\"profileEnd\"];window.console={};for(var i=0;i<names.length;++i){window.console[names[i]]=function(){}}}function _(C,A){if(twttr.i18n){var B=twttr.i18n[C];if(B){C=B}}return replaceParams(C,A)}function replaceParams(B,A){if(A){for(var C in A){B=B.replace(new RegExp(\"\\\\%\\\\{\"+C+\"\\\\}\",\"gi\"),A[C])}}return B}var h=function(){var A=$(\"<div/>\");return function(B){return B?A.text(B).html().replace(/\\\"/gi,\"&quot;\"):B}}();function unh(A){return A?A.replace(/&(amp;)+/g,\"&\").replace(/&[a-z]+;/gi,function(B){if(unh.HTML_ESCAPE_TOKENS[B]){return unh.HTML_ESCAPE_TOKENS[B]}return B}):A}window.unh.HTML_ESCAPE_TOKENS={\"&lt;\":\"<\",\"&gt;\":\">\",\"&quot;\":'\"'};function addSlashes(A){return A.replace(/\\'/g,\"\\\\'\").replace(/\\\"/g,'\\\\\"')}var reverseString=function(A){return A?A.split(\"\").reverse().join(\"\"):A};var numberWithDelimiter=function(B,A,C){A=A?A:\",\";C=C?C:\".\";parts=(\"\"+B).split(\".\");parts[0]=reverseString(reverseString(parts[0]).replace(/(\\d\\d\\d)/g,\"$1\"+A));if(parts[0][0]==A){parts[0]=parts[0].substring(1)}return parts.join(C)};var timeAgo=function(C){if(!C){return false}var H=new Date();var G=new Date(C);if(document.all){G=Date.parse(C.replace(/( \\+)/,\" UTC$1\"))}var D=H-G;var B=1000,F=B*60,A=F*60;if(isNaN(D)||D<0){return false}var E=-1;$.each([5,10,20],function(){if(D<this*B){E=this;return false}});if(E!=-1){return _(\"less than %{time} seconds ago\",{time:E})}if(D<B*40){return _(\"half a minute ago\")}if(D<F){return _(\"less than a minute ago\")}if(D<B*90){return _(\"1 minute ago\")}if(D<F*45){return _(\"%{time} minutes ago\",{time:Math.round(D/F)})}if(D<F*90){return _(\"about 1 hour ago\")}if(D<A*24){return _(\"about %{time} hours ago\",{time:Math.round(D/A)})}return false};var updateTimeAgo=function(){$(\".timestamp\").each(function(){var B=$(this);var A=timeAgo(B.meta().time);if(A&&B.find(\"*\").length==0){B.html(A)}});$(\".timestamp-title\").each(function(){var B=$(this);var A=timeAgo(B.meta().time);if(A){B.attr(\"title\",A)}})};var DEBUG=false;$.extend({log:function(A){if(window.console){console.log(A)}},debug:function(A){if(DEBUG){console.log(A)}},inspect:function(B){var A=\"{\\n\";for(var C in B){A+=\"\\t\"+C+\": \"+B[C]+\"\\n\"}A+=\"}\";console.log(A);return A}});(function(){if(document.all){if(/MSIE (\\d+\\.\\d+);/.test(navigator.userAgent)){var A=new Number(RegExp.$1);if(A>=8){$.browser.msie8=true}else{if(A>=7){$.browser.msie7=true}else{$.browser.msie6=true}}}}})();var _tmp={};twttr.augmentObject(twttr,{templates:{},timeouts:{},wait:function(){var A={};twttr.clearWait=function(B){if(twttr.is.def(A[B])){clearTimeout(B);delete A[B]}};return function(E,C){var B=\"TIMER_\"+(new Date()).getTime();var D=setTimeout(function(){if(!twttr.is.def(A[B])){return }E()},C);A[B]=D;return B}}(),processJson:function(json){if(typeof (json)==\"object\"){var evals=[];$.each(json,function(selector,content){var c=selector.charAt(0);if(c==\"$\"){evals.push(content)}else{if(c==\"!\"){var notification=window[selector.substring(1)+\"Notification\"];if(notification){(new notification()).setMessage(content).show()}}else{var $contentPadded=$(\"<div></div>\").html(content);var $content=$(selector,$contentPadded);if($content.length==1){$(selector).replaceWith($content)}else{$(selector).html(content)}$(selector).show()}}});$.each(evals,function(index,js){if(js){eval(js)}})}},googleAnalytics:function(A){if(window.pageTracker){window.pageTracker._trackEvent(\"Ajax\",\"refresh\",A,null)}},trackPageView:function(C,B,D){if(window.pageTracker){var A;if(C){A=C.toString();if(B){A=\"/search/tweets/\"+encodeURIComponent(h(page.query))}if(D){A=A+D}window.pageTracker._trackPageview(A)}else{window.pageTracker._trackPageview()}}},fadeAndReplace:function(A,B){$(A).fadeOut(\"medium\",function(){$(A).html(B)});$(A).fadeIn(\"medium\")},error:function(A){alert(A?A:_(\"Whoops! Something went wrong. Please refresh the page and try again!\"))},loading:function(){$(\"#loader\").fadeIn(200)},loaded:function(){$(\"#loader\").fadeOut(200)},updateLocation:function(A,E){if(!E){E=document}if(A){var D=A.replace(/^https?:\\/\\/.+?\\//,\"\").replace(/#/gi,\"%23\").replace(/\\s/gi,\"+\");var C=D.replace(/[^\\w\\d_-].*$/,\"\");var B=(C.length>0)?$(E).find(\"#\"+C):[];if(B.length>0){B.get(0).id=C+\"_tmp_for_update_location\"}E.location.hash=D;if(B.length>0){B.get(0).id=C}}},NON_CHAR_KEY_CODES:[8,9,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46,91,92,93],isNonCharKeyCode:function(A){return $.inArray(A.keyCode,twttr.NON_CHAR_KEY_CODES)!=-1||((A.ctrlKey||A.metaKey)&&$.inArray(A.keyCode,[67,88])!=-1)}});$.extend($.expr[\":\"],{onthepage:\"($(elem).is(':visible') && $(elem).parents(':hidden').length == 0)\"});jQuery.fn.move=function(A){var B=$(this).html();$(this).remove();$(A).html(B)};jQuery.fn.meta=function(){var B={type:\"attr\",name:\"data\"};var C=$(this);if(C.length==1){return C.metadata(B)}else{var A=[];C.each(function(){A.push($(this).metadata(B))});return A}};jQuery.fn.visible=function(A){$(this).each(function(){$(this).css(\"visibility\",A?\"visible\":\"hidden\")})};jQuery.fn.isLoading=function(){$(this).addClass(\"loading\")};$.fn.isLoaded=function(){$(this).removeClass(\"loading\")};$.fn.replace_text=function(C,B){var A=$(this).html();if(A){$(this).html(A.replace(C,B))}};var pluralize=function(C,B,A){return C==1?B:A};var setDocumentTitle=function(A){document.title=unh(A)||\"\"};var addCountToDocumentTitle=function(A){document.title=(A?\"(\"+numberWithDelimiter(A)+\") \":\"\")+document.title.replace(/\\([^)]*[0-9]\\)\\s+/gi,\"\")};var getCurrentUserScreenName=function(){return page.user_screenname||$('meta[name=\"session-user-screen_name\"]:first').get(0).content};var sessionUserIsPageUser=function(){try{return $('meta[name=\"session-user-screen_name\"]:first').get(0).content==$('meta[name=\"page-user-screen_name\"]:first').get(0).content}catch(A){return false}};$.fn.focusEnd=function(){return this.each(function(){var A=this;if(A.style.display!=\"none\"){if($.browser.msie){A.focus();var B=A.createTextRange();B.collapse(false);B.select()}else{A.setSelectionRange(A.value.length,A.value.length);A.focus()}}})};$.fn.focusFirstTextField=function(){return this.find(\"input[type=text]:visible:enabled:first\").focus().length>0},$.fn.focusFirstTextArea=function(){return this.find(\"textarea:visible:enabled:first\").focus().length>0};$.fn.focusFirstTexttarget=function(){return this.focusFirstTextField()||this.focusFirstTextArea()};$.fn.maxLength=function(A){return this.each(function(){$(this).keydown(function(B){return this.value.length<=A||twttr.isNonCharKeyCode(B)})})};$.fn.replaceClass=function(B,A){return this.each(function(){var C=$(this);if(C.hasClass(B)){C.removeClass(B).addClass(A)}else{if(C.hasClass(A)){C.removeClass(A).addClass(B)}}})};$.fn.isSelectAll=function(A){return this.each(function(){var B=$(this);if(typeof (A)==\"string\"){var D=$(A).find(\"input[type=checkbox]\")}else{var D=A}function C(){var E=true;D.each(function(){if(!this.checked){E=false;return false}});B.get(0).checked=E}B.click(function(){var E=B.get(0).checked;D.each(function(){this.checked=E});$(this).trigger(\"select-all-changed\",E)});D.click(function(){C();$(this).trigger(\"checkbox-changed\",this.checked)})})};function bodytarget(){return $(\"body\")}twttr.klass(\"twttr.Observer\",function(){this.fns=[]}).method(\"listen\",function(A){this.fns.push(A)}).method(\"unlisten\",function(A){this.fns=this.fns.filter(function(B){if(B!==A){return B}})}).method(\"trigger\",function(C,B){var A=B||window;this.fns.forEach(function(D){D.call(A,C)})});twttr.klass(\"twttr.User\",function(A){this.screen_name=A}).method(\"update\",function(B,A){twttr.tweeters[this.screen_name][B]=A;return this}).method(\"updateAll\",function(B){for(var A in B){twttr.tweeters[this.screen_name][A]=B[A]}return this}).method(\"data\",function(B){var A=twttr.tweeters[this.screen_name];return B?A[B]:A});twttr.augmentString(\"twttr.Tweeter\",{UserFetchTimeout:5000,UserFetchUrl:\"/users/show\",_bail:false,_requesting:false,bail:function(){this._bail=true},isRequesting:function(){return this._requesting},getCurrentUser:function(A){return this.findById(page.sessionUserId,A)},find:function(F,C,G){var B,A;var D=this;if(twttr.is.fn(C)){B=window;A=C}else{B=C;A=G}var E=twttr.is.def(F.screen_name)?F.screen_name.toLowerCase():null;if(E&&twttr.tweeters[E]){A.call(B,new twttr.User(E),true);return true}else{$.ajax({url:this.UserFetchUrl,type:\"GET\",data:F,dataType:\"json\",timeout:this.UserFetchTimeout,beforeSend:function(){D._requesting=true},success:function(K){D._requesting=false;var H=K.user;if(H){var I={};var J=H.screen_name.toLowerCase();I[J]=H;twttr.Tweeter.merge(I,true);if(D._bail){D._bail=false;return false}A.call(B,new twttr.User(J),false)}else{if(D._bail){D._bail=false;return false}A.call(B,null,false)}},error:function(H){D._requesting=false;if(D._bail){D._bail=false;return false}A.call(B,null,false)}});return false}},findByScreenName:function(B,A,C){return this.find({screen_name:B,hovercard:true},A,C)},findById:function(D,A,C){var B=twttr._birdtags[D];if(twttr.is.def(B)){this.findByScreenName(B,A,C)}else{this.find({user_id:D,hovercard:true},A,C)}},merge:function(){twttr.tweeters={};twttr._birdtags={};return function(D,A){var D=D||{};if(A){twttr.merge(twttr.tweeters,D,true)}else{var C=twttr.merge(D,twttr.tweeters,true);twttr.merge(twttr.tweeters,C,true)}for(var B in twttr.tweeters){twttr._birdtags[twttr.tweeters[B].user_id]=B}}}()});twttr.loadTemplate=function(A,B){if(twttr.templates[A]){return twttr.templates[A]}B=B||function(){};$.get(\"/mustaches/\"+A+\".html\",null,function(D){var C={templates:{}};C.templates[A]=D;twttr.merge(twttr,C,true);B(twttr.templates)},\"html\")};twttr.loadTemplates=function(A,B){B=B||function(){};A.forEach(function(D,C){twttr.loadTemplate(D,function(E){var F=A.every(function(G){return twttr.is.def(E[G])});if(F){B(twttr.templates)}})})};twttr.SimplePositioner={setPosition:function(C,G,E){var D={inline:false,direction:null,offsets:{inline:{top:0,left:0},below:{top:0,left:0},above:{top:0,left:0}}};var F=twttr.merge({},D,E,true);var B=C instanceof jQuery?C:$(C);var A=G instanceof jQuery?G:$(G);var H=A.offset();this._opts=F;if(!F.inline){switch(F.direction){case\"above\":this._positionAbove(B,A,H,F.offsets.above);break;case\"below\":this._positionBelow(B,A,H,F.offsets.below);break;default:if((H.top-$(document).scrollTop())>(F.itemHeight||B.height())){this._positionAbove(B,A,H,F.offsets.above)}else{this._positionBelow(B,A,H,F.offsets.below)}break}}else{this._positionInline(B,A,H,F.offsets.inline);B.css(\"left\",H.left+F.offsets.inline.left)}},_positionAbove:function(C,B,H,A){$(\"body\").addClass(\"loading-hoverer-above\");C.addClass(\"position_above\").removeClass(\"position_below\").removeClass(\"position_inline\");var G=Math.round(H.top+A.top);var F=$(\"body\");var E=parseInt(F.css(\"padding-top\"));G+=E>0?12:0;var D=F.outerHeight()-G-B.height();C.css({bottom:D,left:this._getLeftPosition(C,B,H)+A.left})},_positionBelow:function(A,C,D,E){var B=Math.round(D.top+C.height()+E.top);A.addClass(\"position_below\").removeClass(\"position_above\").removeClass(\"position_inline\");A.css({top:B,left:this._getLeftPosition(A,C,D)+E.left})},_positionInline:function(A,B,D,C){A.css(\"top\",D.top+C.top).addClass(\"position_inline\").removeClass(\"position_below\").removeClass(\"position_above\")},_getLeftPosition:function(A,B,C){return Math.round(C.left+(B.width()/2))}};var updateCount=function(A,F,D){try{var E=$(A);var C=parseInt(E.html().replace(/[^0-9]/g,\"\"))+F;return setCount(A,C,D)}catch(B){return false}};var setCount=function(A,C,D){try{var E=$(A);if(D){E.fadeOut(D,function(){E.html(numberWithDelimiter(C)).fadeIn(D)})}else{E.html(numberWithDelimiter(C))}return C}catch(B){return false}};var updateFollowingCount=function(A){return updateCount(\"#following_count\",A)};var updateFollowersCount=function(A){return updateCount(\"#follower_count\",A)};twttr.forbiddenAccess={decider:function(A){twttr.forbiddenAccess.unauthed(A)},unauthed:function(req){var message;try{message=eval(\"(\"+req.responseText+\")\").error}catch(err){}if(!message){if(req.status==403){message=_(\"You are not authorized to perform this operation.\")}}if(message){new ShortNotification().setMessage(message).show()}},revoked:function(){window.location.reload()}};twttr.isReplyOnlyTweet=function(A){var B=/^\\@([a-zA-Z0-9_]{1,20})\\s*$/;if(A.match(B)){return true}return false};$.fn.isAlertBox=function(){return this.each(function(){var A=$(this);A.find(\"a\").click(function(){var B=$(this).attr(\"href\");$.ajax({type:\"POST\",dataType:\"text\",data:{authenticity_token:twttr.form_authenticity_token},url:\"/account/clear_user_alert\",success:function(){A.slideUp(\"fast\");window.location=B}});return false})})};$.fn.isUpdateForm=function(){return this.each(function(){var O=$(this);var H=O.find(\"textarea\").isCharCounter();var A=O.find(\"#tweeting_button, #update-submit\");var B=O.find(\"label.doing\");var J=O.find(\".char-counter\");var F=/^\\s*@(\\w+)\\W+/;var D=/^\\s*[dD][mM]?\\s+(?:(\\w+)\\W+)?/;var I=O.find(\".places-nearby\");var E;var N=false;function M(){var P=H.val();if(twttr.isReplyOnlyTweet(P)){location.href=RegExp.$1;return false}if(P.length>140){alert(_(\"That tweet is over 140 characters!\"));return false}else{if(P.replace(/s\\*/g,\"\")==\"\"){return false}else{A.addClass(\"btn-disabled\").attr(\"disabled\",true);return true}}}A.bind(\"click\",function(Q){var P=$(this);Q.preventDefault();if(!P.hasClass(\"btn-disabled\")){P.closest(\"form\").submit()}});function K(P){if(twttr.is.def(P.users)){twttr.Tweeter.merge(P.users,true)}A.removeClass(\"btn-disabled\").removeAttr(\"disabled\");var Q=P.text;if(P.messageForFlash){(new ShortNotification()).setMessage(P.messageForFlash).show()}else{if(P.errorForFlash){(new InfoNotification()).setMessage(P.errorForFlash).show()}else{if($(\"body\").attr(\"id\")!=\"home\"){(new ShortNotification()).setMessage(_(\"Your status has been updated!\")).show()}else{if(P.status_li){$(\"#timeline tr.hentry:first\").removeClass(\"latest-status\");$.Timeline.prepend(P.status_li)}}setCount(\"#update_count\",P.status_count,250);if(P.latest_status){updateTimeAgo();$(\"#latest_status\").html(P.latest_status).isCurrentStatus(true)}}}H.val(\"\").focusEnd();$(\"#in_reply_to_status_id\").val(\"\");$(\"#in_reply_to\").val(\"\");C(\"\");H.trigger(\"change\");J.removeClass(\"loading\");if(document.all){J.text(\"140\")}else{J.css(\"color\",\"#ccc\")}}function C(Q){var P;if(P=Q.match(D)){B.html(P[1]?_(\"Direct message %{person}:\",{person:P[1]}):_(\"Direct message:\"));A.val(_(\"send\"))}else{if(P=Q.match(F)){B.html(_(\"Reply to %{screen_name}:\",{screen_name:P[1]}));A.val(_(\"reply\"))}else{B.html(_(\"Whatâs happening?\"));A.val(_(\"update\"))}}}H.bind(\"keyup blur focus\",function(){C($(this).val())});O.submit(function(){if(M()){twttr.googleAnalytics(\"/status/update/refresh\");var T=H.val();E={authenticity_token:twttr.form_authenticity_token,status:T,twttr:true};var Q=window.location.href;if($(\"body\").attr(\"id\")==\"home\"&&((Q.indexOf(\"page=\")==-1)||Q.match(/page=1(?!\\d)/))){E.return_rendered_status=true}var P=$(\"#in_reply_to_status_id\").val();var S;if(P&&(S=T.match(F))){if(S[1]==$(\"#in_reply_to\").val()){E.in_reply_to_status_id=P}}var R=$(\"#source\").val();if(R){E.source=R}E.lat=$(\"#lat\").val();E[\"long\"]=$(\"#long\").val();E.place_id=$(\"#place_id\").val();G(E)}return false});function G(P){$.ajax({type:\"POST\",dataType:\"json\",url:\"/status/update\",data:P,beforeSend:function(){J.addClass(\"loading\");if(document.all){J.html(\"&nbsp;&nbsp;&nbsp;&nbsp;\")}else{J.css(\"color\",\"transparent\")}},success:K,error:twttr.forbiddenAccess.decider})}try{H.focusEnd()}catch(L){}})};$.fn.isLocationTrends=function(){var A=$(\"div#trends\").meta()[\"global_id\"];return this.each(function(){var I=$(this);var G=$(\"#location_menu\");var B=$(\"#change_location\");var L=$(\"#trends .trends-links\");var E=new twttr.AttachedDialog($(\"#tt_menu span\"),{content:$(\"#local_trends\"),width:\"545px\",gravity:\"east\",weight:\"top\",modal:false});$(document).click(function(N){var M=$(N.target);if(E.opened&&!M.parents(\".modal, .trends-links li\").length){E.close()}});E.find(\"#location_done\").click(function(){E.close();B.removeClass(\"active\");if(!F()){D(A)}});var K=false;if($(\"#local_trends_notice\").length){setTimeout(function(){(K=new twttr.AttachedDialog($(\"#tt_menu span\"),{content:$(\"#local_trends_notice\").parent(),width:\"186px\",gravity:\"east\",weight:\"top\",openonload:true,closeButton:true,modal:false})).bind(\"close\",function(){D(A);return false}).open();K.find(\"#location_notice_set\").click(function(){D(A);K.close();E.open();return false})},500)}function H(P){E.find(\"a.active-parent\").removeClass(\"active-parent\");var M=$(P).attr(\"parents\");if(M){var N=M.split(\" \");for(var O=0;O<N.length;O++){$(\".\"+N[O]).addClass(\"active-parent\")}}}function F(){return G.find(\"em\")}function D(M){if(!M){M=0}$.ajax({type:\"POST\",url:\"/users/update_trend_location_id\",data:{authenticity_token:twttr.form_authenticity_token,trend_location_id:M},success:function(){L.append($(\"<em></em>\").append(M))}});return false}B.click(function(){E.toggle();if(K){K.close()}B.toggleClass(\"active\");return false});E.find(\"a\").click(function(){var M=$(this);var N=M.attr(\"id\").replace(\"trend_loc_\",\"\");E.find(\".active\").removeClass(\"active\");E.find(\"#trend_loc_\"+N).parent().addClass(\"active\");H(M);if(N){$.ajax({type:\"GET\",dataType:\"json\",url:\"/users/location_trends\",data:{twttr:true,trend_location_id:N},beforeSend:function(){$(\"#trends_loading\").show()},success:function(O){L.hide();L.fadeIn();$(\"#trends_loading\").hide();if(O){var P=[];L.html(\"\");$.each(O.trends,function(){var Q=this;var T=Q.name;var S=$('<a class=\"search_link\" href=\"/search?q='+encodeURIComponent(Q.query)+'\"name=\"'+T+'\" title=\"'+T+'\">'+T+\"</a>\");S.isSearchLink();var R=Q.description;if(R){L.append($(\"<li></li>\").append(S).append($(\"<em></em>\").append(R)))}else{L.append($(\"<li></li>\").append(S))}});G.html(O.location[\"name\"]);loadTrendDescriptions();D(O.location[\"id\"])}else{}},error:function(O){$.debug(\"error: \"+O.responseText)},complete:function(){$(\"#trends_loading\").hide()}})}return false});var C=F();if(C){var J=$(\"#trend_loc_\"+C);J.parent().addClass(\"active\");H(J)}})};$.fn.isDirectMessageForm=function(){return this.each(function(){var L=$(this);var D=L.find(\"textarea\").isCharCounter();var B=/^\\s*[dD][mM]?\\s+([A-Za-z0-9]{1,20})[^A-Za-z0-9]/;var F=L.find(\"select\");var A=L.find(\"#dm-submit\");var E=L.find(\".char-counter\");var G=\"\";L.find(\"input[type=submit]\").attr(\"disabled\",\"disabled\").addClass(\"btn-disabled\");try{D.focusEnd()}catch(I){}function C(N){if(F.val()){return }if((matches=N.match(B))&&matches[1]&&(G!=matches[1])){var M=true;F.find(\"option\").each(function(){if(this.innerHTML.toLowerCase()==matches[1].toLowerCase()){F.val(this.value);M=false;return false}});if(M){F.append(_('<option value=\"%{screen_name}\">%{screen_name}</option>',{screen_name:matches[1]}));F.val(matches[1])}G=matches[1]}}A.click(function(M){var P=D.val();var N=P.match(B);var O=F.find(\"option[value=\"+F.val()+\"]\");if(N&&N[1]&&N[1].toLowerCase()==O.text().toLowerCase()){D.val(P.replace(B,\"\"))}return true});F.change(function(M){D.trigger(\"update\",M)});D.bind(\"keyup blur focus\",function(M){C($(this).val());D.trigger(\"update\",M)});function H(M){(new ShortNotification()).setMessage(M.messageForFlash).show();if($(\"body\").attr(\"id\")==\"sent\"){$.Timeline.prepend(M.direct_message_li)}D.val(\"\");F.val(\"\");G=\"\";D.trigger(\"change\");E.removeClass(\"loading\");if(document.all){E.text(\"140\")}else{E.css(\"color\",\"#ccc\")}}if(F.length>0){function J(){if(F.length&&(F.find(\"option\").length==0)){$.ajax({type:\"GET\",dataType:\"json\",url:\"/direct_messages/recipients_list\",data:{twttr:true},success:function(N){if(N){var M=[];$.each(N,function(){var O=this;if((O.length>1)&&O[0]&&O[1]){M.push('<option value=\"'+O[0]+'\">'+O[1]+\"</option>\")}});F.html('<option value=\"\" selected=\"selected\"></option>'+M.join(\"\"))}},error:function(M){$.debug(\"error: \"+M.responseText)}})}}var K=$(\"body\").attr(\"id\");if(K==\"direct_messages\"||K==\"inbox\"||K==\"sent\"){J()}L.bind(\"loadrecipients\",null,function(M){J()});L.submit(function(){twttr.googleAnalytics(\"/direct_messages/create/refresh\");var N=D.val();var M={authenticity_token:twttr.form_authenticity_token,text:N,\"user[id]\":F.val(),twttr:true};$.ajax({type:\"POST\",dataType:\"json\",url:\"/direct_messages/create\",data:M,beforeSend:function(){E.addClass(\"loading\");if(document.all){E.text(\"\")}else{E.css(\"color\",\"transparent\")}},success:H,error:twttr.forbiddenAccess.decider});return false})}})};$.fn.isTimelineTabLink=function(){return this.each(function(){var A=$(this);A.click(function(B){document.body.id=A.meta().dispatch_action}).bind(\"loading\",null,function(B){A.parent(\"li\").addClass(\"loading\")}).bind(\"loaded\",null,function(B){A.parent(\"li\").removeClass(\"loading\")}).bind(\"aborted\",null,function(B){A.parent(\"li\").removeClass(\"loading\")})})};$.fn.isEmbeddedMediaExpander=function(){return this.livequery(function(){var A=$(this);var B=A.parent().find(\".embedded_media\");A.click(function(){B.slideToggle(\"normal\",function(){if(A.hasClass(\"embedded_media_icon_active\")){A.removeClass(\"embedded_media_icon_active\")}else{A.addClass(\"embedded_media_icon_active\")}})})})};$.fn.isCharCounter=function(){return this.each(function(){var A=true;var F=$(this);var J=F.closest(\"form\");var E=J.find(\".char-counter\");var H=J.find(\"#tweeting_button, #update-submit, #dm-submit\");var D=J.find(\"select\");function C(){H.addClass(\"btn-disabled\").attr(\"disabled\",\"disabled\");A=true}function G(){if(A){H.removeClass(\"btn-disabled\").removeAttr(\"disabled\");A=false}}function B(){var L=F.val();var K=L.length;E.html(\"\"+(140-K));if(K<=0){E.css(\"color\",\"#cccccc\");C()}else{if(K<=140&&(D.length==0||D.val())){G()}else{C()}if(K>130){E.css(\"color\",\"#d40d12\")}else{if(K>120){E.css(\"color\",\"#5c0002\")}else{E.css(\"color\",\"#cccccc\")}}}}var I=\"blur focus change \"+($.browser.mozilla?\"paste input\":\"keyup\");F.bind(I,function(K){B()});D.change(function(K){B()});F.focus()})};$.fn.isCurrentStatus=function(A){return this.each(function(){var F=$(this);var I=$(\"#latest_status\");var C=F.find(\"#latest_text\");var E=C.find(\".status-text\");var D=$(this).parent(\"#update_notifications\");var H=I.find(\"strong\");$(\"#latest_text_full, #latest_text\").click(function(){$(\"#latest_text_full, #latest_text\").toggle()});C.css(\"color\",\"transparent\");var B=$(\"#latest_text_full .status-text\").text();$(\"#latest_text .status-text\").html(\"<strong>\"+_(\"Latest: \")+\"</strong>\").append(B.escapeHTML());C.css(\"color\",\"\");if(A){var G=I.find(\"span, strong\");G.each(function(){$(this).data(\"old_color\",$(this).css(\"color\")).animate({color:\"#333\"},500)});clearTimeout(twttr.timeouts.latest_status_timeout);twttr.timeouts.latest_status_timeout=setTimeout(function(){G.each(function(){$(this).animate({color:$(this).data(\"old_color\")},1500,function(){$(this).css(\"color\",\"\")})})},1500)}})};function initializeTimeline(){$.Statuses.initialize($(\"#timeline\"))}function getListItemFromChild(A){return A.parents(\".hentry:first\")}function getStatusIdFromListItem(B){var A=/status_(.*)/i.exec(B.attr(\"id\"));return(A)?A[1]:null}function getScreenNameFromListItem(B){var A=/u-([A-Za-z0-9_]+)/i.exec(B.attr(\"class\"));return(A)?A[1]:null}function getShareIdFromListItem(B){var A=/(.)* s-([\\d]+)(.)*/i.exec(B.attr(\"class\"));return(A)?A[2]:getStatusIdFromListItem(B)}function timelineRefresh(D,A){var C=$(\"#results_update\");if(C.length==0){return }if(!D||((\"home,replies,inbox\".indexOf(D)==-1)&&!D.match(/^\\/?list/))){return }if(!A){A=($(\"#results_update\").attr(\"href\").replace(/^\\//,\"\")||window.location.hash.replace(/^#/,\"\")||D).replace(/^([^\\/])/,\"/$1\")}A=A.replace(/\\/?list\\//,\"/\");var B=$(\"#new_results_notification\").meta().timeline;$(\"#new_results_notification\").data(\"count\",0);if(page.timelineRefresher){if(page.timelineRefresher.dispatchAction==D){return }else{page.timelineRefresher.stop()}}page.newResults=null;page.timelineRefresher=new Occasionally(B.delay*1000,B.max_delay*1000,function(){var E=false;if($(\"ol#timeline\").length){$.ajax({method:\"GET\",dataType:\"json\",url:A,data:{since_id:getMaxStatusIdFromTimeline(),refresh:true},success:function(F){processTimelineRefresh(F,D)},error:function(){if(page.timelineRefresher){page.timelineRefresher.stop();page.timelineRefresher=null}}})}},function(){return page.newResults},B.decay);page.timelineRefresher.dispatchAction=D;page.timelineRefresher.start()}function getMaxStatusIdFromTimeline(){var A=0;$(\"ol#timeline > li\").each(function(){var B=parseInt(this.id.replace(/^[A-Z_]+/gi,\"\"));if(A<B){A=B}});return A}function processTimelineRefresh(J,D){if(twttr.is.def(J.users)){twttr.Tweeter.merge(J.users)}var G=$(\"#new_results_notification\").meta().timeline;var K=$(\"<div>\"+J[\"#timeline\"]+\"</div>\");var A=$(\"#content ol#timeline\");K.find(\"#timeline > li\").each(function(){if(A.find(\"li#\"+this.id).length){$(this).remove()}});var F=K.find(\"ol > li\");var C=F.length;var E=($(\"#new_results_notification\").data(\"count\")||0)+C;if(C){A.prepend(F.addClass(\"buffered\"));K.remove();A.find(\"li.buffered:gt(\"+(G.max_refresh_size-1)+\")\").remove();var B={results_count:numberWithDelimiter(E),username:getCurrentUserScreenName()};var H=$(\"#results_update\").is(\":visible\")?\"\":' style=\"display:none;\"';var I='<a id=\"results_update\" class=\"minor-notification\" href=\"/'+D+'\" accesskey=\"n\"'+H+\">\";if(D==\"inbox\"){I+=((E==1)?_(\"1 new message.\"):_(\"%{results_count} new messages.\",B))}else{if(D==\"replies\"){I+=((E==1)?_(\"1 new mention of @%{username}.\",B):_(\"%{results_count} new mentions of @%{username}.\",B))}else{I+=((E==1)?_(\"1 new tweet.\"):_(\"%{results_count} new tweets.\",B))}}I+=\"</a>\";$(\"#results_update\").replaceWith(I);$(\"#results_update\").click(function(){$(\"#content ol#timeline > li.buffered\").addClass(\"unbuffered\").removeClass(\"buffered\");if($(\"#new_results_notification\").data(\"count\")>G.max_refresh_size){$(\"#content ol#timeline > li:not(.unbuffered)\").remove();var M=$(\"#content ol#timeline > li\").attr(\"id\").replace(/^[^0-9]+/,\"\");var L=($(\"#results_update\").attr(\"href\")||window.location.hash||D).replace(/^([^\\/])/,\"/$1\")+\"?max_id=\"+M+\"&page=3&twttr=true\";$(\"#pagination\").html('<div id=\"#pagination\"><a id=\"more\" class=\"round more\" rel=\"next\" href=\"'+L+'\">'+_(\"more\")+\"</a></div>\")}else{$(\"#content ol#timeline > li.last-on-refresh\").removeClass(\"last-on-refresh\");$(\"#content ol#timeline > li.unbuffered:last\").addClass(\"last-on-refresh\")}updateTimeAgo();$(\"#content ol#timeline > li.unbuffered\").removeClass(\"unbuffered\");$(\"#results_update\").hide();addCountToDocumentTitle();$.Timeline.triggerPageHeightChangedEvent();$(\"#new_results_notification\").data(\"count\",0);return false});$(\"#new_results_notification\").data(\"count\",E);$(\"#results_update:hidden\").slideDown(\"normal\",function(){$.Timeline.triggerPageHeightChangedEvent();var L=$(this);if(twttr.is.def(twttr.HOVERCARD)){twttr.HOVERCARD.reposition(L.get(0).offsetHeight+parseInt(L.css(\"margin-top\")))}});addCountToDocumentTitle(E)}else{K.remove()}page.newResults=(C>0)}$(document).ready(function(){$().Page();twttr.setDefaultBucket();initializeTimeline();$(\"#pagination #more\").isMoreButton();$(\"body\").bind(\"ajaxSuccess\",twttr.setupRetweetTips);twttr.setupRetweetTips();$(\"span.byline a\").tipsy({gravity:\"n\"})});twttr.augmentObject(twttr,{RETWEETING_BACKGROUND_COLOR:\"#ffffe5\",_bucket:null,setDefaultBucket:function(){this._bucket=parseInt(page.sessionUserId)%2},getBucket:function(){return this._bucket},setBucket:function(A){this._bucket=A},applyTipsy:function(A,C,B){if(!A.data(\"tipsy_applied\")){A.data(\"tipsy_applied\",true);A.attr(\"title\",A.attr(\"title\")+C);A.tipsy(B)}},isRetweetTimeline:function(){return !!(location.hash&&location.hash.match(/retweet/))},setupRetweetTips:function(){$(\"span.status-body span.shared-content a.screen-name, div.shared-by-avatar-tiles a.profile-pic img.photo\").each(function(){var A=$(this);if(A.data(\"tipsy_applied\")||!twttr.isRetweetTimeline()){return }var B=\"left-align\";var C=\"\";if($(\"body#home\").length>0&&!A.hasClass(\"you\")){var C=_('<div class=\"retweet_tip_tip\">Tip: To hide/show retweets from this user, click on their username and look for the retweet setting <div class=\"retweet-icon\"></div></div>');B+=\" retweet-tooltip\"}twttr.applyTipsy(A,C,{gravity:\"l\",hideTimeout:10000,additionalCSSClass:B})});$(\"span.big-retweet-icon\").each(function(){if($(\"body#profile\").length==0){twttr.applyTipsy($(this),\"\",{gravity:\"s\",hideTimeout:10000})}else{$(this).attr(\"title\",\"\")}})},getStatusBodyParent:function(A){return A.parents(\".status-body\").parent()},setRetweetingStyles:function(B,E,D){var A=getListItemFromChild(B);var C=twttr.getStatusBodyParent(B);C.append(\"<span class='retweeting loading'>\"+E+\"</span>\");A.addClass(\"no-hover\");if($(\"body.status\").length==0){A.css(\"background-color\",twttr.RETWEETING_BACKGROUND_COLOR)}},unsetRetweetingStyles:function(B){var A=getListItemFromChild(B);var C=twttr.getStatusBodyParent(B);A.removeClass(\"no-hover\");C.find(\".retweeting.loading\").remove()},animateStatusReplacement:function(B,D){var C=getListItemFromChild(B);var F=$(D.status_li);F.hide();C.after(F);if(C.hasClass(\"latest-status\")){F.addClass(\"latest-status\")}var A=F.height();var E=C.height();F.remove().show().height(E);if($(\"body.status\").length==0){F.css(\"background-color\",twttr.RETWEETING_BACKGROUND_COLOR)}C.replaceWith(F);if(A!=E){F.animate({height:A},500,function(){F.css(\"height\",null);twttr.animateStatusColorChange(F)})}else{twttr.animateStatusColorChange(F)}if(D.latest_status){$(\"#latest_status\").html(D.latest_status).isCurrentStatus(true)}},animateStatusColorChange:function(A){A.animate({backgroundColor:\"#FFF\"},1500,function(){A.css(\"background-color\",null)})}});$.fn.Page=function(){var A=$('meta[name=\"session-user-screen_name\"]:first').get(0);var D=$('meta[name=\"page-user-screen_name\"]:first').get(0);var B=$('meta[name=\"session-userid\"]:first').get(0);var C=A&&D&&A.content==D.content;if(typeof (page)==\"undefined\"){page={}}page=$.extend(page,{timeline:null,sessionUserScreenName:(A?A.content:null),sessionUserId:(B?B.content:null),pageUserScreenName:(D?D.content:null),loggedIn:$('meta[name=\"session-loggedin\"][content=\"y\"]').length>0,hideUnfavorited:C,isTimelineChange:false,currentTimelineChange:{},$oldTimelineLink:\"\"})};$.Statuses={initialize:function(A){if(page.loggedIn){var B=$(A).find(\".hentry\");$.each($.Statuses.actions,function(){var C=this;C.apply(B)})}},actions:{isTweet:function(){this.livequery(function(){var A=$(\"body#show.status\").length>0;var B=$(\"body#profile\").length>0;if(!A&&!B){var C=$(this).find(\"a.hashtag\");C.isSearchLink(SEARCH_CALLBACKS.hashtagLink)}})},isHoverable:function(){if($(\"body.ie,body.ie6\").get(0)){this.livequery(function(){var A=$(this);A.hover(function(){A.addClass(\"hover\")},function(){A.removeClass(\"hover\")})})}},isFavoriteable:function(){this.find(\".fav-action\").live(\"click\",function(){var D=$(this);if(D.hasClass(\"blocked\")){return false}var B=D.parents(\".hentry:first\");var E=B.attr(\"id\").replace(/status_/,\"\");var C=D.hasClass(\"fav\")?\"destroy\":\"create\";twttr.googleAnalytics(\"/favorites/\"+C+\"/refresh/\"+E);function A(){var F=D.hasClass(\"fav\");D.removeClass(F?\"fav\":\"non-fav\").addClass(F?\"non-fav\":\"fav\").attr(\"title\",(F?_(\"favorite this tweet\"):_(\"un-favorite this tweet\")))}$.ajax({type:\"POST\",dataType:\"json\",url:\"/favorites/\"+C+\"/\"+E,data:{authenticity_token:twttr.form_authenticity_token},beforeSend:function(){A();D.addClass(\"blocked\")},complete:function(){D.removeClass(\"blocked\")}});return false})},isReplyable:function(){this.find(\".reply\").live(\"click\",function(){var E=$(this);var C=E.parents(\".hentry:first\");var G=C.attr(\"id\").replace(/status_/,\"\");var A=C.attr(\"class\").match(/u-([A-Za-z0-9_]+)/);var B=A[1];if(!B){alert(_(\"Whoops! Something went wrong. Please refresh the page and try again!\"));return }if(C.hasClass(\"direct_message\")){var F=$(\"#text\");twttr.googleAnalytics(\"/direct_messages/reply/\"+B+\"/\"+G);var D=$(\"#direct_message_user_id\");if(!D.find(\"option[text='\"+B+\"']\").attr(\"selected\",true).length){D.append('<option value=\"'+B+'\" selected=\"selected\">'+B+\"</option>\")}F.trigger(\"update\");$(\"#text\").focusEnd()}else{if(C.hasClass(\"status\")||C.hasClass(\"share\")){var F=$(\"#status\");twttr.googleAnalytics(\"/reply/\"+B+\"/\"+G);if(F.size()){F.val(\"@\"+B+\" \"+F.val().replace(RegExp(\"@\"+B+\" ?\",\"i\"),\"\")).trigger(\"update\");$(\"#status\").focusEnd();$(\"#in_reply_to_status_id\").val(G);$(\"#in_reply_to\").val(B);window.scroll(0,0)}else{window.location=E.find(\"a\").attr(\"href\");return false}}}window.scroll(0,0);return false})},isRetweetable:function(){this.find(\".retweet-link\").live(\"click\",function(A){new RetweetInlineForm().show({targetNode:$(this)});A.preventDefault()})},isDeleteable:function(){this.find(\".del\").live(\"click\",function(D){var C=$(this);var A=C.parents(\".hentry:first\");var F=A.attr(\"id\").replace(/[^\\d]*/,\"\");var E=A.hasClass(\"latest-status\");var B;if(A.hasClass(\"direct_message\")){B=\"/direct_messages/destroy\"}else{B=\"/status/destroy\"}if(confirm(_(\"Sure you want to delete this tweet? There is NO undo!\"))){twttr.googleAnalytics(B+\"/refresh/\"+F);$.ajax({type:\"POST\",url:B+\"/\"+F,data:{authenticity_token:twttr.form_authenticity_token,latest_status:E},dataType:(B==\"/status/destroy\"?\"json\":null),beforeSend:function(){A.fadeOut(500);updateCount(\"#update_count\",-1,250)},success:function(G){A.remove();if(B==\"/status/destroy\"){if(E){twttr.processJson(G);updateLatest()}}setCount(\"#update_count\",G.status_count)},error:function(){A.fadeIn(0);(new InfoNotification()).setMessage(_(\"Whoops! Something went wrong. Please try again!\")).show()}})}D.preventDefault()})},isUndoable:function(){this.find(\".undo\").live(\"click\",function(){var C=$(this);var B=C.parents(\".hentry:first\");var A=B.attr(\"id\").replace(/status_/,\"\");$.ajax({type:\"POST\",url:\"/statuses/\"+A+\"/retweet\",data:{_method:\"delete\",authenticity_token:twttr.form_authenticity_token,controller_name:page.controller_name,action_name:page.action_name,user_screenname:page.pageUserScreenName},dataType:\"json\",beforeSend:function(){C.attr(\"title\",\"\").removeClass(\"undo\");twttr.setRetweetingStyles(C,_(\"Undoing...\"))},success:function(D){if(D.status_li){twttr.animateStatusReplacement(C,D)}else{B.fadeOut(500,function(){var E=$(\"ol#timeline .hentry:visible:first\");if(!E.hasClass(\"share\")){E.addClass(\"latest-status\")}})}(new InfoNotification()).setMessage(_(\"Your followers will no longer see the tweet as retweeted by you.\")).show()},complete:function(){twttr.unsetRetweetingStyles(B)}});return false})},isMappable:function(){this.find(\".geo_pin\").live(\"click\",function(){var B=jQuery(this);var A=B.next();var C=B.position();A.css({left:C.left-25,bottom:C.top+20});A.show();A.find(\".map_close\").click(function(){A.hide();return false})})}}};$.Timeline={prepend:function(A){$(\"#timeline\").prepend(A);$.Timeline.triggerTimelineChanged()},append:function(A){$(\"#timeline\").append(A);$.Timeline.triggerTimelineChanged()},registerTimelineEvent:function(A){$(\"body\").bind(\"timeline-changed\",A)},unregisterTimelineEvent:function(A){$(\"body\").unbind(\"timeline-changed\",A)},triggerTimelineChanged:function(){$(\"body\").trigger(\"timeline-changed\")},registerPageHeightChangedEvent:function(A){$(\"body\").bind(\"page-height-changed\",A)},unregisterPageHeightChangedEvent:function(A){$(\"body\").unbind(\"page-height-changed\",A)},triggerPageHeightChangedEvent:function(){$(\"body\").trigger(\"page-height-changed\")}};function basicMoreButtonHandler(A){return function(){var C=$(this);C.blur();if(C.hasClass(\"loading\")){return false}var B=C.attr(\"href\");var D=$(\"#more\").text();$.ajax(jQuery.extend({type:\"GET\",url:B,dataType:\"json\"},A));return false}}$.fn.isMoreButton=function(){return this.live(\"click\",basicMoreButtonHandler({beforeSend:function(){$(\"#timeline li:last-child\").addClass(\"last-on-page\");$(\"#more\").addClass(\"loading\").html(\"\")},success:function(A){updateTimeAgo();if(twttr.is.def(A.users)){twttr.Tweeter.merge(A.users)}$(\"#timeline\").append($(A[\"#timeline\"]).find(\".hentry\"));$(\"#pagination\").html(A[\"#pagination\"]);if(window.onPageChange){onPageChange()}$.Timeline.triggerTimelineChanged()},error:function(){$(\"#timeline li:last-child\").removeClass(\"last-on-page\");$(\"#more\").removeClass(\"loading\").text(_(\"more\"));(new ShortNotification()).setMessage(_(\"Whoops! Something went wrong. Please try again!\")).show()}}))};$(function(){var request=function(data,success){return function(){var self=this;var $this=$(this);var notification=(new ProgressNotification()).setProgressMessage($this.attr(\"progress\")).setCompletedMessage($this.attr(\"completed\"));$.ajax({type:$this.attr(\"method\"),dataType:\"json\",url:$this.attr(\"href\")||$this.attr(\"action\"),data:data.apply(self),success:function(){notification.done();if(success){success.apply(self)}},beforeSend:function(){twttr.loading();notification.show()},complete:twttr.loaded});return false}};$(\"form.restful\").livequery(\"submit\",request(function(){return $(this).serializeArray()},function(){$(this).trigger(\"submitted\")}));$(\"a.restful\").livequery(\"click\",request(function(){return eval(\"(\"+$(this).attr(\"data\")+\")\")}))});function updateLatest(){var A=$(\"#latest_status\");if(A.length){A.isCurrentStatus(true)}$(\"#timeline li:first\").addClass(\"latest-status\")}function setTitleAndHeading(C){var K=$(\"#timeline_heading h1\");var I=$(\"#timeline_heading h2\");var C=C||$(\"body\").attr(\"id\");var A=h(page.query);var D=getCurrentUserScreenName();if(!twttr.titles_and_headings){var H={user:D,name:page.user_fullname};twttr.titles_and_headings={home:{title:_(\"Home\"),heading:_(\"Home\")},replies:{title:(\"@\"+D),heading:_(\"Tweets mentioning @%{user}\",H)},favorites:{title:_(\"Your Favorites\"),heading:_(\"Your Favorites\")},inbox:{title:_(\"Direct Messages\"),heading:_(\"Direct messages sent only to you\")},direct_messages:{title:_(\"Direct Messages\"),heading:_(\"Direct messages sent only to you\")},sent:{title:_(\"Sent Direct Messages\"),heading:_(\"Direct messages you've sent\")},retweets_by_others:{title:_(\"Retweets\",H),heading:\"&nbsp;\"},profile_favorites:{title:_(\"%{user}'s Favorites\",H),heading:_(\"%{user}'s Favorites\",H)},profile:{title:_(\"%{name} (%{user}) on Twitter\",H),heading:null}}}var E;if(C==\"search\"){E={title:_(\"Search - %{query}\",{query:page.query})};var B=$(\"#side #saved_searches ul.sidebar-menu li.active\");var J;if(B.length){var F=B.attr(\"id\").replace(\"ss_\",\"\");J='<a href=\"/saved_searches/destroy/'+F+'\" title=\"'+A+'\" class=\"delete-search-link\">'+_(\"Remove this saved search\")+\"</a></label>\"}else{J='<a href=\"/saved_searches/create\" class=\"save-search-link\" title=\"'+A+'\">'+_(\"Save this search\")}J=\"<label>\"+J+\"</a></label>\";if(page.searchResults){E.heading=J+_(\"Real-time results for <b>%{query}</b>\",{query:A})}else{E.heading=J+_(\"No results for <b>%{query}</b>\",{query:A})}}else{E=twttr.titles_and_headings[C]}if(E){var G=(C==\"profile\")?\"\":\"Twitter / \";setDocumentTitle(G+E.title);I.remove();if(E.heading){K.html(E.heading);K.parent(\"div\").show()}else{K.parent(\"div\").hide()}if(C==\"search\"){K.find(\".save-search-link\").isSaveSearchLink().end().find(\".delete-search-link\").isRemoveSearchLink()}}}$.fn.isSaveSearchLink=function(){return this.each(function(){var A=$(this);var B=$(\"#saved_searches\");var C=B.find(\"ul.sidebar-menu\");A.click(function(){if(C.find(\"li\").length>=10){(new InfoNotification()).setMessage(_(\"You can only save ten searches. To remove a saved search, select the search and click <strong>remove this saved search</strong>.\")).show();return false}var E=A.attr(\"title\");var D=$('<li><a href=\"/search?q='+encodeURIComponent(E)+'\" class=\"search-link\" title=\"'+h(E)+'\"><span>'+h(E)+\"</span></a></li>\");D.find(\"a\").isSearchLink(SEARCH_CALLBACKS.savedSearchLink);D.fadeOut(1,function(){C.append(D);D.fadeIn(100)});if(B.hasClass(\"collapsed\")){B.trigger(\"expand\")}B.fadeIn();$(\"#side ul.sidebar-menu li\").removeClass(\"active\");$(\"#side #custom_search\").removeClass(\"active\");D.addClass(\"active\");$.ajax({type:\"POST\",dataType:\"json\",url:\"/saved_searches/create\",data:{q:E,authenticity_token:twttr.form_authenticity_token,twttr:true},beforeSend:function(){A.replaceWith('<span class=\"loading\">'+_(\"Save this search\")+\"</span>\")},success:function(F){D.attr(\"id\",\"ss_\"+F.id);setTitleAndHeading(\"search\")},error:function(F){(new InfoNotification()).setMessage(F.responseText).show();D.remove()}});return false})})};$.fn.isRemoveSearchLink=function(){return this.each(function(){var A=$(this);var C=A.attr(\"title\");var B=A.attr(\"href\");A.click(function(){var D=$(\"#side #saved_searches li a[title='\"+C+\"']\").parent(\"li\");D.fadeOut(100,function(){D.remove();var E=$(\"#saved_searches ul.sidebar-menu a\");if(E.length==0){$(\"#saved_searches\").hide()}setTitleAndHeading(\"search\");$(\"#side #custom_search\").addClass(\"active\")});$.ajax({type:\"POST\",url:B,data:{authenticity_token:twttr.form_authenticity_token,twttr:true},beforeSend:function(){A.replaceWith('<span class=\"loading\">'+_(\"Remove this saved search\")+\"</span>\")},error:function(){(new InfoNotification()).setMessage(_(\"Whoops! Something went wrong. Please refresh the page and try again!\")).show()}});return false})})};function initializePage(A){if((\"home,search\".indexOf(A)==-1)&&($(\"body#list_show\").length==0)){twttr.updateLocation(A)}initializeSidebar();$(\"#side form#sidebar_search\").isSearchForm();$(\"#side .collapsible\").isCollapsibleMenu();onPageChange(true);timelineRefresh(A);$(\".saved-search-links li a\").isSearchLink(SEARCH_CALLBACKS.savedSearchLink);$(\".trends-links li a\").isSearchLink(SEARCH_CALLBACKS.trendLink);$(\"#dm_tabs a, #retweet_tabs a\").isTimelineTabLink();$(\"div.bulletin\").isBulletin();$(\"ul.sidebar-menu a\").isSidebarTab()}function initializeSidebar(){if($(\"#side ul.sidebar-menu li.active\").length==0){var B=$(\"body\").attr(\"id\");var A=null;if(B==\"search\"){B=page.query;if(B){var C=$.grep($(\"#side ul.sidebar-menu li a\"),function(D){return $(D).attr(\"title\")==page.query})[0];if(C){A=$(C).parent(\"li\")}else{$(\"#side #custom_search\").addClass(\"active\")}}}else{if(B){if(B==\"sent\"||B==\"inbox\"){B=\"direct_messages\"}A=$(\"#side ul.sidebar-menu li#\"+B+\"_tab\")}}if(A&&A.length){$(A.get(0)).addClass(\"active\")}}}$.fn.isCollapsibleMenu=function(){function A(){var B=[];$(\"#side .collapsible\").each(function(){var C=$(this);var E=C.find(\"h2.sidebar-title\").attr(\"id\");if(E){E=E.replace(\"_menu\",\"\")}else{return true}var D=C.hasClass(\"collapsed\")?\"C\":\"O\";B.push(E+D)});$.cookie(\"menus\",B.join(\"_\"))}return this.each(function(){var D=$(this);var B=D.find(\"h2.sidebar-title\");function F(G){$.ajax({type:\"GET\",url:G,dataType:\"html\",beforeSend:function(){D.addClass(\"loading\")},success:function(H){D.find(\".sidebar-menu\").remove();B.after(H);C()},complete:function(){D.removeClass(\"loading\")}})}function C(){var G=D.find(\".sidebar-menu\");D.find(\"#friends_view_all\").fadeIn();G.slideDown(100,function(){D.removeClass(\"collapsed\");A()})}function E(){var G=D.find(\".sidebar-menu\");D.find(\"a.xref\").fadeOut(100);D.find(\"div#friends_view_all\").fadeOut(100);G.slideUp(100,function(){D.addClass(\"collapsed\");A()})}D.bind(\"expand\",function(){C()});D.bind(\"collapse\",function(){E()});B.click(function(H){if(H.target.nodeName.toLowerCase()==\"a\"){return true}var G=D.find(\"a.fetch-contents\");if(D.hasClass(\"collapsed\")){D.find(\"a.xref\").fadeIn(100);if(G.length){F(G.attr(\"href\"));G.remove()}else{C()}}else{E()}})})};$.fn.isSidebarTab=function(){return this.each(function(){var A=$(this);A.bind(\"click\",function(){A.trigger(\"active\")}).bind(\"active\",null,function(B){if(A.parents(\"#side\").length>0){$(window).scrollTop(0);$(\"#side ul.sidebar-menu li, #trends_list li\").removeClass(\"active\");$(\"#side #custom_search\").removeClass(\"active\");A.parent(\"li\").addClass(\"active\")}}).bind(\"loading\",null,function(B){A.parent(\"li\").addClass(\"loading\")}).bind(\"loaded\",null,function(B){A.parent(\"li\").removeClass(\"loading\")}).bind(\"aborted\",null,function(B){A.parent(\"li\").removeClass(\"loading\")})})};$.fn.isInPageLink=function(A){return this.each(function(){var B=$(this);var C=B.meta();var D=C.dispatch_action;B.click(function(G){var E=G.srcElement||G.originalTarget||G.target;if(E.tagName.toLowerCase()==\"em\"){G.stopImmediatePropagation();return true}if($.browser.msie){this.hideFocus=true}var F=B.attr(\"href\");page.query=\"\";if(page.isTimelineChange){page.currentTimelineChange.abort();page.$oldTimelineLink.trigger(\"aborted\")}page.currentTimelineChange=$.ajax({type:\"GET\",url:F,dataType:\"json\",beforeSend:function(){page.isTimelineChange=true;B.trigger(\"loading\");page.$oldTimelineLink=B},success:function(H){if(twttr.is.def(H.users)){twttr.Tweeter.merge(H.users)}twttr.processJson(H);twttr.updateLocation(D==\"list\"?\"/list\"+F:F);if(D){page.action_name=D;$(\"body\").attr(\"id\",D);if(D==\"direct_messages\"||D==\"inbox\"||D==\"sent\"){$(\"#direct_message_form\").trigger(\"loadrecipients\")}}if(page.timelineRefresher){page.timelineRefresher.stop();page.timelineRefresher=null}addCountToDocumentTitle();timelineRefresh(D,F);$.Timeline.triggerPageHeightChangedEvent()},complete:function(H){$(\"#sidebar_search_q\").val(\"\").blur();onPageChange();$(\"body\").addClass(\"replyable\");B.trigger(\"loaded\");page.isTimelineChange=false;if(A){A(B)}}});return false})})};function reloadTimeline(B){var A=(window.location.hash||B).toString().replace(/^#?([^\\/])/,\"/$1\").replace(/^\\/?list/,\"\");page.currentTimelineChange=$.ajax({type:\"GET\",url:A,dataType:\"json\",beforeSend:function(){page.isTimelineChange=true},success:function(C){if(twttr.is.def(C.users)){twttr.Tweeter.merge(C.users)}twttr.processJson(C);if(page.timelineRefresher){page.timelineRefresher.stop();page.timelineRefresher=null}addCountToDocumentTitle();timelineRefresh(B,A)},error:function(){(new InfoNotification()).setMessage(_(\"Whoops! Something went wrong. Please refresh the page and try again!\")).show()},complete:function(){$(\"#sidebar_search_q\").val(\"\").blur();onPageChange();$(\"body\").addClass(\"replyable\");initializeTimeline();$(\"#timeline\").removeClass(\"loading\");page.isTimelineChange=false;if(B.match(/\\/?list\\//)){var C=$(\".lists-links a[href=\"+h(A)+\"]\");$(\"#side ul.sidebar-menu li, #trends_list li\").removeClass(\"active\");$(\"#side #custom_search\").removeClass(\"active\");if(C.length){C.parent(\"li\").addClass(\"active\");setTimelineForListInPageLink(C)}}}})}$.fn.isBulletin=function(){return this.each(function(){var A=$(this);var B=A.find(\"a.close, a.hide\");B.click(function(){A.fadeOut();return false})})};$.fn.isBrowserUpgradeBulletin=function(A){return this.each(function(){var B=$(this);B.find(\"a.close, a.hide\").click(function(){$.cookie(A+\"_upgrade\",\"y\")})})};$.fn.isDeviceFailBulletin=function(){return this.each(function(){var A=$(this);var B=A.find(\"a.hide-fail-notice, a.close, a.hide\");var C=B.attr(\"id\").replace(\"hide_device_\",\"\");B.click(function(){$.ajax({type:\"POST\",dataType:\"text\",url:\"/devices/update/\"+C,data:{authenticity_token:twttr.form_authenticity_token,\"device[fail_alert]\":\"0\",twttr:true},success:function(D){if(D.match(/success/)){A.fadeOut(200)}else{twttr.error()}},beforeSend:null,complete:null});return false})})};$.fn.isBouncingEmailBulletin=function(){return this.each(function(){var A=$(this);A.find(\"a.close, a.hide\").click(function(){$.ajax({type:\"POST\",dataType:\"text\",url:\"/bouncers/reset\",data:{authenticity_token:twttr.form_authenticity_token,twttr:true},beforeSend:null,complete:function(){(new InfoNotification()).setMessage(_(\"Your email notifications should resume shortly.\")).show()}});return false})})};$.fn.isNotificationSetting=function(){return this.each(function(){var B=$(this);var A=B.attr(\"id\").replace(\"notify_on_\",\"\").replace(\"notify_off_\",\"\");B.click(function(){var C=B.attr(\"value\");$.ajax({type:\"POST\",dataType:\"text\",url:\"/friendships/device_\"+C+\"/\"+A,data:{authenticity_token:twttr.form_authenticity_token,twttr:true},success:function(D){if(D.match(/success/)){$(\".follow-control\").trigger(\"refresh\",[\"notify_\"+(C==\"follow\"?\"on\":\"off\")])}else{twttr.error()}}})})})};$.fn.isNudgable=function(){return this.each(function(){var A=$(this);A.click(function(){var B=A.parents(\"form\");B.find(\"input[name=authenticity_token]\").val(twttr.form_authenticity_token);B.submit();return false})})};$.fn.isSlugField=function(B,A){return this.bind(\"keyup\",function(){var C=slug($(this).val());if(B){B.val(C)}if(A){A.text(C)}})};var slug=function(A){return A.toLowerCase().replace(/[^a-z0-9]/g,\"-\").replace(/-+/g,\"-\").replace(/^[_-]+|[_-]+$/g,\"\")};$.fn.isDeleteButton=function(A){if(!confirm(A)){return false}};$.fn.disable=function(){$(this).attr(\"disabled\",\"disabled\").addClass(\"disabled\")};$.fn.enable=function(){$(this).removeAttr(\"disabled\").removeClass(\"disabled\")};$.fn.textAreaSizeLimiter=function(C){var D=$(this);var A=C.maxLength;var B=C.infoMessageSelector;var E=D.parents(\"form\").find(\"input[type=submit]\");D.keyup(function(){var F=D.val().length;if(F>A){E.attr(\"disabled\",\"DISABLED\").removeClass(\"btn\").addClass(\"dbtn\");$(B).show()}else{E.removeAttr(\"disabled\").removeClass(\"dbtn\").addClass(\"btn\");$(B).hide()}})};$.fn.isPasswordStrengthField=function(A,B){return this.each(function(){if(!A){return }if(!B){B={}}var H=$(this);var J=$(A);J.append('<span class=\"pstrength-text\"></span>');var F=J.find(\".pstrength-text\");function E(K){J.children().each(function(){var L=$(this);if(L.hasClass(\"pstrength-text\")){if(K){L.show()}else{L.hide()}}else{if(K){L.hide()}else{L.show()}}})}function I(K){var M=0;var L=B.minlength?B.minlength:6;if(K.length<L){return{score:K.length,message:_(\"Too short\"),className:\"password-invalid\"}}if(B.username){var N=(typeof (B.username)==\"function\")?B.username():B.username;if(N&&(K.toLowerCase()==N.toLowerCase())){return{score:0,message:_(\"Too obvious\"),className:\"password-invalid\"}}}if($.inArray(K.toLowerCase(),twttr.BANNED_PASSWORDS)!=-1){return{score:0,message:_(\"Too obvious\"),className:\"password-invalid\"}}M+=K.length*4;M+=(D(1,K).length-K.length)*1;M+=(D(2,K).length-K.length)*1;M+=(D(3,K).length-K.length)*1;M+=(D(4,K).length-K.length)*1;if(K.match(/(.*[0-9].*[0-9].*[0-9])/)){M+=5}if(K.match(/(.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~])/)){M+=5}if(K.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){M+=10}if(K.match(/([a-zA-Z])/)&&K.match(/([0-9])/)){M+=15}if(K.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&K.match(/([0-9])/)){M+=15}if(K.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&K.match(/([a-zA-Z])/)){M+=15}if(K.match(/^\\w+$/)||K.match(/^\\d+$/)){M-=10}if(M<0){M=0}if(M>100){M=100}if(M<34){return{score:M,message:_(\"Weak\"),className:\"password-weak\"}}if(M<50){return{score:M,message:_(\"Good\"),className:\"password-good\"}}if(M<75){return{score:M,message:_(\"Strong\"),className:\"password-strong\"}}return{score:M,message:_(\"Very Strong\"),className:\"password-verystrong\"}}function D(L,O){var K=\"\";for(var N=0;N<O.length;N++){var P=true;for(var M=0;M<L&&(M+N+L)<O.length;M++){P=P&&(O.charAt(M+N)==O.charAt(M+N+L))}if(M<L){P=false}if(P){N+=L-1;P=false}else{K+=O.charAt(N)}}return K}function C(K){if(K&&J.hasClass(K)){return false}J.removeClass(\"password-weak\").removeClass(\"password-good\").removeClass(\"password-strong\").removeClass(\"password-verystrong\").removeClass(\"password-invalid\");return true}function G(){var L=H.val();if(L.length==0){C();E(false)}else{if(L.length){E(true)}}if(L.length>0){var K=I(L);F.html(K.message);if(C(K.className)){J.addClass(K.className)}}}H.bind(\"show-password-meter\",function(){J.show()});H.bind(\"hide-password-meter\",function(){J.hide()});H.keyup(function(){G()});H.blur(function(){if(this.value.length==0){C();H.trigger(\"hide-password-meter\")}});if(H.val()){G();J.show()}})};$.fn.isOAuthApplication=function(){return this.each(function(){var C=$(this);var B=C.attr(\"id\").replace(\"oauth_application_\",\"\");var A=C.find(\".revoke-access\");A.click(function(){$.ajax({type:\"POST\",dataType:\"json\",url:\"/oauth/revoke\",data:{authenticity_token:twttr.form_authenticity_token,token:B,twttr:true},success:function(D){if(D.revoked){C.addClass(\"revoked\")}else{C.removeClass(\"revoked\")}A.text(D.label)}});return false})})};$.fn.screenName=function(){return $(this).find(\".screen-name\").text()||page.sessionUserScreenName};$.fn.userId=function(){var A;if(A=$(this).attr(\"id\")){return A.replace(\"user_\",\"\")}else{return page.sessionUserId}};twttr.klass(\"twttr.MinimumDelayCallback\",function(A){this.waitUntil=twttr.getTimeMillis()+A}).method(\"delay\",function(C){var A=twttr.getTimeMillis();var B=this.waitUntil-A;if(B>0){setTimeout(function(){this.delay(C)}.pBind(this),B)}else{C.apply()}});twttr.augmentObject(twttr,{getTimeMillis:function(){return new Date().getTime()}});jQuery.fn.pulsate=function(F,C){var D=$(this);var E=1;var A=function(){E=E+0.5;var G=E>F?function(){}:B;D.fadeIn(C,G)};var B=function(){E=E+0.5;D.fadeOut(C,A)};B()};$(\"html\").keypress(function(C){var B=C.charCode?C.charCode:C.keyCode?C.keyCode:0;var A=$(C.target);if(A&&A.hasClass(\"a-btn\")&&B==32){A.click();C.preventDefault()}});$(\"#status_update_form\").isUpdateForm();twttr.ajaxSetup=function(){$.ajaxSetup({data:{twttr:true,authenticity_token:twttr.form_authenticity_token}})};var searchSummize=function(E,B,F,A){page.query=E;var D=$(\"body#search #timeline li.search_result\").attr(\"id\");if(D&&page.retainTimeline){page.maxId=D.substring(7)}else{page.maxId=null}var C={q:page.query,rpp:20,maxId:page.maxId,callback:F||window.SEARCH_CALLBACKS.summize,layout:\"none\"};if(A){C.page=A}$(\"#side #q\").val(E);B.trigger(\"loading\");return $.ajax({url:page.summizeSearchUrl,data:C,dataType:\"script\",cache:false,complete:function(){$(\"#side #primary_nav li\").removeClass(\"active\");$(\"body\").attr(\"id\",\"search\");var H=\"\";if($(\"body.front\").length){H=$(\"#trends_list li.active\").length?\"front/trends\":\"front/custom_search\"}else{var G=$(\"#side li.active a.search-link\").parents(\"div#trends, div#saved_searches\");H=G.length==0?$(\"#side div#custom_search.active\").attr(\"id\"):G.attr(\"id\")}twttr.trackPageView($(\"body\").attr(\"id\"),(page.query&&page.query.length>0?page.query:null),\"/\"+H+(!page.retainTimeline?\"/ajax\":\"/ajax/more\"));B.trigger(\"loaded\");page.retainTimeline=null;page.isTimelineChange=false}})};var sponsoredSearch=function(A){if(page.showSS){$.ajax({url:\"/timeline/garuda_search\",data:{query:page.query,authenticity_token:twttr.form_authenticity_token},type:\"post\",dataType:\"html\",success:function(B){clearTimelineIfNewSearch();$(\"#timeline\").prepend(B);processSummizeInternal(A)},error:function(){clearTimelineIfNewSearch();processSummizeInternal(A)}})}else{clearTimelineIfNewSearch();processSummizeInternal(A)}};var processSummize=function(A){var B=getPageNumAndUrl(A)[0];if(B==2){sponsoredSearch(A)}else{clearTimelineIfNewSearch();processSummizeInternal(A)}};var clearTimelineIfNewSearch=function(){var A=(page.query!=\"\");if(A){if(!page.retainTimeline){$(\"#timeline\").empty();$(\"#pagination\").empty();$(\"#content .no-results\").remove();$(\"#results_update\").hide()}}};var getPageNumAndUrl=function(A){var E=$(A);var B=1;var D;var C=E.find(\".paginator a.next\");if(C.length){D=C.attr(\"href\");D.match(/\\?.*page=([0-9]+)/gi);B=RegExp.$1;B=B?parseInt(B):1}return[B,D]};var processSummizeInternal=function(B){var J=page.trendDescriptions[page.query];if(J){$(\"#trend_info\").hide();$(\"#trend_description span\").text(_(\"%{trend} is a popular topic on Twitter right now.\",{trend:J[0]}));$(\"#trend_description p\").html(J[1]);$(\"#trend_description\").show()}else{$(\"#trend_description\").hide();$(\"#trend_info\").show()}var H=$(B);var M=$(\".homepage #timeline\").length;var C=M&&!$(\".homepage #timeline li\").length;var F=$(\"#timeline\");var L=(page.query!=\"\");$(\"body\").attr(\"id\",\"search\");var E=getPageNumAndUrl(B)[1];var D=[];if(L){D=renderResultsFromSummize(H,F,M)}$(\"#container, #side_base\").show();F.find(\".msgtxt a\").each(twttr.appendClassesToSearchResults);F.find(\".msgtxt\").prev().addClass(\"tweet-url screen-name\");F.find(\"span.vcard a\").addClass(\"tweet-url profile-pic\");F.find(\".search_result\").find(\".status-body a,.vcard a\").each(function(){var P=$(this);var N=P.attr(\"href\");if(N.match(/^\\/search\\?q=([^&]+)/)){P.removeAttr(\"target\");var O=decodeURIComponent(RegExp.$1);P.attr(\"title\",O);P.isSearchLink(O.match(/^#/)?SEARCH_CALLBACKS.hashtagLink:SEARCH_CALLBACKS.inResultsLink)}else{if(N.match(/^https?:\\/\\/twitter\\.com/)){P.removeAttr(\"target\")}}});if(page.searchResults=(D.length>0&&L)){if(!M){enfavoriteSummize(D)}page.maxId=D[0];if(E){$(\"#pagination\").empty().html('<a id=\"search_more\" class=\"round more\" rel=\"next\" href=\"'+E+'\">'+_(\"more\")+\"</a>\").find(\"a\").isSearchMoreButton(M)}else{$(\"#pagination\").empty().html('<p class=\"no-more-tweets\">'+_(\"Older tweets are temporarily unavailable.\")+\"</p>\")}}else{var I=[_(\"Try a more general search.\"),_(\"Try using different words.\")];var K='<div class=\"no-results\">'+_(\"Suggestions:\")+\"<ol>\";for(var G=0;G<I.length;G++){K+=\"<li>\"+_(I[G])+\"</li>\"}K+=\"</ol></div>\";setTimeout(function(){$(\"#timeline_heading\").after(K)},1)}twttr.updateLocation(\"search?q=\"+encodeURIComponent(page.query));initializeSidebar();var A=$(\"#sidebar_search_q, #home_search_q\");if(A.val()!=page.query){A.val(page.query);A.css(\"color\",\"#000\")}onPageChange(C);$(\"#side #rssfeed a.search-rss\").attr(\"href\",\"http://search.twitter.com/search.atom?q=\"+h(encodeURIComponent(page.query)));summizeRefresh()};if(!window.SEARCH_CALLBACKS){window.SEARCH_CALLBACKS={summize:\"processSummize\",load:\"pageLoadSearch\",searchLink:\"processSearchLink\",trendLink:\"processTrendLink\",savedSearchLink:\"processSavedSearchLink\",searchForm:\"processSearchForm\",hashtagLink:\"processHashtagLink\",inResultsLink:\"processInResultsLink\",more:\"processSearchMore\",refresh:\"processSearchRefresh\"};$.each(window.SEARCH_CALLBACKS,function(){window[this]=window.processSummize})}function renderResultsFromSummize(C,B,A){var D=[];C.find(\".result\").each(function(){var J=$(this);J.find(\".location,.thread,.to_av,p.clearleft,.expand,#share\").remove();var F=$(J.find(\".avatar\").get(0));F.replaceWith('<span class=\"thumb vcard author\">'+F.html()+\"</span>\");var L=$(J.find(\".info\").get(0));var M,G,E;L.find(\"a.lit\").each(function(){E=$(this).attr(\"href\");var P=E.match(/\\/(\\w+)\\/statuses\\/(\\d+)/);M=P[2];D.push(M);G=P[1]});var H=L.find(\".source\").remove();L.find(\"a\").remove();L.html('<a href=\"'+E+'\">'+L.html()+\"</a>\");L.append(H);var O='<span class=\"meta entry-meta\">'+L.html().replace(/\\u00B7/g,\"\")+\"</span>\";L.remove();var N=$(J.find(\".msg\").get(0));N.replaceWith(($.browser.msie6?'<img src=\"http://s.twimg.com/a/1267135446/images/white.png\" width=\"1\" height=\"50\" align=\"left\">':\"\")+N.html().replace(/a>\\s*:\\s*<span/,\"a> <span\")+O);var K=J.html();if(!A){K='<span class=\"actions\"><div><a href=\"#\" class=\"fav-action non-fav\" id=\"status_star_'+M+'\"> &nbsp; </a></div></span>'+K;K+='<ul class=\"actions-hover\"><li><span class=\"reply\"><span class=\"reply-icon icon\"></span><a href=\"/home?status=@'+G+\"%20&in_reply_to_status_id=\"+M+\"&in_reply_to=\"+G+'\">Reply</a></span></li><li><span class=\"retweet-link\"><span class=\"retweet-icon icon\"></span><a href=\"#\" title=\"Retweet\">Retweet</a></span></li></ul>'}var I=$('<li class=\"hentry status search_result u-'+G+'\" id=\"status_'+M+'\"><span class=\"status-body\">'+K+\"</span></li>\");B.append(I)});return D}function enfavoriteSummize(A){if(page.loggedIn&&A.length>0){$timeline=$(\"#timeline\");$.ajax({type:\"POST\",dataType:\"json\",url:\"/favourings/intersect_for_search\",data:{authenticity_token:twttr.form_authenticity_token,\"status_id[]\":A,twttr:true},beforeSend:null,success:function(B){$.map(B,function(C){$timeline.find(\"#status_\"+C+\" .non-fav\").addClass(\"fav\").removeClass(\"non-fav\")})},complete:null})}}function summizeRefresh(){if(page.timelineRefresher){page.timelineRefresher.stop();page.timelineRefresher=null;addCountToDocumentTitle()}var B=$(\"#results_update\");B.data(\"count\",0);var A=$(\"#new_results_notification\").meta().search;if(page.summizeRefresher||$(\"#results_update\").length==0){return }page.newResults=null;page.summizeRefresher=new Occasionally(A.delay*1000,A.max_delay*1000,function(){var C=false;$.ajax({dataType:\"script\",url:page.summizeSearchUrl,data:{q:page.query,since_id:page.maxId,refresh:true,callback:\"processSummizeRefresh\"},cache:false,callback:null})},function(){return page.newResults},A.decay);page.summizeRefresher.start()}function processSummizeRefresh(B){if(decodeURIComponent(B.query).replace(/\\+/g,\" \")==page.query&&B.total){page.maxId=B.max_id;var C=page.summizeRefreshResults=(page.summizeRefreshResults||0)+B.total;var A=$(\"#results_update\").is(\":visible\")?\"\":' style=\"display:none;\"';var D='<a id=\"results_update\" class=\"minor-notification\"'+A+\">\";D+=(C==1)?_(\"1 more tweet since you started searching.\"):_(\"%{results_count} more tweets since you started searching.\",{results_count:numberWithDelimiter(C)});D+=\"</a>\";$(\"#results_update\").replaceWith(D);$(\"#results_update:hidden\").slideDown();$(\"#results_update\").attr(\"title\",page.query).attr(\"href\",\"/search?q=\"+encodeURIComponent(h(page.query))).isSearchLink(SEARCH_CALLBACKS.refresh).click(function(){addCountToDocumentTitle();return false});if(C){addCountToDocumentTitle(C)}page.newResults=true}else{page.newResults=false}}$.fn.isSearchMoreButton=function(A){return this.each(function(){var B=$(this);B.click(function(){B.blur();var D=B.attr(\"href\");D.match(/\\?.*page=([0-9]+)/gi);var C=RegExp.$1;page.retainTimeline=true;$(\"#timeline li:last-child\").addClass(\"last-on-page\");searchSummize(page.query,B,SEARCH_CALLBACKS.more,C);B.addClass(\"loading\").html(\"\");return false})})};function onPageChange(A){var C=$(\"body\").attr(\"id\");setTitleAndHeading(C);if(!A){if(page.summizeRefresher){page.summizeRefresher.stop();page.summizeRefresher=null;page.summizeRefreshResults=null}if(!page.retainTimeline){$(\"#results_update\").hide()}$(\".no-results\").remove();$(\"#new_results_count\").html(\"0\")}$(\".in-page-link\").isInPageLink();$(\".in-page-list-link\").isListInPageLink();try{$(\".in-page-list-label\").isListInPageLabel();$(\".in-page-label\").isInPageLabel()}catch(B){}if(C==\"list\"||C==\"list_show\"){C=(window.location.hash||window.location.pathname).replace(/^#/,\"\").replace(/^([^\\/])/,\"/$1\");if(C.indexOf(\"/list\")!=0){C=\"/list\"+C}}twttr.trackPageView(C,(page.query&&page.query.length>0?page.query:null),A?null:\"/ajax\")}$.fn.isSearchLink=function(A){return this.each(function(){var B=$(this);B.click(function(C){C.preventDefault();if($.browser.msie){this.hideFocus=true}if(page.isTimelineChange&&page.currentTimelineChange){page.currentTimelineChange.abort();page.$oldTimelineLink.trigger(\"aborted\");page.isTimelineChange=false}page.isTimelineChange=true;page.currentTimelineChange=searchSummize(B.attr(\"name\")?B.attr(\"name\"):B.attr(\"title\"),B,A);if(B.parents(\"#side\").length>0){$(\"#side ul.sidebar-menu li\").removeClass(\"active\");B.parent(\"li\").addClass(\"active\")}$(\"#trends_list li.active a\").removeClass(\"active\")})})};$.fn.isSearchForm=function(){return this.each(function(){var B=$(this);var A=$(B.find('input[type=\"text\"]')[0]);var C=B.find(\"#sidebar_search_submit\");A.Watermark(_(\"Search\")).focus(function(){A.select();return true});C.click(function(){B.submit()});B.submit(function(){var D=A.val();if(D!=\"\"){C.addClass(\"loading\");searchSummize(D,B,SEARCH_CALLBACKS.searchForm)}$(\"#side ul.sidebar-menu li\").removeClass(\"active\");$(\"#side #custom_search\").addClass(\"active\");return false});B.bind(\"loaded\",null,function(D){C.removeClass(\"loading\")})})};function loadTrendDescriptions(){$(\"#trends a\").each(function(){var A=$(this);var C=A.parent().find(\"em\");if(C.length){var B=A.text();var D=C.text().replace(new RegExp(B.replace(/([^\\w])/gi,\"\\\\$1\"),\"gi\"),\"<strong>\"+B+\"</strong>\");page.trendDescriptions[A.attr(\"title\")]=[B,D]}})}$(document).ready(function(){$(\"#tweet_search_submit\").click(function(){$(\"#tweet_search\").submit()});$(\"#content #trend_description img\").tipsy({gravity:\"s\"});page.trendDescriptions={};loadTrendDescriptions();if($(\"body\").attr(\"id\")==\"search\"){onCondition(function(){return page.summizeResults},function(){window[SEARCH_CALLBACKS.summize](page.summizeResults)})}});twttr.appendClassesToSearchResults=function(){var A=$(this);A.addClass(\"tweet-url\");if(A.text().match(/^@/)){A.addClass(\"username\")}else{if(A.text().match(/^#/)){A.addClass(\"hashtag\")}else{A.addClass(\"web\")}}};var LIST_PUBLIC_MODE=\"public\";var LIST_PRIVATE_MODE=\"private\";var LIST_MAX_NAME_LENGTH=25;var LIST_MAX_DESCRIPTION_LENGTH=100;var numeric_mode=function(A){switch(A){case\"public\":return 0;case\"private\":return 1;default:return 0}};var updateListFollowersCount=function(A){return updateCount(\"#subscribers_tab .stat-count\",A)};var updateListFollowingCount=function(A){return updateCount(\"#members_tab .stat-count\",A)};var fadeUserOnListUnfollow=function(A){A.fadeOut(\"medium\",function(){A.remove()})};var onListMembersPage=function(A){return $(\"body\").hasClass(\"lists_members\")&&$('.list-header h2 a[href=\"'+A.uri+'\"]').length==1};var linkToList=function(A,B){A.dispatch_action=\"list\";return'<li><a class=\"list_'+A.id+'\" href=\"'+A.uri+'\" data=\"'+h(JSON.stringify(A))+'\">'+(B?\"<em />\":\"\")+\"<span>\"+listDisplayName(A)+\"</span></a></li>\"};var listDisplayName=function(A){return(page.sessionUserScreenName&&page.sessionUserScreenName==A.user?h(A.slug):\"<b>@</b>\"+h(A.user)+\"/<wbr/>\"+h(A.slug))+lockIconForList(A)};var lockIconForList=function(A){return(A.mode==LIST_PRIVATE_MODE)?'<span class=\"lock-icon\" title=\"Private List\"></span>':\"\"};var findListIndexBySlug=function(A,B){return jQuery.map(A,function(D,C){if(D.slug==B){return C}else{return null}})};$.fn.isUserListMenu=function(){var A=$(\"#list_menu\");return this.one(\"click\",function(){var D=$(this);var E=D.parents(\".user\");var C={};$.map(E.meta().lists,function(F){C[F.slug]=true});$(\"body\").click();D.addClass(\"clicked\").after(A.html());var B=D.siblings(\"ul\");if(B.find(\"li:not(.new-list)\").size()>=twttr.ListPerUserLimit){B.find(\".new-list\").remove()}B.find(\"li\").each(function(){var F=$(this);if(F.hasClass(\"new-list\")){F.isNewListLink()}else{F.isUserListItem(C[F.find('input[type=\"checkbox\"]').meta().slug])}});$(\"html\").one(\"click\",function(){D.removeClass(\"clicked\").blur().siblings(\"ul\").remove().end().isUserListMenu();return false});return false})};$.fn.isUserListItem=function(D){var A=function(I,H,F,G){I.show();H.hide();var E=(G==\"POST\");H.attr(\"checked\",E);F.unbind(\"click.checkbox\");F.bind(\"click.while-processing\",function(){return false})};var C=function(H,G,F,E){H.hide();G.show();F.unbind(\"click.while-processing\");F.bind(\"click.checkbox\",function(I){B.call(this,F,G,H,E);return false})};var B=function(M,F,I,L){var H=L?\"DELETE\":\"POST\";var G=M.parents(\".user\");var K=G.attr(\"id\").replace(\"user_\",\"\");var J={authenticity_token:twttr.form_authenticity_token,twttr:true};var E=M.find('input[type=\"checkbox\"]').meta().uri+\"/members\";if(H==\"POST\"){J[\"member[id]\"]=K}else{E+=\"/\"+K}$.ajax({type:H,dataType:\"json\",url:E,data:J,beforeSend:function(){A(I,F,M,H)},complete:function(){C(I,F,M,L)},success:function(N){L=(H==\"POST\");F.attr(\"checked\",L);if(H==\"POST\"){addListToUser(G,N);if(onListMembersPage(N)){updateListFollowingCount(1)}}else{removeListFromUser(G,N);if(onListMembersPage(N)){fadeUserOnListUnfollow(G);updateListFollowingCount(-1)}}},error:function(){F.attr(\"checked\",L)}})};return this.each(function(){var E=$(this);var F=E.find('input[type=\"checkbox\"]');var H=E.find(\".loading-spinner\");var G=false;if(D){G=F.attr(\"checked\",true)}E.bind(\"click.checkbox\",function(I){B.call(this,E,F,H,G);return false})})};$.fn.isNewListLink=function(){return this.click(function(){var A=$(this).parents(\".user\");if(A.length==0){A=null}$(this).parent(\".ul\").remove();openListDialog(true,{userObject:A});return false})};$.fn.isEditListLink=function(){return this.click(function(){openListDialog(false,$(this).meta());return false})};var openListDialog=function(D,F){if(!F){F={}}var G=$(\"#list_dialog\");var B=$(G.html());var A=new twttr.dialog(false,{closeButton:true,content:B,heading:$($(\"#list_dialog_header\").html()),modal:true,width:\"405px\"});A.bind(\"close\",function(){A.$root.remove()});var E=\"\";A.$root.addClass(\"list-dialog\");if(D){A.$root.addClass(\"create-list-dialog\")}else{E=F.description;A.$root.addClass(\"update-list-dialog\").find('input[type=\"submit\"]').val(_(\"Update list\")).end().find(\".list-name\").val(F.name).end().find(\".list-slug-title-and-slug\").show().end().find(\".list-description\").val(E).end().find(\".list-link span\").text(F.slug).end().find('input[name=\"list[mode]\"][value=\"'+numeric_mode(F.mode)+'\"]').attr(\"checked\",true);var C=A.find(\".private-warning\");A.find('input[name=\"list[mode]\"]').change(function(){if(this.value==numeric_mode(LIST_PRIVATE_MODE)&&this.checked){C.show()}else{C.hide()}})}$(\".list-description\",A.$root).maxLength(LIST_MAX_DESCRIPTION_LENGTH-2);A.find(\".list-name\").focus();A.$root.isListDialog(D,F,A);A.open()};$.fn.isListDialog=function(C,A,B){return this.each(function(){var G=$(this);var F=A.userObject;var D=G.find(\"form\");D.find(\".list-name\").one(\"keyup\",function(){console.log(\"keyup\");$(this).siblings(\".list-slug-title-and-slug\").show()}).isSlugField(D.find(\".list-slug-field\"),D.find(\".list-link span\"));if(F){D.find(\".list-member-id\").val(F.userId())}var E=$(this).find('input[type=\"submit\"]');D.submit(function(I){var H=D.serialize();if(!C){H+=\"&\"+$('<input type=\"hidden\" name=\"_method\" value=\"PUT\" />').serialize()}$.ajax({type:\"POST\",dataType:\"json\",url:C?D.attr(\"action\"):A.uri,data:H,beforeSend:function(){E.attr(\"disabled\",\"disabled\")},success:function(J){B.close();B.$root.remove();if(C){addListToMenu(J);if(F){addListToUser(F,J)}addListToLists(J);(new ShortNotification()).setMessage(_(\"Yay! Your list was created.\")).show()}else{window.location=J.uri}},error:function(J){(new InfoNotification()).setMessage(J.responseText).show()},complete:function(){E.removeAttr(\"disabled\",\"disabled\")}});I.preventDefault()})})};$.fn.isDestroyListLink=function(){return this.click(function(D){var C=$(this);var A=C.next(\"form\");var B=A.attr(\"action\");if(confirm(_(\"Are sure you want to delete this list? There is NO undo!\"))){$.ajax({url:B,type:\"POST\",dataType:\"json\",data:{_method:\"delete\",authenticity_token:twttr.form_authenticity_token,twttr:true},beforeSend:function(){C.disable()},success:function(){document.location=\"/\"},error:function(){C.enable()}})}return false})};$.fn.isSubscribeListLink=function(){return this.click(function(B){var A=$(this);$.ajax({url:A.attr(\"href\"),type:\"POST\",dataType:\"json\",data:{authenticity_token:twttr.form_authenticity_token,twttr:true},beforeSend:function(){A.disable()},complete:function(){A.enable()},success:function(){A.parents(\".list\").addClass(\"subscriber\");updateListFollowersCount(1)},error:function(){A.parents(\".list\").removeClass(\"subscriber\")}});return false})};$.fn.isUnsubscribeListLink=function(){return this.click(function(B){var A=$(this);$.ajax({url:A.attr(\"href\"),type:\"POST\",dataType:\"json\",data:{_method:\"delete\",authenticity_token:twttr.form_authenticity_token,twttr:true},success:function(){A.parents(\".list\").removeClass(\"subscriber\");var C=$(\"#lists_subscribers #follow_grid #user_\"+page.sessionUserId);fadeUserOnListUnfollow(C);updateListFollowersCount(-1)},error:function(){A.parents(\".list\").addClass(\"subscriber\")}});B.preventDefault()})};$.fn.isListInPageLink=function(){return this.each(function(){var A=$(this);A.isInPageLink(setTimelineForListInPageLink)})};var setTimelineForListInPageLink=function(A){$(\"#timeline_heading\").show();var E=$(\"#timeline_heading h1\");var D=$(\"#timeline_heading h2\");var C=A.meta();var B=h(C.uri);var F=listDisplayName(C);D.remove();E.html(F);E.after('<h2 class=\"list-subheading\"><p class=\"list-numbers\"><a href=\"'+B+'/members\">'+_(\"Following:\")+\" <span>\"+h(C.member_count)+\"</span></a>\"+(C.mode==LIST_PRIVATE_MODE?\"\":'<a href=\"'+B+'/subscribers\">'+_(\"Followers:\")+\" <span>\"+h(C.subscriber_count)+\"</span></a>\")+'</p><p class=\"list-link\"><a href=\"'+B+'\">'+_(\"View list page\")+\"<span> âº</span></a></p></h2>\");if(C.member_count==0){$(\"#timeline_heading h2\").append($(C.user==page.sessionUserScreenName?\"#list_no_members_owner\":\"#list_no_members\").html())}setDocumentTitle(\"Twitter / \"+C.full_name)};var addListToUser=function(B,A){return B.each(function(){if(findListIndexBySlug(B.meta().lists,A.slug).length==0){B.meta().lists.push(A);if(B.find(\".list-tags\").length>0){B.find(\".list-tags-outer:hidden\").show();B.find(\".list-tags\").append(linkToList(A))}}})};var removeListFromUser=function(B,A){$.each(findListIndexBySlug(B.meta().lists,A.slug),function(){Array.remove(B.meta().lists,this);B.find(\".list-tags .list_\"+A.id).each(function(){$(this).parent(\"li\").remove()});if(B.meta().lists.length==0){B.find(\".list-tags-outer:visible\").hide()}})};var addListToMenu=function(B){var A=$(\"#list_menu\");A.find(\".new-list\").before('<li><img class=\"loading-spinner\" src=\"http://s.twimg.com/a/1267135446/images/spinner.gif\" style=\"display: none;\" alt=\"waiting\" title=\"waiting\" height=\"14\" width=\"14\"/><input type=\"checkbox\" id=\"list_'+B.id+'\" data=\"'+h(JSON.stringify(B))+'\" /> <label for=\"list_'+B.id+'\">'+h(B.name)+lockIconForList(B)+\"</label></li>\")};var isInPageLists=function(){return $(\"#side_lists.in-page-lists\").length==1};var addListToLists=function(C){var B=isInPageLists();var A=$(\"ul.lists-links\").siblings(\".no-lists\").remove().end().append(linkToList(C,B)).find(\".list_\"+C.id);if(B){A.addClass(\"in-page-list-link\").isListInPageLink().isSidebarTab().click()}};var bindAdminListActions=function(){$(\"#admin_list a.destroy-list\").isDestroyListLink();$(\"#admin_list a.edit-list\").isEditListLink()};var isMoreButton=function(){$(\"#lists_pagination #more\").live(\"click\",basicMoreButtonHandler({beforeSend:function(){$(\"#more\").addClass(\"loading\").html(\"\")},success:function(A){$(\"#lists_table tbody\").append($(A[\"#lists\"]));$(\"#lists_pagination\").html(A[\"#pagination\"])},error:function(){$(\"#more\").removeClass(\"loading\").text(_(\"more\"));(new ShortNotification()).setMessage(_(\"Whoops! Something went wrong. Please try again!\")).show()}}))};$.fn.equals=function(A){return this.length==1&&A.length==1&&this.get(0)==A.get(0)};$.fn.hasParent=function(A){return jQuery.inArray(A[0],this.parents())>-1};function InlineForm(A){this.initialize(A)}jQuery.extend(InlineForm.prototype,{defaultOptions:{title:\"\",submitBtnValue:\"\",showCancel:true,closeOnOutsideClick:true,formClass:\"\",timelineChangedEvents:false,pageHeightChangedEvents:false},overrideDefaultOptions:{},initialize:function(A){this.options=jQuery.extend({},this.defaultOptions);jQuery.extend(this.options,this.overrideDefaultOptions);jQuery.extend(this.options,A);this.$form=$('<div class=\"inline-form '+this.options.formClass+'\"></div>');this.$buttonParent=$('<div class=\"inline-form-buttons\"></div>');this.$button=$('<button type=\"button\" class=\"btn\">'+this.options.submitBtnValue+\"</button>\");if(this.options.showCancel){this.$cancel=$('<span class=\"cancel\">&nbsp;</span>')}this.$form_inner=$('<div class=\"inline-form-inner\"></div>');this.$input=$('<textarea class=\"inline-form-input\"></textarea>');this.$inputsPrompt=$('<div class=\"inline-inputs-prompt\"></div>');this.$title=$('<div class=\"title\">'+this.options.title+\"</div>\");this.$body=$('<div class=\"body\">'+(this.options.body||\"\")+\"</div>\");this.initEvents()},initEvents:function(){this.buttonEvent=this.submitForm.pBind(this);this.closeEvent=this.close.pBind(this);this.outsideClickEvent=this.destroyFromEvent.pBind(this);this.timelineEvent=this.timelineEvent.pBind(this);if(this.options.timelineChangedEvents){$.Timeline.registerTimelineEvent(this.timelineEvent)}if(this.options.pageHeightChangedEvents){this.pageHeightChangedEvent=this.pageHeightChangedEvent.pBind(this);$.Timeline.registerPageHeightChangedEvent(this.pageHeightChangedEvent)}},addEvents:function(){this.$button.click(this.buttonEvent);if(this.options.showCancel){this.$cancel.click(this.closeEvent)}if(this.options.closeOnOutsideClick){$(window).click(this.outsideClickEvent)}},removeEvents:function(){this.$button.unbind(\"click\",this.buttonEvent);if(this.options.showCancel){this.$cancel.unbind(\"click\",this.closeEvent)}if(this.options.closeOnOutsideClick){$(window).unbind(\"click\",this.outsideClickEvent)}if(this.options.timelineChangedEvents){$.Timeline.unregisterTimelineEvent(this.timelineEvent)}$.Timeline.unregisterPageHeightChangedEvent(this.pageHeightChangedEvent)},onSendError:function(A){if(this.sendNotification){this.sendNotification.cancel()}(new InfoNotification()).setMessage(_(\"Whoops! Something went wrong. Please refresh the page and try again!\")).show();this.close()},onSendSuccess:function(A){},formAction:function(){},timelineEvent:function(){},pageHeightChangedEvent:function(){this.positionForm()},postData:function(){},beforePost:function(){},onComplete:function(){},submitForm:function(){this.$button.disable();var A={authenticity_token:twttr.form_authenticity_token};jQuery.extend(A,this.postData());if(this.progressNotificationText){this.sendNotification=(new ProgressNotification()).setProgressMessage(this.progressNotificationText).setCompletedMessage(_(\"Ok, done.\")).show()}this.beforePost();$.ajax({type:\"POST\",dataType:\"json\",dataFilter:function(B){if(!jQuery.trim(B)){return null}return B},url:this.formAction(),data:A,error:function(B){this.onSendError(B)}.pBind(this),success:function(B){this.onSendSuccess(B);this.close();if(this.sendNotification){this.sendNotification.done()}}.pBind(this),beforeSend:twttr.loading,complete:function(){twttr.loaded();this.onComplete()}.pBind(this)})},arrange:function(){var A=$('<div class=\"inline-form-inputs\"></div>');if(this.options.showCancel){this.$buttonParent.append(this.$cancel)}this.$buttonParent.append(this.$button);this.$form_inner.append(A.append(this.$title).append(this.$body).append(this.$inputsPrompt).append(this.$input)).append(this.$buttonParent);this.$form.append(this.$form_inner);this.$form.hide();this.baseElement().append(this.$form)},baseElement:function(){return this.$parentNode||$(document.body)},show:function(A){this.addEvents();this.$targetNode=A.targetNode;this.$parentNode=A.parentNode;this.positionForm();this.arrange();this.$form.fadeIn(100);this.currentlyShown=true;this.afterShow()},afterShow:function(){},positionForm:function(){if(this.$targetNode&&this.$targetNode.width()>0){var C=this.position();var B=C[0];var A=C[1];this.$form.css(\"top\",B).css(\"left\",A)}else{this.close()}},close:function(){this.removeEvents();this.$form.remove();this.currentlyShown=false;this.afterClose()},afterClose:function(){},destroyFromEvent:function(B){var A=$(B.target);if(A.equals(this.$targetNode)||jQuery.inArray(this.$targetNode.get(0),A.parents())!=-1||A.equals(this.$form)||A.hasParent(this.$form)){return }this.close()},position:function(){var A=this.$targetNode.offset();return[A.top,A.left]}});RetweetInlineForm=function(){var A=_(\"Yes\");var B=_(\"Retweet to your followers?\");this.initialize({title:B,submitBtnValue:A})};RetweetInlineForm.prototype=new InlineForm();jQuery.extend(RetweetInlineForm.prototype,{overrideDefaultOptions:{formClass:\"retweet-dlg\",pageHeightChangedEvents:true},formAction:function(){var B=getListItemFromChild(this.$targetNode);var A=getStatusIdFromListItem(B);return\"/statuses/\"+A+\"/retweet\"},postData:function(){return{controller_name:page.controller_name,action_name:page.action_name}},beforePost:function(){this.close();twttr.setRetweetingStyles(this.$targetNode,_(\"Updating...\"))},onSendSuccess:function(A){twttr.animateStatusReplacement(this.$targetNode,A)},onComplete:function(){twttr.unsetRetweetingStyles(this.$targetNode)},afterShow:function(){getListItemFromChild(this.$targetNode).addClass(\"perma-hover\");this.$targetNode.find(\"a\").blur()},afterClose:function(){getListItemFromChild(this.$targetNode).removeClass(\"perma-hover\")},position:function(){var A=this.$targetNode.offset();return[parseInt(A.top)+20,parseInt(A.left)-220]}});RetweetContextDlgForm=function(){var B=_(\"Close\");var C=_(\"Wondering who this is?\");var A=_('Someone you follow thought this was worth retweeting, which is why you are seeing it in your Home timeline. <a target=\"_blank\" href=\"http://help.twitter.com/forums/10711/entries/77606\">Learn more</a>.');this.initialize({title:C,body:A,submitBtnValue:B})};RetweetContextDlgForm.prototype=new InlineForm();jQuery.extend(RetweetContextDlgForm.prototype,{overrideDefaultOptions:{showCancel:false,closeOnOutsideClick:false,formClass:\"retweet-ctx-dlg\",timelineChangedEvents:true},formAction:function(){return\"/users/\"+page.sessionUserId},postData:function(){return{_method:\"put\",\"user[has_dismissed_retweet_contextual_dialog]\":\"1\"}},position:function(){return[this.$parentNode.height(),-9]},timelineEvent:function(){if(!this.currentlyShown){this.showIfElementExists()}},afterShow:function(){this.$targetNode.css(\"z-index\",\"300\");var A=parseInt($.cookie(\"retweet_contextual_count\"))||0;if(A<5){$.cookie(\"retweet_contextual_count\",A+1)}else{this.close();this.submitForm();$.cookie(\"retweet_contextual_count\",null)}},afterClose:function(){this.$targetNode.css(\"z-index\",null)},showIfElementExists:function(){var A=$(\".rt-dlg\");if(A.length){this.show({targetNode:A,parentNode:A})}}});$(document).ready(function(){new RetweetContextDlgForm().showIfElementExists()});$(document).ready(function(){try{var A=\"share-text-active\";$(\".status\").each(function(){var E=$(this);var C=E.find(\".retweet-link\");var D=E.find(\".share-text\");C.hover(function(){D.addClass(A)},function(){D.removeClass(A)})})}catch(B){}});(function(){jQuery.inherits=function(A,C){function B(){}B.prototype=C.prototype;A.prototype=new B();A.prototype.constructor=A}})();(function(){jQuery.fn.equals=function(A){return this.get(0)==A.get(0)}})();(function(){jQuery.fn.hasParent=function(A){var B=false;this.parents().map(function(){if($(this).equals(A)){B=true}});return B}})();function Notification(B){this.$bar=jQuery('<div class=\"notification-bar\"></div>');this.$barContainer=jQuery('<div class=\"notification-bar-container\"></div>');this.$barContents=jQuery('<div class=\"notification-bar-contents\"></div>');this.$barBackground=jQuery('<div class=\"notification-bar-bkg\"></div>');this.$message=jQuery('<div class=\"message\"></div>');this.$bar.hide();this.$barBackground.hide();var A=this;this.$bar.click(function(C){A.removeAfterEvent(C)});this.className=B}Notification.SLIDE_SPEED_IN_MS=300;Notification.prototype.remove=function(){var A=this;this.slideUp(function(){A.$bar.remove();A.$barBackground.remove();window.clearTimeout(A.timeout)})};Notification.prototype.removeAfterEvent=function(B){var A=$(B.target);if(A.get(0).nodeName.toLowerCase()==\"a\"&&A.hasParent(this.$message)){return }this.remove()};Notification.prototype.setMessage=function(A){this.msg=A;return this};Notification.prototype.show=function(){this.$message.addClass(this.className).html(this.msg);this.$barContainer.append(this.$barBackground).append(this.$bar.append(this.$barContents.append(this.$message)));jQuery(\"#notifications\").append(this.$barContainer);this.$barBackground.height(this.$bar.height());this.showBar();if(this.onShow){this.onShow()}return this};Notification.prototype.removeInMilliseconds=function(){var A=this;this.timeout=window.setTimeout(function(){A.remove()},A.timeoutInMilliseconds)};Notification.prototype.showBar=function(){this.$bar.show();this.$barBackground.show()};Notification.prototype.onShow=function(){this.removeInMilliseconds()};Notification.prototype.slideUp=function(A){this.$bar.slideUp(Notification.SLIDE_SPEED_IN_MS);this.$barBackground.slideUp(Notification.SLIDE_SPEED_IN_MS,A)};function ShortNotification(){Notification.call(this,\"message-info\");this.timeoutInMilliseconds=3000}jQuery.inherits(ShortNotification,Notification);ShortNotification.prototype.showBar=function(){this.$bar.slideDown(Notification.SLIDE_SPEED_IN_MS);this.$barBackground.slideDown(Notification.SLIDE_SPEED_IN_MS)};function InfoNotification(){Notification.call(this,\"message-info\");this.timeoutInMilliseconds=6000}jQuery.inherits(InfoNotification,Notification);InfoNotification.prototype.showBar=function(){this.$bar.slideDown(Notification.SLIDE_SPEED_IN_MS);this.$barBackground.slideDown(Notification.SLIDE_SPEED_IN_MS)};function ProgressNotification(){Notification.call(this,\"message-progress\");this.timeoutInMilliseconds=1000}jQuery.inherits(ProgressNotification,Notification);ProgressNotification.prototype.setProgressMessage=function(A){return this.setMessage(A)};ProgressNotification.prototype.setCompletedMessage=function(A){this.completedMsg=A;return this};ProgressNotification.prototype.onShow=function(){};ProgressNotification.prototype.cancel=function(){this.timeoutInMilliseconds=0;this.removeInMilliseconds()};ProgressNotification.prototype.done=function(){this.$message.addClass(\"message-progress-done\").removeClass(this.className).html(this.completedMsg);this.removeInMilliseconds()};function ErrorNotification(){Notification.call(this,\"message-error\");this.timeoutInMilliseconds=8000}jQuery.inherits(ErrorNotification,Notification);function Occasionally(A,D,C,B,E){this.interval=A;this.maxDecayTime=D;this.job=C;this.decayCallback=B;this.timesRun=0;this.decayRate=1;this.decayMultiplier=E||1.25;this.maxRequests=360}Occasionally.prototype.start=function(){this.stop();this.run()};Occasionally.prototype.stop=function(){if(this.worker){window.clearTimeout(this.worker)}};Occasionally.prototype.run=function(){var A=this;this.decayRate=this.decayCallback()?Math.max(1,this.decayRate/this.decayMultiplier):this.decayRate*this.decayMultiplier;var B=this.interval*this.decayRate;B=(B>=this.maxDecayTime)?this.maxDecayTime:B;this.worker=window.setTimeout(function(){A.execute()},Math.floor(B))};Occasionally.prototype.execute=function(){this.job();if(++this.timesRun<this.maxRequests){this.run()}};twttr.countClick=function(){var A=twttr.createTrackingParameters(this);twttr.asyncClickCount(A)};twttr.asyncClickCount=function(A){(new Image()).src=\"/abacus?\"+$.param(A)};twttr.createTrackingParameters=function(F){var B=$(F);var A=function(){var K=B.attr(\"class\");var I=[\"hashtag\",\"profile-pic\",\"screen-name\",\"username\",\"web\"];for(var J in I){if(K.indexOf(I[J])!==-1){return I[J]}}}();var E=B.closest(\".status\").find(\".meta\").children(\"a\").get(0).href.split(\"/\");var G=E[E.length-1];var H=$('meta[name=\"session-userid\"]');var D=H.attr(\"content\")||-1;var C=twttr.form_authenticity_token||$('input[name=\"authenticity_token\"]').attr(\"value\");return{url:F.href,linkType:A,tweetId:G,userId:D,authenticity_token:C,time:(new Date).getTime()}};$(document).ready(function(){var A=$(\"#content a.tweet-url\");A.live(\"mousedown\",twttr.countClick)});/*\n 43649      http://www.JSON.org/json2.js\n 43650      2009-09-21\n\nD:\\Prog\\Git\\SuperSprint\\app\\node_modules\\karma\\node_modules\\socket.io\\node_modules\\socket.io-client\\node_modules\\uglify-js\\tmp\\app.js:\n 12264           * https://developer.mozilla.org/en/CSS/-moz-linear-gradient\n 12265           * https://developer.mozilla.org/en/CSS/-moz-radial-gradient\n 12266:          * http://dev.w3.org/csswg/css3-images/#gradients-\n 12267           */\n 12268  \n\n55 matches across 20 files\n",
			"settings":
			{
				"buffer_size": 669585,
				"line_ending": "Windows",
				"name": "Find Results",
				"scratch": true
			}
		},
		{
			"file": "js/Sprites.js",
			"settings":
			{
				"buffer_size": 42,
				"line_ending": "Unix"
			}
		},
		{
			"file": "/D/Prog/Git/SuperSprint/README.md",
			"settings":
			{
				"buffer_size": 893,
				"line_ending": "Unix"
			}
		},
		{
			"file": "/C/Windows/System32/drivers/etc/hosts",
			"settings":
			{
				"buffer_size": 435610,
				"line_ending": "Windows"
			}
		},
		{
			"file": "js/Main.js",
			"settings":
			{
				"buffer_size": 2554,
				"line_ending": "Unix"
			}
		},
		{
			"file": "/C/Users/Simon/AppData/Roaming/Sublime Text 3/Packages/User/Preferences.sublime-settings",
			"settings":
			{
				"buffer_size": 601,
				"line_ending": "Unix"
			}
		},
		{
			"file": "index.html",
			"settings":
			{
				"buffer_size": 871,
				"line_ending": "Unix"
			}
		}
	],
	"build_system": "",
	"command_palette":
	{
		"height": 94.0,
		"selected_items":
		[
			[
				"instal",
				"Package Control: Install Package"
			],
			[
				"pack",
				"Package Control: Remove Package"
			],
			[
				"html",
				"Set Syntax: HTML"
			],
			[
				"css",
				"Set Syntax: CSS"
			],
			[
				"brow",
				"Preferences: Browse Packages"
			]
		],
		"width": 384.0
	},
	"console":
	{
		"height": 392.0,
		"history":
		[
			"import urllib.request,os; pf = 'Package Control.sublime-package'; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); open(os.path.join(ipp, pf), 'wb').write(urllib.request.urlopen( 'http://sublime.wbond.net/' + pf.replace(' ','%20')).read())"
		]
	},
	"distraction_free":
	{
		"menu_visible": true,
		"show_minimap": false,
		"show_open_files": false,
		"show_tabs": false,
		"side_bar_visible": false,
		"status_bar_visible": false
	},
	"file_history":
	[
		"/D/Prog/Git/SuperSprint/docs/Top Down Car with Box2D (c++).url",
		"/D/Prog/Git/SuperSprint/app/node_modules/grunt-contrib-uglify/node_modules/uglify-js/lib/mozilla-ast.js",
		"/D/Prog/Git/SuperSprint/app/js/Main.js",
		"/D/Prog/Git/SuperSprint/app/js/libs/box2dweb/Box2dWeb-2.1.a.3.js",
		"/D/Prog/Git/SuperSprint/app/bower.json",
		"/D/Prog/Git/SuperSprint/app/node_modules/karma/node_modules/log4js/test/consoleAppender-test.js",
		"/D/Prog/Git/SuperSprint/app/node_modules/grunt/node_modules/exit/test/fixtures/create-files.sh",
		"/D/Prog/Git/SuperSprint/app/node_modules/karma/node_modules/useragent/CREDITS",
		"/D/Prog/Git/SuperSprint/app/js/libs/pixi.js/docs/classes/CanvasRenderer.html",
		"/D/Dropbox/CONFIGS/Sublime Text 3/Preferences.sublime-settings",
		"/D/Prog/Git/SuperSprint/app/Global.asax",
		"/D/Prog/Git/SuperSprint/app/node_modules/karma/node_modules/http-proxy/node_modules/utile/test/fixtures/require-directory/directory/index.js",
		"/D/Prog/Git/SuperSprint/app/node_modules/karma/node_modules/socket.io/node_modules/socket.io-client/lib/vendor/web-socket-js/flash-src/com/hurlant/crypto/cert/X509CertificateCollection.as",
		"/D/Prog/Git/SuperSprint/app/node_modules/karma/node_modules/socket.io/node_modules/socket.io-client/lib/vendor/web-socket-js/flash-src/com/hurlant/math/ClassicReduction.as",
		"/D/Prog/Git/SuperSprint/app/node_modules/karma/node_modules/socket.io/node_modules/socket.io-client/lib/vendor/web-socket-js/flash-src/com/hurlant/crypto/tls/IConnectionState.as",
		"/D/Prog/Git/SuperSprint/app/js/libs/pixi.js/docs/files/src_pixi_InteractionManager.js.html",
		"/D/Prog/Git/SuperSprint/app/js/libs/pixi.js/docs/files/src_pixi_InteractionData.js.html",
		"/D/Prog/Git/SuperSprint/app/node_modules/karma/node_modules/socket.io/node_modules/socket.io-client/lib/vendor/web-socket-js/flash-src/com/hurlant/math/IReduction.as",
		"/D/Prog/Git/SuperSprint/app/js/libs/pixi.js/docs/files/src_pixi_renderers_canvas_utils_CanvasTinter.js.html",
		"/D/Prog/Git/SuperSprint/app/node_modules/grunt/node_modules/findup-sync/node_modules/glob/test/readme-issue.js",
		"/D/Prog/Git/SuperSprint/app/js/libs/pixi.js/docs/files/src_pixi_filters_RGBSplitFilter.js.html",
		"/C/Users/Simon/AppData/Roaming/Sublime Text 3/Packages/User/Preferences.sublime-settings",
		"/D/Prog/Git/SuperSprint/app/index.html",
		"/C/Users/Simon/AppData/Roaming/Sublime Text 3/Packages/AdvancedNewFile/Default (Windows).sublime-keymap",
		"/D/Prog/Git/SuperSprint/app/js/game.js",
		"/D/Prog/Git/SuperSprint/app/js/utils/salut.js",
		"/D/Prog/Git/SuperSprint/app/index2.html",
		"/D/Prog/Git/SuperSprint/app/js/utils/b2.js",
		"/D/Prog/Git/SuperSprint/app/js/b2Helper.js",
		"/D/Prog/Git/SuperSprint/app/js/Car.js",
		"/D/Prog/Git/SuperSprint/app/js/KeyboardHandler.js",
		"/D/Prog/Git/SuperSprint/app/js/libs/pixi.js/docs/files/src_pixi_utils_Polyk.js.html",
		"/D/Prog/Git/SuperSprint/app/js/libs/pixi.js/src/pixi/utils/Utils.js",
		"/D/Prog/Git/SuperSprint/app/js/Game.js",
		"/C/Users/Simon/AppData/Roaming/Sublime Text 3/Packages/LiveReload/LiveReload.sublime-settings",
		"/C/Users/Simon/AppData/Roaming/Sublime Text 3/Packages/User/LiveReload.sublime-settings",
		"/C/Users/Simon/AppData/Local/Temp/.ssh/SSH_AUTH_SOCK.env",
		"/C/Users/Simon/AppData/Local/Temp/.ssh/SSH_AGENT_PID.env",
		"/C/Users/Simon/.ssh/known_hosts",
		"/C/Users/Simon/.ssh/id_rsa.pub",
		"/C/Users/Simon/.ssh/id_rsa",
		"/D/Prog/Git/SuperSprint/app/app.csproj",
		"/D/Prog/Git/SuperSprint/samples/pixijs_box2d/MouseJoint/src/utils/MathUtil.js",
		"/D/Prog/Git/SuperSprint/samples/pixijs_box2d/MouseJoint/src/Main.js",
		"/D/Prog/Git/SuperSprint/app/js/libs/PhysicsJS/examples/sims/basket.js",
		"/D/Prog/Git/SuperSprint/samples/pixijs_box2d/MouseJoint/index.html",
		"/D/Prog/Git/SuperSprint/app/.bowerrc",
		"/D/Prog/Git/SuperSprint/app/js/libs/physics/examples/showcase.html",
		"/D/Prog/Git/SuperSprint/app/js/libs/physics/examples/sims/impact.js",
		"/D/Prog/Git/SuperSprint/app/js/libs/physics/examples/sims/newtonian.js",
		"/D/Prog/Git/SuperSprint/app/js/libs/physics/examples/sims/simple.js",
		"/D/Prog/Git/Patterns/Commande/README.md",
		"/D/Prog/Git/Patterns/Commande/commande.cs",
		"/C/Users/Simon/AppData/Roaming/Sublime Text 3/Packages/Default/Preferences.sublime-settings",
		"/D/prog/git/PixiJsLib/examples/example 2 - SpriteSheet/SpriteSheet.json",
		"/D/Prog/Git/2048-angular/Webapp/js/app/app.js",
		"/C/Users/Simon/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startup/deletePremiereCache.bat",
		"/D/_Setups/___Premium/Console-2.00b148-Beta_32bit/console.xml",
		"/D/Prog/Git/PixiJsLib/examples/example 12 - Spine/data/spineboySpineData.json",
		"/D/Prog/Git/PixiJsLib/examples/example 12 - Spine/data/spineboy.json",
		"/D/prog/git/PixiJsLib/examples/example 2 - SpriteSheet/index.html",
		"/D/prog/git/angular-phonecat/scripts/web-server.js",
		"/D/Prog/Git/SuperSprint/samples/pixijs_box2d/MouseJoint/test.html",
		"/C/Users/Simon/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startup/deleteLightroomCache.bat",
		"/D/prog/git/WindowsUtils/FileDeletor/README.md",
		"/D/Prog/Git/WindowsUtils/FileDeletor/deleteAdobeCache.bat",
		"/D/prog/git/WindowsUtils/FileDeletor/FileDeletor.sln",
		"/D/prog/git/WindowsUtils/FileDeletor/FileDeletor/FileDeletor.csproj",
		"/D/Dropbox/Prog/Utilities/DeleteAdobeCacheFiles/deleteAdobeCache.bat",
		"/D/Prog/Git/SuperSprint/app/package.json",
		"/D/Prog/Git/SuperSprint/asp.net.sln",
		"/D/Prog/Git/SuperSprint/.gitattributes",
		"/D/Prog/Git/SuperSprint/index.html",
		"/D/Prog/Git/SuperSprint/app/Global.asax.cs",
		"/D/Prog/Git/SuperSprint/node_modules/karma-chrome-launcher/index.js",
		"/D/prog/git/SuperSprint/package.json",
		"/D/Prog/Git/SuperSprint/.gitignore",
		"/D/Prog/Git/SuperSprint/4112-0.gitignore",
		"/D/prog/git/2048-angular/Webapp/js/bower.json",
		"/D/Dropbox/SpeedDialConfig/speeddialconfig.js",
		"/D/prog/git/SuperSprint/game.js",
		"/C/Users/Simon/Documents/WindowsPowerShell/Microsoft.PowerShell_profile.ps1",
		"/D/prog/git/SuperSprint/index.html",
		"/D/Prog/Git/SuperSprint/bower_components/pixi.js/bin/pixi.js",
		"/D/Prog/Git/2048-angular/Webapp/Properties/PublishProfiles/Journeyman.pubxml",
		"/G/_TUTOS/The Structure of Man/HumanBeingHD070.txt",
		"/D/Prog/Git/2048-angular/.gitignore",
		"/D/Prog/Git/2048-angular/Webapp/js/bower.json",
		"/D/Dropbox/1p/test.1pif",
		"/G/_TUTOS/The Structure of Man/HumanBeingHD066.txt",
		"/D/Prog/Git/angular-phonecat/app/index.html",
		"/D/Prog/Git/angular-phonecat/test/unit/controllersSpec.js",
		"/D/Prog/Git/angular-phonecat/app/js/controllers.js",
		"/D/Prog/Git/angular-phonecat/app/js/app.js",
		"/D/Prog/Git/angular-phonecat/scripts/e2e-test.bat",
		"/D/Prog/Git/angular-phonecat/config/karma.conf.js",
		"/D/Prog/Git/angular-phonecat/test/e2e/scenarios.js",
		"/D/Prog/Git/angular-phonecat/test/e2e/runner.html",
		"/D/Prog/Git/angular-phonecat/app/js/services.js",
		"/D/Prog/Git/angular-phonecat/app/js/filters.js",
		"/D/Prog/Git/angular-phonecat/app/js/directives.js",
		"/D/Dropbox/Mel&Simon/Films que Louloute voudrait.txt",
		"/G/_TUTOS/The Structure of Man/HumanBeingHD064.txt",
		"/D/Prog/Git/NodeJs/OpenClassRoomTuto/node_modules/sayhello.js",
		"/D/Prog/Git/NodeJs/OpenClassRoomTuto/node_modules/markdown/README.markdown",
		"/D/Prog/Git/NodeJs/OpenClassRoomTuto/server.js",
		"/D/Prog/Git/NodeJs/OpenClassRoomTuto/node_modules/sayhello",
		"/C/Users/Simon/Desktop/_temp/chap_IV_9/QuickSort.dpr",
		"/C/Users/Simon/AppData/Local/Temp/Rar$DR44.984/Unit1.pas",
		"/C/Users/Simon/AppData/Local/Temp/Rar$DR44.984/Unit1.dfm",
		"/G/BigSetups/Adobe Premiere.Pro_CC_Multi-XFORCE/Crack-Windows/disable_activation.cmd",
		"/C/Windows/System32/drivers/etc/hosts",
		"/D/Prog/Git/angular60ish/index.html",
		"/D/Prog/Git/angular-phonecat/app/lib/angular/angular-scenario.js",
		"/D/Prog/Git/angular-phonecat/test/e2e/app/lib/angular/angular-scenario.js",
		"/D/Prog/Git/angular-phonecat/scripts/test.bat",
		"/D/Prog/Git/gokeyboard/.gitignore",
		"/D/Dropbox/Prog/ASP.NET MVC/GoKeyboard/GoKeyboard.Webapp/Content/Site.less",
		"/D/Dropbox/Prog/ASP.NET MVC/GoKeyboard/GoKeyboard.Webapp/Content/mixin.less",
		"/D/Dropbox/Prog/ASP.NET MVC/GoKeyboard/TemplatingHTML/Gabarits/styles/base.css",
		"/D/Dropbox/Prog/ASP.NET MVC/GoKeyboard/TemplatingHTML/Gabarits/styles/modele06.css",
		"/D/Dropbox/Prog/ASP.NET MVC/GoKeyboard/TemplatingHTML/Gabarits/modele06.html",
		"/C/Users/Simon/Downloads/Madagascar 2005 H264 DVDRip 5.1 ch-SecretMyth/Madagascar.srt",
		"/C/Users/Simon/Desktop/test.html",
		"/D/Dropbox/Prog/PHP/lagarennebossard/sftp-config.json",
		"/D/Dropbox/Prog/ASP.NET MVC/GoKeyboard/GoKeyboard.Webapp/Content/bootstrap.css",
		"/D/Dropbox/Prog/ASP.NET MVC/Sc2TutsBase/Sc2TutsBase/Content/css/MFInLess.less",
		"/D/Dropbox/Prog/ASP.NET MVC/GoKeyboard/GoKeyboard.sln"
	],
	"find":
	{
		"height": 55.0
	},
	"find_in_files":
	{
		"height": 157.0,
		"where_history":
		[
			""
		]
	},
	"find_state":
	{
		"case_sensitive": false,
		"find_history":
		[
			"images/",
			"baseFixture",
			"b2_staticBody",
			"createwal",
			"METER",
			"console",
			");\n",
			"<<<",
			"#17b",
			"find",
			"search",
			"highl",
			"var",
			"AdobeCacheDeleter",
			"keyboardHandler",
			"3",
			"test",
			"renderer",
			"Renderer",
			"renderer",
			"Renderer",
			"renderer",
			"Renderer",
			"renderer",
			"Renderer",
			"renderer",
			"Renderer",
			"renderer",
			"Renderer",
			"renderer",
			"load",
			"Load",
			"load",
			">\n",
			"Assets",
			"assets",
			"Assets",
			"assets",
			"..",
			"extensionWith",
			"ado",
			"bunny",
			"<<<",
			".db",
			"127.0.0.1 lm.licenses.adobe.com",
			"127.0.0.1 lmlicenses.wip4.adobe.com",
			"#332510",
			"#F0E39E",
			"#363B29",
			"#181A12",
			"img/",
			"nav",
			"galleria-image-nav-right",
			"body",
			"animation",
			"scroll"
		],
		"highlight": false,
		"in_selection": false,
		"preserve_case": false,
		"regex": true,
		"replace_history":
		[
			"wallFixture",
			"@linkColor",
			"@globalColor",
			"@contentTextColor",
			"@contentBgColor",
			"./images/"
		],
		"reverse": false,
		"show_context": true,
		"use_buffer2": true,
		"whole_word": false,
		"wrap": false
	},
	"groups":
	[
		{
			"selected": 7,
			"sheets":
			[
				{
					"buffer": 0,
					"file": "js/b2Helper.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 2708,
						"regions":
						{
						},
						"selection":
						[
							[
								1805,
								1805
							]
						],
						"settings":
						{
							"incomplete_sync": null,
							"remote_loading": false,
							"synced": false,
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"translate_tabs_to_spaces": false
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 6,
					"type": "text"
				},
				{
					"buffer": 1,
					"file": "js/utils/b2.js",
					"semi_transient": true,
					"settings":
					{
						"buffer_size": 127,
						"regions":
						{
						},
						"selection":
						[
							[
								0,
								0
							]
						],
						"settings":
						{
							"incomplete_sync": null,
							"remote_loading": false,
							"synced": false,
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage"
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 10,
					"type": "text"
				},
				{
					"buffer": 2,
					"file": "js/utils/Consts.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 263,
						"regions":
						{
						},
						"selection":
						[
							[
								46,
								46
							]
						],
						"settings":
						{
							"incomplete_sync": null,
							"remote_loading": false,
							"synced": false,
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage"
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 9,
					"type": "text"
				},
				{
					"buffer": 3,
					"file": "js/Car.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 3997,
						"regions":
						{
						},
						"selection":
						[
							[
								231,
								231
							]
						],
						"settings":
						{
							"incomplete_sync": null,
							"remote_loading": false,
							"synced": false,
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"translate_tabs_to_spaces": false
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 4,
					"type": "text"
				},
				{
					"buffer": 4,
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 669585,
						"regions":
						{
							"match":
							{
								"flags": 112,
								"regions":
								[
									[
										207,
										214
									],
									[
										379,
										386
									],
									[
										587,
										594
									],
									[
										732,
										739
									],
									[
										989,
										996
									],
									[
										1184,
										1191
									],
									[
										1447,
										1454
									],
									[
										1822,
										1829
									],
									[
										2103,
										2110
									],
									[
										2603,
										2610
									],
									[
										7366,
										7373
									],
									[
										7651,
										7658
									],
									[
										7846,
										7853
									],
									[
										8109,
										8116
									],
									[
										8637,
										8644
									],
									[
										13400,
										13407
									],
									[
										14669,
										14676
									],
									[
										24447,
										24454
									],
									[
										24971,
										24978
									],
									[
										26004,
										26011
									],
									[
										31684,
										31691
									],
									[
										31824,
										31831
									],
									[
										32136,
										32143
									],
									[
										33804,
										33811
									],
									[
										43781,
										43788
									],
									[
										44321,
										44328
									],
									[
										44682,
										44689
									],
									[
										45072,
										45079
									],
									[
										45476,
										45483
									],
									[
										45847,
										45854
									],
									[
										46267,
										46274
									],
									[
										46524,
										46531
									],
									[
										46966,
										46973
									],
									[
										47208,
										47215
									],
									[
										47485,
										47492
									],
									[
										47848,
										47855
									],
									[
										48219,
										48226
									],
									[
										48559,
										48566
									],
									[
										48998,
										49005
									],
									[
										49292,
										49299
									],
									[
										49633,
										49640
									],
									[
										49965,
										49972
									],
									[
										50158,
										50165
									],
									[
										51739,
										51746
									],
									[
										53833,
										53840
									],
									[
										54301,
										54308
									],
									[
										56602,
										56609
									],
									[
										59038,
										59045
									],
									[
										62591,
										62598
									],
									[
										67597,
										67604
									],
									[
										71575,
										71582
									],
									[
										439572,
										439579
									],
									[
										641235,
										641242
									],
									[
										655458,
										655465
									],
									[
										669509,
										669516
									]
								],
								"scope": ""
							}
						},
						"selection":
						[
							[
								666,
								666
							]
						],
						"settings":
						{
							"detect_indentation": false,
							"incomplete_sync": null,
							"line_numbers": false,
							"output_tag": 1,
							"result_base_dir": "",
							"result_file_regex": "^([A-Za-z\\\\/<].*):$",
							"result_line_regex": "^ +([0-9]+):",
							"scroll_past_end": true,
							"syntax": "Packages/Default/Find Results.hidden-tmLanguage"
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 3,
					"type": "text"
				},
				{
					"buffer": 5,
					"file": "js/Sprites.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 42,
						"regions":
						{
						},
						"selection":
						[
							[
								24,
								24
							]
						],
						"settings":
						{
							"incomplete_sync": null,
							"remote_loading": false,
							"synced": false,
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage"
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 2,
					"type": "text"
				},
				{
					"buffer": 6,
					"file": "/D/Prog/Git/SuperSprint/README.md",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 893,
						"regions":
						{
						},
						"selection":
						[
							[
								859,
								859
							]
						],
						"settings":
						{
							"incomplete_sync": null,
							"remote_loading": false,
							"synced": false,
							"syntax": "Packages/Markdown/Markdown.tmLanguage"
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 1,
					"type": "text"
				},
				{
					"buffer": 7,
					"file": "/C/Windows/System32/drivers/etc/hosts",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 435610,
						"regions":
						{
						},
						"selection":
						[
							[
								0,
								0
							]
						],
						"settings":
						{
							"incomplete_sync": null,
							"remote_loading": false,
							"synced": false,
							"syntax": "Packages/Text/Plain text.tmLanguage"
						},
						"translation.x": 0.0,
						"translation.y": 486.0,
						"zoom_level": 1.0
					},
					"stack_index": 0,
					"type": "text"
				},
				{
					"buffer": 8,
					"file": "js/Main.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 2554,
						"regions":
						{
						},
						"selection":
						[
							[
								2496,
								2496
							]
						],
						"settings":
						{
							"incomplete_sync": null,
							"remote_loading": false,
							"synced": false,
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"translate_tabs_to_spaces": false
						},
						"translation.x": 0.0,
						"translation.y": 882.0,
						"zoom_level": 1.0
					},
					"stack_index": 7,
					"type": "text"
				},
				{
					"buffer": 9,
					"file": "/C/Users/Simon/AppData/Roaming/Sublime Text 3/Packages/User/Preferences.sublime-settings",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 601,
						"regions":
						{
						},
						"selection":
						[
							[
								487,
								487
							]
						],
						"settings":
						{
							"incomplete_sync": null,
							"remote_loading": false,
							"synced": false,
							"syntax": "Packages/JavaScript/JSON.tmLanguage",
							"translate_tabs_to_spaces": false
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 8,
					"type": "text"
				},
				{
					"buffer": 10,
					"file": "index.html",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 871,
						"regions":
						{
						},
						"selection":
						[
							[
								119,
								121
							]
						],
						"settings":
						{
							"incomplete_sync": null,
							"remote_loading": false,
							"synced": false,
							"syntax": "Packages/HTML/HTML.tmLanguage",
							"translate_tabs_to_spaces": false
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 5,
					"type": "text"
				}
			]
		}
	],
	"incremental_find":
	{
		"height": 31.0
	},
	"input":
	{
		"height": 36.0
	},
	"layout":
	{
		"cells":
		[
			[
				0,
				0,
				1,
				1
			]
		],
		"cols":
		[
			0.0,
			1.0
		],
		"rows":
		[
			0.0,
			1.0
		]
	},
	"menu_visible": true,
	"output.find_results":
	{
		"height": 0.0
	},
	"output.sftp":
	{
		"height": 220.0
	},
	"output.unsaved_changes":
	{
		"height": 118.0
	},
	"project": "supersprint.sublime-project",
	"replace":
	{
		"height": 106.0
	},
	"save_all_on_build": true,
	"select_file":
	{
		"height": 0.0,
		"selected_items":
		[
			[
				"car",
				"js\\Car.js"
			],
			[
				"main",
				"js\\Main.js"
			],
			[
				"b2hel",
				"js\\b2Helper.js"
			],
			[
				"car.js",
				"js\\Car.js"
			],
			[
				"index",
				"app\\index.html"
			],
			[
				"index.",
				"index.html"
			]
		],
		"width": 0.0
	},
	"select_project":
	{
		"height": 500.0,
		"selected_items":
		[
			[
				"",
				"D:\\Prog\\Git\\SuperSprint\\app\\supersprint.sublime-project"
			]
		],
		"width": 380.0
	},
	"select_symbol":
	{
		"height": 368.0,
		"selected_items":
		[
			[
				"createwall",
				"CreateWalls"
			]
		],
		"width": 640.0
	},
	"settings":
	{
	},
	"show_minimap": true,
	"show_open_files": true,
	"show_tabs": true,
	"side_bar_visible": true,
	"side_bar_width": 231.0,
	"status_bar_visible": true,
	"template_settings":
	{
	}
}
