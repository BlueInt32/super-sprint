/**
 * PhysicsJS v0.5.4 - 2014-02-03
 * A modular, extendable, and easy-to-use physics engine for javascript
 * http://wellcaffeinated.net/PhysicsJS
 *
 * Copyright (c) 2014 Jasper Palfree <jasper@wellcaffeinated.net>
 * Licensed MIT
 */
!function(a,b){"object"==typeof exports?module.exports=b.call(a):"function"==typeof define&&define.amd?define(function(){return b.call(a)}):a.Physics=b.call(a)}(this,function(){"use strict";var a=this,b=a.document,c=function e(){return e.world.apply(e,arguments)};c.util={},!function(a){function d(a){return"function"!=typeof a.toString&&"string"==typeof(a+"")}function e(){}function f(a){a.length=0,A.length<D&&A.push(a)}function g(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);var d=-1;c=c-b||0;for(var e=Array(0>c?0:c);++d<c;)e[d]=a[b+d];return e}function h(){}function i(a,b,c,e,h){if(c){var j=c(a);if("undefined"!=typeof j)return j}if(!s(a))return a;var k=hb.call(a);if(!R[k]||!vb.nodeClass&&d(a))return a;var l=tb[k];switch(k){case K:case L:return new l(+a);case N:case Q:return new l(a);case P:return j=l(a.source,E.exec(a)),j.lastIndex=a.lastIndex,j}if(k=xb(a),b){var m=!e;e||(e=A.pop()||[]),h||(h=A.pop()||[]);for(var n=e.length;n--;)if(e[n]==a)return h[n];j=k?l(a.length):{}}else j=k?g(a):Cb({},a);return k&&(db.call(a,"index")&&(j.index=a.index),db.call(a,"input")&&(j.input=a.input)),b?(e.push(a),h.push(j),(k?Bb:Eb)(a,function(a,d){j[d]=i(a,b,c,e,h)}),m&&(f(e),f(h)),j):j}function j(a,b,c){if("function"!=typeof a)return x;if("undefined"==typeof b)return a;var d=a.__bindData__||vb.funcNames&&!a.name;if("undefined"==typeof d){var e=G&&bb.call(a);vb.funcNames||!e||F.test(e)||(d=!0),(vb.funcNames||!d)&&(d=!vb.funcDecomp||G.test(e),wb(a,d))}if(!0!==d&&d&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return v(a,b)}function l(a,b,c,e,g,h){if(c){var i=c(a,b);if("undefined"!=typeof i)return!!i}if(a===b)return 0!==a||1/a==1/b;if(a===a&&!(a&&V[typeof a]||b&&V[typeof b]))return!1;if(null==a||null==b)return a===b;var j=hb.call(a),k=hb.call(b);if(j==I&&(j=O),k==I&&(k=O),j!=k)return!1;switch(j){case K:case L:return+a==+b;case N:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case P:case Q:return a==b+""}if(k=j==J,!k){if(db.call(a,"__wrapped__")||db.call(b,"__wrapped__"))return l(a.__wrapped__||a,b.__wrapped__||b,c,e,g,h);if(j!=O||!vb.nodeClass&&(d(a)||d(b)))return!1;var j=!vb.argsObject&&q(a)?Object:a.constructor,m=!vb.argsObject&&q(b)?Object:b.constructor;if(j!=m&&!(r(j)&&j instanceof j&&r(m)&&m instanceof m))return!1}for(m=!g,g||(g=A.pop()||[]),h||(h=A.pop()||[]),j=g.length;j--;)if(g[j]==a)return h[j]==b;var n=0,i=!0;if(g.push(a),h.push(b),k){if(j=a.length,n=b.length,i=n==a.length,!i&&!e)return i;for(;n--;)if(k=j,m=b[n],e)for(;k--&&!(i=l(a[k],m,c,e,g,h)););else if(!(i=l(a[n],m,c,e,g,h)))break;return i}return Db(b,function(b,d,f){return db.call(f,d)?(n++,i=db.call(a,d)&&l(a[d],b,c,e,g,h)):void 0}),i&&!e&&Db(a,function(a,b,c){return db.call(c,b)?i=-1<--n:void 0}),m&&(f(g),f(h)),i}function m(a,b,c,d,e,f){var g=1&b,h=2&b,i=4&b,j=8&b,k=16&b,l=32&b,n=a;if(!h&&!r(a))throw new TypeError;k&&!c.length&&(b&=-17,k=c=!1),l&&!d.length&&(b&=-33,l=d=!1);var p=a&&a.__bindData__;if(p)return!g||1&p[1]||(p[4]=e),!g&&1&p[1]&&(b|=8),!i||4&p[1]||(p[5]=f),k&&fb.apply(p[2]||(p[2]=[]),c),l&&fb.apply(p[3]||(p[3]=[]),d),p[1]|=b,m.apply(null,p);if(!g||h||i||l||!(vb.fastBind||kb&&k))t=function(){var p=arguments,q=g?e:this;return(i||k||l)&&(p=rb.call(p),k&&ib.apply(p,c),l&&fb.apply(p,d),i&&p.length<f)?(b|=16,m(a,j?b:-4&b,p,null,e,f)):(h&&(a=q[n]),this instanceof t?(q=o(a.prototype),p=a.apply(q,p),s(p)?p:q):a.apply(q,p))};else{if(k){var q=[e];fb.apply(q,c)}var t=k?kb.apply(a,q):kb.call(a,e)}return wb(t,rb.call(arguments)),t}function n(){U.h=H,U.b=U.c=U.g=U.i="",U.e="t",U.j=!0;for(var a,b=0;a=arguments[b];b++)for(var c in a)U[c]=a[c];b=U.a,U.d=/^[^,]+/.exec(b)[0],a=Function,b="return function("+b+"){",c=U;var d="var n,t="+c.d+",E="+c.e+";if(!t)return E;"+c.i+";";c.b?(d+="var u=t.length;n=-1;if("+c.b+"){",vb.unindexedChars&&(d+="if(s(t)){t=t.split('')}"),d+="while(++n<u){"+c.g+";}}else{"):vb.nonEnumArgs&&(d+="var u=t.length;n=-1;if(u&&p(t)){while(++n<u){n+='';"+c.g+";}}else{"),vb.enumPrototypes&&(d+="var G=typeof t=='function';"),vb.enumErrorProps&&(d+="var F=t===k||t instanceof Error;");var e=[];if(vb.enumPrototypes&&e.push('!(G&&n=="prototype")'),vb.enumErrorProps&&e.push('!(F&&(n=="message"||n=="name"))'),c.j&&c.f)d+="var C=-1,D=B[typeof t]&&v(t),u=D?D.length:0;while(++C<u){n=D[C];",e.length&&(d+="if("+e.join("&&")+"){"),d+=c.g+";",e.length&&(d+="}"),d+="}";else if(d+="for(n in t){",c.j&&e.push("m.call(t, n)"),e.length&&(d+="if("+e.join("&&")+"){"),d+=c.g+";",e.length&&(d+="}"),d+="}",vb.nonEnumShadows){for(d+="if(t!==A){var i=t.constructor,r=t===(i&&i.prototype),f=t===J?I:t===k?j:L.call(t),x=y[f];",k=0;7>k;k++)d+="n='"+c.h[k]+"';if((!(r&&x[n])&&m.call(t,n))",c.j||(d+="||(!x[n]&&t[n]!==A[n])"),d+="){"+c.g+"}";d+="}"}return(c.b||vb.nonEnumArgs)&&(d+="}"),d+=c.c+";return E",a("d,j,k,m,o,p,q,s,v,A,B,y,I,J,L",b+d+"}")(j,M,Y,db,C,q,xb,t,U.f,Z,V,ub,Q,$,hb)}function o(a){return s(a)?lb(a):{}}function p(a){var b,c;return!a||hb.call(a)!=O||(b=a.constructor,r(b)&&!(b instanceof b))||!vb.argsClass&&q(a)||!vb.nodeClass&&d(a)?!1:vb.ownLast?(Db(a,function(a,b,d){return c=db.call(d,b),!1}),!1!==c):(Db(a,function(a,b){c=b}),"undefined"==typeof c||db.call(a,c))}function q(a){return a&&"object"==typeof a&&"number"==typeof a.length&&hb.call(a)==I||!1}function r(a){return"function"==typeof a}function s(a){return!(!a||!V[typeof a])}function t(a){return"string"==typeof a||hb.call(a)==Q}function u(a,b,c){if(b&&"undefined"==typeof c&&xb(a)){c=-1;for(var d=a.length;++c<d&&!1!==b(a[c],c,a););}else Bb(a,b,c);return a}function v(a,b){return 2<arguments.length?m(a,17,rb.call(arguments,2),null,b):m(a,1,null,null,b)}function w(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!r(a))throw new TypeError;if(b=ob(0,b)||0,!0===c)var n=!0,m=!1;else s(c)&&(n=c.leading,l="maxWait"in c&&(ob(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var o=function(){var c=b-(eb()-g);c>0?i=setTimeout(o,c):(e&&clearTimeout(e),c=j,e=i=j=z,c&&(k=eb(),f=a.apply(h,d)))},p=function(){i&&clearTimeout(i),e=i=j=z,(m||l!==b)&&(k=eb(),f=a.apply(h,d))};return function(){if(d=arguments,g=eb(),h=this,j=m&&(i||!n),!1===l)var c=n&&!i;else{e||n||(k=g);var q=l-(g-k);q>0?e||(e=setTimeout(p,q)):(e&&(e=clearTimeout(e)),k=g,f=a.apply(h,d))}return i||b===l||(i=setTimeout(o,b)),c&&(f=a.apply(h,d)),f}}function x(a){return a}function y(a,b,c){var d=null==a,e=null==b;return null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,d=qb(),c||a%1||b%1?pb(a+d*(b-a+parseFloat("1e-"+((d+"").length-1))),b):a+ab(d*(b-a+1))}var z,A=[],B=0,C={},D=40,E=/\w*$/,F=/^function[ \n\r\t]+\w/,G=/\bthis\b/,H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),I="[object Arguments]",J="[object Array]",K="[object Boolean]",L="[object Date]",M="[object Error]",N="[object Number]",O="[object Object]",P="[object RegExp]",Q="[object String]",R={"[object Function]":!1};R[I]=R[J]=R[K]=R[L]=R[N]=R[O]=R[P]=R[Q]=!0;var S={leading:!1,maxWait:0,trailing:!1},T={configurable:!1,enumerable:!1,value:null,writable:!1},U={a:"",b:null,c:"",d:"",e:"",v:null,g:"",h:null,support:null,i:"",j:!1},V={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},W=V[typeof a]&&a||this,X=[],Y=Error.prototype,Z=Object.prototype,$=String.prototype,_=RegExp("^"+(Z.valueOf+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),ab=Math.floor,bb=Function.prototype.toString,cb=_.test(cb=Object.getPrototypeOf)&&cb,db=Z.hasOwnProperty,eb=_.test(eb=Date.now)&&eb||function(){return+new Date},fb=X.push,gb=Z.propertyIsEnumerable,hb=Z.toString,ib=X.unshift,jb=function(){try{var a={},b=_.test(b=Object.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),kb=_.test(kb=hb.bind)&&kb,lb=_.test(lb=Object.create)&&lb,mb=_.test(mb=Array.isArray)&&mb,nb=_.test(nb=Object.keys)&&nb,ob=Math.max,pb=Math.min,qb=Math.random,rb=X.slice;a=_.test(W.attachEvent);var sb=kb&&!/\n|true/.test(kb+a),tb={};tb[J]=Array,tb[K]=Boolean,tb[L]=Date,tb["[object Function]"]=Function,tb[O]=Object,tb[N]=Number,tb[P]=RegExp,tb[Q]=String;var ub={};ub[J]=ub[L]=ub[N]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},ub[K]=ub[Q]={constructor:!0,toString:!0,valueOf:!0},ub[M]=ub["[object Function]"]=ub[P]={constructor:!0,toString:!0},ub[O]={constructor:!0},function(){for(var a=H.length;a--;){var b,c=H[a];for(b in ub)db.call(ub,b)&&!db.call(ub[b],c)&&(ub[b][c]=!1)}}();var vb=h.support={};!function(){var a=function(){this.x=1},c={0:1,length:1},d=[];a.prototype={valueOf:1,y:1};for(var e in new a)d.push(e);for(e in arguments);vb.argsClass=hb.call(arguments)==I,vb.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),vb.enumErrorProps=gb.call(Y,"message")||gb.call(Y,"name"),vb.enumPrototypes=gb.call(a,"prototype"),vb.fastBind=kb&&!sb,vb.funcDecomp=!_.test(W.WinRTError)&&G.test(function(){return this}),vb.funcNames="string"==typeof Function.name,vb.nonEnumArgs=0!=e,vb.nonEnumShadows=!/valueOf/.test(d),vb.ownLast="x"!=d[0],vb.spliceObjects=(X.splice.call(c,0,1),!c[0]),vb.unindexedChars="xx"!="x"[0]+Object("x")[0];try{vb.nodeClass=!(hb.call(b)==O&&!({toString:0}+""))}catch(f){vb.nodeClass=!0}}(1),lb||(o=function(a){if(s(a)){e.prototype=a;var b=new e;e.prototype=null}return b||{}});var wb=jb?function(a,b){T.value=b,jb(a,"__bindData__",T)}:e;vb.argsClass||(q=function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&db.call(a,"callee")||!1});var xb=mb||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&hb.call(a)==J||!1},yb=n({a:"z",e:"[]",i:"if(!(B[typeof z]))return E",g:"E.push(n)"}),zb=nb?function(a){return s(a)?vb.enumPrototypes&&"function"==typeof a||vb.nonEnumArgs&&a.length&&q(a)?yb(a):nb(a):[]}:yb,mb={a:"g,e,K",i:"e=e&&typeof K=='undefined'?e:d(e,K,3)",b:"typeof u=='number'",v:zb,g:"if(e(t[n],n,g)===false)return E"};a={a:"z,H,l",i:"var a=arguments,b=0,c=typeof l=='number'?2:a.length;while(++b<c){t=a[b];if(t&&B[typeof t]){",v:zb,g:"if(typeof E[n]=='undefined')E[n]=t[n]",c:"}}"};var Ab={i:"if(!B[typeof t])return E;"+mb.i,b:!1},Bb=n(mb),Cb=n(a,{i:a.i.replace(";",";if(c>3&&typeof a[c-2]=='function'){var e=d(a[--c-1],a[c--],2)}else if(c>2&&typeof a[c-1]=='function'){e=a[--c]}"),g:"E[n]=e?e(E[n],t[n]):t[n]"}),Db=n(mb,Ab,{j:!1}),Eb=n(mb,Ab);r(/x/)&&(r=function(a){return"function"==typeof a&&"[object Function]"==hb.call(a)}),mb=cb?function(a){if(!a||hb.call(a)!=O||!vb.argsClass&&q(a))return!1;var b=a.valueOf,c="function"==typeof b&&(c=cb(b))&&cb(c);return c?a==c||cb(a)==c:p(a)}:p,h.assign=Cb,h.bind=v,h.createCallback=function(a,b,c){var d=typeof a;if(null==a||"function"==d)return j(a,b,c);if("object"!=d)return function(b){return b[a]};var e=zb(a),f=e[0],g=a[f];return 1!=e.length||g!==g||s(g)?function(b){for(var c=e.length,d=!1;c--&&(d=l(b[e[c]],a[e[c]],null,!0)););return d}:function(a){return a=a[f],g===a&&(0!==g||1/g==1/a)}},h.debounce=w,h.forEach=u,h.forIn=Db,h.forOwn=Eb,h.keys=zb,h.shuffle=function(a){var b=-1,c=a?a.length:0,d=Array("number"==typeof c?c:0);return u(a,function(a){var c=y(++b);d[b]=d[c],d[c]=a}),d},h.throttle=function(a,b,c){var d=!0,e=!0;if(!r(a))throw new TypeError;return!1===c?d=!1:s(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),S.leading=d,S.maxWait=b,S.trailing=e,w(a,b,S)},h.each=u,h.extend=Cb,h.clone=function(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),i(a,b,"function"==typeof c&&j(c,d,1))},h.identity=x,h.isArguments=q,h.isArray=xb,h.isFunction=r,h.isObject=s,h.isPlainObject=mb,h.isString=t,h.random=y,h.sortedIndex=function(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?h.createCallback(c,d,1):x,b=c(b);f>e;)d=e+f>>>1,c(a[d])<b?e=d+1:f=d;return e},h.uniqueId=function(a){var b=++B;return(null==a?"":a)+""+b},h.VERSION="2.2.1",h.extend(c.util,h)}(this);var d=c.util.decorator=function(a,b){var d={},e={},f=function(a,b){return c.util.isFunction(b)?b:a},g=Object.getPrototypeOf;"function"!=typeof g&&(g="object"==typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});var h=Object.create;"function"!=typeof h&&(h=function(a){function b(){}return b.prototype=a,new b});var i=function(b,d){return"object"==typeof b?(e=c.util.extend(e,b,f),e.type=a,void 0):("type"!==b&&c.util.isFunction(d)&&(e[b]=d),void 0)};i(b);var j=function(b,i,j,k){var l,m=e;if("string"!=typeof i)k=j,j=i;else{if(m=d[i],!m)throw'Error: "'+i+'" '+a+" not defined";m=m.prototype}if("function"==typeof j)l=d[b],l?l.prototype=c.util.extend(l.prototype,j(g(l.prototype)),f):(l=d[b]=function(a){this.init&&this.init(a)},l.prototype=h(m),l.prototype=c.util.extend(l.prototype,j(m),f)),l.prototype.type=a,l.prototype.name=b;else if(k=j||{},l=d[b],!l)throw'Error: "'+b+'" '+a+" not defined";return k?new l(k):void 0};return j.mixin=i,j};return function(a){var b=a.Physics;c.noConflict=function(){return a.Physics===c&&(a.Physics=b),c}}(this),function(){var a=function b(a){return this instanceof b?(this.initPubsub(a),void 0):new b(a)};a.prototype={initPubsub:function(a){this._topics={},this._defaultScope=a||this},subscribe:function(a,b,d,e){var f,g=this._topics[a]||(this._topics[a]=[]),h=b;if(c.util.isObject(a)){for(var i in a)this.subscribe(i,a[i],b,d);return this}return c.util.isObject(d)?(b=c.util.bind(b,d),b._bindfn_=h):e||(e=d),b._priority_=e,f=c.util.sortedIndex(g,b,"_priority_"),g.splice(f,0,b),this},unsubscribe:function(a,b){if(a===!0)return this._topics={},this;var c,d=this._topics[a];if(!d)return this;if(b===!0)return this._topics[a]=[],this;for(var e=0,f=d.length;f>e;e++)if(c=d[e],c._bindfn_===b||c===b){d.splice(e,1);break}return this},publish:function(a){"object"!=typeof a&&(a={topic:a});var b=a.topic,c=this._topics[b],d=c&&c.length;if(!b)throw"Error: No topic specified in call to world.publish()";if(!d)return this;for(a.scope=a.scope||this._defaultScope;d--;)a.handler=c[d],a.handler(a);return this}},c.util.pubsub=a}(),function(a){for(var b=0,c=["ms","moz","webkit","o"],d=0;d<c.length&&!a.requestAnimationFrame;++d)a.requestAnimationFrame=a[c[d]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[c[d]+"CancelAnimationFrame"]||a[c[d]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(c){var d=(new Date).getTime(),e=Math.max(0,16-(d-b)),f=a.setTimeout(function(){c(d+e)},e);return b=d+e,f}),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)})}(this),function(){var a=100,b=10,d="Error: Scratchpad used after .done() called. (Could it be unintentionally scoped?)",e="Error: Scratchpad usage space out of bounds. (Did you forget to call .done()?)",f="Error: Too many scratchpads created. (Did you forget to call .done()?)",g=[],h=0,i=function(){if(this.objIndex=0,this.arrayIndex=0,this.vectorIndex=0,this.aabbIndex=0,this.transformIndex=0,this.objectStack=[],this.arrayStack=[],this.vectorStack=[],this.aabbStack=[],this.transformStack=[],++h>=a)throw f};i.prototype={done:function(){this._active=!1,this.objIndex=this.arrayIndex=this.vectorIndex=this.aabbIndex=this.transformIndex=0,g.push(this)},object:function(){var a=this.objectStack;if(!this._active)throw d;if(this.objIndex>=b)throw e;return a[this.objIndex++]||a[a.push({})-1]},array:function(){var a=this.arrayStack;if(!this._active)throw d;if(this.arrIndex>=b)throw e;return a[this.arrIndex++]||a[a.push([])-1]},vector:function(){var a=this.vectorStack;if(!this._active)throw d;if(this.vectorIndex>=b)throw e;return a[this.vectorIndex++]||a[a.push(c.vector())-1]},aabb:function(){var a=this.aabbStack;if(!this._active)throw d;if(this.aabbIndex>=b)throw e;return a[this.aabbIndex++]||a[a.push(c.aabb())-1]},transform:function(){var a=this.transformStack;if(!this._active)throw d;if(this.transformIndex>=b)throw e;return a[this.transformIndex++]||a[a.push(c.transform())-1]}},c.scratchpad=function(){var a=g.pop()||new i;return a._active=!0,a}}(),function(a){function b(c){var d=k;if(j){a.requestAnimationFrame(b);for(var e=0,f=d.length;f>e;++e)d[e](c,c-i);i=c}}function d(){return i=(new Date).getTime(),j=!0,b(),this}function e(){return j=!1,this}function f(a){if("function"==typeof a){for(var b=0,c=k.length;c>b;++b)if(a===k[b])return this;k.push(a)}return this}function g(a){for(var b=k,c=0,d=b.length;d>c;++c)if(b[c]===a)return b.splice(c,1),this;return this}function h(){return!!j}var i=0,j=!1,k=[];c.util.ticker={start:d,stop:e,subscribe:f,unsubscribe:g,isActive:h}}(this),function(){var a=function b(a,d,e,f){return this instanceof b?(this._pos=c.vector(),this.set(a,d,e,f),void 0):new b(a,d,e,f)};a.prototype.set=function(a,b,d,e){return c.util.isObject(a)?(this._pos.clone(a.pos),this._hw=a.halfWidth,this._hh=a.halfHeight,this):(this._pos.set(.5*(d+a),.5*(e+b)),this._hw=.5*(d-a),this._hh=.5*(e-b),this)},a.prototype.get=function(){var a=this.halfWidth(),b=this.halfHeight();return{pos:this._pos.values(),halfWidth:a,halfHeight:b,x:a,y:b}},a.prototype.halfWidth=function(){return this._hw},a.prototype.halfHeight=function(){return this._hh},a.prototype.contains=function(a){var b=void 0!==a.x?a.x:a.get(0),c=void 0!==a.y?a.y:a.get(1);return b>this._pos.get(0)-this._hw&&b<this._pos.get(0)+this._hw&&c>this._pos.get(1)-this._hh&&c<this._pos.get(1)+this._hh},a.prototype.transform=function(a){var b=this._hw,d=this._hh,e=c.scratchpad(),f=e.vector().set(b,d),g=e.vector().set(b,-d);return this._pos.translate(a),f.rotate(a),g.rotate(a),this._hw=Math.max(Math.abs(f.get(0)),Math.abs(g.get(0))),this._hh=Math.max(Math.abs(f.get(1)),Math.abs(g.get(1))),e.done(),this},a.contains=function(a,b){var c=void 0!==b.x?b.x:b.get(0),d=void 0!==b.y?b.y:b.get(1);return a=a.get?a.get():a,c>a.pos.x-a.halfWidth&&c<a.pos.x+a.halfWidth&&d>a.pos.y-a.halfHeight&&d<a.pos.y+a.halfHeight},c.aabb=a}(),function(){var a=1e-4,b=100,d=function(a,b,c){var d=b.normSq()-b.dot(a),e=b.dot(a)-a.normSq();return 0>d?c.clone(b).negate():e>0?c.clone(a).negate():(c.clone(b).vsub(a),c.perp(a.cross(c)<0))},e=function(a){var b,d,e=a.length,f=a[e-2],g=a[e-3],h=c.scratchpad(),i=h.vector().clone(f.pt),j=h.vector().clone(g.pt).vsub(i);if(j.equals(c.vector.zero))return h.done(),{a:f.a,b:f.b};if(b=-j.dot(i)/j.normSq(),d=1-b,0>=d)return h.done(),{a:g.a,b:g.b};if(0>=b)return h.done(),{a:f.a,b:f.b};var k={a:i.clone(f.a).mult(d).vadd(j.clone(g.a).mult(b)).values(),b:i.clone(f.b).mult(d).vadd(j.clone(g.b).mult(b)).values()};return h.done(),k},f=function(f,g,h,i){var j,k,l,m,n=!1,o=!1,p=!1,q=[],r=1,s=c.scratchpad(),t=s.vector().clone(g||c.vector.axis[0]),u=s.vector(),v=s.vector(),w=s.vector(),x=s.vector(),y=0;for(m=f(t),r=q.push(m),u.clone(m.pt),t.negate();++y;){if(u.swap(v),m=f(t),r=q.push(m),u.clone(m.pt),i&&i(q),u.equals(c.vector.zero)){n=!0;break}if(!o&&u.dot(t)<=0){if(h)break;o=!0}if(2===r)t=d(u,v,t);else if(o){if(t.normalize(),m=v.dot(t),Math.abs(m-u.dot(t))<a){p=-m;break}v.normSq()<w.clone(q[0].pt).normSq()?q.shift():q.splice(1,1),t=d(w.clone(q[1].pt),x.clone(q[0].pt),t)}else if(j=j||s.vector(),k=k||s.vector(),j.clone(v).vsub(u),k.clone(q[0].pt).vsub(u),l=j.cross(k)>0,l^u.cross(j)>0)q.shift(),j.perp(l),t.swap(j);else{if(!(l^k.cross(u)>0)){n=!0;break}q.splice(1,1),k.perp(!l),t.swap(j)}if(y>b)return s.done(),{simplex:q,iterations:y,distance:0,maxIterationsReached:!0}}return s.done(),m={overlap:n,simplex:q,iterations:y},p!==!1&&(m.distance=p,m.closest=e(q)),m};c.gjk=f}(),function(){var a=function b(a,d,e){return this instanceof b?(this.v=c.vector(),this.o=c.vector(),a instanceof b?(this.clone(a),void 0):(a&&this.setTranslation(a),this.setRotation(d||0,e),void 0)):new b(a,d)};a.prototype.setTranslation=function(a){return this.v.clone(a),this},a.prototype.setRotation=function(a,b){return this.cosA=Math.cos(a),this.sinA=Math.sin(a),b?this.o.clone(b):this.o.zero(),this},a.prototype.clone=function(b){return b?(this.setTranslation(b.v),this.cosA=b.cosA,this.sinA=b.sinA,this.o.clone(b.o),this):new a(this)},c.transform=a}(),function(a){var b=Math.sqrt,d=Math.min,e=Math.max,f=(Math.acos,Math.atan2),g=2*Math.PI,h=!!a.Float64Array,i=function j(a,b){return this instanceof j?(this._=h?new Float64Array(5):[],a&&(void 0!==a.x||a._&&a._.length)?this.clone(a):(this.recalc=!0,this.set(a||0,b||0)),void 0):new j(a,b)};i.prototype.set=function(a,b){return this.recalc=!0,this._[0]=a||0,this._[1]=b||0,this},i.prototype.get=function(a){return this._[a]},i.prototype.vadd=function(a){return this.recalc=!0,this._[0]+=a._[0],this._[1]+=a._[1],this},i.prototype.vsub=function(a){return this.recalc=!0,this._[0]-=a._[0],this._[1]-=a._[1],this},i.prototype.add=function(a,b){return this.recalc=!0,this._[0]+=a,this._[1]+=void 0===b?a:b,this},i.prototype.sub=function(a,b){return this.recalc=!0,this._[0]-=a,this._[1]-=void 0===b?a:b,this},i.prototype.mult=function(a){return this.recalc||(this._[4]*=a*a,this._[3]*=a),this._[0]*=a,this._[1]*=a,this},i.prototype.dot=function(a){return this._[0]*a._[0]+this._[1]*a._[1]},i.prototype.cross=function(a){return-this._[0]*a._[1]+this._[1]*a._[0]},i.prototype.proj=function(a){return this.dot(a)/a.norm()},i.prototype.vproj=function(a){var b=this.dot(a)/a.normSq();return this.clone(a).mult(b)},i.prototype.angle=function(a){var b;if(this.equals(i.zero))return a?a.angle():0/0;for(b=a&&!a.equals(i.zero)?f(this._[1]*a._[0]-this._[0]*a._[1],this._[0]*a._[0]+this._[1]*a._[1]):f(this._[1],this._[0]);b>Math.PI;)b-=g;for(;b<-Math.PI;)b+=g;return b},i.prototype.angle2=function(a,b){for(var c=a._[0]-this._[0],d=a._[1]-this._[1],e=b._[0]-this._[0],h=b._[1]-this._[1],i=f(d*e-c*h,c*e+d*h);i>Math.PI;)i-=g;for(;i<-Math.PI;)i+=g;return i},i.prototype.norm=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=b(this._[4])),this._[3]},i.prototype.normSq=function(){return this.recalc&&(this.recalc=!1,this._[4]=this._[0]*this._[0]+this._[1]*this._[1],this._[3]=b(this._[4])),this._[4]},i.prototype.dist=function(a){var c,d;return b((c=a._[0]-this._[0])*c+(d=a._[1]-this._[1])*d)},i.prototype.distSq=function(a){var b,c;return(b=a._[0]-this._[0])*b+(c=a._[1]-this._[1])*c},i.prototype.perp=function(a){var b=this._[0];return a?(this._[0]=-this._[1],this._[1]=b):(this._[0]=this._[1],this._[1]=-b),this},i.prototype.normalize=function(){var a=this.norm();return 0===a?this:(a=1/a,this._[0]*=a,this._[1]*=a,this._[3]=1,this._[4]=1,this)},i.prototype.transform=function(a){var b=a.sinA,c=a.cosA,d=a.o._[0],e=a.o._[1];return this._[0]-=d,this._[1]-=e,this.set(this._[0]*c-this._[1]*b+d+a.v._[0],this._[0]*b+this._[1]*c+e+a.v._[1])},i.prototype.transformInv=function(a){var b=a.sinA,c=a.cosA,d=a.o._[0],e=a.o._[1];return this._[0]-=d+a.v._[0],this._[1]-=e+a.v._[1],this.set(this._[0]*c+this._[1]*b+d,-this._[0]*b+this._[1]*c+e)},i.prototype.rotate=function(a,b){var c,d,e=0,f=0;return"number"==typeof a?(c=Math.sin(a),d=Math.cos(a),b&&(e=0|(b.x||b._[0]),f=0|(b.y||b._[1]))):(c=a.sinA,d=a.cosA,e=a.o._[0],f=a.o._[1]),this._[0]-=e,this._[1]-=f,this.set(this._[0]*d-this._[1]*c+e,this._[0]*c+this._[1]*d+f)},i.prototype.rotateInv=function(a){return this.set((this._[0]-a.o._[0])*a.cosA+(this._[1]-a.o._[1])*a.sinA+a.o._[0],-(this._[0]-a.o._[0])*a.sinA+(this._[1]-a.o._[1])*a.cosA+a.o._[1])},i.prototype.translate=function(a){return this.vadd(a.v)},i.prototype.translateInv=function(a){return this.vsub(a.v)},i.prototype.clone=function(a){return a?a._?(this.recalc=a.recalc,a.recalc||(this._[3]=a._[3],this._[4]=a._[4]),this._[0]=a._[0],this._[1]=a._[1],this):this.set(a.x,a.y):new i(this)},i.prototype.swap=function(a){var b=this._;return this._=a._,a._=b,b=this.recalc,this.recalc=a.recalc,a.recalc=b,this},i.prototype.values=function(){return{x:this._[0],y:this._[1]}},i.prototype.zero=function(){return this._[3]=0,this._[4]=0,this._[0]=0,this._[1]=0,this},i.prototype.negate=function(a){return void 0!==a?(this._[a]=-this._[a],this):(this._[0]=-this._[0],this._[1]=-this._[1],this)},i.prototype.clamp=function(a,b){return a=a.values?a.values():a,b=b.values?b.values():b,this._[0]=d(e(this._[0],a.x),b.x),this._[1]=d(e(this._[1],a.y),b.y),this.recalc=!0,this},i.prototype.toString=function(){return"("+this._[0]+", "+this._[1]+")"},i.prototype.equals=function(a){return this._[0]===a._[0]&&this._[1]===a._[1]&&this._[2]===a._[2]},i.vadd=function(a,b){return new i(a._[0]+b._[0],a._[1]+b._[1])},i.vsub=function(a,b){return new i(a._[0]-b._[0],a._[1]-b._[1])},i.mult=function(a,b){return new i(b._[0]*a,b._[1]*a)},i.vproj=function(a,b){return i.mult(a.dot(b)/b.normSq(),b)},i.axis=[new i(1,0),new i(0,1)],i.zero=new i(0,0),c.vector=i}(this),function(){c.behavior=c.behaviour=d("behavior",{priority:0,init:function(){this.options={}},connect:function(a){this.behave&&a.subscribe("integrate:positions",this.behave,this,this.priority)},disconnect:function(a){this.behave&&a.unsubscribe("integrate:positions",this.behave)},behave:null})}(),function(){var a={fixed:!1,mass:1,restitution:1,cof:.8,view:null};c.body=d("body",{init:function(b){var d=c.vector;if(this.options=c.util.extend({},a,b),this.fixed=this.options.fixed,this.hidden=this.options.hidden,this.mass=this.options.mass,this.restitution=this.options.restitution,this.cof=this.options.cof,this.view=this.options.view,this.state={pos:d(b.x,b.y),vel:d(b.vx,b.vy),acc:d(),angular:{pos:b.angle||0,vel:b.angularVelocity||0,acc:0},old:{pos:d(),vel:d(),acc:d(),angular:{pos:0,vel:0,acc:0}}},0===this.mass)throw"Error: Bodies must have non-zero mass";this.geometry=c.geometry("point")},accelerate:function(a){return this.state.acc.vadd(a),this},applyForce:function(a,b){var d,e=c.scratchpad(),f=e.vector();return b?this.moi&&(d=this.state,f.clone(b),this.state.angular.acc-=f.cross(a)/this.moi,this.applyForce(a)):this.accelerate(f.clone(a).mult(1/this.mass)),e.done(),this},aabb:function(){var a=c.scratchpad(),b=a.transform(),d=this.state.angular.pos,e=a.aabb().set(this.geometry.aabb(d));return b.setRotation(0).setTranslation(this.state.pos),e.transform(b),e=e.get(),a.done(),e},recalc:function(){}})}(),function(){c.geometry=d("geometry",{init:function(){this._aabb=new c.aabb},aabb:function(){return this._aabb.get()},getFarthestHullPoint:function(a,b){return b=b||c.vector(),b.set(0,0)},getFarthestCorePoint:function(a,b){return b=b||c.vector(),b.set(0,0)}})}(),c.geometry.isPolygonConvex=function(a){var b=c.scratchpad(),d=b.vector(),e=b.vector(),f=b.vector(),g=!0,h=!1,i=a.length;if(!a||!i)return!1;if(3>i)return b.done(),g;d.clone(a[0]).vsub(f.clone(a[i-1]));for(var j=1;i>=j;++j){if(e.clone(a[j%i]).vsub(f.clone(a[(j-1)%i])),h===!1)h=d.cross(e);else if(h>0^d.cross(e)>0){g=!1;break}e.swap(d)}return b.done(),g},c.geometry.getPolygonMOI=function(a){var b,d=c.scratchpad(),e=d.vector(),f=d.vector(),g=0,h=0,i=a.length;if(2>i)return d.done(),0;if(2===i)return b=f.clone(a[1]).distSq(e.clone(a[0])),d.done(),b/12;e.clone(a[0]);for(var j=1;i>j;++j)f.clone(a[j]),b=Math.abs(f.cross(e)),g+=b*(f.normSq()+f.dot(e)+e.normSq()),h+=b,e.swap(f);return d.done(),g/(6*h)},c.geometry.isPointInPolygon=function(a,b){var d=c.scratchpad(),e=d.vector().clone(a),f=d.vector(),g=d.vector(),h=0,i=b.length;if(2>i)return h=e.equals(f.clone(b[0])),d.done(),h;if(2===i)return h=e.angle(f.clone(b[0])),h+=e.angle(f.clone(b[1])),d.done(),Math.abs(h)===Math.PI;f.clone(b[0]).vsub(e);for(var j=1;i>=j;++j)g.clone(b[j%i]).vsub(e),h+=g.angle(f),f.swap(g);return d.done(),Math.abs(h)>1e-6},c.geometry.getPolygonArea=function(a){var b=c.scratchpad(),d=b.vector(),e=b.vector(),f=0,g=a.length;if(3>g)return b.done(),0;d.clone(a[g-1]);for(var h=0;g>h;++h)e.clone(a[h]),f+=d.cross(e),d.swap(e);return b.done(),f/2},c.geometry.getPolygonCentroid=function(a){var b,d=c.scratchpad(),e=d.vector(),f=d.vector(),g=c.vector(),h=a.length;if(2>h)return d.done(),c.vector(a[0]);if(2===h)return d.done(),c.vector((a[1].x+a[0].x)/2,(a[1].y+a[0].y)/2);e.clone(a[h-1]);for(var i=0;h>i;++i)f.clone(a[i]),b=e.cross(f),e.vadd(f).mult(b),g.vadd(e),e.swap(f);return b=1/(6*c.geometry.getPolygonArea(a)),d.done(),g.mult(b)},c.geometry.nearestPointOnLine=function(a,b,d){var e,f,g=c.scratchpad(),h=g.vector().clone(a),i=g.vector().clone(b).vsub(h),j=g.vector().clone(d).vsub(h).vsub(i);return j.equals(c.vector.zero)?(g.done(),c.vector(b)):(e=-j.dot(i)/j.normSq(),f=1-e,0>=f?(g.done(),c.vector(d)):0>=e?(g.done(),c.vector(b)):(h=c.vector(d).mult(e).vadd(i.clone(b).mult(f)),g.done(),h))},function(){var a={drag:0};c.integrator=d("integrator",{init:function(b){this.options=c.util.extend({},a,b)},integrate:function(a,b){var c=this._world;return this.integrateVelocities(a,b),c&&c.publish({topic:"integrate:velocities",bodies:a,dt:b}),this.integratePositions(a,b),c&&c.publish({topic:"integrate:positions",bodies:a,dt:b}),this},integrateVelocities:function(){throw"The integrator.integrateVelocities() method must be overriden"},integratePositions:function(){throw"The integrator.integratePositions() method must be overriden"}})}(),function(){var a={meta:!1,metaRefresh:200,width:600,height:600};c.renderer=d("renderer",{init:function(d){var e="string"==typeof d.el?b.getElementById(d.el):d.el;this.options=c.util.extend({},a,d),this.el=e?e:b.body,this.drawMeta=c.util.throttle(c.util.bind(this.drawMeta,this),this.options.metaRefresh)},render:function(a,b){var c,d;this.beforeRender&&this.beforeRender(),this._world.publish({topic:"beforeRender",renderer:this,bodies:a,meta:b}),this.options.meta&&this.drawMeta(b);for(var e=0,f=a.length;f>e;++e)c=a[e],d=c.view||(c.view=this.createView(c.geometry)),c.hidden||this.drawBody(c,d);return this},createView:function(){throw"You must override the renderer.createView() method."},drawMeta:function(){throw"You must override the renderer.drawMeta() method."},drawBody:function(){throw"You must override the renderer.drawBody() method."}})}(),function(){var a=function(a){this.disconnect&&this._world&&this.disconnect(this._world),this._world=a,this.connect&&a&&this.connect(a)};c.util.each("body,behavior,integrator,renderer".split(","),function(b){c[b].mixin("setWorld",a)});var b=function f(a,b,c){for(var d,e,g=function(){return f(a,b,c)};d=a.shift();)if(e=d.apply(b,c),e&&e.then)return e.then(g)},d={timestep:6.25,maxIPF:16,webworker:!1,integrator:"verlet"},e=function g(a,b){return this instanceof g?(this.init(a,b),void 0):new g(a,b)};e.prototype=c.util.extend({},c.util.pubsub.prototype,{init:function(a,d){(c.util.isFunction(a)||c.util.isArray(a))&&(d=a,a={}),this._stats={fps:0,ipf:0},this._bodies=[],this._behaviors=[],this._integrator=null,this._renderer=null,this._paused=!1,this._opts={},this.initPubsub(this),this.options(a||{}),c.util.isFunction(d)?b([d],this,[this,c]):c.util.isArray(d)&&b(d,this,[this,c])},options:function(a){return a?(c.util.extend(this._opts,d,a),this.timeStep(this._opts.timestep),this.add(c.integrator(this._opts.integrator)),this):c.util.clone(this._opts)},add:function(a){var b=0,c=a&&a.length||0,d=c?a[0]:a;if(!d)return this;do switch(d.type){case"behavior":this.addBehavior(d);break;case"integrator":this.integrator(d);break;case"renderer":this.renderer(d);break;case"body":this.addBody(d);break;default:throw'Error: failed to add item of unknown type "'+d.type+'" to world'}while(++b<c&&(d=a[b]));return this},remove:function(a){var b=0,c=a&&a.length||0,d=c?a[0]:a;if(!d)return this;do switch(d.type){case"behavior":this.removeBehavior(d);break;case"integrator":d===this._integrator&&this.integrator(null);break;case"renderer":d===this._renderer&&this.renderer(null);break;case"body":this.removeBody(d);break;default:throw'Error: failed to remove item of unknown type "'+d.type+'" from world'}while(++b<c&&(d=a[b]));return this},has:function(a){var b,c,d;if(!a)return!1;switch(a.type){case"behavior":b=this._behaviors;break;case"integrator":return this._integrator===a;case"renderer":return this._renderer===a;case"body":b=this._bodies;break;default:throw'Error: unknown type "'+a.type+'"'}for(c=0,d=b.length;d>c;++c)if(a===b[c])return!0;return!1},integrator:function(a){var b;return void 0===a?this._integrator:this._integrator===a?this:(this._integrator&&(this._integrator.setWorld(null),b={topic:"remove:integrator",integrator:this._integrator},this.publish(b)),a&&(this._integrator=a,this._integrator.setWorld(this),b={topic:"add:integrator",integrator:this._integrator},this.publish(b)),this)
},renderer:function(a){var b;return void 0===a?this._renderer:this._renderer===a?this:(this._renderer&&(this._renderer.setWorld(null),b={topic:"remove:renderer",renderer:this._renderer},this.publish(b)),a&&(this._renderer=a,this._renderer.setWorld(this),b={topic:"add:renderer",renderer:this._renderer},this.publish(b)),this)},timeStep:function(a){return a?(this._dt=a,this._maxJump=a*this._opts.maxIPF,this):this._dt},addBehavior:function(a){var b;return this.has(a)?this:(a.setWorld(this),this._behaviors.push(a),b={topic:"add:behavior",behavior:a},this.publish(b),this)},getBehaviors:function(){return[].concat(this._behaviors)},removeBehavior:function(a){var b,c=this._behaviors;if(a)for(var d=0,e=c.length;e>d;++d)if(a===c[d]){c.splice(d,1),a.setWorld(null),b={topic:"remove:behavior",behavior:a},this.publish(b);break}return this},addBody:function(a){var b;return this.has(a)?this:(a.setWorld(this),this._bodies.push(a),b={topic:"add:body",body:a},this.publish(b),this)},getBodies:function(){return[].concat(this._bodies)},removeBody:function(a){var b,c=this._bodies;if(a)for(var d=0,e=c.length;e>d;++d)if(a===c[d]){c.splice(d,1),a.setWorld(null),b={topic:"remove:body",body:a},this.publish(b);break}return this},findOne:function(a){var b={check:function(a){for(var b=this;b=b.next;)if(b(a))return!0;return!1}},d=b,e=this._bodies;a.$within,a.$at&&(d.next=function(b){var d=b.aabb();return c.aabb.contains(d,a.$at)});for(var f=0,g=e.length;g>f;++f)if(b.check(e[f]))return e[f];return!1},iterate:function(a){this._integrator.integrate(this._bodies,a)},step:function(a){if(this._paused)return this._time=!1,this;var b=this._time||(this._time=a),c=a-b,d=this._stats,e=this._dt;if(!c)return this;for(c>this._maxJump&&(this._time=a-this._maxJump,c=this._maxJump),d.fps=1e3/c,d.ipf=Math.ceil(c/this._dt);this._time<a;)this._time+=e,this.iterate(e);return this.publish({topic:"step"}),this},render:function(){if(!this._renderer)throw"No renderer added to world";return this._renderer.render(this._bodies,this._stats),this.publish({topic:"render",bodies:this._bodies,stats:this._stats,renderer:this._renderer}),this},pause:function(){return this._paused=!0,this.publish({topic:"pause"}),this},unpause:function(){return this._paused=!1,this.publish({topic:"unpause"}),this},isPaused:function(){return!!this._paused},destroy:function(){var a=this;a.pause(),this.publish("destroy"),a.unsubscribe(!0),a.remove(a.getBodies()),a.remove(a.getBehaviors()),a.integrator(null),a.renderer(null)}}),c.world=e}(),c.integrator("verlet",function(a){return c.body.mixin({started:function(a){return void 0!==a&&(this._started=!0),!!this._started}}),{init:function(b){a.init.call(this,b)},integrateVelocities:function(a,b){for(var c,d=b*b,e=1-this.options.drag,f=null,g=0,h=a.length;h>g;++g)f=a[g],c=f.state,f.fixed?(c.vel.zero(),c.acc.zero(),c.angular.vel=0,c.angular.acc=0):(c.vel.equals(c.old.vel)&&f.started()?c.vel.clone(c.pos).vsub(c.old.pos):(c.old.pos.clone(c.pos).vsub(c.vel),c.vel.mult(b)),e&&c.vel.mult(e),c.vel.vadd(c.acc.mult(d)),c.vel.mult(1/b),c.old.vel.clone(c.vel),c.acc.zero(),c.angular.vel===c.old.angular.vel&&f.started()?c.angular.vel=c.angular.pos-c.old.angular.pos:(c.old.angular.pos=c.angular.pos-c.angular.vel,c.angular.vel*=b),c.angular.vel+=c.angular.acc*d,c.angular.vel/=b,c.old.angular.vel=c.angular.vel,c.angular.acc=0,f.started(!0))},integratePositions:function(a,b){for(var c,d=null,e=0,f=a.length;f>e;++e)d=a[e],c=d.state,d.fixed||(c.vel.mult(b),c.old.pos.clone(c.pos),c.pos.vadd(c.vel),c.vel.mult(1/b),c.old.vel.clone(c.vel),c.angular.vel*=b,c.old.angular.pos=c.angular.pos,c.angular.pos+=c.angular.vel,c.angular.vel/=b,c.old.angular.vel=c.angular.vel)}}}),c.geometry("point",function(){}),c});